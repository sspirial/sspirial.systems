var vM=Object.defineProperty;var K0=e=>{throw TypeError(e)};var EM=(e,t,n)=>t in e?vM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var d=(e,t,n)=>EM(e,typeof t!="symbol"?t+"":t,n),B_=(e,t,n)=>t.has(e)||K0("Cannot "+n);var xe=(e,t,n)=>(B_(e,t,"read from private field"),n?n.call(e):t.get(e)),Vr=(e,t,n)=>t.has(e)?K0("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Gd=(e,t,n,r)=>(B_(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),nt=(e,t,n)=>(B_(e,t,"access private method"),n);const kM=e=>typeof e=="function",y=function(e,t){if(typeof e=="function")return function(){return e(arguments)?t.apply(this,arguments):n=>t(n,...arguments)};switch(e){case 0:case 1:throw new RangeError(`Invalid arity ${e}`);case 2:return function(n,r){return arguments.length>=2?t(n,r):function(s){return t(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?t(n,r,s):function(o){return t(o,n,r)}};case 4:return function(n,r,s,o){return arguments.length>=4?t(n,r,s,o):function(a){return t(a,n,r,s)}};case 5:return function(n,r,s,o,a){return arguments.length>=5?t(n,r,s,o,a):function(u){return t(u,n,r,s,o)}};default:return function(){if(arguments.length>=e)return t.apply(this,arguments);const n=arguments;return function(r){return t(r,...n)}}}},ce=e=>e,pp=e=>()=>e,J0=pp(!0),Yn=pp(!1),o1=pp(void 0),jl=o1;function v(e,t,n,r,s,o,a,u,f){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return s(r(n(t(e))));case 6:return o(s(r(n(t(e)))));case 7:return a(o(s(r(n(t(e))))));case 8:return u(a(o(s(r(n(t(e)))))));case 9:return f(u(a(o(s(r(n(t(e))))))));default:{let h=arguments[0];for(let p=1;p<arguments.length;p++)h=arguments[p](h);return h}}}const Bf=e=>(t,n)=>t===n||e(t,n),$M=(e,t)=>e===t,CM=()=>$M,TM=CM(),i1=y(2,(e,t)=>Bf((n,r)=>e(t(n),t(r)))),IM=i1(TM,e=>e.getTime()),RM=e=>Bf((t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0});let OM="3.15.2";const gp=()=>OM,Qd=`effect/GlobalValue/globalStoreId/${gp()}`;let tl;const Te=(e,t)=>(tl||(globalThis[Qd]??(globalThis[Qd]=new Map),tl=globalThis[Qd]),tl.has(e)||tl.set(e,t()),tl.get(e)),qM=e=>e instanceof Set,Pn=e=>typeof e=="string",mo=e=>typeof e=="number",na=e=>typeof e=="boolean",_p=e=>typeof e=="bigint",Kh=e=>typeof e=="symbol",du=kM,AM=e=>e===void 0,PM=e=>!1,DS=e=>typeof e=="object"&&e!==null,Ls=e=>DS(e)||du(e),ne=y(2,(e,t)=>Ls(e)&&t in e),yp=y(2,(e,t)=>ne(e,"_tag")&&e._tag===t),Ga=e=>e==null,FM=e=>e!=null,xM=e=>e instanceof Uint8Array,a1=e=>e instanceof Date,MS=e=>ne(e,Symbol.iterator),NM=e=>DS(e)&&!Array.isArray(e),c1=e=>ne(e,"then")&&du(e.then),bp=e=>`BUG: ${e} - please report an issue at https://github.com/Effect-TS/effect/issues`;let u1=class l1{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new l1(this.self)}};const DM=335903614,MM=4150755663,LM=1481765933,jM=1284865837,UM=9007199254740992,zM=134217728;class BM{constructor(t,n,r,s){d(this,"_state");return Ga(n)&&Ga(t)?(n=Math.random()*4294967295>>>0,t=0):Ga(n)&&(n=t,t=0),Ga(s)&&Ga(r)?(s=this._state?this._state[3]:MM,r=this._state?this._state[2]:DM):Ga(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),G0(this._state,this._state[0],this._state[1],t>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(t){this._state[0]=t[0],this._state[1]=t[1],this._state[2]=t[2],this._state[3]=t[3]|1}integer(t){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%t}number(){const t=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(t*zM+n)/UM}_next(){const t=this._state[0]>>>0,n=this._state[1]>>>0;HM(this._state,t,n,LM,jM),G0(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=t>>>18,s=(n>>>18|t<<14)>>>0;r=(r^t)>>>0,s=(s^n)>>>0;const o=(s>>>27|r<<5)>>>0,a=t>>>27,u=(-a>>>0&31)>>>0;return(o>>>a|o<<u)>>>0}}function HM(e,t,n,r,s){let o=(n>>>16)*(s&65535)>>>0,a=(n&65535)*(s>>>16)>>>0,u=(n&65535)*(s&65535)>>>0,f=(n>>>16)*(s>>>16)+((a>>>16)+(o>>>16))>>>0;a=a<<16>>>0,u=u+a>>>0,u>>>0<a>>>0&&(f=f+1>>>0),o=o<<16>>>0,u=u+o>>>0,u>>>0<o>>>0&&(f=f+1>>>0),f=f+Math.imul(n,r)>>>0,f=f+Math.imul(t,s)>>>0,e[0]=f,e[1]=u}function G0(e,t,n,r,s){let o=t+r>>>0;const a=n+s>>>0;a>>>0<n>>>0&&(o=o+1|0),e[0]=o,e[1]=a}const Fy=Symbol.for("effect/Utils/YieldWrap");var Uf;class hu{constructor(t){Vr(this,Uf);Gd(this,Uf,t)}[Fy](){return xe(this,Uf)}}Uf=new WeakMap;function f1(e){if(typeof e=="object"&&e!==null&&Fy in e)return e[Fy]();throw new Error(bp("yieldWrapGet"))}const $r=Te("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),d1={effect_internal_function:e=>e()},VM={effect_internal_function:e=>{try{return e()}finally{}}};var fT;const WM=((fT=d1.effect_internal_function(()=>new Error().stack))==null?void 0:fT.includes("effect_internal_function"))===!0,gt=WM?d1.effect_internal_function:VM.effect_internal_function,KM=(function*(){}).constructor,JM=e=>Ls(e)&&e.constructor===KM,H_=Te(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),_e=Symbol.for("effect/Hash"),Q=e=>{if($r.enabled===!0)return 0;switch(typeof e){case"number":return LS(e);case"bigint":return Tt(e.toString(10));case"boolean":return Tt(String(e));case"symbol":return Tt(String(e));case"string":return Tt(e);case"undefined":return Tt("undefined");case"function":case"object":return e===null?Tt("null"):e instanceof Date?Q(e.toISOString()):e instanceof URL?Q(e.href):GM(e)?e[_e]():Sp(e);default:throw new Error(`BUG: unhandled typeof ${typeof e} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},Sp=e=>(H_.has(e)||H_.set(e,LS(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),H_.get(e)),fe=e=>t=>t*53^e,wp=e=>e&3221225471|e>>>1&1073741824,GM=e=>ne(e,_e),LS=e=>{if(e!==e||e===1/0)return 0;let t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)t^=e/=4294967295;return wp(t)},Tt=e=>{let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return wp(t)},QM=(e,t)=>{let n=12289;for(let r=0;r<t.length;r++)n^=v(Tt(t[r]),fe(Q(e[t[r]])));return wp(n)},h1=e=>QM(e,Object.keys(e)),Hf=e=>{let t=6151;for(let n=0;n<e.length;n++)t=v(t,fe(Q(e[n])));return wp(t)},ct=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,_e,{value(){return r},enumerable:!1}),r}}const e=arguments[0],t=arguments[1];return Object.defineProperty(e,_e,{value(){return t},enumerable:!1}),t},ye=Symbol.for("effect/Equal");function me(){return arguments.length===1?e=>Jh(e,arguments[0]):Jh(arguments[0],arguments[1])}function Jh(e,t){if(e===t)return!0;const n=typeof e;if(n!==typeof t)return!1;if(n==="object"||n==="function"){if(e!==null&&t!==null){if(Ul(e)&&Ul(t))return Q(e)===Q(t)&&e[ye](t)?!0:$r.enabled&&$r.tester?$r.tester(e,t):!1;if(e instanceof Date&&t instanceof Date)return e.toISOString()===t.toISOString();if(e instanceof URL&&t instanceof URL)return e.href===t.href}if($r.enabled){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((r,s)=>Jh(r,t[s]));if(Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){const r=Object.keys(e),s=Object.keys(t);if(r.length===s.length){for(const o of r)if(!(o in t&&Jh(e[o],t[o])))return $r.tester?$r.tester(e,t):!1;return!0}}return $r.tester?$r.tester(e,t):!1}}return $r.enabled&&$r.tester?$r.tester(e,t):!1}const Ul=e=>ne(e,ye),jS=()=>me,Be=Symbol.for("nodejs.util.inspect.custom"),Ot=e=>{try{if(ne(e,"toJSON")&&du(e.toJSON)&&e.toJSON.length===0)return e.toJSON();if(Array.isArray(e))return e.map(Ot)}catch{return{}}return sa(e)},dt=e=>JSON.stringify(e,null,2),vp={toJSON(){return Ot(this)},[Be](){return this.toJSON()},toString(){return dt(this.toJSON())}};let YM=class{[Be](){return this.toJSON()}toString(){return dt(this.toJSON())}};const ra=(e,t=2)=>{if(typeof e=="string")return e;try{return typeof e=="object"?m1(e,t):String(e)}catch{return String(e)}},m1=(e,t)=>{let n=[];const r=JSON.stringify(e,(s,o)=>typeof o=="object"&&o!==null?n.includes(o)?void 0:n.push(o)&&(Vi.fiberRefs!==void 0&&p1(o)?o[Ep](Vi.fiberRefs):o):o,t);return n=void 0,r},Ep=Symbol.for("effect/Inspectable/Redactable"),p1=e=>typeof e=="object"&&e!==null&&Ep in e,Vi=Te("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),XM=(e,t)=>{const n=Vi.fiberRefs;Vi.fiberRefs=e;try{return t()}finally{Vi.fiberRefs=n}},sa=e=>p1(e)&&Vi.fiberRefs!==void 0?e[Ep](Vi.fiberRefs):e,ee=(e,t)=>{switch(t.length){case 0:return e;case 1:return t[0](e);case 2:return t[1](t[0](e));case 3:return t[2](t[1](t[0](e)));case 4:return t[3](t[2](t[1](t[0](e))));case 5:return t[4](t[3](t[2](t[1](t[0](e)))));case 6:return t[5](t[4](t[3](t[2](t[1](t[0](e))))));case 7:return t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))));case 8:return t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e))))))));case 9:return t[8](t[7](t[6](t[5](t[4](t[3](t[2](t[1](t[0](e)))))))));default:{let n=e;for(let r=0,s=t.length;r<s;r++)n=t[r](n);return n}}},kl="Async",Vf="Commit",dn="Failure",yh="OnFailure",Gh="OnSuccess",Qh="OnSuccessAndFailure",hn="Success",g1="Sync",ZM="Tag",mu="UpdateRuntimeFlags",Yh="While",$l="Iterator",_1="WithRuntime",bh="Yield",US="RevertFlags",eL=Symbol.for("effect/Effect"),xy=Symbol.for("effect/Stream"),tL=Symbol.for("effect/Sink"),nL=Symbol.for("effect/Channel"),oa={_R:e=>e,_E:e=>e,_A:e=>e,_V:gp()},rL={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e},sL={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},Wf={[eL]:oa,[xy]:oa,[tL]:rL,[nL]:sL,[ye](e){return this===e},[_e](){return ct(this,Sp(this))},[Symbol.iterator](){return new u1(new hu(this))},pipe(){return ee(this,arguments)}},zS={[_e](){return ct(this,h1(this))},[ye](e){const t=Object.keys(this),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t)if(!(r in e&&me(this[r],e[r])))return!1;return!0}},Kf={...Wf,_op:Vf},oL={...Kf,...zS},iL=(function(){function e(){}return e.prototype=Kf,e})(),y1=Symbol.for("effect/Option"),b1={...Wf,[y1]:{_A:e=>e},[Be](){return this.toJSON()},toString(){return dt(this.toJSON())}},aL=Object.assign(Object.create(b1),{_tag:"Some",_op:"Some",[ye](e){return BS(e)&&w1(e)&&me(this.value,e.value)},[_e](){return ct(this,fe(Q(this._tag))(Q(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:Ot(this.value)}}}),cL=Q("None"),uL=Object.assign(Object.create(b1),{_tag:"None",_op:"None",[ye](e){return BS(e)&&S1(e)},[_e](){return cL},toJSON(){return{_id:"Option",_tag:this._tag}}}),BS=e=>ne(e,y1),S1=e=>e._tag==="None",w1=e=>e._tag==="Some",v1=Object.create(uL),Ny=e=>{const t=Object.create(aL);return t.value=e,t},E1=Symbol.for("effect/Either"),k1={...Wf,[E1]:{_R:e=>e},[Be](){return this.toJSON()},toString(){return dt(this.toJSON())}},lL=Object.assign(Object.create(k1),{_tag:"Right",_op:"Right",[ye](e){return HS(e)&&C1(e)&&me(this.right,e.right)},[_e](){return fe(Q(this._tag))(Q(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:Ot(this.right)}}}),fL=Object.assign(Object.create(k1),{_tag:"Left",_op:"Left",[ye](e){return HS(e)&&$1(e)&&me(this.left,e.left)},[_e](){return fe(Q(this._tag))(Q(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:Ot(this.left)}}}),HS=e=>ne(e,E1),$1=e=>e._tag==="Left",C1=e=>e._tag==="Right",dL=e=>{const t=Object.create(fL);return t.left=e,t},hL=e=>{const t=Object.create(lL);return t.right=e,t},le=hL,ae=dL,VS=e=>{if(du(e))try{return le(e())}catch(t){return ae(t)}else try{return le(e.try())}catch(t){return ae(e.catch(t))}},T1=HS,on=$1,bs=C1,mL=y(2,(e,{onLeft:t,onRight:n})=>on(e)?ae(t(e.left)):le(n(e.right))),ia=y(2,(e,t)=>on(e)?ae(t(e.left)):le(e.right)),pL=y(2,(e,t)=>bs(e)?le(t(e.right)):ae(e.left)),un=y(2,(e,{onLeft:t,onRight:n})=>on(e)?t(e.left):n(e.right)),gL=un({onLeft:ce,onRight:ce}),I1=y(2,(e,t)=>{if(bs(e))return e.right;throw t(e.left)}),_L=I1(()=>new Error("getOrThrow called on a Left")),WS=e=>e.length>0,R1=e=>(t,n)=>t===n?0:e(t,n),yL=R1((e,t)=>e<t?-1:1),O1=y(2,(e,t)=>R1((n,r)=>e(t(n),t(r)))),bL=e=>y(2,(t,n)=>e(t,n)===1),V=()=>v1,W=Ny,SL=BS,Ft=S1,lt=w1,ot=y(2,(e,{onNone:t,onSome:n})=>Ft(e)?t():n(e.value)),Et=y(2,(e,t)=>Ft(e)?t():e.value),ro=y(2,(e,t)=>Ft(e)?t():e),wL=y(2,(e,t)=>Ft(e)?W(t()):e),Ta=e=>e==null?V():W(e),hr=Et(o1),vL=e=>(...t)=>{try{return W(e(...t))}catch{return V()}},Zo=y(2,(e,t)=>Ft(e)?V():W(t(e.value))),pu=y(2,(e,t)=>Ft(e)?V():t(e.value)),EL=y(2,(e,t)=>Ft(e)?V():Ta(t(e.value))),kL=pu(ce),$L=e=>Bf((t,n)=>Ft(t)?Ft(n):Ft(n)?!1:e(t.value,n.value)),CL=e=>y(2,(t,n)=>Ft(t)?!1:e(t.value,n)),TL=jS(),IL=CL(TL),RL=y(2,(e,t)=>Ft(e)?!1:t(e.value)),Q0=e=>(t,n)=>Ft(t)?n:Ft(n)?t:W(e(t.value,n.value)),OL=(...e)=>e,qL=e=>{const n=e[Symbol.iterator]().next();if(n.done)throw new Error("unsafeHead: empty iterable");return n.value},AL=y(2,(e,t)=>{let n=0;for(const r of e){const s=t(r,n);if(na(s)){if(s)return W(r)}else if(lt(s))return s;n++}return V()}),PL={[Symbol.iterator](){return FL}},FL={next(){return{done:!0,value:void 0}}},q1=()=>PL,xL=y(2,(e,t)=>({[Symbol.iterator](){const n=e[Symbol.iterator]();let r=0;return{next(){const s=n.next();return s.done?{done:!0,value:void 0}:{done:!1,value:t(s.value,r++)}}}}})),NL=y(2,(e,t)=>{const n={...e};for(const r of DL(e))n[r]=t(e[r],r);return n}),DL=e=>Object.keys(e),kp=e=>new Array(e),ML=y(2,(e,t)=>{const n=Math.max(1,Math.floor(e)),r=new Array(n);for(let s=0;s<n;s++)r[s]=t(s);return r}),ze=e=>Array.isArray(e)?e:Array.from(e),KS=e=>Array.isArray(e)?e:[e],LL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>bt(e)?n(e):t()),jL=y(2,(e,{onEmpty:t,onNonEmpty:n})=>bt(e)?n(Un(e),aa(e)):t()),Xh=y(2,(e,t)=>[t,...e]),UL=y(2,(e,t)=>[...e,t]),$p=y(2,(e,t)=>ze(e).concat(ze(t))),zL=Array.isArray,BL=e=>e.length===0,HL=BL,Sh=WS,bt=WS,A1=(e,t)=>e<0||e>=t.length,VL=(e,t)=>Math.floor(Math.min(Math.max(0,e),t.length)),WL=y(2,(e,t)=>{const n=Math.floor(t);return A1(n,e)?V():W(e[n])}),P1=y(2,(e,t)=>{const n=Math.floor(t);if(A1(n,e))throw new Error(`Index ${n} out of bounds`);return e[n]}),yc=WL(0),Un=P1(0),KL=e=>bt(e)?W(F1(e)):V(),F1=e=>e[e.length-1],aa=e=>e.slice(1),x1=(e,t)=>{let n=0;for(const r of e){if(!t(r,n))break;n++}return n},N1=y(2,(e,t)=>M1(e,x1(e,t))),JL=y(2,(e,t)=>{const n=ze(e);return n.slice(VL(t,n),n.length)}),GL=y(2,(e,t)=>ze(e).slice(x1(e,t))),QL=AL,Y0=e=>Array.from(e).reverse(),zl=y(2,(e,t)=>{const n=Array.from(e);return n.sort(t),n}),X0=y(2,(e,t)=>YL(e,t,OL)),YL=y(3,(e,t,n)=>{const r=ze(e),s=ze(t);if(bt(r)&&bt(s)){const o=[n(Un(r),Un(s))],a=Math.min(r.length,s.length);for(let u=1;u<a;u++)o[u]=n(r[u],s[u]);return o}return[]}),XL=e=>{const t=ze(e);if(bt(t)){const n=[t[0][0]],r=[t[0][1]];for(let s=1;s<t.length;s++)n[s]=t[s][0],r[s]=t[s][1];return[n,r]}return[[],[]]},ZL=e=>y(2,(t,n)=>{for(const r of t)if(e(n,r))return!0;return!1}),D1=jS(),ej=y(2,(e,t)=>{const n=ze(e);if(bt(n)){const[r,s]=t(n),o=[r];let a=s;for(;WS(a);){const[u,f]=t(a);o.push(u),a=f}return o}return[]}),M1=y(2,(e,t)=>{const n=Array.from(e),r=Math.floor(t);return bt(n)?r>=1?L1(n,r):[[],n]:[n,[]]}),L1=y(2,(e,t)=>{const n=Math.max(1,Math.floor(t));return n>=e.length?[fl(e),[]]:[Xh(e.slice(1,n),Un(e)),e.slice(n)]}),j1=y(2,(e,t)=>N1(e,(n,r)=>!t(n,r))),fl=e=>e.slice(),tj=y(2,(e,t)=>{const n=ze(e);return bt(n)?ej(n,L1(t)):[]}),nj=y(3,(e,t,n)=>{const r=ze(e),s=ze(t);return bt(r)?bt(s)?B1(n)($p(r,s)):r:s}),wh=y(2,(e,t)=>nj(e,t,D1)),rj=e=>{const t=ZL(e);return y(2,(n,r)=>ze(n).filter(s=>t(r,s)))},sj=rj(D1),oi=()=>[],fr=e=>[e],so=y(2,(e,t)=>e.map(t)),Zh=y(2,(e,t)=>{if(HL(e))return[];const n=[];for(let r=0;r<e.length;r++){const s=t(e[r],r);for(let o=0;o<s.length;o++)n.push(s[o])}return n}),oj=Zh(ce),U1=y(2,(e,t)=>{const n=ze(e),r=[];for(let s=0;s<n.length;s++){const o=t(n[s],s);lt(o)&&r.push(o.value)}return r}),z1=y(2,(e,t)=>{const n=ze(e),r=[];for(let s=0;s<n.length;s++)t(n[s],s)&&r.push(n[s]);return r}),JS=y(3,(e,t,n)=>ze(e).reduce((r,s,o)=>n(r,s,o),t)),Z0=(e,t)=>{const n=[];let r=e,s;for(;lt(s=t(r));){const[o,a]=s.value;n.push(o),r=a}return n},Jf=RM,B1=y(2,(e,t)=>{const n=ze(e);if(bt(n)){const r=[Un(n)],s=aa(n);for(const o of s)r.every(a=>!t(o,a))&&r.push(o);return r}return[]}),ij=e=>B1(e,jS()),Ia=y(2,(e,t)=>ze(e).join(t)),H1=(e,t)=>{switch(t._tag){case"StringKeyword":case"TemplateLiteral":return Object.keys(e);case"SymbolKeyword":return Object.getOwnPropertySymbols(e);case"Refinement":return H1(e,t.from)}},Es=e=>Object.keys(e).concat(Object.getOwnPropertySymbols(e)),V1=e=>{let t=!1,n;return()=>(t||(n=e(),t=!0),n)},W1=e=>{try{return e.toISOString()}catch{return String(e)}},xr=(e,t=!0)=>{if(Array.isArray(e))return`[${e.map(n=>xr(n,t)).join(",")}]`;if(a1(e))return W1(e);if(ne(e,"toString")&&du(e.toString)&&e.toString!==Object.prototype.toString)return e.toString();if(Pn(e))return JSON.stringify(e);if(mo(e)||e==null||na(e)||Kh(e))return String(e);if(_p(e))return String(e)+"n";if(MS(e))return`${e.constructor.name}(${xr(Array.from(e),t)})`;try{t&&JSON.stringify(e);const n=`{${Es(e).map(s=>`${Pn(s)?JSON.stringify(s):String(s)}:${xr(e[s],!1)}`).join(",")}}`,r=e.constructor.name;return e.constructor!==Object.prototype.constructor?`${r}(${n})`:n}catch{return"<circular structure>"}},GS=e=>typeof e=="string"?JSON.stringify(e):String(e),K1=e=>Array.isArray(e),aj=e=>!Array.isArray(e),ek=e=>`[${GS(e)}]`,J1=e=>K1(e)?e.map(ek).join(""):ek(e),Oo=(e,t,n,r)=>{let s=e;return n&&bt(n)&&(s+=`
at path: ${J1(n)}`),t!==void 0&&(s+=`
details: ${t}`),r&&(s+=`
schema (${r._tag}): ${r}`),s},cj=(e,t,n)=>Oo("Unsupported schema",e,t,n),G1=(e,t,n)=>Oo("Unsupported schema or overlapping types",`cannot extend ${e} with ${t}`,n),Bl=e=>cj(void 0,void 0,e),uj=e=>Oo("Unsupported key schema",void 0,void 0,e),lj=e=>Oo("Unsupported literal",`literal value: ${xr(e)}`),tk=e=>Oo("Duplicate index signature",`${e} index signature`),fj=Oo("Unsupported index signature parameter","An index signature parameter type must be `string`, `symbol`, a template literal type or a refinement of the previous types"),dj=Oo("Invalid element","A required element cannot follow an optional element. ts(1257)"),nk=e=>Oo("Duplicate property signature transformation",`Duplicate key ${xr(e)}`),Q1=e=>Oo("Duplicate property signature",`Duplicate key ${xr(e)}`),hj=Symbol.for("effect/SchemaId/DateFromSelf"),mj=Symbol.for("effect/SchemaId/GreaterThanOrEqualTo"),pj=Symbol.for("effect/SchemaId/Int"),gj=Symbol.for("effect/SchemaId/Between"),Fc=yL,em=e=>e.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),Y1=Symbol.for("effect/annotation/Brand"),_j=Symbol.for("effect/annotation/SchemaId"),X1=Symbol.for("effect/annotation/Message"),QS=Symbol.for("effect/annotation/MissingMessage"),YS=Symbol.for("effect/annotation/Identifier"),js=Symbol.for("effect/annotation/Title"),bc=Symbol.for("effect/annotation/AutoTitle"),Gf=Symbol.for("effect/annotation/Description"),Z1=Symbol.for("effect/annotation/Examples"),eR=Symbol.for("effect/annotation/Default"),tR=Symbol.for("effect/annotation/JSONSchema"),nR=Symbol.for("effect/annotation/Arbitrary"),rR=Symbol.for("effect/annotation/Pretty"),sR=Symbol.for("effect/annotation/Equivalence"),yj=Symbol.for("effect/annotation/Documentation"),oR=Symbol.for("effect/annotation/Concurrency"),iR=Symbol.for("effect/annotation/Batching"),aR=Symbol.for("effect/annotation/ParseIssueTitle"),cR=Symbol.for("effect/annotation/ParseOptions"),uR=Symbol.for("effect/annotation/DecodingFallback"),tm=Symbol.for("effect/annotation/Surrogate"),bj=Symbol.for("effect/annotation/StableFilter"),Wn=y(2,(e,t)=>Object.prototype.hasOwnProperty.call(e.annotations,t)?W(e.annotations[t]):V()),lR=Wn(Y1),Sj=Wn(X1),wj=Wn(QS),fR=Wn(js),dR=Wn(bc),Cp=Wn(YS),hR=Wn(Gf),vj=Wn(oR),Ej=Wn(iR),kj=Wn(aR),$j=Wn(cR),Cj=Wn(uR),gu=Wn(tm),Tj=Wn(bj),Ij=e=>RL(Tj(e),t=>t===!0),Tp=Symbol.for("effect/annotation/JSONIdentifier"),Rj=Wn(Tp),Oj=e=>ro(Rj(e),()=>Cp(e)),qj=Symbol.for("effect/schema/ParseJson");class Ip{constructor(t,n,r,s={}){d(this,"typeParameters");d(this,"decodeUnknown");d(this,"encodeUnknown");d(this,"annotations");d(this,"_tag","Declaration");this.typeParameters=t,this.decodeUnknown=n,this.encodeUnknown=r,this.annotations=s}toString(){return Et(Is(this),()=>"<declaration schema>")}toJSON(){return{_tag:this._tag,typeParameters:this.typeParameters.map(t=>t.toJSON()),annotations:nn(this.annotations)}}}const Us=e=>t=>t._tag===e;let nm=class{constructor(t,n={}){d(this,"literal");d(this,"annotations");d(this,"_tag","Literal");this.literal=t,this.annotations=n}toString(){return Et(Is(this),()=>xr(this.literal))}toJSON(){return{_tag:this._tag,literal:_p(this.literal)?String(this.literal):this.literal,annotations:nn(this.annotations)}}};const Cl=Us("Literal"),Aj=new nm(null);class mR{constructor(t,n={}){d(this,"symbol");d(this,"annotations");d(this,"_tag","UniqueSymbol");this.symbol=t,this.annotations=n}toString(){return Et(Is(this),()=>xr(this.symbol))}toJSON(){return{_tag:this._tag,symbol:String(this.symbol),annotations:nn(this.annotations)}}}class Pj{constructor(t={}){d(this,"annotations");d(this,"_tag","UndefinedKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const xc=new Pj({[js]:"undefined"});class Fj{constructor(t={}){d(this,"annotations");d(this,"_tag","VoidKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const xj=new Fj({[js]:"void"});class Nj{constructor(t={}){d(this,"annotations");d(this,"_tag","NeverKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const Rp=new Nj({[js]:"never"}),Dj=Us("NeverKeyword");class Mj{constructor(t={}){d(this,"annotations");d(this,"_tag","UnknownKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const pR=new Mj({[js]:"unknown"});class Lj{constructor(t={}){d(this,"annotations");d(this,"_tag","AnyKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const gR=new Lj({[js]:"any"});class jj{constructor(t={}){d(this,"annotations");d(this,"_tag","StringKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const Dy=new jj({[js]:"string",[Gf]:"a string"}),My=Us("StringKeyword");class Uj{constructor(t={}){d(this,"annotations");d(this,"_tag","NumberKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const Ly=new Uj({[js]:"number",[Gf]:"a number"}),rk=Us("NumberKeyword");class zj{constructor(t={}){d(this,"annotations");d(this,"_tag","BooleanKeyword");this.annotations=t}toString(){return gi(this)}toJSON(){return{_tag:this._tag,annotations:nn(this.annotations)}}}const jy=new zj({[js]:"boolean",[Gf]:"a boolean"}),sk=Us("BooleanKeyword"),_R=Us("SymbolKeyword");let Qf=class{constructor(t,n={}){d(this,"type");d(this,"annotations");this.type=t,this.annotations=n}toJSON(){return{type:this.type.toJSON(),annotations:nn(this.annotations)}}toString(){return String(this.type)}};class pi extends Qf{constructor(n,r,s={}){super(n,s);d(this,"isOptional");this.isOptional=r}toJSON(){return{type:this.type.toJSON(),isOptional:this.isOptional,annotations:nn(this.annotations)}}toString(){return String(this.type)+(this.isOptional?"?":"")}}const Op=e=>e.map(t=>t.type);class Yf{constructor(t,n,r,s={}){d(this,"elements");d(this,"rest");d(this,"isReadonly");d(this,"annotations");d(this,"_tag","TupleType");this.elements=t,this.rest=n,this.isReadonly=r,this.annotations=s;let o=!1,a=!1;for(const u of t)if(u.isOptional)o=!0;else if(o){a=!0;break}if(a||o&&n.length>1)throw new Error(dj)}toString(){return Et(Is(this),()=>Bj(this))}toJSON(){return{_tag:this._tag,elements:this.elements.map(t=>t.toJSON()),rest:this.rest.map(t=>t.toJSON()),isReadonly:this.isReadonly,annotations:nn(this.annotations)}}}const Bj=e=>{const t=e.elements.map(String).join(", ");return jL(e.rest,{onEmpty:()=>`readonly [${t}]`,onNonEmpty:(n,r)=>{const s=String(n),o=s.includes(" | ")?`(${s})`:s;if(r.length>0){const a=r.map(String).join(", ");return e.elements.length>0?`readonly [${t}, ...${o}[], ${a}]`:`readonly [...${o}[], ${a}]`}else return e.elements.length>0?`readonly [${t}, ...${o}[]]`:`ReadonlyArray<${s}>`}})};class Nt extends pi{constructor(n,r,s,o,a){super(r,s,a);d(this,"name");d(this,"isReadonly");this.name=n,this.isReadonly=o}toString(){return(this.isReadonly?"readonly ":"")+String(this.name)+(this.isOptional?"?":"")+": "+this.type}toJSON(){return{name:String(this.name),type:this.type.toJSON(),isOptional:this.isOptional,isReadonly:this.isReadonly,annotations:nn(this.annotations)}}}const yR=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return!0;case"Refinement":return yR(e.from)}return!1};class _u{constructor(t,n,r){d(this,"type");d(this,"isReadonly");d(this,"parameter");if(this.type=n,this.isReadonly=r,yR(t))this.parameter=t;else throw new Error(fj)}toString(){return(this.isReadonly?"readonly ":"")+`[x: ${this.parameter}]: ${this.type}`}toJSON(){return{parameter:this.parameter.toJSON(),type:this.type.toJSON(),isReadonly:this.isReadonly}}}class Nr{constructor(t,n,r={}){d(this,"annotations");d(this,"_tag","TypeLiteral");d(this,"propertySignatures");d(this,"indexSignatures");this.annotations=r;const s={};for(let a=0;a<t.length;a++){const u=t[a].name;if(Object.prototype.hasOwnProperty.call(s,u))throw new Error(Q1(u));s[u]=null}const o={string:!1,symbol:!1};for(let a=0;a<n.length;a++){const u=sm(n[a].parameter);if(My(u)){if(o.string)throw new Error(tk("string"));o.string=!0}else if(_R(u)){if(o.symbol)throw new Error(tk("symbol"));o.symbol=!0}}this.propertySignatures=t,this.indexSignatures=n}toString(){return Et(Is(this),()=>Hj(this))}toJSON(){return{_tag:this._tag,propertySignatures:this.propertySignatures.map(t=>t.toJSON()),indexSignatures:this.indexSignatures.map(t=>t.toJSON()),annotations:nn(this.annotations)}}}const ok=e=>e.map(String).join("; "),Hj=e=>{if(e.propertySignatures.length>0){const t=e.propertySignatures.map(String).join("; ");return e.indexSignatures.length>0?`{ ${t}; ${ok(e.indexSignatures)} }`:`{ ${t} }`}else return e.indexSignatures.length>0?`{ ${ok(e.indexSignatures)} }`:"{}"},ik=Us("TypeLiteral"),Vj=zl(O1(Fc,e=>{switch(e._tag){case"AnyKeyword":return 0;case"UnknownKeyword":return 1;case"ObjectKeyword":return 2;case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":return 3}return 4})),Wj={string:"StringKeyword",number:"NumberKeyword",boolean:"BooleanKeyword",bigint:"BigIntKeyword"},bR=e=>Zh(e,t=>ZS(t)?bR(t.types):[t]),Kj=e=>{const t=Vj(e),n=[],r={},s=[];for(const o of t)switch(o._tag){case"NeverKeyword":break;case"AnyKeyword":return[gR];case"UnknownKeyword":return[pR];case"ObjectKeyword":case"UndefinedKeyword":case"VoidKeyword":case"StringKeyword":case"NumberKeyword":case"BooleanKeyword":case"BigIntKeyword":case"SymbolKeyword":{r[o._tag]||(r[o._tag]=o,n.push(o));break}case"Literal":{const a=typeof o.literal;switch(a){case"string":case"number":case"bigint":case"boolean":{const u=Wj[a];!r[u]&&!s.includes(o.literal)&&(s.push(o.literal),n.push(o));break}case"object":{s.includes(o.literal)||(s.push(o.literal),n.push(o));break}}break}case"UniqueSymbol":{!r.SymbolKeyword&&!s.includes(o.symbol)&&(s.push(o.symbol),n.push(o));break}case"TupleType":{r.ObjectKeyword||n.push(o);break}case"TypeLiteral":{o.propertySignatures.length===0&&o.indexSignatures.length===0?r["{}"]||(r["{}"]=o,n.push(o)):r.ObjectKeyword||n.push(o);break}default:n.push(o)}return n};var Qs;let an=(Qs=class{constructor(t,n={}){d(this,"types");d(this,"annotations");d(this,"_tag","Union");this.types=t,this.annotations=n}toString(){return Et(Is(this),()=>this.types.map(String).join(" | "))}toJSON(){return{_tag:this._tag,types:this.types.map(t=>t.toJSON()),annotations:nn(this.annotations)}}},d(Qs,"make",(t,n)=>XS(t)?new Qs(t,n):t.length===1?t[0]:Rp),d(Qs,"unify",(t,n)=>Qs.make(Kj(bR(t)),n)),Qs);const Jj=(e,t)=>e.map(t),XS=e=>e.length>1,ZS=Us("Union"),V_=Te(Symbol.for("effect/Schema/AST/toJSONMemoMap"),()=>new WeakMap);class ca{constructor(t,n={}){d(this,"f");d(this,"annotations");d(this,"_tag","Suspend");this.f=t,this.annotations=n,this.f=V1(t)}toString(){return Is(this).pipe(ro(()=>pu(vL(this.f)(),t=>Is(t))),Et(()=>"<suspended schema>"))}toJSON(){const t=this.f();let n=V_.get(t);return n||(V_.set(t,{_tag:this._tag}),n={_tag:this._tag,ast:t.toJSON(),annotations:nn(this.annotations)},V_.set(t,n),n)}}let Xf=class{constructor(t,n,r={}){d(this,"from");d(this,"filter");d(this,"annotations");d(this,"_tag","Refinement");this.from=t,this.filter=n,this.annotations=r}toString(){return Cp(this).pipe(Et(()=>ot(CR(this),{onNone:()=>`{ ${this.from} | filter }`,onSome:t=>Sc(this.from)?String(this.from)+" & "+t:t})))}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),annotations:nn(this.annotations)}}};const Sc=Us("Refinement"),W_={};let qr=class{constructor(t,n,r,s={}){d(this,"from");d(this,"to");d(this,"transformation");d(this,"annotations");d(this,"_tag","Transformation");this.from=t,this.to=n,this.transformation=r,this.annotations=s}toString(){return Et(Is(this),()=>`(${String(this.from)} <-> ${String(this.to)})`)}toJSON(){return{_tag:this._tag,from:this.from.toJSON(),to:this.to.toJSON(),annotations:nn(this.annotations)}}};const Gj=Us("Transformation");class SR{constructor(t,n){d(this,"decode");d(this,"encode");d(this,"_tag","FinalTransformation");this.decode=t,this.encode=n}}const Qj=e=>t=>t._tag===e;class Yj{constructor(){d(this,"_tag","ComposeTransformation")}}const ew=new Yj;let Xj=class{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");this.from=t,this.to=n,this.decode=r,this.encode=s}};const Zj=e=>e.decode===ce&&e.encode===ce;class rm{constructor(t){d(this,"propertySignatureTransformations");d(this,"_tag","TypeLiteralTransformation");this.propertySignatureTransformations=t;const n={},r={};for(const s of t){const o=s.from;if(n[o])throw new Error(nk(o));n[o]=!0;const a=s.to;if(r[a])throw new Error(nk(a));r[a]=!0}}}const Uy=Qj("TypeLiteralTransformation"),ua=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={...e.annotations,...t},s=gu(e);return lt(s)&&(r[tm]=ua(s.value,t)),n.annotations.value=r,Object.create(Object.getPrototypeOf(e),n)},eU="[\\s\\S]*",tU="[+-]?\\d*\\.?\\d+(?:[Ee][+-]?\\d+)?",wR=(e,t)=>{switch(e._tag){case"Literal":return em(String(e.literal));case"StringKeyword":return eU;case"NumberKeyword":return tU;case"TemplateLiteral":return vR(e);case"Union":return e.types.map(n=>wR(n)).join("|")}},nU=(e,t,n,r)=>ZS(e)?`(${t})`:t,vR=(e,t,n)=>{let r="";if(e.head!==""){const s=em(e.head);r+=s}for(const s of e.spans){const o=wR(s.type);if(r+=nU(s.type,o),s.literal!==""){const a=em(s.literal);r+=a}}return r},ER=e=>new RegExp(`^${vR(e)}$`),vh=e=>{const t=gu(e);if(lt(t))return vh(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.slice();case"Suspend":return vh(e.f());case"Refinement":return vh(e.from)}return Ri(e).map(n=>Ni(e,n))},Eh=e=>{switch(e._tag){case"TupleType":{let t=!1,n=[];for(const r of e.elements)r.isOptional&&(t=!0),n.push(r.type);return t&&n.push(xc),n=n.concat(Op(e.rest)),an.make(n)}case"Refinement":return Eh(e.from);case"Union":return an.make(e.types.map(Eh));case"Suspend":return Eh(e.f())}throw new Error(Bl(e))},kR=(e,t)=>{const n=QL(e.propertySignatures,r=>r.name===t);if(lt(n))return n.value;if(Pn(t)){let r;for(const s of e.indexSignatures){const o=sm(s.parameter);switch(o._tag){case"TemplateLiteral":{if(ER(o).test(t))return new Nt(t,s.type,!1,!0);break}case"StringKeyword":r===void 0&&(r=new Nt(t,s.type,!1,!0))}}if(r)return r}else if(Kh(t))for(const r of e.indexSignatures){const s=sm(r.parameter);if(_R(s))return new Nt(t,r.type,!1,!0)}},Ni=(e,t)=>{const n=gu(e);if(lt(n))return Ni(n.value,t);switch(e._tag){case"TypeLiteral":{const r=kR(e,t);if(r)return r;break}case"Union":return new Nt(t,an.make(e.types.map(r=>Ni(r,t).type)),!1,!0);case"Suspend":return Ni(e.f(),t);case"Refinement":return Ni(e.from,t)}throw new Error(Bl(e))},Ri=e=>{const t=gu(e);if(lt(t))return Ri(t.value);switch(e._tag){case"TypeLiteral":return e.propertySignatures.map(n=>n.name);case"Union":return e.types.slice(1).reduce((n,r)=>sj(n,Ri(r)),Ri(e.types[0]));case"Suspend":return Ri(e.f());case"Refinement":return Ri(e.from);case"Transformation":return Ri(e.to)}return[]},ak=(e,t)=>{const n=[],r=[],s=o=>{switch(o._tag){case"NeverKeyword":break;case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":case"Refinement":r.push(new _u(o,t,!0));break;case"Literal":if(Pn(o.literal)||mo(o.literal))n.push(new Nt(o.literal,t,!1,!0));else throw new Error(lj(o.literal));break;case"Enums":{for(const[a,u]of o.enums)n.push(new Nt(u,t,!1,!0));break}case"UniqueSymbol":n.push(new Nt(o.symbol,t,!1,!0));break;case"Union":o.types.forEach(s);break;default:throw new Error(uj(o))}};return s(e),{propertySignatures:n,indexSignatures:r}},Ks=(e,t)=>{const n=gu(e);if(lt(n))return Ks(n.value,t);switch(e._tag){case"TypeLiteral":{const r=[],s={};for(const o of e.propertySignatures)s[o.name]=null,t.includes(o.name)&&r.push(o);for(const o of t)if(!(o in s)){const a=kR(e,o);a&&r.push(a)}return new Nr(r,[])}case"Union":return new Nr(t.map(r=>Ni(e,r)),[]);case"Suspend":return Ks(e.f(),t);case"Refinement":return Ks(e.from,t);case"Transformation":switch(e.transformation._tag){case"ComposeTransformation":return new qr(Ks(e.from,t),Ks(e.to,t),ew);case"TypeLiteralTransformation":{const r=[],s=[];for(const o of t){const a=e.transformation.propertySignatureTransformations.find(u=>u.to===o);a?(r.push(a),s.push(a.from)):s.push(o)}return bt(r)?new qr(Ks(e.from,s),Ks(e.to,t),new rm(r)):Ks(e.from,s)}}}throw new Error(Bl(e))},kh=e=>an.make([e,xc]),dl=(e,t)=>{switch(e._tag){case"TupleType":return new Yf(e.elements.map(n=>new pi(kh(n.type),!0)),LL(e.rest,{onEmpty:()=>e.rest,onNonEmpty:n=>[new Qf(an.make([...Op(n),xc]))]}),e.isReadonly);case"TypeLiteral":return new Nr(e.propertySignatures.map(n=>new Nt(n.name,kh(n.type),!0,n.isReadonly,n.annotations)),e.indexSignatures.map(n=>new _u(n.parameter,kh(n.type),n.isReadonly)));case"Union":return an.make(e.types.map(n=>dl(n)));case"Suspend":return new ca(()=>dl(e.f()));case"Declaration":case"Refinement":throw new Error(Bl(e));case"Transformation":{if(Uy(e.transformation)&&e.transformation.propertySignatureTransformations.every(Zj))return new qr(dl(e.from),dl(e.to),e.transformation);throw new Error(Bl(e))}}return e},nc=e=>{switch(e._tag){case"TupleType":return e.isReadonly===!1?e:new Yf(e.elements,e.rest,!1,e.annotations);case"TypeLiteral":{const t=jn(e.propertySignatures,r=>r.isReadonly===!1?r:new Nt(r.name,r.type,r.isOptional,!1,r.annotations)),n=jn(e.indexSignatures,r=>r.isReadonly===!1?r:new _u(r.parameter,r.type,!1));return t===e.propertySignatures&&n===e.indexSignatures?e:new Nr(t,n,e.annotations)}case"Union":{const t=jn(e.types,nc);return t===e.types?e:an.make(t,e.annotations)}case"Suspend":return new ca(()=>nc(e.f()),e.annotations);case"Refinement":{const t=nc(e.from);return t===e.from?e:new Xf(t,e.filter,e.annotations)}case"Transformation":{const t=nc(e.from),n=nc(e.to);return t===e.from&&n===e.to?e:new qr(t,n,e.transformation,e.annotations)}}return e},$R=e=>t=>{let n;for(const r of e)Object.prototype.hasOwnProperty.call(t.annotations,r)&&(n===void 0&&(n={}),n[r]=t.annotations[r]);return n},rU=e=>t=>{const n={...t.annotations};for(const r of e)delete n[r];return n},sU=$R([Z1,eR,tR,nR,rR,sR]),Dt=e=>{switch(e._tag){case"Declaration":{const t=jn(e.typeParameters,Dt);return t===e.typeParameters?e:new Ip(t,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const t=jn(e.elements,s=>{const o=Dt(s.type);return o===s.type?s:new pi(o,s.isOptional)}),n=Op(e.rest),r=jn(n,Dt);return t===e.elements&&r===n?e:new Yf(t,r.map(s=>new Qf(s)),e.isReadonly,e.annotations)}case"TypeLiteral":{const t=jn(e.propertySignatures,r=>{const s=Dt(r.type);return s===r.type?r:new Nt(r.name,s,r.isOptional,r.isReadonly)}),n=jn(e.indexSignatures,r=>{const s=Dt(r.type);return s===r.type?r:new _u(r.parameter,s,r.isReadonly)});return t===e.propertySignatures&&n===e.indexSignatures?e:new Nr(t,n,e.annotations)}case"Union":{const t=jn(e.types,Dt);return t===e.types?e:an.make(t,e.annotations)}case"Suspend":return new ca(()=>Dt(e.f()),e.annotations);case"Refinement":{const t=Dt(e.from);return t===e.from?e:new Xf(t,e.filter,e.annotations)}case"Transformation":{const t=sU(e);return Dt(t!==void 0?ua(e.to,t):e.to)}}return e},Qa=e=>ot(Oj(e),{onNone:()=>{},onSome:t=>({[Tp]:t})});function jn(e,t){let n=!1;const r=kp(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=t(o);a!==o&&(n=!0),r[s]=a}return n?r:e}const ls=(e,t)=>{switch(e._tag){case"Declaration":{const n=jn(e.typeParameters,r=>ls(r));return n===e.typeParameters?e:new Ip(n,e.decodeUnknown,e.encodeUnknown,e.annotations)}case"TupleType":{const n=jn(e.elements,o=>{const a=ls(o.type);return a===o.type?o:new pi(a,o.isOptional)}),r=Op(e.rest),s=jn(r,o=>ls(o));return n===e.elements&&s===r?e:new Yf(n,s.map(o=>new Qf(o)),e.isReadonly,Qa(e))}case"TypeLiteral":{const n=jn(e.propertySignatures,s=>{const o=ls(s.type);return o===s.type?s:new Nt(s.name,o,s.isOptional,s.isReadonly)}),r=jn(e.indexSignatures,s=>{const o=ls(s.type);return o===s.type?s:new _u(s.parameter,o,s.isReadonly)});return n===e.propertySignatures&&r===e.indexSignatures?e:new Nr(n,r,Qa(e))}case"Union":{const n=jn(e.types,r=>ls(r));return n===e.types?e:an.make(n,Qa(e))}case"Suspend":return new ca(()=>ls(e.f()),Qa(e));case"Refinement":{const n=ls(e.from),r=Qa(e);return r?ua(n,r):n}case"Transformation":{const n=Qa(e);return ls(n?ua(e.from,n):e.from)}}return e},zy=e=>ls(e),nn=e=>{const t={};for(const n of Object.getOwnPropertySymbols(e))t[String(n)]=e[n];return t},sm=e=>{switch(e._tag){case"StringKeyword":case"SymbolKeyword":case"TemplateLiteral":return e;case"Refinement":return sm(e.from)}},oU=(e,t)=>new qr(e,t,ew),gi=e=>Et(Is(e),()=>e._tag);function iU(e){return ot(lR(e),{onNone:()=>"",onSome:t=>t.map(n=>` & Brand<${xr(n)}>`).join("")})}const CR=e=>fR(e).pipe(ro(()=>hR(e)),ro(()=>dR(e)),Zo(t=>t+iU(e))),Is=e=>ro(Cp(e),()=>CR(e)),aU=(e,t,n)=>{switch(e._tag){case"UndefinedKeyword":return Rp;case"Union":{const r=[];let s=!1;for(const o of e.types){const a=t(o);a?(s=!0,Dj(a)||r.push(a)):r.push(o)}if(s)return an.make(r);break}case"Suspend":return t(e.f());case"Transformation":return n(e)}},ck=Symbol.for("effect/Brand/Refined"),TR=()=>Object.assign(e=>e,{[ck]:ck,option:e=>W(e),either:e=>le(e),is:e=>!0}),IR=Symbol.for("effect/Context/Tag"),om=Symbol.for("effect/Context/Reference"),cU="effect/STM",uU=Symbol.for(cU),tw={...Wf,_op:"Tag",[uU]:oa,[IR]:{_Service:e=>e,_Identifier:e=>e},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[Be](){return this.toJSON()},of(e){return e},context(e){return qR(this,e)}},lU={...tw,[om]:om},fU=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;const r=Object.create(tw);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=e,r},dU=e=>()=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=t;function r(){}return Object.setPrototypeOf(r,tw),r.key=e,Object.defineProperty(r,"stack",{get(){return n.stack}}),r},hU=()=>(e,t)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,lU),s.key=e,s.defaultValue=t.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},RR=Symbol.for("effect/Context"),mU={[RR]:{_Services:e=>e},[ye](e){if(OR(e)&&this.unsafeMap.size===e.unsafeMap.size){for(const t of this.unsafeMap.keys())if(!e.unsafeMap.has(t)||!me(this.unsafeMap.get(t),e.unsafeMap.get(t)))return!1;return!0}return!1},[_e](){return ct(this,LS(this.unsafeMap.size))},pipe(){return ee(this,arguments)},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(Ot)}},[Be](){return this.toJSON()}},la=e=>{const t=Object.create(mU);return t.unsafeMap=e,t},pU=e=>{const t=new Error(`Service not found${e.key?`: ${String(e.key)}`:""}`);if(e.stack){const n=e.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(t.message=t.message+` (defined at ${r[1]})`)}}if(t.stack){const n=t.stack.split(`
`);n.splice(1,3),t.stack=n.join(`
`)}return t},OR=e=>ne(e,RR),gU=e=>ne(e,IR),_U=e=>ne(e,om),yU=la(new Map),bU=()=>yU,qR=(e,t)=>la(new Map([[e.key,t]])),SU=y(3,(e,t,n)=>{const r=new Map(e.unsafeMap);return r.set(t.key,n),la(r)}),K_=Te("effect/Context/defaultValueCache",()=>new Map),nw=e=>{if(K_.has(e.key))return K_.get(e.key);const t=e.defaultValue();return K_.set(e.key,t),t},wU=(e,t)=>e.unsafeMap.has(t.key)?e.unsafeMap.get(t.key):nw(t),AR=y(2,(e,t)=>{if(!e.unsafeMap.has(t.key)){if(om in t)return nw(t);throw pU(t)}return e.unsafeMap.get(t.key)}),vU=AR,EU=y(2,(e,t)=>e.unsafeMap.has(t.key)?Ny(e.unsafeMap.get(t.key)):_U(t)?Ny(nw(t)):v1),kU=y(2,(e,t)=>{const n=new Map(e.unsafeMap);for(const[r,s]of t.unsafeMap)n.set(r,s);return la(n)}),$U=(...e)=>t=>{const n=new Map(t.unsafeMap);for(const r of e)n.delete(r.key);return la(n)},sr=fU,CU=OR,qp=gU,po=bU,Zf=qR,_s=SU,Xn=vU,Ap=AR,Lr=EU,qo=kU,TU=$U,rw=dU,yu=hU,PR=Symbol.for("effect/Chunk");function IU(e,t,n,r,s){for(let o=t;o<Math.min(e.length,t+s);o++)n[r+o-t]=e[o];return n}const FR=[],RU=e=>Bf((t,n)=>t.length===n.length&&pr(t).every((r,s)=>e(r,oo(n,s)))),OU=RU(me),qU={[PR]:{_A:e=>e},toString(){return dt(this.toJSON())},toJSON(){return{_id:"Chunk",values:pr(this).map(Ot)}},[Be](){return this.toJSON()},[ye](e){return Wi(e)&&OU(this,e)},[_e](){return ct(this,Hf(pr(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return FR[Symbol.iterator]();default:return pr(this)[Symbol.iterator]()}},pipe(){return ee(this,arguments)}},zt=e=>{const t=Object.create(qU);switch(t.backing=e,e._tag){case"IEmpty":{t.length=0,t.depth=0,t.left=t,t.right=t;break}case"IConcat":{t.length=e.left.length+e.right.length,t.depth=1+Math.max(e.left.depth,e.right.depth),t.left=e.left,t.right=e.right;break}case"IArray":{t.length=e.array.length,t.depth=0,t.left=Gr,t.right=Gr;break}case"ISingleton":{t.length=1,t.depth=0,t.left=Gr,t.right=Gr;break}case"ISlice":{t.length=e.length,t.depth=e.chunk.depth+1,t.left=Gr,t.right=Gr;break}}return t},Wi=e=>ne(e,PR),Gr=zt({_tag:"IEmpty"}),yt=()=>Gr,J_=(...e)=>FU(e),ft=e=>zt({_tag:"ISingleton",a:e}),go=e=>Wi(e)?e:Bt(ze(e)),By=(e,t,n)=>{switch(e.backing._tag){case"IArray":{IU(e.backing.array,0,t,n,e.length);break}case"IConcat":{By(e.left,t,n),By(e.right,t,n+e.left.length);break}case"ISingleton":{t[n]=e.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<e.length;)t[s]=oo(e,r),r+=1,s+=1;break}}},AU=e=>{switch(e.backing._tag){case"IEmpty":return FR;case"IArray":return e.backing.array;default:{const t=new Array(e.length);return By(e,t,0),e.backing={_tag:"IArray",array:t},e.left=Gr,e.right=Gr,e.depth=0,t}}},pr=AU,PU=e=>{switch(e.backing._tag){case"IEmpty":case"ISingleton":return e;case"IArray":return zt({_tag:"IArray",array:Y0(e.backing.array)});case"IConcat":return zt({_tag:"IConcat",left:_o(e.backing.right),right:_o(e.backing.left)});case"ISlice":return Bt(Y0(pr(e)))}},_o=PU,xR=y(2,(e,t)=>t<0||t>=e.length?V():W(oo(e,t))),Bt=e=>e.length===0?yt():e.length===1?ft(e[0]):zt({_tag:"IArray",array:e}),FU=e=>Bt(e),oo=y(2,(e,t)=>{switch(e.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(t!==0)throw new Error("Index out of bounds");return e.backing.a}case"IArray":{if(t>=e.length||t<0)throw new Error("Index out of bounds");return e.backing.array[t]}case"IConcat":return t<e.left.length?oo(e.left,t):oo(e.right,t-e.left.length);case"ISlice":return oo(e.backing.chunk,t+e.backing.offset)}}),Hl=y(2,(e,t)=>Rt(e,ft(t))),Tn=y(2,(e,t)=>Rt(ft(t),e)),Nc=y(2,(e,t)=>{if(t<=0)return Gr;if(t>=e.length)return e;switch(e.backing._tag){case"ISlice":return zt({_tag:"ISlice",chunk:e.backing.chunk,length:t,offset:e.backing.offset});case"IConcat":return t>e.left.length?zt({_tag:"IConcat",left:e.left,right:Nc(e.right,t-e.left.length)}):Nc(e.left,t);default:return zt({_tag:"ISlice",chunk:e,offset:0,length:t})}}),Ys=y(2,(e,t)=>{if(t<=0)return e;if(t>=e.length)return Gr;switch(e.backing._tag){case"ISlice":return zt({_tag:"ISlice",chunk:e.backing.chunk,offset:e.backing.offset+t,length:e.backing.length-t});case"IConcat":return t>e.left.length?Ys(e.right,t-e.left.length):zt({_tag:"IConcat",left:Ys(e.left,t),right:e.right});default:return zt({_tag:"ISlice",chunk:e,offset:t,length:e.length-t})}}),Rt=y(2,(e,t)=>{if(e.backing._tag==="IEmpty")return t;if(t.backing._tag==="IEmpty")return e;const n=t.depth-e.depth;if(Math.abs(n)<=1)return zt({_tag:"IConcat",left:e,right:t});if(n<-1)if(e.left.depth>=e.right.depth){const r=Rt(e.right,t);return zt({_tag:"IConcat",left:e.left,right:r})}else{const r=Rt(e.right.right,t);if(r.depth===e.depth-3){const s=zt({_tag:"IConcat",left:e.right.left,right:r});return zt({_tag:"IConcat",left:e.left,right:s})}else{const s=zt({_tag:"IConcat",left:e.left,right:e.right.left});return zt({_tag:"IConcat",left:s,right:r})}}else if(t.right.depth>=t.left.depth){const r=Rt(e,t.left);return zt({_tag:"IConcat",left:r,right:t.right})}else{const r=Rt(e,t.left.left);if(r.depth===t.depth-3){const s=zt({_tag:"IConcat",left:r,right:t.left.right});return zt({_tag:"IConcat",left:s,right:t.right})}else{const s=zt({_tag:"IConcat",left:t.left.right,right:t.right});return zt({_tag:"IConcat",left:r,right:s})}}}),NR=y(2,(e,t)=>Bt(U1(e,t))),Pp=y(2,(e,t)=>Bt(z1(e,t))),ed=e=>e.length===0,yo=e=>e.length>0,Fp=xR(0),xp=e=>oo(e,0),Ss=xp,xU=e=>xR(e,e.length-1),Ya=e=>oo(e,e.length-1),lc=y(2,(e,t)=>e.backing._tag==="ISingleton"?ft(t(e.backing.a,0)):Bt(v(pr(e),so((n,r)=>t(n,r))))),DR=y(2,(e,t)=>[Nc(e,t),Ys(e,t)]),NU=y(2,(e,t)=>{let n=0;for(const r of pr(e)){if(t(r))break;n++}return DR(e,n)}),Xs=e=>Ys(e,1),DU=y(2,(e,t)=>Ys(e,e.length-t)),MU=JS,Hy=Symbol.for("effect/Duration"),MR=BigInt(0),uk=BigInt(24),Yd=BigInt(60),Vy=BigInt(1e3),lk=BigInt(1e6),fk=BigInt(1e9),LU=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,br=e=>{if(sw(e))return e;if(mo(e))return fa(e);if(_p(e))return $h(e);if(Array.isArray(e)&&e.length===2&&e.every(mo))return e[0]===-1/0||e[1]===-1/0||Number.isNaN(e[0])||Number.isNaN(e[1])?LR:e[0]===1/0||e[1]===1/0?jR:$h(BigInt(Math.round(e[0]*1e9))+BigInt(Math.round(e[1])));if(Pn(e)){const t=LU.exec(e);if(t){const[n,r,s]=t,o=Number(r);switch(s){case"nano":case"nanos":return $h(BigInt(r));case"micro":case"micros":return BU(BigInt(r));case"milli":case"millis":return fa(o);case"second":case"seconds":return ow(o);case"minute":case"minutes":return UR(o);case"hour":case"hours":return HU(o);case"day":case"days":return VU(o);case"week":case"weeks":return WU(o)}}}throw new Error("Invalid DurationInput")},dk={_tag:"Millis",millis:0},jU={_tag:"Infinity"},UU={[Hy]:Hy,[_e](){return ct(this,h1(this.value))},[ye](e){return sw(e)&&ZU(this,e)},toString(){return`Duration(${HR(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:JU(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},er=e=>{const t=Object.create(UU);return mo(e)?isNaN(e)||e<=0?t.value=dk:Number.isFinite(e)?Number.isInteger(e)?t.value={_tag:"Millis",millis:e}:t.value={_tag:"Nanos",nanos:BigInt(Math.round(e*1e6))}:t.value=jU:e<=MR?t.value=dk:t.value={_tag:"Nanos",nanos:e},t},sw=e=>ne(e,Hy),zU=e=>{switch(e.value._tag){case"Millis":return e.value.millis===0;case"Nanos":return e.value.nanos===MR;case"Infinity":return!1}},LR=er(0),jR=er(1/0),$h=e=>er(e),BU=e=>er(e*Vy),fa=e=>er(e),ow=e=>er(e*1e3),UR=e=>er(e*6e4),HU=e=>er(e*36e5),VU=e=>er(e*864e5),WU=e=>er(e*6048e5),Dc=e=>zR(e,{onMillis:t=>t,onNanos:t=>Number(t)/1e6}),KU=e=>{const t=br(e);switch(t.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return t.value.nanos;case"Millis":return BigInt(Math.round(t.value.millis*1e6))}},JU=e=>{const t=br(e);switch(t.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(t.value.nanos/fk),Number(t.value.nanos%fk)];case"Millis":return[Math.floor(t.value.millis/1e3),Math.round(t.value.millis%1e3*1e6)]}},zR=y(2,(e,t)=>{const n=br(e);switch(n.value._tag){case"Nanos":return t.onNanos(n.value.nanos);case"Infinity":return t.onMillis(1/0);case"Millis":return t.onMillis(n.value.millis)}}),Np=y(3,(e,t,n)=>{const r=br(e),s=br(t);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(Dc(r),Dc(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const o=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),a=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(o,a)}return n.onMillis(r.value.millis,s.value.millis)}),BR=(e,t)=>Np(e,t,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),GU=y(2,(e,t)=>zR(e,{onMillis:n=>er(n*t),onNanos:n=>er(n*BigInt(t))})),QU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>er(n+r),onNanos:(n,r)=>er(n+r)})),YU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),XU=y(2,(e,t)=>Np(e,t,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),ZU=y(2,(e,t)=>BR(br(e),br(t))),ez=e=>{const t=br(e);if(t.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=KU(t),r=n/lk,s=r/Vy,o=s/Yd,a=o/Yd,u=a/uk;return{days:Number(u),hours:Number(a%uk),minutes:Number(o%Yd),seconds:Number(s%Yd),millis:Number(r%Vy),nanos:Number(n%lk)}},HR=e=>{const t=br(e);if(t.value._tag==="Infinity")return"Infinity";if(zU(t))return"0";const n=ez(t),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},da=5,iw=Math.pow(2,da),tz=iw-1,nz=iw/2,rz=iw/4;function sz(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function Mc(e,t){return t>>>e&tz}function fc(e){return 1<<e}function VR(e,t){return sz(e&t-1)}const oz=(e,t)=>({value:e,previous:t});function wc(e,t,n,r){let s=r;if(!e){const o=r.length;s=new Array(o);for(let a=0;a<o;++a)s[a]=r[a]}return s[t]=n,s}function WR(e,t,n){const r=n.length-1;let s=0,o=0,a=n;if(e)s=o=t;else for(a=new Array(r);s<t;)a[o++]=n[s++];for(++s;s<=r;)a[o++]=n[s++];return e&&(a.length=r),a}function iz(e,t,n,r){const s=r.length;if(e){let f=s;for(;f>=t;)r[f--]=r[f];return r[t]=n,r}let o=0,a=0;const u=new Array(s+1);for(;o<t;)u[a++]=r[o++];for(u[t]=n;o<s;)u[++a]=r[o++];return u}class ii{constructor(){d(this,"_tag","EmptyNode")}modify(t,n,r,s,o,a){const u=r(V());return Ft(u)?new ii:(++a.value,new Ki(t,s,o,u))}}function Xr(e){return yp(e,"EmptyNode")}function az(e){return Xr(e)||e._tag==="LeafNode"||e._tag==="CollisionNode"}function Dp(e,t){return Xr(e)?!1:t===e.edit}class Ki{constructor(t,n,r,s){d(this,"edit");d(this,"hash");d(this,"key");d(this,"value");d(this,"_tag","LeafNode");this.edit=t,this.hash=n,this.key=r,this.value=s}modify(t,n,r,s,o,a){if(me(o,this.key)){const f=r(this.value);return f===this.value?this:Ft(f)?(--a.value,new ii):Dp(this,t)?(this.value=f,this):new Ki(t,s,o,f)}const u=r(V());return Ft(u)?this:(++a.value,KR(t,n,this.hash,this,s,new Ki(t,s,o,u)))}}class aw{constructor(t,n,r){d(this,"edit");d(this,"hash");d(this,"children");d(this,"_tag","CollisionNode");this.edit=t,this.hash=n,this.children=r}modify(t,n,r,s,o,a){if(s===this.hash){const f=Dp(this,t),h=this.updateCollisionList(f,t,this.hash,this.children,r,o,a);return h===this.children?this:h.length>1?new aw(t,this.hash,h):h[0]}const u=r(V());return Ft(u)?this:(++a.value,KR(t,n,this.hash,this,s,new Ki(t,s,o,u)))}updateCollisionList(t,n,r,s,o,a,u){const f=s.length;for(let p=0;p<f;++p){const g=s[p];if("key"in g&&me(a,g.key)){const k=g.value,T=o(k);return T===k?s:Ft(T)?(--u.value,WR(t,p,s)):wc(t,p,new Ki(n,r,a,T),s)}}const h=o(V());return Ft(h)?s:(++u.value,wc(t,f,new Ki(n,r,a,h),s))}}class Lc{constructor(t,n,r){d(this,"edit");d(this,"mask");d(this,"children");d(this,"_tag","IndexedNode");this.edit=t,this.mask=n,this.children=r}modify(t,n,r,s,o,a){const u=this.mask,f=this.children,h=Mc(n,s),p=fc(h),g=VR(u,p),k=u&p,T=Dp(this,t);if(!k){const _=new ii().modify(t,n+da,r,s,o,a);return _?f.length>=nz?uz(t,h,_,u,f):new Lc(t,u|p,iz(T,g,_,f)):this}const O=f[g],L=O.modify(t,n+da,r,s,o,a);if(O===L)return this;let E=u,S;if(Xr(L)){if(E&=~p,!E)return new ii;if(f.length<=2&&az(f[g^1]))return f[g^1];S=WR(T,g,f)}else S=wc(T,g,L,f);return T?(this.mask=E,this.children=S,this):new Lc(t,E,S)}}class cw{constructor(t,n,r){d(this,"edit");d(this,"size");d(this,"children");d(this,"_tag","ArrayNode");this.edit=t,this.size=n,this.children=r}modify(t,n,r,s,o,a){let u=this.size;const f=this.children,h=Mc(n,s),p=f[h],g=(p||new ii).modify(t,n+da,r,s,o,a);if(p===g)return this;const k=Dp(this,t);let T;if(Xr(p)&&!Xr(g))++u,T=wc(k,h,g,f);else if(!Xr(p)&&Xr(g)){if(--u,u<=rz)return cz(t,u,h,f);T=wc(k,h,new ii,f)}else T=wc(k,h,g,f);return k?(this.size=u,this.children=T,this):new cw(t,u,T)}}function cz(e,t,n,r){const s=new Array(t-1);let o=0,a=0;for(let u=0,f=r.length;u<f;++u)if(u!==n){const h=r[u];h&&!Xr(h)&&(s[o++]=h,a|=1<<u)}return new Lc(e,a,s)}function uz(e,t,n,r,s){const o=[];let a=r,u=0;for(let f=0;a;++f)a&1&&(o[f]=s[u++]),a>>>=1;return o[t]=n,new cw(e,u+1,o)}function lz(e,t,n,r,s,o){if(n===s)return new aw(e,n,[o,r]);const a=Mc(t,n),u=Mc(t,s);if(a===u)return f=>new Lc(e,fc(a)|fc(u),[f]);{const f=a<u?[r,o]:[o,r];return new Lc(e,fc(a)|fc(u),f)}}function KR(e,t,n,r,s,o){let a,u=t;for(;;){const f=lz(e,u,n,r,s,o);if(typeof f=="function")a=oz(f,a),u=u+da;else{let h=f;for(;a!=null;)h=a.value(h),a=a.previous;return h}}}const JR="effect/HashMap",Wy=Symbol.for(JR),fz={[Wy]:Wy,[Symbol.iterator](){return new Mp(this,(e,t)=>[e,t])},[_e](){let e=Q(JR);for(const t of this)e^=v(Q(t[0]),fe(Q(t[1])));return ct(this,e)},[ye](e){if(mz(e)){if(e._size!==this._size)return!1;for(const t of this){const n=v(e,lw(t[0],Q(t[0])));if(Ft(n))return!1;if(!me(t[1],n.value))return!1}return!0}return!1},toString(){return dt(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(Ot)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},uw=(e,t,n,r)=>{const s=Object.create(fz);return s._editable=e,s._edit=t,s._root=n,s._size=r,s};class Mp{constructor(t,n){d(this,"map");d(this,"f");d(this,"v");this.map=t,this.f=n,this.v=GR(this.map._root,this.f,void 0)}next(){if(Ft(this.v))return{done:!0,value:void 0};const t=this.v.value;return this.v=im(t.cont),{done:!1,value:t.value}}[Symbol.iterator](){return new Mp(this.map,this.f)}}const im=e=>e?QR(e[0],e[1],e[2],e[3],e[4]):V(),GR=(e,t,n=void 0)=>{switch(e._tag){case"LeafNode":return lt(e.value)?W({value:t(e.key,e.value.value),cont:n}):im(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=e.children;return QR(r.length,r,0,t,n)}default:return im(n)}},QR=(e,t,n,r,s)=>{for(;n<e;){const o=t[n++];if(o&&!Xr(o))return GR(o,r,[e,t,n,r,s])}return im(s)},dz=uw(!1,0,new ii,0),Lp=()=>dz,hz=e=>{const t=XR(Lp());for(const n of e)Vl(t,n[0],n[1]);return bz(t)},mz=e=>ne(e,Wy),pz=e=>e&&Xr(e._root),gz=y(2,(e,t)=>lw(e,t,Q(t))),lw=y(3,(e,t,n)=>{let r=e._root,s=0;for(;;)switch(r._tag){case"LeafNode":return me(t,r.key)?r.value:V();case"CollisionNode":{if(n===r.hash){const o=r.children;for(let a=0,u=o.length;a<u;++a){const f=o[a];if("key"in f&&me(t,f.key))return f.value}}return V()}case"IndexedNode":{const o=Mc(s,n),a=fc(o);if(r.mask&a){r=r.children[VR(r.mask,a)],s+=da;break}return V()}case"ArrayNode":{if(r=r.children[Mc(s,n)],r){s+=da;break}return V()}default:return V()}}),_z=y(2,(e,t)=>lt(lw(e,t,Q(t)))),Vl=y(3,(e,t,n)=>fw(e,t,()=>W(n))),yz=y(3,(e,t,n)=>e._editable?(e._root=t,e._size=n,e):t===e._root?e:uw(e._editable,e._edit,t,n)),YR=e=>new Mp(e,t=>t),am=e=>e._size,XR=e=>uw(!0,e._edit+1,e._root,e._size),bz=e=>(e._editable=!1,e),fw=y(3,(e,t,n)=>Sz(e,t,Q(t),n)),Sz=y(4,(e,t,n,r)=>{const s={value:e._size},o=e._root.modify(e._editable?e._edit:NaN,0,r,n,t,s);return v(e,yz(o,s.value))}),hk=y(2,(e,t)=>fw(e,t,V)),wz=y(2,(e,t)=>jp(e,Lp(),(n,r,s)=>Vl(n,s,t(r,s)))),ZR=y(2,(e,t)=>jp(e,void 0,(n,r,s)=>t(r,s))),jp=y(3,(e,t,n)=>{const r=e._root;if(r._tag==="LeafNode")return lt(r.value)?n(t,r.value.value,r.key):t;if(r._tag==="EmptyNode")return t;const s=[r.children];let o;for(;o=s.pop();)for(let a=0,u=o.length;a<u;){const f=o[a++];f&&!Xr(f)&&(f._tag==="LeafNode"?lt(f.value)&&(t=n(t,f.value.value,f.key)):s.push(f.children))}return t}),eO="effect/HashSet",Ky=Symbol.for(eO),vz={[Ky]:Ky,[Symbol.iterator](){return YR(this._keyMap)},[_e](){return ct(this,fe(Q(this._keyMap))(Q(eO)))},[ye](e){return Ez(e)?am(this._keyMap)===am(e._keyMap)&&me(this._keyMap,e._keyMap):!1},toString(){return dt(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(Ot)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},Up=e=>{const t=Object.create(vz);return t._keyMap=e,t},Ez=e=>ne(e,Ky),kz=Up(Lp()),zp=()=>kz,$z=e=>{const t=dw(zp());for(const n of e)Wl(t,n);return hw(t)},Cz=(...e)=>{const t=dw(zp());for(const n of e)Wl(t,n);return hw(t)},Tz=y(2,(e,t)=>_z(e._keyMap,t)),Iz=e=>am(e._keyMap),dw=e=>Up(XR(e._keyMap)),hw=e=>(e._keyMap._editable=!1,e),tO=y(2,(e,t)=>{const n=dw(e);return t(n),hw(n)}),Wl=y(2,(e,t)=>e._keyMap._editable?(Vl(t,!0)(e._keyMap),e):Up(Vl(t,!0)(e._keyMap))),nO=y(2,(e,t)=>e._keyMap._editable?(hk(t)(e._keyMap),e):Up(hk(t)(e._keyMap))),Rz=y(2,(e,t)=>tO(e,n=>{for(const r of t)nO(n,r)})),Oz=y(2,(e,t)=>tO(zp(),n=>{qz(e,r=>Wl(n,r));for(const r of t)Wl(n,r)})),qz=y(2,(e,t)=>ZR(e._keyMap,(n,r)=>t(r))),Az=y(3,(e,t,n)=>jp(e._keyMap,t,(r,s,o)=>n(r,o))),ha=zp,Pz=$z,Bp=Cz,Hp=Tz,mw=Iz,vc=Wl,pw=nO,mk=Rz,Kl=Oz,Jl=Az,pk=Symbol.for("effect/MutableRef"),Fz={[pk]:pk,toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableRef",current:Ot(this.current)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},Ra=e=>{const t=Object.create(Fz);return t.current=e,t},xz=y(3,(e,t,n)=>me(t,e.current)?(e.current=n,!0):!1),He=e=>e.current,Oa=y(2,(e,t)=>(e.current=t,e)),Vp="effect/FiberId",ma=Symbol.for(Vp),jc="None",Jy="Runtime",Gy="Composite",Nz=Tt(`${Vp}-${jc}`);var dT;let Dz=class{constructor(){d(this,dT,ma);d(this,"_tag",jc);d(this,"id",-1);d(this,"startTimeMillis",-1)}[(dT=ma,_e)](){return Nz}[ye](t){return _w(t)&&t._tag===jc}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[Be](){return this.toJSON()}};var hT;class gw{constructor(t,n){d(this,"id");d(this,"startTimeMillis");d(this,hT,ma);d(this,"_tag",Jy);this.id=t,this.startTimeMillis=n}[(hT=ma,_e)](){return ct(this,Tt(`${Vp}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[ye](t){return _w(t)&&t._tag===Jy&&this.id===t.id&&this.startTimeMillis===t.startTimeMillis}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[Be](){return this.toJSON()}}var mT;let rO=class{constructor(t,n){d(this,"left");d(this,"right");d(this,mT,ma);d(this,"_tag",Gy);d(this,"_hash");this.left=t,this.right=n}[(mT=ma,_e)](){return v(Tt(`${Vp}-${this._tag}`),fe(Q(this.left)),fe(Q(this.right)),ct(this))}[ye](t){return _w(t)&&t._tag===Gy&&me(this.left,t.left)&&me(this.right,t.right)}toString(){return dt(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,left:Ot(this.left),right:Ot(this.right)}}[Be](){return this.toJSON()}};const sO=new Dz,Mz=(e,t)=>new gw(e,t),Lz=(e,t)=>new rO(e,t),_w=e=>ne(e,ma),oO=y(2,(e,t)=>e._tag===jc?t:t._tag===jc?e:new rO(e,t)),jz=e=>v(e,Jl(sO,(t,n)=>oO(n)(t))),cm=e=>{switch(e._tag){case jc:return ha();case Jy:return Bp(e.id);case Gy:return v(cm(e.left),Kl(cm(e.right)))}},gk=Te(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Ra(0)),Uz=(e,t)=>new gw(e,t),Wp=e=>Array.from(cm(e)).map(n=>`#${n}`).join(","),zz=()=>{const e=He(gk);return v(gk,Oa(e+1)),new gw(e,Date.now())},zn=sO,Bz=Mz,Hz=Lz,gr=oO,Vz=jz,Kp=cm,yw=Uz,Wz=Wp,iO=zz,Jp=Lp,Kz=hz,Jz=pz,aO=gz,Uc=Vl,cO=YR,uO=am,Gz=fw,Qz=wz,Yz=ZR,lO=jp,Gl=Symbol.for("effect/List"),Qy=e=>ze(e),Xz=e=>i1(Jf(e),Qy),Zz=Xz(me),eB={[Gl]:Gl,_tag:"Cons",toString(){return dt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:Qy(this).map(Ot)}},[Be](){return this.toJSON()},[ye](e){return dO(e)&&this._tag===e._tag&&Zz(this,e)},[_e](){return ct(this,Hf(Qy(this)))},[Symbol.iterator](){let e=!1,t=this;return{next(){if(e)return this.return();if(t._tag==="Nil")return e=!0,this.return();const n=t.head;return t=t.tail,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},pipe(){return ee(this,arguments)}},um=(e,t)=>{const n=Object.create(eB);return n.head=e,n.tail=t,n},tB=Tt("Nil"),nB={[Gl]:Gl,_tag:"Nil",toString(){return dt(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[Be](){return this.toJSON()},[_e](){return tB},[ye](e){return dO(e)&&this._tag===e._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return ee(this,arguments)}},fO=Object.create(nB),dO=e=>ne(e,Gl),io=e=>e._tag==="Nil",bw=e=>e._tag==="Cons",rB=()=>fO,pa=(e,t)=>um(e,t),zc=rB,Sw=e=>um(e,fO),sB=y(2,(e,t)=>iB(t,e)),oB=y(2,(e,t)=>pa(t,e)),iB=y(2,(e,t)=>{if(io(e))return t;if(io(t))return e;{const n=um(t.head,e);let r=n,s=t.tail;for(;!io(s);){const o=um(s.head,e);r.tail=o,r=o,s=s.tail}return n}}),aB=y(3,(e,t,n)=>{let r=t,s=e;for(;!io(s);)r=n(r,s.head),s=s.tail;return r}),cB=e=>{let t=zc(),n=e;for(;!io(n);)t=oB(t,n.head),n=n.tail;return t},Gp=(function(){function e(t){t&&Object.assign(this,t)}return e.prototype=zS,e})(),uB=Symbol.for("effect/DifferContextPatch");function _k(e){return e}const td={...Gp.prototype,[uB]:{_Value:_k,_Patch:_k}},lB=Object.assign(Object.create(td),{_tag:"Empty"}),fB=Object.create(lB),hO=()=>fB,dB=Object.assign(Object.create(td),{_tag:"AndThen"}),hB=(e,t)=>{const n=Object.create(dB);return n.first=e,n.second=t,n},mB=Object.assign(Object.create(td),{_tag:"AddService"}),pB=(e,t)=>{const n=Object.create(mB);return n.key=e,n.service=t,n},gB=Object.assign(Object.create(td),{_tag:"RemoveService"}),_B=e=>{const t=Object.create(gB);return t.key=e,t},yB=Object.assign(Object.create(td),{_tag:"UpdateService"}),bB=(e,t)=>{const n=Object.create(yB);return n.key=e,n.update=t,n},SB=(e,t)=>{const n=new Map(e.unsafeMap);let r=hO();for(const[s,o]of t.unsafeMap.entries())if(n.has(s)){const a=n.get(s);n.delete(s),me(a,o)||(r=Ch(bB(s,()=>o))(r))}else n.delete(s),r=Ch(pB(s,o))(r);for(const[s]of n.entries())r=Ch(_B(s))(r);return r},Ch=y(2,(e,t)=>hB(e,t)),wB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=!1,r=ft(e);const s=new Map(t.unsafeMap);for(;yo(r);){const a=Ss(r),u=Xs(r);switch(a._tag){case"Empty":{r=u;break}case"AddService":{s.set(a.key,a.service),r=u;break}case"AndThen":{r=Tn(Tn(u,a.second),a.first);break}case"RemoveService":{s.delete(a.key),r=u;break}case"UpdateService":{s.set(a.key,a.update(s.get(a.key))),n=!0,r=u;break}}}if(!n)return la(s);const o=new Map;for(const[a]of t.unsafeMap)s.has(a)&&(o.set(a,s.get(a)),s.delete(a));for(const[a,u]of s)o.set(a,u);return la(o)}),vB=Symbol.for("effect/DifferHashSetPatch");function G_(e){return e}const Qp={...Gp.prototype,[vB]:{_Value:G_,_Key:G_,_Patch:G_}},EB=Object.assign(Object.create(Qp),{_tag:"Empty"}),kB=Object.create(EB),mO=()=>kB,$B=Object.assign(Object.create(Qp),{_tag:"AndThen"}),CB=(e,t)=>{const n=Object.create($B);return n.first=e,n.second=t,n},TB=Object.assign(Object.create(Qp),{_tag:"Add"}),IB=e=>{const t=Object.create(TB);return t.value=e,t},RB=Object.assign(Object.create(Qp),{_tag:"Remove"}),OB=e=>{const t=Object.create(RB);return t.value=e,t},qB=(e,t)=>{const[n,r]=Jl([e,mO()],([s,o],a)=>Hp(a)(s)?[pw(a)(s),o]:[s,Yy(IB(a))(o)])(t);return Jl(r,(s,o)=>Yy(OB(o))(s))(n)},Yy=y(2,(e,t)=>CB(e,t)),AB=y(2,(e,t)=>{if(e._tag==="Empty")return t;let n=t,r=ft(e);for(;yo(r);){const s=Ss(r),o=Xs(r);switch(s._tag){case"Empty":{r=o;break}case"AndThen":{r=Tn(s.first)(Tn(s.second)(o));break}case"Add":{n=vc(s.value)(n),r=o;break}case"Remove":n=pw(s.value)(n),r=o}}return n}),PB=Symbol.for("effect/DifferReadonlyArrayPatch");function yk(e){return e}const nd={...Gp.prototype,[PB]:{_Value:yk,_Patch:yk}},FB=Object.assign(Object.create(nd),{_tag:"Empty"}),xB=Object.create(FB),pO=()=>xB,NB=Object.assign(Object.create(nd),{_tag:"AndThen"}),DB=(e,t)=>{const n=Object.create(NB);return n.first=e,n.second=t,n},MB=Object.assign(Object.create(nd),{_tag:"Append"}),LB=e=>{const t=Object.create(MB);return t.values=e,t},jB=Object.assign(Object.create(nd),{_tag:"Slice"}),UB=(e,t)=>{const n=Object.create(jB);return n.from=e,n.until=t,n},zB=Object.assign(Object.create(nd),{_tag:"Update"}),BB=(e,t)=>{const n=Object.create(zB);return n.index=e,n.patch=t,n},HB=e=>{let t=0,n=pO();for(;t<e.oldValue.length&&t<e.newValue.length;){const r=e.oldValue[t],s=e.newValue[t],o=e.differ.diff(r,s);me(o,e.differ.empty)||(n=Th(n,BB(t,o))),t=t+1}return t<e.oldValue.length&&(n=Th(n,UB(0,t))),t<e.newValue.length&&(n=Th(n,LB(JL(t)(e.newValue)))),n},Th=y(2,(e,t)=>DB(e,t)),VB=y(3,(e,t,n)=>{if(e._tag==="Empty")return t;let r=t.slice(),s=fr(e);for(;Sh(s);){const o=Un(s),a=aa(s);switch(o._tag){case"Empty":{s=a;break}case"AndThen":{a.unshift(o.first,o.second),s=a;break}case"Append":{for(const u of o.values)r.push(u);s=a;break}case"Slice":{r=r.slice(o.from,o.until),s=a;break}case"Update":{r[o.index]=n.patch(o.patch,r[o.index]),s=a;break}}}return r}),WB=Symbol.for("effect/Differ"),KB={[WB]:{_P:ce,_V:ce},pipe(){return ee(this,arguments)}},bu=e=>{const t=Object.create(KB);return t.empty=e.empty,t.diff=e.diff,t.combine=e.combine,t.patch=e.patch,t},JB=()=>bu({empty:hO(),combine:(e,t)=>Ch(t)(e),diff:(e,t)=>SB(e,t),patch:(e,t)=>wB(t)(e)}),GB=()=>bu({empty:mO(),combine:(e,t)=>Yy(t)(e),diff:(e,t)=>qB(e,t),patch:(e,t)=>AB(t)(e)}),QB=e=>bu({empty:pO(),combine:(t,n)=>Th(t,n),diff:(t,n)=>HB({oldValue:t,newValue:n,differ:e}),patch:(t,n)=>VB(t,n,e)}),gO=()=>YB((e,t)=>t),YB=e=>bu({empty:ce,combine:(t,n)=>t===ce?n:n===ce?t:r=>n(t(r)),diff:(t,n)=>me(t,n)?ce:pp(n),patch:(t,n)=>e(n,t(n))}),Ql=255,_O=8,Xy=e=>e&Ql,Zy=e=>e>>_O&Ql,rd=(e,t)=>(e&Ql)+((t&e&Ql)<<_O),XB=rd(0,0),ZB=e=>rd(e,e),eH=e=>rd(e,0),tH=y(2,(e,t)=>rd(Xy(e)&~t,Zy(e))),nH=y(2,(e,t)=>e|t),rH=e=>~e>>>0&Ql,sH=0,Su=1,oH=2,yO=4,eb=16,bO=32,iH=e=>Yp(e,bO),aH=y(2,(e,t)=>e|t),Wo=e=>SO(e)&&!uH(e),SO=e=>Yp(e,Su),Yp=y(2,(e,t)=>(e&t)!==0),wO=(...e)=>e.reduce((t,n)=>t|n,0),cH=wO(sH),bk=e=>Yp(e,yO),uH=e=>Yp(e,eb),ei=y(2,(e,t)=>rd(e^t,t)),Ec=y(2,(e,t)=>e&(rH(Xy(t))|Zy(t))|Xy(t)&Zy(t)),Sk=bu({empty:XB,diff:(e,t)=>ei(e,t),combine:(e,t)=>nH(t)(e),patch:(e,t)=>Ec(t,e)}),lH=ZB,vO=eH,wk=tH,EO=(e,t)=>({_tag:"Par",left:e,right:t}),Xd=(e,t)=>({_tag:"Seq",left:e,right:t}),fH=e=>{let t=Sw(e),n=zc();for(;;){const[r,s]=aB(t,[kO(),zc()],([o,a],u)=>{const[f,h]=dH(u);return[_H(o,f),sB(a,h)]});if(n=hH(n,r),io(s))return cB(n);t=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},dH=e=>{let t=e,n=kO(),r=zc(),s=zc();for(;;)switch(t._tag){case"Empty":{if(io(r))return[n,s];t=r.head,r=r.tail;break}case"Par":{r=pa(t.right,r),t=t.left;break}case"Seq":{const o=t.left,a=t.right;switch(o._tag){case"Empty":{t=a;break}case"Par":{const u=o.left,f=o.right;t=EO(Xd(u,a),Xd(f,a));break}case"Seq":{const u=o.left,f=o.right;t=Xd(u,Xd(f,a));break}case"Single":{t=o,s=pa(a,s);break}}break}case"Single":{if(n=gH(n,t),io(r))return[n,s];t=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},hH=(e,t)=>{if(io(e))return Sw(Q_(t));if(yH(t))return e;const n=kH(e.head),r=bH(t);return n.length===1&&r.length===1&&me(n[0],r[0])?pa(EH(e.head,Q_(t)),e.tail):pa(Q_(t),e)},mH=Symbol.for("effect/RequestBlock/RequestBlockParallel"),pH={_R:e=>e};var pT;pT=mH;class ww{constructor(t){d(this,"map");d(this,pT,pH);this.map=t}}const kO=()=>new ww(Jp()),gH=(e,t)=>new ww(Gz(e.map,t.dataSource,n=>wL(Zo(n,Hl(t.blockedRequest)),()=>ft(t.blockedRequest)))),_H=(e,t)=>new ww(lO(e.map,t.map,(n,r,s)=>Uc(n,s,ot(aO(n,s),{onNone:()=>r,onSome:o=>Rt(r,o)})))),yH=e=>Jz(e.map),bH=e=>Array.from(cO(e.map)),Q_=e=>vH(Qz(e.map,t=>ft(t))),SH=Symbol.for("effect/RequestBlock/RequestBlockSequential"),wH={_R:e=>e};var gT;gT=SH;class $O{constructor(t){d(this,"map");d(this,gT,wH);this.map=t}}const vH=e=>new $O(e),EH=(e,t)=>new $O(lO(t.map,e.map,(n,r,s)=>Uc(n,s,ot(aO(n,s),{onNone:()=>yt(),onSome:o=>Rt(o,r)})))),kH=e=>Array.from(cO(e.map)),$H=e=>Array.from(e.map),wu="Die",ga="Empty",qa="Fail",vu="Interrupt",Bc="Parallel",Hc="Sequential",CO="effect/Cause",TO=Symbol.for(CO),CH={_E:e=>e},Eu={[TO]:CH,[_e](){return v(Q(CO),fe(Q(xH(this))),ct(this))},[ye](e){return vw(e)&&FH(this,e)},pipe(){return ee(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:Ot(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:Ot(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:Ot(this.left),right:Ot(this.right)}}},toString(){return _i(this)},[Be](){return this.toJSON()}},bo=(()=>{const e=Object.create(Eu);return e._tag=ga,e})(),_a=e=>{const t=Object.create(Eu);return t._tag=qa,t.error=e,t},Bn=e=>{const t=Object.create(Eu);return t._tag=wu,t.defect=e,t},Ir=e=>{const t=Object.create(Eu);return t._tag=vu,t.fiberId=e,t},So=(e,t)=>{const n=Object.create(Eu);return n._tag=Bc,n.left=e,n.right=t,n},en=(e,t)=>{const n=Object.create(Eu);return n._tag=Hc,n.left=e,n.right=t,n},vw=e=>ne(e,TO),TH=e=>e._tag===ga,IH=e=>e._tag===qa,Ew=e=>e._tag===wu,kw=e=>e._tag===ga?!0:Vc(e,!0,(t,n)=>{switch(n._tag){case ga:return W(t);case wu:case qa:case vu:return W(!1);default:return V()}}),$w=e=>lt(qH(e)),Xp=e=>ng(void 0,DH)(e),RH=e=>_o(Vc(e,yt(),(t,n)=>n._tag===qa?W(v(t,Tn(n.error))):V())),IO=e=>_o(Vc(e,yt(),(t,n)=>n._tag===wu?W(v(t,Tn(n.defect))):V())),Cw=e=>Vc(e,ha(),(t,n)=>n._tag===vu?W(v(t,vc(n.fiberId))):V()),RO=e=>eg(e,t=>t._tag===qa?W(t.error):V()),Zp=e=>{const t=RO(e);switch(t._tag){case"None":return le(e);case"Some":return ae(t.value)}},OH=e=>tg(e,{onEmpty:W(bo),onFail:Zo(_a),onDie:t=>W(Bn(t)),onInterrupt:t=>W(Ir(t)),onSequential:Q0(en),onParallel:Q0(So)}),qH=e=>eg(e,t=>t._tag===vu?W(t.fiberId):V()),vk=e=>tg(e,{onEmpty:bo,onFail:()=>bo,onDie:Bn,onInterrupt:Ir,onSequential:en,onParallel:So}),AH=e=>tg(e,{onEmpty:bo,onFail:Bn,onDie:Bn,onInterrupt:Ir,onSequential:en,onParallel:So}),OO=y(2,(e,t)=>PH(e,n=>_a(t(n)))),PH=y(2,(e,t)=>tg(e,{onEmpty:bo,onFail:n=>t(n),onDie:n=>Bn(n),onInterrupt:n=>Ir(n),onSequential:(n,r)=>en(n,r),onParallel:(n,r)=>So(n,r)})),FH=(e,t)=>{let n=ft(e),r=ft(t);for(;yo(n)&&yo(r);){const[s,o]=v(Ss(n),Vc([ha(),yt()],([f,h],p)=>{const[g,k]=tb(p);return W([v(f,Kl(g)),v(h,Rt(k))])})),[a,u]=v(Ss(r),Vc([ha(),yt()],([f,h],p)=>{const[g,k]=tb(p);return W([v(f,Kl(g)),v(h,Rt(k))])}));if(!me(s,a))return!1;n=o,r=u}return!0},xH=e=>NH(ft(e),yt()),NH=(e,t)=>{for(;;){const[n,r]=v(e,JS([ha(),yt()],([o,a],u)=>{const[f,h]=tb(u);return[v(o,Kl(f)),v(a,Rt(h))]})),s=mw(n)>0?v(t,Tn(n)):t;if(ed(r))return _o(s);e=r,t=s}throw new Error(bp("Cause.flattenCauseLoop"))},eg=y(2,(e,t)=>{const n=[e];for(;n.length>0;){const r=n.pop(),s=t(r);switch(s._tag){case"None":{switch(r._tag){case Hc:case Bc:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return V()}),tb=e=>{let t=e;const n=[];let r=ha(),s=yt();for(;t!==void 0;)switch(t._tag){case ga:{if(n.length===0)return[r,s];t=n.pop();break}case qa:{if(r=vc(r,J_(t._tag,t.error)),n.length===0)return[r,s];t=n.pop();break}case wu:{if(r=vc(r,J_(t._tag,t.defect)),n.length===0)return[r,s];t=n.pop();break}case vu:{if(r=vc(r,J_(t._tag,t.fiberId)),n.length===0)return[r,s];t=n.pop();break}case Hc:{switch(t.left._tag){case ga:{t=t.right;break}case Hc:{t=en(t.left.left,en(t.left.right,t.right));break}case Bc:{t=So(en(t.left.left,t.right),en(t.left.right,t.right));break}default:{s=Tn(s,t.right),t=t.left;break}}break}case Bc:{n.push(t.right),t=t.left;break}}throw new Error(bp("Cause.evaluateCauseLoop"))},DH={emptyCase:J0,failCase:Yn,dieCase:Yn,interruptCase:J0,sequentialCase:(e,t,n)=>t&&n,parallelCase:(e,t,n)=>t&&n},Ek="SequentialCase",kk="ParallelCase",tg=y(2,(e,{onDie:t,onEmpty:n,onFail:r,onInterrupt:s,onParallel:o,onSequential:a})=>ng(e,void 0,{emptyCase:()=>n,failCase:(u,f)=>r(f),dieCase:(u,f)=>t(f),interruptCase:(u,f)=>s(f),sequentialCase:(u,f,h)=>a(f,h),parallelCase:(u,f,h)=>o(f,h)})),Vc=y(3,(e,t,n)=>{let r=t,s=e;const o=[];for(;s!==void 0;){const a=n(r,s);switch(r=lt(a)?a.value:r,s._tag){case Hc:{o.push(s.right),s=s.left;break}case Bc:{o.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&o.length>0&&(s=o.pop())}return r}),ng=y(3,(e,t,n)=>{const r=[e],s=[];for(;r.length>0;){const a=r.pop();switch(a._tag){case ga:{s.push(le(n.emptyCase(t)));break}case qa:{s.push(le(n.failCase(t,a.error)));break}case wu:{s.push(le(n.dieCase(t,a.defect)));break}case vu:{s.push(le(n.interruptCase(t,a.fiberId)));break}case Hc:{r.push(a.right),r.push(a.left),s.push(ae({_tag:Ek}));break}case Bc:{r.push(a.right),r.push(a.left),s.push(ae({_tag:kk}));break}}}const o=[];for(;s.length>0;){const a=s.pop();switch(a._tag){case"Left":{switch(a.left._tag){case Ek:{const u=o.pop(),f=o.pop(),h=n.sequentialCase(t,u,f);o.push(h);break}case kk:{const u=o.pop(),f=o.pop(),h=n.parallelCase(t,u,f);o.push(h);break}}break}case"Right":{o.push(a.right);break}}}if(o.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return o.pop()}),_i=(e,t)=>Xp(e)?"All fibers interrupted without errors.":Tw(e).map(function(n){return(t==null?void 0:t.renderErrorCause)!==!0||n.cause===void 0?n.stack:`${n.stack} {
${qO(n.cause,"  ")}
}`}).join(`
`),qO=(e,t)=>{const n=e.stack.split(`
`);let r=`${t}[cause]: ${n[0]}`;for(let s=1,o=n.length;s<o;s++)r+=`
${t}${n[s]}`;return e.cause&&(r+=` {
${qO(e.cause,`${t}  `)}
${t}}`),r};class lm extends globalThis.Error{constructor(n){const r=typeof n=="object"&&n!==null,s=Error.stackTraceLimit;Error.stackTraceLimit=1;super(AO(n),r&&"cause"in n&&typeof n.cause<"u"?{cause:new lm(n.cause)}:void 0);d(this,"span");this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=s,this.name=n instanceof Error?n.name:"Error",r&&(Wc in n&&(this.span=n[Wc]),Object.keys(n).forEach(o=>{o in this||(this[o]=n[o])})),this.stack=LH(`${this.name}: ${this.message}`,n instanceof Error&&n.stack?n.stack:"",this.span)}}const AO=e=>{if(typeof e=="string")return e;if(typeof e=="object"&&e!==null&&e instanceof Error)return e.message;try{if(ne(e,"toString")&&du(e.toString)&&e.toString!==Object.prototype.toString&&e.toString!==globalThis.Array.prototype.toString)return e.toString()}catch{}return m1(e)},MH=/\((.*)\)/g,fm=Te("effect/Tracer/spanToTrace",()=>new WeakMap),LH=(e,t,n)=>{const r=[e],s=t.startsWith(e)?t.slice(e.length).split(`
`):t.split(`
`);for(let o=1;o<s.length;o++){if(s[o].includes(" at new BaseEffectError")||s[o].includes(" at new YieldableError")){o++;continue}if(s[o].includes("Generator.next")||s[o].includes("effect_internal_function"))break;r.push(s[o].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let o=n,a=0;for(;o&&o._tag==="Span"&&a<10;){const u=fm.get(o);if(typeof u=="function"){const f=u();if(typeof f=="string"){const h=f.matchAll(MH);let p=!1;for(const[,g]of h)p=!0,r.push(`    at ${o.name} (${g})`);p||r.push(`    at ${o.name} (${f.replace(/^at /,"")})`)}else r.push(`    at ${o.name}`)}else r.push(`    at ${o.name}`);o=hr(o.parent),a++}}return r.join(`
`)},Wc=Symbol.for("effect/SpanAnnotation"),Tw=e=>ng(e,void 0,{emptyCase:()=>[],dieCase:(t,n)=>[new lm(n)],failCase:(t,n)=>[new lm(n)],interruptCase:()=>[],parallelCase:(t,n,r)=>[...n,...r],sequentialCase:(t,n,r)=>[...n,...r]}),sd="Pending",rg="Done",jH="effect/Deferred",UH=Symbol.for(jH),zH={_E:e=>e,_A:e=>e},BH=e=>({_tag:sd,joiners:e}),PO=e=>({_tag:rg,effect:e});class ku{constructor(t){d(this,"self");d(this,"called",!1);this.self=t}next(t){return this.called?{value:t,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(t){return{value:t,done:!0}}throw(t){throw t}[Symbol.iterator](){return new ku(this.self)}}const FO=(e,t)=>{const n=new rn("Blocked");return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n},HH=e=>{const t=new rn("RunBlocked");return t.effect_instruction_i0=e,t},ya=Symbol.for("effect/Effect");class VH{constructor(t,n){d(this,"patch");d(this,"op");d(this,"_op",US);this.patch=t,this.op=n}}var _T;class rn{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,_T,oa);this._op=t}[(_T=ya,ye)](t){return this===t}[_e](){return ct(this,Sp(this))}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:Ot(this.effect_instruction_i0),effect_instruction_i1:Ot(this.effect_instruction_i1),effect_instruction_i2:Ot(this.effect_instruction_i2)}}toString(){return dt(this.toJSON())}[Be](){return this.toJSON()}[Symbol.iterator](){return new ku(new hu(this))}}var yT;class xO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,yT,oa);this._op=t,this._tag=t}[(yT=ya,ye)](t){return gg(t)&&t._op==="Failure"&&me(this.effect_instruction_i0,t.effect_instruction_i0)}[_e](){return v(Tt(this._tag),fe(Q(this.effect_instruction_i0)),ct(this))}get cause(){return this.effect_instruction_i0}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return dt(this.toJSON())}[Be](){return this.toJSON()}[Symbol.iterator](){return new ku(new hu(this))}}var bT;class NO{constructor(t){d(this,"_op");d(this,"effect_instruction_i0");d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,"trace");d(this,bT,oa);this._op=t,this._tag=t}[(bT=ya,ye)](t){return gg(t)&&t._op==="Success"&&me(this.effect_instruction_i0,t.effect_instruction_i0)}[_e](){return v(Tt(this._tag),fe(Q(this.effect_instruction_i0)),ct(this))}get value(){return this.effect_instruction_i0}pipe(){return ee(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:Ot(this.value)}}toString(){return dt(this.toJSON())}[Be](){return this.toJSON()}[Symbol.iterator](){return new ku(new hu(this))}}const wr=e=>ne(e,ya),Fe=e=>{const t=new rn(_1);return t.effect_instruction_i0=e,t},DO=y(3,(e,t,n)=>Sr(r=>U(e,s=>U(ks(pe(()=>r(t(s)))),o=>pe(()=>n(s,o)).pipe(Vn({onFailure:a=>{switch(o._tag){case dn:return $t(en(o.effect_instruction_i0,a));case hn:return $t(a)}},onSuccess:()=>o})))))),tn=y(2,(e,t)=>U(e,()=>J(t))),or=e=>tn(e,void 0),MO=function(){const e=new rn(Vf);switch(arguments.length){case 2:{e.effect_instruction_i0=arguments[0],e.commit=arguments[1];break}case 3:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.commit=arguments[2];break}case 4:{e.effect_instruction_i0=arguments[0],e.effect_instruction_i1=arguments[1],e.effect_instruction_i2=arguments[2],e.commit=arguments[3];break}default:throw new Error(bp("you're not supposed to end up here"))}return e},Yl=(e,t=zn)=>{const n=new rn(kl);let r;return n.effect_instruction_i0=s=>{r=e(s)},n.effect_instruction_i1=t,Pa(n,s=>wr(r)?r:Qe)},Go=(e,t=zn)=>pe(()=>Yl(e,t)),ns=(e,t=zn)=>MO(e,function(){let n,r;function s(f){n?n(f):r===void 0&&(r=f)}const o=new rn(kl);o.effect_instruction_i0=f=>{n=f,r&&f(r)},o.effect_instruction_i1=t;let a,u;return this.effect_instruction_i0.length!==1?(u=new AbortController,a=gt(()=>this.effect_instruction_i0(s,u.signal))):a=gt(()=>this.effect_instruction_i0(s)),a||u?Pa(o,f=>(u&&u.abort(),a??Qe)):o}),sg=y(2,(e,t)=>{const n=new rn(yh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),Kc=y(2,(e,t)=>wo(e,{onFailure:t,onSuccess:J})),LO=y(3,(e,t,n)=>sg(e,r=>{const s=Zp(r);switch(s._tag){case"Left":return t(s.left)?n(s.left):$t(r);case"Right":return $t(s.right)}})),$k=Symbol.for("effect/OriginalAnnotation"),Iw=(e,t)=>lt(t)?new Proxy(e,{has(n,r){return r===Wc||r===$k||r in n},get(n,r){return r===Wc?t.value:r===$k?e:n[r]}}):e,Xl=e=>Ls(e)&&!(Wc in e)?Fe(t=>$t(Bn(Iw(e,jw(t))))):$t(Bn(e)),nb=e=>jO(()=>Bn(new $4(e))),Jc=e=>wo(e,{onFailure:t=>J(ae(t)),onSuccess:t=>J(le(t))}),ks=e=>UO(e,{onFailure:st,onSuccess:Ge}),St=e=>Ls(e)&&!(Wc in e)?Fe(t=>$t(_a(Iw(e,jw(t))))):$t(_a(e)),od=e=>U(K(e),St),$t=e=>{const t=new xO(dn);return t.effect_instruction_i0=e,t},jO=e=>U(K(e),$t),og=Fe(e=>J(e.id())),Aa=e=>Fe(t=>e(t.id())),U=y(2,(e,t)=>{const n=new rn(Gh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t,n}),WH=y(2,(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return wr(r)?r:c1(r)?Yl(s=>{r.then(o=>s(J(o)),o=>s(St(new pg(o,"An unknown error occurred in Effect.andThen"))))}):J(r)})),KH=e=>{const t=new rn("OnStep");return t.effect_instruction_i0=e,t},$u=e=>U(e,ce),UO=y(2,(e,t)=>Vn(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),Vn=y(2,(e,t)=>{const n=new rn(Qh);return n.effect_instruction_i0=e,n.effect_instruction_i1=t.onFailure,n.effect_instruction_i2=t.onSuccess,n}),wo=y(2,(e,t)=>Vn(e,{onFailure:n=>{if(IO(n).length>0)return $t(AH(n));const s=RH(n);return s.length>0?t.onFailure(xp(s)):$t(n)},onSuccess:t.onSuccess})),Zs=y(2,(e,t)=>pe(()=>{const n=ze(e),r=kp(n.length);let s=0;return tn(qw({while:()=>s<n.length,body:()=>t(n[s],s),step:o=>{r[s++]=o}}),r)})),Gc=y(2,(e,t)=>pe(()=>{const n=ze(e);let r=0;return qw({while:()=>r<n.length,body:()=>t(n[r],r),step:()=>{r++}})})),_n=U(og,e=>zO(e)),zO=e=>$t(Ir(e)),ig=e=>{const t=new rn(mu);return t.effect_instruction_i0=lH(Su),t.effect_instruction_i1=()=>e,t},BO=y(2,(e,t)=>Sr(n=>U(ks(n(e)),r=>rq(t,r)))),Se=y(2,(e,t)=>U(e,n=>K(()=>t(n)))),Rw=y(2,(e,t)=>wo(e,{onFailure:n=>od(()=>t.onFailure(n)),onSuccess:n=>K(()=>t.onSuccess(n))})),ag=y(2,(e,t)=>Vn(e,{onFailure:n=>{const r=Zp(n);switch(r._tag){case"Left":return od(()=>t(r.left));case"Right":return $t(r.right)}},onSuccess:J})),JH=y(2,(e,t)=>Rs(e,n=>tq(n)?Qe:t(n.effect_instruction_i0))),Rs=y(2,(e,t)=>Sr(n=>Vn(n(e),{onFailure:r=>{const s=st(r);return Vn(t(s),{onFailure:o=>st(en(r,o)),onSuccess:()=>s})},onSuccess:r=>{const s=Ge(r);return It(t(s),s)}}))),Pa=y(2,(e,t)=>Rs(e,_g({onFailure:n=>Xp(n)?or(t(Cw(n))):Qe,onSuccess:()=>Qe}))),Ow=e=>GH(e,ce),GH=y(2,(e,t)=>wo(e,{onFailure:n=>Xl(t(n)),onSuccess:J})),QH=Fe((e,t)=>J(t.runtimeFlags)),J=e=>{const t=new NO(hn);return t.effect_instruction_i0=e,t},pe=e=>{const t=new rn(Vf);return t.commit=e,t},K=e=>{const t=new rn(g1);return t.effect_instruction_i0=e,t},cg=y(e=>e.length===3||e.length===2&&!(Ls(e[1])&&"onlyEffect"in e[1]),(e,t)=>U(e,n=>{const r=typeof t=="function"?t(n):t;return wr(r)?tn(r,n):c1(r)?Yl(s=>{r.then(o=>s(J(n)),o=>s(St(new pg(o,"An unknown error occurred in Effect.tap"))))}):J(n)})),YH=e=>Fe(t=>{const n=t.getFiberRef(sb),r=v(n,Et(()=>t.scope()));return e(Ao(sb,W(r)))}),yi=e=>{const t=new rn(mu);return t.effect_instruction_i0=vO(Su),t.effect_instruction_i1=()=>e,t},Sr=e=>MO(e,function(){const t=new rn(mu);return t.effect_instruction_i0=vO(Su),t.effect_instruction_i1=n=>SO(n)?gt(()=>this.effect_instruction_i0(ig)):gt(()=>this.effect_instruction_i0(yi)),t}),Qe=J(void 0),HO=e=>{const t=new rn(mu);return t.effect_instruction_i0=e,t.effect_instruction_i1=void 0,t},id=y(2,(e,t)=>U(t,n=>n?v(e,Se(W)):J(V()))),qw=e=>{const t=new rn(Yh);return t.effect_instruction_i0=e.while,t.effect_instruction_i1=e.body,t.effect_instruction_i2=e.step,t},dm=e=>pe(()=>{const t=new rn($l);return t.effect_instruction_i0=e(),t}),XH=function(){const e=arguments.length===1?arguments[0]:arguments[1].bind(arguments[0]);return dm(()=>e(v))},ZH=(e,...t)=>Object.defineProperty(t.length===0?function(...n){return dm(()=>e.apply(this,n))}:function(...n){let r=dm(()=>e.apply(this,n));for(const s of t)r=s(r,...n);return r},"length",{value:e.length,configurable:!0}),e4=y(2,(e,t)=>{const n=new rn(mu);return n.effect_instruction_i0=t,n.effect_instruction_i1=()=>e,n}),ug=e=>{const t=new rn(bh);return typeof(e==null?void 0:e.priority)<"u"?_4(t,e.priority):t},lg=y(2,(e,t)=>U(e,n=>Se(t,r=>[n,r]))),Aw=y(2,(e,t)=>U(e,n=>tn(t,n))),It=y(2,(e,t)=>U(e,()=>t)),VO=y(3,(e,t,n)=>U(e,r=>Se(t,s=>n(r,s)))),t4=Go(()=>{const e=setInterval(()=>{},2147483647);return K(()=>clearInterval(e))}),Pw=e=>U(og,t=>v(e,eo(t))),eo=y(2,(e,t)=>U(e.interruptAsFork(t),()=>e.await)),n4={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return ee(this,arguments)}},r4={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return ee(this,arguments)}},s4={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return ee(this,arguments)}},o4={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return ee(this,arguments)}},WO={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return ee(this,arguments)}},KO={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return ee(this,arguments)}},i4={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return ee(this,arguments)}},a4={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return ee(this,arguments)}},c4="effect/FiberRef",u4=Symbol.for(c4),l4={_A:e=>e},ad=e=>Fe(t=>Ge(t.getFiberRef(e))),Cu=y(2,(e,t)=>U(ad(e),t)),hm=y(2,(e,t)=>f4(e,()=>[void 0,t])),f4=y(2,(e,t)=>Fe(n=>{const[r,s]=t(n.getFiberRef(e));return n.setFiberRef(e,s),J(r)})),Ao=y(3,(e,t,n)=>DO(Aw(ad(t),hm(t,n)),()=>e,r=>hm(t,r))),fg=y(3,(e,t,n)=>Cu(t,r=>Ao(e,t,n(r)))),wn=(e,t)=>Tu(e,{differ:gO(),fork:(t==null?void 0:t.fork)??ce,join:t==null?void 0:t.join}),d4=e=>{const t=GB();return Tu(e,{differ:t,fork:t.empty})},h4=e=>{const t=QB(gO());return Tu(e,{differ:t,fork:t.empty})},JO=e=>{const t=JB();return Tu(e,{differ:t,fork:t.empty})},Tu=(e,t)=>({...Kf,[u4]:l4,initial:e,commit(){return ad(this)},diff:(r,s)=>t.differ.diff(r,s),combine:(r,s)=>t.differ.combine(r,s),patch:r=>s=>t.differ.patch(r,s),fork:t.fork,join:t.join??((r,s)=>s)}),m4=e=>Tu(e,{differ:Sk,fork:Sk.empty}),os=Te(Symbol.for("effect/FiberRef/currentContext"),()=>JO(po())),bi=Te(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>wn(0)),dg=Te(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>wn(2048)),GO=Te(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>wn(Jp())),p4=Te(Symbol.for("effect/FiberRef/currentLogLevel"),()=>wn(WO)),g4=Te(Symbol.for("effect/FiberRef/currentLogSpan"),()=>wn(zc())),_4=y(2,(e,t)=>Ao(e,bi,t)),y4=y(2,(e,t)=>Ao(e,dg,t)),b4=Te(Symbol.for("effect/FiberRef/currentConcurrency"),()=>wn("unbounded")),S4=Te(Symbol.for("effect/FiberRef/currentRequestBatching"),()=>wn(!0)),QO=Te(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>wn(W(KO))),w4=y(2,(e,t)=>Ao(e,QO,t)),rb=Te(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>h4(oi())),sb=Te(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>wn(V(),{fork:()=>V(),join:(e,t)=>e})),Zd=Te(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>wn(bo,{fork:()=>bo,join:(e,t)=>e})),YO=Te(Symbol.for("effect/FiberRef/currentTracerEnabled"),()=>wn(!0)),hg=Te(Symbol.for("effect/FiberRef/currentTracerTiming"),()=>wn(!0)),XO=Te(Symbol.for("effect/FiberRef/currentTracerSpanAnnotations"),()=>wn(Jp())),v4=Te(Symbol.for("effect/FiberRef/currentTracerSpanLinks"),()=>wn(yt())),Ck=Symbol.for("effect/Scope"),Tk=Symbol.for("effect/CloseableScope"),ZO=(e,t)=>e.addFinalizer(()=>or(t)),Zl=(e,t)=>e.addFinalizer(t),ob=(e,t)=>e.close(t),mg=(e,t)=>e.fork(t),E4=e=>k4(ce)(e),k4=y(2,(e,t)=>{const n=v(e,RO,Zo(t));switch(n._tag){case"None":return v(IO(e),Fp,ot({onNone:()=>{const r=ze(Cw(e)).flatMap(s=>ze(Kp(s)).map(o=>`#${o}`));return new C4(r?`Interrupted by fibers: ${r.join(", ")}`:void 0)},onSome:ce}));case"Some":return n.value}}),Fw=(function(){class e extends globalThis.Error{commit(){return St(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[Be](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?_i(_a(this),{renderErrorCause:!0}):this}}return Object.assign(e.prototype,oL),e})(),cd=(e,t)=>{class n extends Fw{constructor(){super(...arguments);d(this,"_tag",t)}}return Object.assign(n.prototype,e),n.prototype.name=t,n},Ik=Symbol.for("effect/Cause/errors/RuntimeException"),$4=cd({[Ik]:Ik},"RuntimeException"),ib=Symbol.for("effect/Cause/errors/InterruptedException"),C4=cd({[ib]:ib},"InterruptedException"),T4=e=>ne(e,ib),Rk=Symbol.for("effect/Cause/errors/IllegalArgument"),I4=cd({[Rk]:Rk},"IllegalArgumentException"),Ok=Symbol.for("effect/Cause/errors/NoSuchElement"),ud=cd({[Ok]:Ok},"NoSuchElementException"),qk=Symbol.for("effect/Cause/errors/Timeout"),R4=cd({[qk]:qk},"TimeoutException"),O4=e=>new R4(`Operation timed out after '${HR(e)}'`),Ak=Symbol.for("effect/Cause/errors/UnknownException"),pg=(function(){class e extends Fw{constructor(r,s){super(s??"An unknown error occurred",{cause:r});d(this,"_tag","UnknownException");d(this,"error");this.error=r}}return Object.assign(e.prototype,{[Ak]:Ak,name:"UnknownException"}),e})(),gg=e=>wr(e)&&"_tag"in e&&(e._tag==="Success"||e._tag==="Failure"),eq=e=>e._tag==="Failure",tq=e=>e._tag==="Success",q4=e=>{switch(e._tag){case dn:return $w(e.effect_instruction_i0);case hn:return!1}},Ih=y(2,(e,t)=>{switch(e._tag){case dn:return st(e.effect_instruction_i0);case hn:return Ge(t)}}),Y_=e=>Ih(e,void 0),kc=(e,t)=>F4(e,t!=null&&t.parallel?So:en),dc=e=>st(Bn(e)),ef=e=>st(_a(e)),st=e=>{const t=new xO(dn);return t.effect_instruction_i0=e,t},xw=e=>st(Ir(e)),Rh=y(2,(e,t)=>{switch(e._tag){case dn:return st(e.effect_instruction_i0);case hn:return Ge(t(e.effect_instruction_i0))}}),A4=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case dn:return st(v(e.effect_instruction_i0,OO(t)));case hn:return Ge(n(e.effect_instruction_i0))}}),_g=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case dn:return t(e.effect_instruction_i0);case hn:return n(e.effect_instruction_i0)}}),ab=y(2,(e,{onFailure:t,onSuccess:n})=>{switch(e._tag){case dn:return t(e.effect_instruction_i0);case hn:return n(e.effect_instruction_i0)}}),Ge=e=>{const t=new NO(hn);return t.effect_instruction_i0=e,t},qn=Ge(void 0),P4=y(2,(e,t)=>Nw(e,t,{onSuccess:(n,r)=>[n,r],onFailure:en})),nq=y(2,(e,t)=>Nw(e,t,{onSuccess:(n,r)=>r,onFailure:en})),Nw=y(3,(e,t,{onFailure:n,onSuccess:r})=>{switch(e._tag){case dn:switch(t._tag){case hn:return st(e.effect_instruction_i0);case dn:return st(n(e.effect_instruction_i0,t.effect_instruction_i0))}case hn:switch(t._tag){case hn:return Ge(r(e.effect_instruction_i0,t.effect_instruction_i0));case dn:return st(t.effect_instruction_i0)}}}),F4=(e,t)=>{const n=go(e);return yo(n)?v(Xs(n),JS(v(Ss(n),Rh(ft)),(r,s)=>v(r,Nw(s,{onSuccess:(o,a)=>v(o,Tn(a)),onFailure:t}))),Rh(_o),Rh(r=>pr(r)),W):V()},Iu=e=>({...Kf,[UH]:zH,state:Ra(BH([])),commit(){return rs(this)},blockingOn:e}),Ru=()=>U(og,e=>x4(e)),x4=e=>K(()=>Iu(e)),rs=e=>Go(t=>{const n=He(e.state);switch(n._tag){case rg:return t(n.effect);case sd:return n.joiners.push(t),M4(e,t)}},e.blockingOn),ld=y(2,(e,t)=>K(()=>{const n=He(e.state);switch(n._tag){case rg:return!1;case sd:{Oa(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t);return!0}}})),rq=y(2,(e,t)=>ld(e,t)),N4=y(2,(e,t)=>ld(e,St(t))),sq=y(2,(e,t)=>ld(e,$t(t))),Dw=y(2,(e,t)=>ld(e,zO(t))),D4=e=>K(()=>He(e.state)._tag===rg),fd=y(2,(e,t)=>ld(e,J(t))),dd=(e,t)=>{const n=He(e.state);if(n._tag===sd){Oa(e.state,PO(t));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](t)}},M4=(e,t)=>K(()=>{const n=He(e.state);if(n._tag===sd){const r=n.joiners.indexOf(t);r>=0&&n.joiners.splice(r,1)}}),L4=Fe(e=>Ge(e.currentContext)),hd=()=>L4,Ou=e=>U(hd(),e),Mw=y(2,(e,t)=>Ao(os,t)(e)),Lw=y(2,(e,t)=>fg(os,n=>qo(n,t))(e)),oq=y(2,(e,t)=>Ou(n=>Mw(e,t(n)))),jw=e=>{const t=e.currentSpan;return t!==void 0&&t._tag==="Span"?W(t):V()},j4={_tag:"Span",spanId:"noop",traceId:"noop",sampled:!1,status:{_tag:"Ended",startTime:BigInt(0),endTime:BigInt(0),exit:qn},attributes:new Map,links:[],kind:"internal",attribute(){},event(){},end(){},addLinks(){}},U4=e=>Object.assign(Object.create(j4),e),Ue=Ru,Vt=rs,Fa=rq,Uw=N4,iq=sq,cb=D4,ut=fd,z4=Iu,Di=dd,B4=gg,xa=eq,Qc=tq,H4=q4,V4=kc,tf=dc,md=ef,ln=st,W4=xw,K4=Rh,J4=A4,Zr=_g,Kt=Ge,tr=qn,Pk=P4,nf=nq,Fk=Symbol.for("effect/MutableHashMap"),G4={[Fk]:Fk,[Symbol.iterator](){return new zw(this)},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(Ot)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}};class zw{constructor(t){d(this,"self");d(this,"referentialIterator");d(this,"bucketIterator");this.self=t,this.referentialIterator=t.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const t=this.referentialIterator.next();return t.done?(this.bucketIterator=new Q4(this.self.buckets.values()),this.next()):t}[Symbol.iterator](){return new zw(this.self)}}class Q4{constructor(t){d(this,"backing");d(this,"currentBucket");this.backing=t}next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const t=this.currentBucket.next();return t.done?(this.currentBucket=void 0,this.next()):t}}const aq=()=>{const e=Object.create(G4);return e.referential=new Map,e.buckets=new Map,e.bucketsSize=0,e},hs=y(2,(e,t)=>{if(Ul(t)===!1)return e.referential.has(t)?W(e.referential.get(t)):V();const n=t[_e](),r=e.buckets.get(n);return r===void 0?V():Y4(e,r,t)}),Y4=(e,t,n,r=!1)=>{for(let s=0,o=t.length;s<o;s++)if(n[ye](t[s][0])){const a=t[s][1];return r&&(t.splice(s,1),e.bucketsSize--),W(a)}return V()},rc=y(2,(e,t)=>lt(hs(e,t))),sc=y(3,(e,t,n)=>{if(Ul(t)===!1)return e.referential.set(t,n),e;const r=t[_e](),s=e.buckets.get(r);return s===void 0?(e.buckets.set(r,[[t,n]]),e.bucketsSize++,e):(cq(e,s,t),s.push([t,n]),e.bucketsSize++,e)}),cq=(e,t,n)=>{for(let r=0,s=t.length;r<s;r++)if(n[ye](t[r][0])){t.splice(r,1),e.bucketsSize--;return}},X4=y(2,(e,t)=>{if(Ul(t)===!1)return e.referential.delete(t),e;const n=t[_e](),r=e.buckets.get(n);return r===void 0||(cq(e,r,t),r.length===0&&e.buckets.delete(n)),e}),xk=Symbol.for("effect/MutableList"),Z4={[xk]:xk,[Symbol.iterator](){let e=!1,t=this.head;return{next(){if(e)return this.return();if(t==null)return e=!0,this.return();const n=t.value;return t=t.next,{done:e,value:n}},return(n){return e||(e=!0),{done:!0,value:n}}}},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableList",values:Array.from(this).map(Ot)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},e6=e=>({value:e,removed:!1,prev:void 0,next:void 0}),t6=()=>{const e=Object.create(Z4);return e.head=void 0,e.tail=void 0,e._length=0,e},uq=e=>Bw(e)===0,Bw=e=>e._length,n6=y(2,(e,t)=>{const n=e6(t);return e.head===void 0&&(e.head=n),e.tail===void 0||(e.tail.next=n,n.prev=e.tail),e.tail=n,e._length+=1,e}),r6=e=>{const t=e.head;if(t!==void 0)return s6(e,t),t.value},s6=(e,t)=>{t.removed||(t.removed=!0,t.prev!==void 0&&t.next!==void 0?(t.prev.next=t.next,t.next.prev=t.prev):t.prev!==void 0?(e.tail=t.prev,t.prev.next=void 0):t.next!==void 0?(e.head=t.next,t.next.prev=void 0):(e.tail=void 0,e.head=void 0),e._length>0&&(e._length-=1))},Nk=Symbol.for("effect/MutableQueue"),Wt=Symbol.for("effect/mutable/MutableQueue/Empty"),o6={[Nk]:Nk,[Symbol.iterator](){return Array.from(this.queue)[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"MutableQueue",values:Array.from(this).map(Ot)}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},lq=e=>{const t=Object.create(o6);return t.queue=t6(),t.capacity=e,t},Hw=e=>lq(e),yg=()=>lq(void 0),Vw=e=>Bw(e.queue),Ji=e=>uq(e.queue),i6=e=>e.capacity===void 0?1/0:e.capacity,Yc=y(2,(e,t)=>{const n=Bw(e.queue);return e.capacity!==void 0&&n===e.capacity?!1:(n6(t)(e.queue),!0)}),Ww=y(2,(e,t)=>{const n=t[Symbol.iterator]();let r,s=yt(),o=!0;for(;o&&(r=n.next())&&!r.done;)o=Yc(r.value)(e);for(;r!=null&&!r.done;)s=Tn(r.value)(s),r=n.next();return _o(s)}),ao=y(2,(e,t)=>uq(e.queue)?t:r6(e.queue)),bg=y(2,(e,t)=>{let n=yt(),r=0;for(;r<t;){const s=ao(Wt)(e);if(s===Wt)break;n=Tn(s)(n),r+=1}return _o(n)}),a6="effect/Clock",Dk=Symbol.for(a6),Na=sr("effect/Clock"),c6=2**31-1,Mk={unsafeSchedule(e,t){const n=Dc(t);if(n>c6)return Yn;let r=!1;const s=setTimeout(()=>{r=!0,e()},n);return()=>(clearTimeout(s),!r)}},Lk=(function(){const e=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*e;let t;return()=>(t===void 0&&(t=BigInt(Date.now())*e-BigInt(Math.round(performance.now()*1e6))),t+BigInt(Math.round(performance.now()*1e6)))})(),u6=(function(){const e=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!e)return Lk;const t=Lk()-e.bigint();return()=>t+e.bigint()})();var ST;ST=Dk;class l6{constructor(){d(this,ST,Dk);d(this,"currentTimeMillis",K(()=>this.unsafeCurrentTimeMillis()));d(this,"currentTimeNanos",K(()=>this.unsafeCurrentTimeNanos()))}unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return u6()}scheduler(){return J(Mk)}sleep(t){return ns(n=>{const r=Mk.unsafeSchedule(()=>n(Qe),t);return or(K(r))})}}const f6=()=>new l6,fq="And",dq="Or",hq="InvalidData",mq="MissingData",pq="SourceUnavailable",gq="Unsupported",d6="effect/ConfigError",jk=Symbol.for(d6),qu={_tag:"ConfigError",[jk]:jk},_q=(e,t)=>{const n=Object.create(qu);return n._op=fq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},yq=(e,t)=>{const n=Object.create(qu);return n._op=dq,n.left=e,n.right=t,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},h6=(e,t,n={pathDelim:"."})=>{const r=Object.create(qu);return r._op=hq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${v(this.path,Ia(n.pathDelim))}: "${this.message}")`}}),r},ba=(e,t,n={pathDelim:"."})=>{const r=Object.create(qu);return r._op=mq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${v(this.path,Ia(n.pathDelim))}: "${this.message}")`}}),r},m6=(e,t,n,r={pathDelim:"."})=>{const s=Object.create(qu);return s._op=pq,s.path=e,s.message=t,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${v(this.path,Ia(r.pathDelim))}: "${this.message}")`}}),s},p6=(e,t,n={pathDelim:"."})=>{const r=Object.create(qu);return r._op=gq,r.path=e,r.message=t,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${v(this.path,Ia(n.pathDelim))}: "${this.message}")`}}),r},Mi=y(2,(e,t)=>{switch(e._op){case fq:return _q(Mi(e.left,t),Mi(e.right,t));case dq:return yq(Mi(e.left,t),Mi(e.right,t));case hq:return h6([...t,...e.path],e.message);case mq:return ba([...t,...e.path],e.message);case pq:return m6([...t,...e.path],e.message,e.cause);case gq:return p6([...t,...e.path],e.message)}}),g6={_tag:"Empty"},X_=y(2,(e,t)=>{let n=Sw(t),r=e;for(;bw(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=pa(s.first,pa(s.second,n.tail));break}case"MapName":{r=so(r,s.f),n=n.tail;break}case"Nested":{r=Xh(r,s.name),n=n.tail;break}case"Unnested":{if(v(yc(r),IL(s.name)))r=aa(r),n=n.tail;else return ae(ba(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return le(r)}),_6="Constant",y6="Fail",b6="Fallback",S6="Described",w6="Lazy",v6="MapOrFail",E6="Nested",k6="Primitive",$6="Sequence",C6="HashMap",T6="ZipWith";var Uk={};const mm=(e,t)=>[...e,...t],I6="effect/ConfigProvider",zk=Symbol.for(I6),R6=sr("effect/ConfigProvider"),O6="effect/ConfigProviderFlat",Bk=Symbol.for(O6),q6=e=>({[zk]:zk,pipe(){return ee(this,arguments)},...e}),A6=e=>({[Bk]:Bk,patch:e.patch,load:(t,n,r=!0)=>e.load(t,n,r),enumerateChildren:e.enumerateChildren}),P6=e=>q6({load:t=>U(Cr(e,oi(),t,!1),n=>ot(yc(n),{onNone:()=>St(ba(oi(),`Expected a single value having structure: ${t}`)),onSome:J})),flattened:e}),F6=e=>{const{pathDelim:t,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},e),r=f=>v(f,Ia(t)),s=f=>f.split(t),o=()=>typeof process<"u"&&"env"in process&&typeof Uk=="object"?Uk:{};return P6(A6({load:(f,h,p=!0)=>{const g=r(f),k=o(),T=g in k?W(k[g]):V();return v(T,ag(()=>ba(f,`Expected ${g} to exist in the process context`)),U(O=>L6(O,f,h,n,p)))},enumerateChildren:f=>K(()=>{const h=o(),k=Object.keys(h).map(T=>s(T.toUpperCase())).filter(T=>{for(let O=0;O<f.length;O++){const L=v(f,P1(O)),E=T[O];if(E===void 0||L!==E)return!1}return!0}).flatMap(T=>T.slice(f.length,f.length+1));return Pz(k)}),patch:g6}))},x6=(e,t,n,r)=>{const s=Z0(n.length,f=>f>=r.length?V():W([e(f),f+1])),o=Z0(r.length,f=>f>=n.length?V():W([t(f),f+1])),a=mm(n,s),u=mm(r,o);return[a,u]},N6=(e,t)=>{let n=t;if(n._tag==="Nested"){const r=e.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return e},Cr=(e,t,n,r)=>{const s=n;switch(s._tag){case _6:return J(fr(s.value));case S6:return pe(()=>Cr(e,t,s.config,r));case y6:return St(ba(t,s.message));case b6:return v(pe(()=>Cr(e,t,s.first,r)),Kc(o=>s.condition(o)?v(Cr(e,t,s.second,r),Kc(a=>St(yq(o,a)))):St(o)));case w6:return pe(()=>Cr(e,t,s.config(),r));case v6:return pe(()=>v(Cr(e,t,s.original,r),U(Zs(o=>v(s.mapOrFail(o),ag(Mi(N6(t,s.original))))))));case E6:return pe(()=>Cr(e,mm(t,fr(s.name)),s.config,r));case k6:return v(X_(t,e.patch),U(o=>v(e.load(o,s,r),U(a=>{if(a.length===0){const u=v(KL(o),Et(()=>"<n/a>"));return St(ba([],`Expected ${s.description} with name ${u}`))}return J(a)}))));case $6:return v(X_(t,e.patch),U(o=>v(e.enumerateChildren(o),U(U6),U(a=>a.length===0?pe(()=>Se(Cr(e,t,s.config,!0),fr)):v(Zs(a,u=>Cr(e,UL(t,`[${u}]`),s.config,!0)),Se(u=>{const f=oj(u);return f.length===0?fr(oi()):fr(f)}))))));case C6:return pe(()=>v(X_(t,e.patch),U(o=>v(e.enumerateChildren(o),U(a=>v(a,Zs(u=>Cr(e,mm(o,fr(u)),s.valueConfig,r)),Se(u=>u.length===0?fr(Jp()):v(j6(u),so(f=>Kz(X0(ze(a),f)))))))))));case T6:return pe(()=>v(Cr(e,t,s.left,r),Jc,U(o=>v(Cr(e,t,s.right,r),Jc,U(a=>{if(on(o)&&on(a))return St(_q(o.left,a.left));if(on(o)&&bs(a))return St(o.left);if(bs(o)&&on(a))return St(a.left);if(bs(o)&&bs(a)){const u=v(t,Ia(".")),f=D6(t,u),[h,p]=x6(f,f,v(o.right,so(le)),v(a.right,so(le)));return v(h,X0(p),Zs(([g,k])=>v(lg(g,k),Se(([T,O])=>s.zip(T,O)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},D6=(e,t)=>n=>ae(ba(e,`The element at index ${n} in a sequence at path "${t}" was missing`)),M6=(e,t)=>e.split(new RegExp(`\\s*${em(t)}\\s*`)),L6=(e,t,n,r,s)=>s?v(M6(e,r),Zs(o=>n.parse(o.trim())),ag(Mi(t))):v(n.parse(e),Rw({onFailure:Mi(t),onSuccess:fr})),j6=e=>Object.keys(e[0]).map(t=>e.map(n=>n[t])),U6=e=>v(Zs(e,B6),Rw({onFailure:()=>oi(),onSuccess:zl(Fc)}),Jc,Se(gL)),z6=/^(\[(\d+)\])$/,B6=e=>{const t=e.match(z6);if(t!==null){const n=t[2];return v(n!==void 0&&n.length>0?W(n):V(),pu(H6))}return V()},H6=e=>{const t=Number.parseInt(e);return Number.isNaN(t)?V():W(t)},Hk=Symbol.for("effect/Console"),Sg=sr("effect/Console"),V6={[Hk]:Hk,assert(e,...t){return K(()=>{console.assert(e,...t)})},clear:K(()=>{console.clear()}),count(e){return K(()=>{console.count(e)})},countReset(e){return K(()=>{console.countReset(e)})},debug(...e){return K(()=>{console.debug(...e)})},dir(e,t){return K(()=>{console.dir(e,t)})},dirxml(...e){return K(()=>{console.dirxml(...e)})},error(...e){return K(()=>{console.error(...e)})},group(e){return e!=null&&e.collapsed?K(()=>console.groupCollapsed(e==null?void 0:e.label)):K(()=>console.group(e==null?void 0:e.label))},groupEnd:K(()=>{console.groupEnd()}),info(...e){return K(()=>{console.info(...e)})},log(...e){return K(()=>{console.log(...e)})},table(e,t){return K(()=>{console.table(e,t)})},time(e){return K(()=>console.time(e))},timeEnd(e){return K(()=>console.timeEnd(e))},timeLog(e,...t){return K(()=>{console.timeLog(e,...t)})},trace(...e){return K(()=>{console.trace(...e)})},warn(...e){return K(()=>{console.warn(...e)})},unsafe:console},W6="effect/Random",Vk=Symbol.for(W6),K6=sr("effect/Random");var wT;wT=Vk;class J6{constructor(t){d(this,"seed");d(this,wT,Vk);d(this,"PRNG");this.seed=t,this.PRNG=new BM(t)}get next(){return K(()=>this.PRNG.number())}get nextBoolean(){return Se(this.next,t=>t>.5)}get nextInt(){return K(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(t,n){return Se(this.next,r=>(n-t)*r+t)}nextIntBetween(t,n){return K(()=>this.PRNG.integer(n-t)+t)}shuffle(t){return G6(t,n=>this.nextIntBetween(0,n))}}const G6=(e,t)=>pe(()=>v(K(()=>Array.from(e)),U(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return v(r,Gc(s=>v(t(s),Se(o=>Q6(n,s-1,o)))),tn(go(n)))}))),Q6=(e,t,n)=>{const r=e[t];return e[t]=e[n],e[n]=r,e},Y6=e=>new J6(Q(e)),Wk=Symbol.for("effect/Tracer"),bq=e=>({[Wk]:Wk,...e}),pd=sr("effect/Tracer"),Os=sr("effect/ParentSpan"),Kk=(function(){const e="abcdef0123456789",t=e.length;return function(n){let r="";for(let s=0;s<n;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}})();class X6{constructor(t,n,r,s,o,a){d(this,"name");d(this,"parent");d(this,"context");d(this,"startTime");d(this,"kind");d(this,"_tag","Span");d(this,"spanId");d(this,"traceId","native");d(this,"sampled",!0);d(this,"status");d(this,"attributes");d(this,"events",[]);d(this,"links");this.name=t,this.parent=n,this.context=r,this.startTime=o,this.kind=a,this.status={_tag:"Started",startTime:o},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Kk(32),this.spanId=Kk(16),this.links=Array.from(s)}end(t,n){this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime}}attribute(t,n){this.attributes.set(t,n)}event(t,n,r){this.events.push([t,n,r??{}])}addLinks(t){this.links.push(...t)}}const Z6=bq({span:(e,t,n,r,s,o)=>new X6(e,t,n,r,s,o),context:e=>e()}),co=e=>{if((e==null?void 0:e.captureStackTrace)===!1)return e;if((e==null?void 0:e.captureStackTrace)!==void 0&&typeof e.captureStackTrace!="boolean")return e;const t=Error.stackTraceLimit;Error.stackTraceLimit=3;const n=new Error;Error.stackTraceLimit=t;let r=!1;return{...e,captureStackTrace:()=>{if(r!==!1)return r;if(n.stack!==void 0){const s=n.stack.split(`
`);if(s[3]!==void 0)return r=s[3].trim(),r}}}},pm=yu()("effect/Tracer/DisablePropagation",{defaultValue:Yn}),e5=v(po(),_s(Na,f6()),_s(Sg,V6),_s(K6,Y6(Math.random())),_s(R6,F6()),_s(pd,Z6)),qs=Te(Symbol.for("effect/DefaultServices/currentServices"),()=>JO(e5)),t5=e=>{const t=br(e);return Kw(n=>n.sleep(t))},Sq=e=>Fe(t=>e(t.currentDefaultServices)),Kw=e=>Sq(t=>e(t.unsafeMap.get(Na.key))),n5=Kw(e=>e.currentTimeMillis),r5=e=>Sq(t=>e(t.unsafeMap.get(pd.key))),wq=t5,s5=n5,o5=Kw,i5=Na;function a5(e){return new ai(e)}function c5(){return a5(new Map)}const Jk=Symbol.for("effect/FiberRefs");var vT;vT=Jk;class ai{constructor(t){d(this,"locals");d(this,vT,Jk);this.locals=t}pipe(){return ee(this,arguments)}}const u5=(e,t,n,r=!1)=>{const s=e;let o=t,a=n,u=r,f;for(;f===void 0;)if(bt(o)&&bt(a)){const h=Un(o)[0],p=aa(o),g=Un(a)[0],k=Un(a)[1],T=aa(a);h.startTimeMillis<g.startTimeMillis?(a=T,u=!0):h.startTimeMillis>g.startTimeMillis?o=p:h.id<g.id?(a=T,u=!0):h.id>g.id?o=p:f=[k,u]}else f=[s.initial,!0];return f},l5=y(3,(e,t,n)=>{const r=new Map(e.locals);return n.locals.forEach((s,o)=>{const a=s[0][1];if(!s[0][0][ye](t)){if(!r.has(o)){if(me(a,o.initial))return;r.set(o,[[t,o.join(o.initial,a)]]);return}const u=r.get(o),[f,h]=u5(o,u,s);if(h){const p=o.diff(f,a),g=u[0][1],k=o.join(g,o.patch(p)(g));if(!me(g,k)){let T;const O=u[0][0];O[ye](t)?T=[[O,k],...u.slice(1)]:T=[[t,k],...u],r.set(o,T)}}}}),new ai(r)}),f5=y(2,(e,t)=>{const n=new Map;return vq(e,n,t),new ai(n)}),vq=(e,t,n)=>{e.locals.forEach((r,s)=>{const o=r[0][1],a=s.patch(s.fork)(o);me(o,a)?t.set(s,r):t.set(s,[[n,a],...r])})},Eq=y(2,(e,t)=>{const n=new Map(e.locals);return n.delete(t),new ai(n)}),kq=y(2,(e,t)=>e.locals.has(t)?W(Un(e.locals.get(t))[1]):V()),rf=y(2,(e,t)=>v(kq(e,t),Et(()=>t.initial))),ub=y(2,(e,{fiberId:t,fiberRef:n,value:r})=>{if(e.locals.size===0)return new ai(new Map([[n,[[t,r]]]]));const s=new Map(e.locals);return lb(s,t,n,r),new ai(s)}),lb=(e,t,n,r)=>{const s=e.get(n)??[];let o;if(bt(s)){const[a,u]=Un(s);if(a[ye](t)){if(me(u,r))return;o=[[t,r],...s.slice(1)]}else o=[[t,r],...s]}else o=[[t,r]];e.set(n,o)},d5=y(2,(e,{entries:t,forkAs:n})=>{if(e.locals.size===0)return new ai(new Map(t));const r=new Map(e.locals);return n!==void 0&&vq(e,r,n),t.forEach(([s,o])=>{o.length===1?lb(r,o[0][0],s,o[0][1]):o.forEach(([a,u])=>{lb(r,a,s,u)})}),new ai(r)}),Gk=kq,wg=rf,h5=d5,m5=c5,p5=n4,g5=r4,$q=s4,Cq=o4,_5=WO,Jw=KO,y5=i4,b5=a4,S5=v(Fc,O1(e=>e.ordinal)),w5=bL(S5),v5=e=>{switch(e){case"All":return p5;case"Debug":return Jw;case"Error":return $q;case"Fatal":return g5;case"Info":return _5;case"Trace":return y5;case"None":return b5;case"Warning":return Cq}},Tq=e=>e.replace(/[\s="]/g,"_"),Gw=e=>t=>`${Tq(t.label)}=${e-t.startTime}ms`,E5=Wf,k5=iL;let Po=class extends k5{};const ci=Symbol.for("effect/Readable"),Qw=Symbol.for("effect/Ref"),Yw={_A:e=>e};var ET,kT,$T;class $5 extends($T=Po,kT=Qw,ET=ci,$T){constructor(n){super();d(this,"ref");d(this,kT,Yw);d(this,ET,ci);d(this,"get");this.ref=n,this.get=K(()=>He(this.ref))}commit(){return this.get}modify(n){return K(()=>{const r=He(this.ref),[s,o]=n(r);return r!==o&&Oa(o)(this.ref),s})}}const Iq=e=>new $5(Ra(e)),gm=e=>K(()=>Iq(e)),ti=e=>e.get,sf=y(2,(e,t)=>e.modify(()=>[void 0,t])),C5=y(2,(e,t)=>e.modify(n=>[n,t])),Rq=y(2,(e,t)=>e.modify(t)),fb=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),T5=Qw,Si=gm,Gi=ti,I5=C5,qi=Rq,Xc=sf,R5=fb,O5=Os,Oq=bq,q5=r5,qq="Empty",Aq="Add",Pq="Remove",Fq="Update",xq="AndThen",A5={_tag:qq},Xw=(e,t)=>{const n=new Map(e.locals);let r=A5;for(const[s,o]of t.locals.entries()){const a=Un(o)[1],u=n.get(s);if(u!==void 0){const f=Un(u)[1];me(f,a)||(r=Z_({_tag:Fq,fiberRef:s,patch:s.diff(f,a)})(r))}else r=Z_({_tag:Aq,fiberRef:s,value:a})(r);n.delete(s)}for(const[s]of n.entries())r=Z_({_tag:Pq,fiberRef:s})(r);return r},Z_=y(2,(e,t)=>({_tag:xq,first:e,second:t})),Nq=y(3,(e,t,n)=>{let r=n,s=fr(e);for(;bt(s);){const o=Un(s),a=aa(s);switch(o._tag){case qq:{s=a;break}case Aq:{r=ub(r,{fiberId:t,fiberRef:o.fiberRef,value:o.value}),s=a;break}case Pq:{r=Eq(r,o.fiberRef),s=a;break}case Fq:{const u=rf(r,o.fiberRef);r=ub(r,{fiberId:t,fiberRef:o.fiberRef,value:o.fiberRef.patch(o.patch)(u)}),s=a;break}case xq:{s=Xh(o.first)(Xh(o.second)(a));break}}}return r}),Dq="effect/MetricLabel",db=Symbol.for(Dq);var CT;class P5{constructor(t,n){d(this,"key");d(this,"value");d(this,CT,db);d(this,"_hash");this.key=t,this.value=n,this._hash=Tt(Dq+this.key+this.value)}[(CT=db,_e)](){return this._hash}[ye](t){return x5(t)&&this.key===t.key&&this.value===t.value}pipe(){return ee(this,arguments)}}const F5=(e,t)=>new P5(e,t),x5=e=>ne(e,db),N5=y(e=>wr(e[0]),function(){const e=arguments;return fg(e[0],GO,typeof e[1]=="string"?Uc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>Uc(n,r,s),t))}),D5=e=>Se(e,W),Mq=e=>{let t,n;return typeof e=="function"?t=e:(t=e.try,n=e.catch),pe(()=>{try{return J(gt(t))}catch(r){return St(n?gt(()=>n(r)):new pg(r,"An unknown error occurred in Effect.try"))}})},M5=y(2,(e,t)=>sg(e,n=>{const r=eg(n,s=>Ew(s)?W(s):V());switch(r._tag){case"None":return $t(n);case"Some":return t(r.value.defect)}})),L5=y(2,(e,t)=>Vn(e,{onFailure:n=>{const r=t(n);switch(r._tag){case"None":return $t(n);case"Some":return r.value}},onSuccess:J})),j5=y(e=>wr(e[0]),(e,...t)=>{const n=t[t.length-1];let r;return t.length===2?r=yp(t[0]):r=s=>{const o=ne(s,"_tag")?s._tag:void 0;if(!o)return!1;for(let a=0;a<t.length-1;a++)if(t[a]===o)return!0;return!1},LO(e,r,n)}),U5=o5,z5=U5(J),B5=y(2,(e,t)=>It(wq(t),e)),H5=e=>Hq(e,jq,Xw),V5=e=>Hq(e,lg(jq,QH),([t,n],[r,s])=>[Xw(t,r),ei(n,s)]),Lq=y(2,(e,t)=>wo(e,{onFailure:n=>J(t.onFailure(n)),onSuccess:n=>J(t.onSuccess(n))})),W5=e=>{const t=U(U(e,()=>ug()),()=>t);return t},jq=Fe(e=>J(e.getFiberRefs())),Uq=e=>Lq(e,{onFailure:jl,onSuccess:jl}),K5=e=>Vn(e,{onFailure:t=>zq(t,"An error was silently ignored because it is not anticipated to be useful"),onSuccess:()=>Qe}),vg=e=>(...t)=>{const n=Ta(e);let r;for(let s=0,o=t.length;s<o;s++){const a=t[s];vw(a)&&(r!==void 0?r=en(r,a):r=a,t=[...t.slice(0,s),...t.slice(s+1)],s--)}return r===void 0&&(r=bo),Fe(s=>(s.log(t,r,n),Qe))},J5=vg(),zq=vg(Jw),G5=vg(Cq),Q5=vg($q),Qk=y(2,(e,t)=>Vn(e,{onFailure:n=>jO(()=>t(n)),onSuccess:J})),Y5=e=>v(Ru(),U(t=>v(V5(e),BO(t),Z5,Se(n=>It(n,v(rs(t),U(([r,s])=>tn(lg(Bq(r[0]),HO(r[1])),s)))))))),X5=e=>Se(e,t=>!t),Z5=e=>Se(Si(!0),t=>or(id(e,I5(t,!1)))),Bq=e=>uV((t,n)=>v(e,Nq(t,n))),eV=e=>e.length>=1?ns((t,n)=>{try{e(n).then(r=>t(Ge(r)),r=>t(dc(r)))}catch(r){t(dc(r))}}):ns(t=>{try{e().then(n=>t(Ge(n)),n=>t(dc(n)))}catch(n){t(dc(n))}}),of=y(3,(e,t,n)=>Ou(r=>Mw(e,_s(r,t,n)))),Zw=wq,tV=J(V()),Hq=y(3,(e,t,n)=>U(t,r=>U(e,s=>Se(t,o=>[n(r,o),s])))),nV=y(2,(e,t)=>Vn(e,{onFailure:n=>{const r=Zp(n);switch(r._tag){case"Left":return It(t(r.left),$t(n));case"Right":return $t(n)}},onSuccess:J})),rV=y(3,(e,t,n)=>nV(e,r=>yp(r,t)?n(r):Qe)),sV=y(2,(e,t)=>Vn(e,{onFailure:n=>It(t(n),$t(n)),onSuccess:J})),oV=q5,iV=oV(J),aV=e=>{let t,n;typeof e=="function"?t=e:(t=e.try,n=e.catch);const r=s=>n?od(()=>n(s)):St(new pg(s,"An unknown error occurred in Effect.tryPromise"));return t.length>=1?ns((s,o)=>{try{t(o).then(a=>s(Ge(a)),a=>s(r(a)))}catch(a){s(r(a))}}):ns(s=>{try{t().then(o=>s(Ge(o)),o=>s(r(o)))}catch(o){s(r(o))}})},cV=y(2,(e,t)=>U(e,n=>Mq({try:()=>t.try(n),catch:t.catch}))),uV=e=>Fe(t=>(t.setFiberRefs(e(t.id(),t.getFiberRefs())),Qe)),lV=y(2,(e,t)=>pe(()=>t()?Se(e,W):J(V()))),fV=e=>new Proxy({},{get(t,n,r){return(...s)=>U(e,o=>o[n](...s))}}),dV=e=>Se(hd(),Lr(e)),hV=function(){const e=arguments;return Uq(U(Vq,t=>K(()=>{if(typeof e[0]=="string")t.attribute(e[0],e[1]);else for(const n in e[0])t.attribute(n,e[0][n])})))},mV=y(e=>wr(e[0]),function(){const e=arguments;return fg(e[0],XO,typeof e[1]=="string"?Uc(e[1],e[2]):t=>Object.entries(e[1]).reduce((n,[r,s])=>Uc(n,r,s),t))}),Vq=U(hd(),e=>{const t=e.unsafeMap.get(Os.key);return t!==void 0&&t._tag==="Span"?J(t):St(new ud)}),Wq=BigInt(0),Kq=pu(e=>Xn(e.context,pm)?e._tag==="Span"?Kq(e.parent):V():W(e)),ev=(e,t,n)=>{const r=!e.getFiberRef(YO)||n.context&&Xn(n.context,pm),s=e.getFiberRef(os),o=n.parent?W(n.parent):n.root?V():Kq(Lr(s,Os));let a;if(r)a=U4({name:t,parent:o,context:_s(n.context??po(),pm,!0)});else{const u=e.getFiberRef(qs),f=Xn(u,pd),h=Xn(u,i5),p=e.getFiberRef(hg),g=e.getFiberRefs(),k=Gk(g,XO),T=Gk(g,v4),O=T._tag==="Some"?n.links!==void 0?[...pr(T.value),...n.links??[]]:pr(T.value):n.links??oi();a=f.span(t,o,n.context??po(),O,p?h.unsafeCurrentTimeNanos():Wq,n.kind??"internal"),k._tag==="Some"&&Yz(k.value,(L,E)=>a.attribute(E,L)),n.attributes!==void 0&&Object.entries(n.attributes).forEach(([L,E])=>a.attribute(L,E))}return typeof n.captureStackTrace=="function"&&fm.set(a,n.captureStackTrace),a},pV=(e,t)=>(t=co(t),Fe(n=>J(ev(n,e,t)))),_m=(e,t,n,r)=>K(()=>{e.status._tag!=="Ended"&&(eq(t)&&fm.has(e)&&e.attribute("code.stacktrace",fm.get(e)()),e.end(r?n.unsafeCurrentTimeNanos():Wq,t))}),hb=(e,...t)=>{const n=co(t.length===1?void 0:t[0]),r=t[t.length-1];return Fe(s=>{const o=ev(s,e,n),a=s.getFiberRef(hg),u=Xn(s.getFiberRef(qs),Na);return Rs(r(o),f=>_m(o,f,u,a))})},mb=y(2,(e,t)=>of(e,Os,t)),gV=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return hb(t,n,s=>mb(r,s))}return r=>hb(t,n,s=>mb(r,s))},Jq="Sequential",Gq="Parallel",_V="ParallelN",gd={_tag:Jq},yV={_tag:Gq},bV=e=>({_tag:_V,parallelism:e}),SV=e=>e._tag===Jq,wV=e=>e._tag===Gq,af=gd,pb=yV,gb=bV,cf=Xw,uf=Nq,Eg="effect/FiberStatus",Sa=Symbol.for(Eg),ym="Done",Yk="Running",Xk="Suspended",vV=Tt(`${Eg}-${ym}`);var TT;let EV=class{constructor(){d(this,TT,Sa);d(this,"_tag",ym)}[(TT=Sa,_e)](){return vV}[ye](t){return tv(t)&&t._tag===ym}};var IT;class kV{constructor(t){d(this,"runtimeFlags");d(this,IT,Sa);d(this,"_tag",Yk);this.runtimeFlags=t}[(IT=Sa,_e)](){return v(Q(Eg),fe(Q(this._tag)),fe(Q(this.runtimeFlags)),ct(this))}[ye](t){return tv(t)&&t._tag===Yk&&this.runtimeFlags===t.runtimeFlags}}var RT;class $V{constructor(t,n){d(this,"runtimeFlags");d(this,"blockingOn");d(this,RT,Sa);d(this,"_tag",Xk);this.runtimeFlags=t,this.blockingOn=n}[(RT=Sa,_e)](){return v(Q(Eg),fe(Q(this._tag)),fe(Q(this.runtimeFlags)),fe(Q(this.blockingOn)),ct(this))}[ye](t){return tv(t)&&t._tag===Xk&&this.runtimeFlags===t.runtimeFlags&&me(this.blockingOn,t.blockingOn)}}const CV=new EV,TV=e=>new kV(e),IV=(e,t)=>new $V(e,t),tv=e=>ne(e,Sa),RV=e=>e._tag===ym,OV=CV,Qq=TV,qV=IV,AV=RV,PV=Symbol.for("effect/Micro"),bm=Symbol.for("effect/Micro/MicroExit"),Zk=Symbol.for("effect/Micro/MicroCause"),FV={_E:ce};var OT;class Yq extends globalThis.Error{constructor(n,r,s){const o=`MicroCause.${n}`;let a,u,f;if(r instanceof globalThis.Error){a=`(${o}) ${r.name}`,u=r.message;const h=u.split(`
`).length;f=r.stack?`(${o}) ${r.stack.split(`
`).slice(0,h+3).join(`
`)}`:`${a}: ${u}`}else a=o,u=ra(r,0),f=`${a}: ${u}`;s.length>0&&(f+=`
    ${s.join(`
    `)}`);super(u);d(this,"_tag");d(this,"traces");d(this,OT);this._tag=n,this.traces=s,this[Zk]=FV,this.name=a,this.stack=f}pipe(){return ee(this,arguments)}toString(){return this.stack}[(OT=Zk,Be)](){return this.stack}}class xV extends Yq{constructor(n,r=[]){super("Die",n,r);d(this,"defect");this.defect=n}}const NV=(e,t=[])=>new xV(e,t);class DV extends Yq{constructor(t=[]){super("Interrupt","interrupted",t)}}const MV=(e=[])=>new DV(e),LV=e=>e._tag==="Interrupt",e$=Symbol.for("effect/Micro/MicroFiber"),jV={_A:ce,_E:ce};var qT;qT=e$;class UV{constructor(t,n=!0){d(this,"context");d(this,"interruptible");d(this,qT);d(this,"_stack",[]);d(this,"_observers",[]);d(this,"_exit");d(this,"_children");d(this,"currentOpCount",0);d(this,"_interrupted",!1);d(this,"_yielded");this.context=t,this.interruptible=n,this[e$]=jV}getRef(t){return wU(this.context,t)}addObserver(t){return this._exit?(t(this._exit),jl):(this._observers.push(t),()=>{const n=this._observers.indexOf(t);n>=0&&this._observers.splice(n,1)})}unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(iv))}unsafePoll(){return this._exit}evaluate(t){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(t);if(n===eh)return;const r=t$.interruptChildren&&t$.interruptChildren(this);if(r!==void 0)return this.evaluate(wm(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(t){let n=!1,r=t;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(av).shouldYield(this)){n=!0;const s=r;r=wm(WV,()=>s)}if(r=r[_b](this),r===eh){const s=this._yielded;return bm in s?(this._yielded=void 0,s):eh}}}catch(s){return ne(r,_b)?yb(s):yb(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(t){for(;;){const n=this._stack.pop();if(!n)return;const r=n[Sm]&&n[Sm](this);if(r)return{[t]:r};if(n[t])return n}}yieldWith(t){return this._yielded=t,eh}children(){return this._children??(this._children=new Set)}}const t$=Te("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Xq=Symbol.for("effect/Micro/identifier"),cn=Symbol.for("effect/Micro/args"),_b=Symbol.for("effect/Micro/evaluate"),Zc=Symbol.for("effect/Micro/successCont"),$c=Symbol.for("effect/Micro/failureCont"),Sm=Symbol.for("effect/Micro/ensureCont"),eh=Symbol.for("effect/Micro/Yield"),zV={_A:ce,_E:ce,_R:ce},BV={...E5,_op:"Micro",[PV]:zV,pipe(){return ee(this,arguments)},[Symbol.iterator](){return new u1(new hu(this))},toJSON(){return{_id:"Micro",op:this[Xq],...cn in this?{args:this[cn]}:void 0}},toString(){return dt(this)},[Be](){return dt(this)}};function HV(e){return yb("Micro.evaluate: Not implemented")}const kg=e=>({...BV,[Xq]:e.op,[_b]:e.eval??HV,[Zc]:e.contA,[$c]:e.contE,[Sm]:e.ensure}),nv=e=>{const t=kg(e);return function(){const n=Object.create(t);return n[cn]=e.single===!1?arguments:arguments[0],n}},Zq=e=>{const t={...kg(e),[bm]:bm,_tag:e.op,get[e.prop](){return this[cn]},toJSON(){return{_id:"MicroExit",_tag:e.op,[e.prop]:this[cn]}},[ye](n){return GV(n)&&n._tag===e.op&&me(this[cn],n[cn])},[_e](){return ct(this,fe(Tt(e.op))(Q(this[cn])))}};return function(n){const r=Object.create(t);return r[cn]=n,r[Zc]=void 0,r[$c]=void 0,r[Sm]=void 0,r}},rv=Zq({op:"Success",prop:"value",eval(e){const t=e.getCont(Zc);return t?t[Zc](this[cn],e):e.yieldWith(this)}}),eA=Zq({op:"Failure",prop:"cause",eval(e){let t=e.getCont($c);for(;LV(this[cn])&&t&&e.interruptible;)t=e.getCont($c);return t?t[$c](this[cn],e):e.yieldWith(this)}}),VV=nv({op:"Yield",eval(e){let t=!1;return e.getRef(av).scheduleTask(()=>{t||e.evaluate(QV)},this[cn]??0),e.yieldWith(()=>{t=!0})}}),WV=VV(0),KV=rv(void 0),sv=nv({op:"WithMicroFiber",eval(e){return this[cn](e)}}),wm=y(2,(e,t)=>{const n=Object.create(JV);return n[cn]=e,n[Zc]=t,n}),JV=kg({op:"OnSuccess",eval(e){return e._stack.push(this),this[cn]}}),GV=e=>ne(e,bm),tA=rv,ov=eA,iv=ov(MV()),yb=e=>ov(NV(e)),QV=tA(void 0),YV="setImmediate"in globalThis?globalThis.setImmediate:e=>setTimeout(e,0);class nA{constructor(){d(this,"tasks",[]);d(this,"running",!1);d(this,"afterScheduled",()=>{this.running=!1,this.runTasks()})}scheduleTask(t,n){this.tasks.push(t),this.running||(this.running=!0,YV(this.afterScheduled))}runTasks(){const t=this.tasks;this.tasks=[];for(let n=0,r=t.length;n<r;n++)t[n]()}shouldYield(t){return t.currentOpCount>=t.getRef(eW)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const XV=y(2,(e,t)=>sv(n=>{const r=n.context;return n.context=t(r),rW(e,()=>(n.context=r,KV))})),ZV=y(2,(e,t)=>XV(e,qo(t)));class eW extends yu()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class av extends yu()("effect/Micro/currentScheduler",{defaultValue:()=>new nA}){}const tW=y(2,(e,t)=>{const n=Object.create(nW);return n[cn]=e,n[Zc]=t.onSuccess,n[$c]=t.onFailure,n}),nW=kg({op:"OnSuccessAndFailure",eval(e){return e._stack.push(this),this[cn]}}),rW=y(2,(e,t)=>oW(n=>tW(n(e),{onFailure:r=>wm(t(ov(r)),()=>eA(r)),onSuccess:r=>wm(t(tA(r)),()=>rv(r))}))),rA=nv({op:"SetInterruptible",ensure(e){if(e.interruptible=this[cn],e._interrupted&&e.interruptible)return()=>iv}}),sW=e=>sv(t=>t.interruptible?e:(t.interruptible=!0,t._stack.push(rA(!1)),t._interrupted?iv:e)),oW=e=>sv(t=>t.interruptible?(t.interruptible=!1,t._stack.push(rA(!0)),e(sW)):e(ce)),iW=(e,t)=>{const n=new UV(av.context(new nA));return n.evaluate(e),n};class cv{constructor(){d(this,"buckets",[])}scheduleTask(t,n){const r=this.buckets.length;let s,o=0;for(;o<r&&this.buckets[o][0]<=n;o++)s=this.buckets[o];s&&s[0]===n?s[1].push(t):o===r?this.buckets.push([n,[t]]):this.buckets.splice(o,0,[n,[t]])}}class aW{constructor(t){d(this,"maxNextTickBeforeTimer");d(this,"running",!1);d(this,"tasks",new cv);this.maxNextTickBeforeTimer=t}starveInternal(t){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let o=0;o<s.length;o++)s[o]();this.tasks.buckets.length===0?this.running=!1:this.starve(t)}starve(t=0){t>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(t+1))}shouldYield(t){return t.currentOpCount>t.getFiberRef(dg)?t.getFiberRef(bi):!1}scheduleTask(t,n){this.tasks.scheduleTask(t,n),this.running||(this.running=!0,this.starve())}}const sA=Te(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new aW(2048));class oA{constructor(){d(this,"tasks",new cv);d(this,"deferred",!1)}scheduleTask(t,n){this.deferred?sA.scheduleTask(t,n):this.tasks.scheduleTask(t,n)}shouldYield(t){return t.currentOpCount>t.getFiberRef(dg)?t.getFiberRef(bi):!1}flush(){for(;this.tasks.buckets.length>0;){const t=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of t)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const uv=e=>e.currentOpCount>e.getFiberRef(dg)?e.getFiberRef(bi):!1,cW=(e,t=uv)=>({scheduleTask:e,shouldYield:t}),uW=(e,t=uv)=>{let n=!1;const r=new cv,s=()=>{const a=r.buckets;r.buckets=[];for(const[u,f]of a)for(let h=0;h<f.length;h++)f[h]();r.buckets.length===0?n=!1:o()},o=()=>e(s);return cW((a,u)=>{r.scheduleTask(a,u),n||(n=!0,o())},t)},_d=Te(Symbol.for("effect/FiberRef/currentScheduler"),()=>wn(sA)),lW=y(2,(e,t)=>Ao(e,_d,t)),iA=Te(Symbol.for("effect/FiberRef/currentRequestMap"),()=>wn(new Map)),n$=(e,t,n,r)=>{switch(e){case void 0:return t();case"unbounded":return n();case"inherit":return Cu(b4,s=>s==="unbounded"?n():s>1?r(s):t());default:return e>1?r(e):t()}},lv="InterruptSignal",fv="Stateful",dv="Resume",hv="YieldNow",ey=e=>({_tag:lv,cause:e}),Oh=e=>({_tag:fv,onFiber:e}),Xa=e=>({_tag:dv,effect:e}),fW=()=>({_tag:hv}),dW="effect/FiberScope",vm=Symbol.for(dW);var AT;AT=vm;class hW{constructor(){d(this,AT,vm);d(this,"fiberId",zn);d(this,"roots",new Set)}add(t,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}var PT;PT=vm;class mW{constructor(t,n){d(this,"fiberId");d(this,"parent");d(this,PT,vm);this.fiberId=t,this.parent=n}add(t,n){this.parent.tell(Oh(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const pW=e=>new mW(e.id(),e),yd=Te(Symbol.for("effect/FiberScope/Global"),()=>new hW),gW="effect/Fiber",_W=Symbol.for(gW),yW={_E:e=>e,_A:e=>e},bW="effect/Fiber",SW=Symbol.for(bW),aA=e=>e.await,wW=e=>e.inheritAll,vW=y(2,(e,t)=>v(Gc(e,cA(t)),It(v(e,Gc(aA))))),cA=y(2,(e,t)=>e.interruptAsFork(t)),eu=e=>Aw($u(e.await),e.inheritAll);({...Kf});const Vo="effect/FiberCurrent",EW=()=>Ta(globalThis[Vo]),kW="effect/Logger",$W=Symbol.for(kW),CW={_Message:e=>e,_Output:e=>e},bd=e=>({[$W]:CW,log:e,pipe(){return ee(this,arguments)}}),TW=/^[^\s"=]*$/,IW=(e,t)=>({annotations:n,cause:r,date:s,fiberId:o,logLevel:a,message:u,spans:f})=>{const h=O=>O.match(TW)?O:e(O),p=(O,L)=>`${Tq(O)}=${h(L)}`,g=(O,L)=>" "+p(O,L);let k=p("timestamp",s.toISOString());k+=g("level",a.label),k+=g("fiber",Wp(o));const T=KS(u);for(let O=0;O<T.length;O++)k+=g("message",ra(T[O],t));TH(r)||(k+=g("cause",_i(r,{renderErrorCause:!0})));for(const O of f)k+=" "+Gw(s.getTime())(O);for(const[O,L]of n)k+=g(O,ra(L,t));return k},RW=e=>`"${e.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,OW=bd(IW(RW)),uA=e=>{switch(typeof e){case"bigint":case"function":case"symbol":return String(e);default:return Ot(e)}},qW=(e,...t)=>{let n="";for(let r=0;r<t.length;r++)n+=`\x1B[${t[r]}m`;return n+e+"\x1B[0m"},AW=(e,...t)=>e,Tr={bold:"1",red:"31",green:"32",yellow:"33",blue:"34",cyan:"36",white:"37",gray:"90",black:"30",bgBrightRed:"101"},PW={None:[],All:[],Trace:[Tr.gray],Debug:[Tr.blue],Info:[Tr.green],Warning:[Tr.yellow],Error:[Tr.red],Fatal:[Tr.bgBrightRed,Tr.black]},FW={None:"",All:"",Trace:"color:gray",Debug:"color:blue",Info:"color:green",Warning:"color:orange",Error:"color:red",Fatal:"background-color:red;color:white"},xW=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,lA=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null,NW=lA&&process.stdout.isTTY===!0,DW=lA||"Deno"in globalThis,MW=e=>{const t=(e==null?void 0:e.mode)??"auto",r=(t==="auto"?DW?"tty":"browser":t)==="browser",s=typeof(e==null?void 0:e.colors)=="boolean"?e.colors:NW||r,o=(e==null?void 0:e.formatDate)??xW;return r?jW({colors:s,formatDate:o}):LW({colors:s,formatDate:o,stderr:(e==null?void 0:e.stderr)===!0})},LW=e=>{const t=typeof process=="object"&&"isBun"in process&&process.isBun===!0,n=e.colors?qW:AW;return bd(({annotations:r,cause:s,context:o,date:a,fiberId:u,logLevel:f,message:h,spans:p})=>{const g=wg(o,qs),k=Xn(g,Sg).unsafe,T=e.stderr===!0?k.error:k.log,O=KS(h);let L=n(`[${e.formatDate(a)}]`,Tr.white)+` ${n(f.label,...PW[f._tag])} (${Wp(u)})`;if(bw(p)){const S=a.getTime(),_=Gw(S);for(const C of p)L+=" "+_(C)}L+=":";let E=0;if(O.length>0){const S=uA(O[0]);typeof S=="string"&&(L+=" "+n(S,Tr.bold,Tr.cyan),E++)}if(T(L),t||k.group(),kw(s)||T(_i(s,{renderErrorCause:!0})),E<O.length)for(;E<O.length;E++)T(sa(O[E]));if(uO(r)>0)for(const[S,_]of r)T(n(`${S}:`,Tr.bold,Tr.white),sa(_));t||k.groupEnd()})},jW=e=>{const t=e.colors?"%c":"";return bd(({annotations:n,cause:r,context:s,date:o,fiberId:a,logLevel:u,message:f,spans:h})=>{const p=wg(s,qs),g=Xn(p,Sg).unsafe,k=KS(f);let T=`${t}[${e.formatDate(o)}]`;const O=[];if(e.colors&&O.push("color:gray"),T+=` ${t}${u.label}${t} (${Wp(a)})`,e.colors&&O.push(FW[u._tag],""),bw(h)){const E=o.getTime(),S=Gw(E);for(const _ of h)T+=" "+S(_)}T+=":";let L=0;if(k.length>0){const E=uA(k[0]);typeof E=="string"&&(T+=` ${t}${E}`,e.colors&&O.push("color:deepskyblue"),L++)}if(g.groupCollapsed(T,...O),kw(r)||g.error(_i(r,{renderErrorCause:!0})),L<k.length)for(;L<k.length;L++)g.log(sa(k[L]));if(uO(n)>0)for(const[E,S]of n){const _=sa(S);e.colors?g.log(`%c${E}:`,"color:gray",_):g.log(`${E}:`,_)}g.groupEnd()})},fA="effect/MetricBoundaries",bb=Symbol.for(fA);var FT;class UW{constructor(t){d(this,"values");d(this,FT,bb);d(this,"_hash");this.values=t,this._hash=v(Tt(fA),fe(Hf(this.values)))}[(FT=bb,_e)](){return this._hash}[ye](t){return zW(t)&&me(this.values,t.values)}pipe(){return ee(this,arguments)}}const zW=e=>ne(e,bb),BW=e=>{const t=v(e,$p(ft(Number.POSITIVE_INFINITY)),ij);return new UW(t)},HW=e=>v(ML(e.count-1,t=>e.start*Math.pow(e.factor,t)),Bt,BW),VW="effect/MetricKeyType",dA=Symbol.for(VW),hA="effect/MetricKeyType/Counter",Sb=Symbol.for(hA),WW="effect/MetricKeyType/Frequency",KW=Symbol.for(WW),JW="effect/MetricKeyType/Gauge",GW=Symbol.for(JW),mA="effect/MetricKeyType/Histogram",wb=Symbol.for(mA),QW="effect/MetricKeyType/Summary",YW=Symbol.for(QW),pA={_In:e=>e,_Out:e=>e};var xT,NT;class XW{constructor(t,n){d(this,"incremental");d(this,"bigint");d(this,NT,pA);d(this,xT,Sb);d(this,"_hash");this.incremental=t,this.bigint=n,this._hash=Tt(hA)}[(NT=dA,xT=Sb,_e)](){return this._hash}[ye](t){return gA(t)}pipe(){return ee(this,arguments)}}var DT,MT;class ZW{constructor(t){d(this,"boundaries");d(this,MT,pA);d(this,DT,wb);d(this,"_hash");this.boundaries=t,this._hash=v(Tt(mA),fe(Q(this.boundaries)))}[(MT=dA,DT=wb,_e)](){return this._hash}[ye](t){return _A(t)&&me(this.boundaries,t.boundaries)}pipe(){return ee(this,arguments)}}const eK=e=>new XW((e==null?void 0:e.incremental)??!1,(e==null?void 0:e.bigint)??!1),tK=e=>new ZW(e),gA=e=>ne(e,Sb),nK=e=>ne(e,KW),rK=e=>ne(e,GW),_A=e=>ne(e,wb),sK=e=>ne(e,YW),oK="effect/MetricKey",yA=Symbol.for(oK),iK={_Type:e=>e},aK=Jf(me);var LT;class mv{constructor(t,n,r,s=[]){d(this,"name");d(this,"keyType");d(this,"description");d(this,"tags");d(this,LT,iK);d(this,"_hash");this.name=t,this.keyType=n,this.description=r,this.tags=s,this._hash=v(Tt(this.name+this.description),fe(Q(this.keyType)),fe(Hf(this.tags)))}[(LT=yA,_e)](){return this._hash}[ye](t){return cK(t)&&this.name===t.name&&me(this.keyType,t.keyType)&&me(this.description,t.description)&&aK(this.tags,t.tags)}pipe(){return ee(this,arguments)}}const cK=e=>ne(e,yA),uK=(e,t)=>new mv(e,eK(t),Ta(t==null?void 0:t.description)),lK=(e,t,n)=>new mv(e,tK(t),Ta(n)),fK=y(2,(e,t)=>t.length===0?e:new mv(e.name,e.keyType,e.description,wh(e.tags,t))),dK="effect/MetricState",Sd=Symbol.for(dK),bA="effect/MetricState/Counter",vb=Symbol.for(bA),SA="effect/MetricState/Frequency",Eb=Symbol.for(SA),wA="effect/MetricState/Gauge",kb=Symbol.for(wA),vA="effect/MetricState/Histogram",$b=Symbol.for(vA),EA="effect/MetricState/Summary",Cb=Symbol.for(EA),wd={_A:e=>e};var jT,UT;class hK{constructor(t){d(this,"count");d(this,UT,wd);d(this,jT,vb);this.count=t}[(UT=Sd,jT=vb,_e)](){return v(Q(bA),fe(Q(this.count)),ct(this))}[ye](t){return kK(t)&&this.count===t.count}pipe(){return ee(this,arguments)}}const mK=Jf(me);var zT,BT;class pK{constructor(t){d(this,"occurrences");d(this,BT,wd);d(this,zT,Eb);d(this,"_hash");this.occurrences=t}[(BT=Sd,zT=Eb,_e)](){return v(Tt(SA),fe(Hf(ze(this.occurrences.entries()))),ct(this))}[ye](t){return $K(t)&&mK(ze(this.occurrences.entries()),ze(t.occurrences.entries()))}pipe(){return ee(this,arguments)}}var HT,VT;class gK{constructor(t){d(this,"value");d(this,VT,wd);d(this,HT,kb);this.value=t}[(VT=Sd,HT=kb,_e)](){return v(Q(wA),fe(Q(this.value)),ct(this))}[ye](t){return CK(t)&&this.value===t.value}pipe(){return ee(this,arguments)}}var WT,KT;class _K{constructor(t,n,r,s,o){d(this,"buckets");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,KT,wd);d(this,WT,$b);this.buckets=t,this.count=n,this.min=r,this.max=s,this.sum=o}[(KT=Sd,WT=$b,_e)](){return v(Q(vA),fe(Q(this.buckets)),fe(Q(this.count)),fe(Q(this.min)),fe(Q(this.max)),fe(Q(this.sum)),ct(this))}[ye](t){return TK(t)&&me(this.buckets,t.buckets)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return ee(this,arguments)}}var JT,GT;class yK{constructor(t,n,r,s,o,a){d(this,"error");d(this,"quantiles");d(this,"count");d(this,"min");d(this,"max");d(this,"sum");d(this,GT,wd);d(this,JT,Cb);this.error=t,this.quantiles=n,this.count=r,this.min=s,this.max=o,this.sum=a}[(GT=Sd,JT=Cb,_e)](){return v(Q(EA),fe(Q(this.error)),fe(Q(this.quantiles)),fe(Q(this.count)),fe(Q(this.min)),fe(Q(this.max)),fe(Q(this.sum)),ct(this))}[ye](t){return IK(t)&&this.error===t.error&&me(this.quantiles,t.quantiles)&&this.count===t.count&&this.min===t.min&&this.max===t.max&&this.sum===t.sum}pipe(){return ee(this,arguments)}}const bK=e=>new hK(e),SK=e=>new pK(e),wK=e=>new gK(e),vK=e=>new _K(e.buckets,e.count,e.min,e.max,e.sum),EK=e=>new yK(e.error,e.quantiles,e.count,e.min,e.max,e.sum),kK=e=>ne(e,vb),$K=e=>ne(e,Eb),CK=e=>ne(e,kb),TK=e=>ne(e,$b),IK=e=>ne(e,Cb),RK="effect/MetricHook",OK=Symbol.for(RK),qK={_In:e=>e,_Out:e=>e},vd=e=>({[OK]:qK,pipe(){return ee(this,arguments)},...e}),r$=BigInt(0),AK=e=>{let t=e.keyType.bigint?r$:0;const n=e.keyType.incremental?e.keyType.bigint?s=>s>=r$:s=>s>=0:s=>!0,r=s=>{n(s)&&(t=t+s)};return vd({get:()=>bK(t),update:r,modify:r})},PK=e=>{const t=new Map;for(const r of e.keyType.preregisteredWords)t.set(r,0);const n=r=>{const s=t.get(r)??0;t.set(r,s+1)};return vd({get:()=>SK(t),update:n,modify:n})},FK=(e,t)=>{let n=t;return vd({get:()=>wK(n),update:r=>{n=r},modify:r=>{n=n+r}})},xK=e=>{const t=e.keyType.boundaries.values,n=t.length,r=new Uint32Array(n+1),s=new Float32Array(n);let o=0,a=0,u=Number.MAX_VALUE,f=Number.MIN_VALUE;v(t,zl(Fc),so((g,k)=>{s[k]=g}));const h=g=>{let k=0,T=n;for(;k!==T;){const O=Math.floor(k+(T-k)/2),L=s[O];g<=L?T=O:k=O,T===k+1&&(g<=s[k]?T=k:k=T)}r[k]=r[k]+1,o=o+1,a=a+g,g<u&&(u=g),g>f&&(f=g)},p=()=>{const g=kp(n);let k=0;for(let T=0;T<n;T++){const O=s[T],L=r[T];k=k+L,g[T]=[O,k]}return g};return vd({get:()=>vK({buckets:p(),count:o,min:u,max:f,sum:a}),update:h,modify:h})},NK=e=>{const{error:t,maxAge:n,maxSize:r,quantiles:s}=e.keyType,o=v(s,zl(Fc)),a=kp(r);let u=0,f=0,h=0,p=Number.MAX_VALUE,g=Number.MIN_VALUE;const k=O=>{const L=[];let E=0;for(;E!==r-1;){const S=a[E];if(S!=null){const[_,C]=S,$=fa(O-_);XU($,LR)&&YU($,n)&&L.push(C)}E=E+1}return DK(t,o,zl(L,Fc))},T=(O,L)=>{if(r>0){u=u+1;const E=u%r;a[E]=[L,O]}f=f+1,h=h+O,O<p&&(p=O),O>g&&(g=O)};return vd({get:()=>EK({error:t,quantiles:k(Date.now()),count:f,min:p,max:g,sum:h}),update:([O,L])=>T(O,L),modify:([O,L])=>T(O,L)})},DK=(e,t,n)=>{const r=n.length;if(!bt(t))return oi();const s=t[0],o=t.slice(1),a=s$(e,r,V(),0,s,n),u=fr(a);return o.forEach(f=>{u.push(s$(e,r,a.value,a.consumed,f,a.rest))}),so(u,f=>[f.quantile,f.value])},s$=(e,t,n,r,s,o)=>{let a=e,u=t,f=n,h=r,p=s,g=o,k=e,T=t,O=n,L=r,E=s,S=o;for(;;){if(!bt(g))return{quantile:p,value:V(),consumed:h,rest:[]};if(p===1)return{quantile:p,value:W(F1(g)),consumed:h+g.length,rest:[]};const _=Un(g),C=N1(g,M=>M===_),$=p*u,q=a/2*$,P=h+C[0].length,N=Math.abs(P-$);if(P<$-q){k=a,T=u,O=yc(g),L=P,E=p,S=C[1],a=k,u=T,f=O,h=L,p=E,g=S;continue}if(P>$+q){const M=Ft(f)?W(_):f;return{quantile:p,value:M,consumed:h,rest:g}}switch(f._tag){case"None":{k=a,T=u,O=yc(g),L=P,E=p,S=C[1],a=k,u=T,f=O,h=L,p=E,g=S;continue}case"Some":{const M=Math.abs($-f.value);if(N<M){k=a,T=u,O=yc(g),L=P,E=p,S=C[1],a=k,u=T,f=O,h=L,p=E,g=S;continue}return{quantile:p,value:W(f.value),consumed:h,rest:g}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},MK="effect/MetricPair",LK=Symbol.for(MK),jK={_Type:e=>e},UK=(e,t)=>({[LK]:jK,metricKey:e,metricState:t,pipe(){return ee(this,arguments)}}),zK="effect/MetricRegistry",o$=Symbol.for(zK);var QT;QT=o$;class BK{constructor(){d(this,QT,o$);d(this,"map",aq())}snapshot(){const t=[];for(const[n,r]of this.map)t.push(UK(n,r.get()));return t}get(t){const n=v(this.map,hs(t),hr);if(n==null){if(gA(t.keyType))return this.getCounter(t);if(rK(t.keyType))return this.getGauge(t);if(nK(t.keyType))return this.getFrequency(t);if(_A(t.keyType))return this.getHistogram(t);if(sK(t.keyType))return this.getSummary(t);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(t){let n=v(this.map,hs(t),hr);if(n==null){const r=AK(t);v(this.map,rc(t))||v(this.map,sc(t,r)),n=r}return n}getFrequency(t){let n=v(this.map,hs(t),hr);if(n==null){const r=PK(t);v(this.map,rc(t))||v(this.map,sc(t,r)),n=r}return n}getGauge(t){let n=v(this.map,hs(t),hr);if(n==null){const r=FK(t,t.keyType.bigint?BigInt(0):0);v(this.map,rc(t))||v(this.map,sc(t,r)),n=r}return n}getHistogram(t){let n=v(this.map,hs(t),hr);if(n==null){const r=xK(t);v(this.map,rc(t))||v(this.map,sc(t,r)),n=r}return n}getSummary(t){let n=v(this.map,hs(t),hr);if(n==null){const r=NK(t);v(this.map,rc(t))||v(this.map,sc(t,r)),n=r}return n}}const HK=()=>new BK,VK="effect/Metric",WK=Symbol.for(VK),KK={_Type:e=>e,_In:e=>e,_Out:e=>e},i$=Te(Symbol.for("effect/Metric/globalMetricRegistry"),()=>HK()),kA=function(e,t,n,r){const s=Object.assign(o=>cg(o,a=>YK(s,a)),{[WK]:KK,keyType:e,unsafeUpdate:t,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return ee(this,arguments)}});return s},$g=(e,t)=>$A(uK(e,t)),$A=e=>{let t;const n=new WeakMap,r=s=>{if(s.length===0)return t!==void 0||(t=i$.get(e)),t;let o=n.get(s);return o!==void 0||(o=i$.get(fK(e,s)),n.set(s,o)),o};return kA(e.keyType,(s,o)=>r(o).update(s),s=>r(s).get(),(s,o)=>r(o).modify(s))},JK=(e,t,n)=>$A(lK(e,t,n)),GK=y(3,(e,t,n)=>QK(e,[F5(t,n)])),QK=y(2,(e,t)=>kA(e.keyType,(n,r)=>e.unsafeUpdate(n,wh(t,r)),n=>e.unsafeValue(wh(t,n)),(n,r)=>e.unsafeModify(n,wh(t,r)))),YK=y(2,(e,t)=>Cu(rb,n=>K(()=>e.unsafeUpdate(t,n)))),XK="effect/Request",ZK=Symbol.for(XK),e8={_E:e=>e,_A:e=>e},t8={...zS,[ZK]:e8},n8=(function(){function e(t){t&&Object.assign(this,t)}return e.prototype=t8,e})(),r8=y(2,(e,t)=>Cu(iA,n=>K(()=>{if(n.has(e)){const r=n.get(e);r.state.completed||(r.state.completed=!0,dd(r.result,t))}}))),s8="effect/Supervisor",Cg=Symbol.for(s8),pv={_T:e=>e};var YT;YT=Cg;const y0=class y0{constructor(t,n){d(this,"underlying");d(this,"value0");d(this,YT,pv);this.underlying=t,this.value0=n}get value(){return this.value0}onStart(t,n,r,s){this.underlying.onStart(t,n,r,s)}onEnd(t,n){this.underlying.onEnd(t,n)}onEffect(t,n){this.underlying.onEffect(t,n)}onSuspend(t){this.underlying.onSuspend(t)}onResume(t){this.underlying.onResume(t)}map(t){return new y0(this,v(this.value,Se(t)))}zip(t){return new km(this,t)}};let Em=y0;var XT;XT=Cg;const b0=class b0{constructor(t,n){d(this,"left");d(this,"right");d(this,"_tag","Zip");d(this,XT,pv);this.left=t,this.right=n}get value(){return lg(this.left.value,this.right.value)}onStart(t,n,r,s){this.left.onStart(t,n,r,s),this.right.onStart(t,n,r,s)}onEnd(t,n){this.left.onEnd(t,n),this.right.onEnd(t,n)}onEffect(t,n){this.left.onEffect(t,n),this.right.onEffect(t,n)}onSuspend(t){this.left.onSuspend(t),this.right.onSuspend(t)}onResume(t){this.left.onResume(t),this.right.onResume(t)}map(t){return new Em(this,v(this.value,Se(t)))}zip(t){return new b0(this,t)}};let km=b0;const CA=e=>ne(e,Cg)&&yp(e,"Zip");var ZT;ZT=Cg;class o8{constructor(t){d(this,"effect");d(this,ZT,pv);this.effect=t}get value(){return this.effect}onStart(t,n,r,s){}onEnd(t,n){}onEffect(t,n){}onSuspend(t){}onResume(t){}map(t){return new Em(this,v(this.value,Se(t)))}zip(t){return new km(this,t)}onRun(t,n){return t()}}const i8=e=>new o8(e),Tg=Te("effect/Supervisor/none",()=>i8(Qe)),a8=bu,TA="Empty",IA="AddSupervisor",RA="RemoveSupervisor",OA="AndThen",Tl={_tag:TA},qh=(e,t)=>({_tag:OA,first:e,second:t}),c8=(e,t)=>u8(t,ft(e)),u8=(e,t)=>{let n=e,r=t;for(;yo(r);){const s=Ss(r);switch(s._tag){case TA:{r=Xs(r);break}case IA:{n=n.zip(s.supervisor),r=Xs(r);break}case RA:{n=Tb(n,s.supervisor),r=Xs(r);break}case OA:{r=Tn(s.first)(Tn(s.second)(Xs(r)));break}}}return n},Tb=(e,t)=>me(e,t)?Tg:CA(e)?Tb(e.left,t).zip(Tb(e.right,t)):e,$m=e=>me(e,Tg)?ha():CA(e)?v($m(e.left),Kl($m(e.right))):Bp(e),l8=(e,t)=>{if(me(e,t))return Tl;const n=$m(e),r=$m(t),s=v(r,mk(n),Jl(Tl,(a,u)=>qh(a,{_tag:IA,supervisor:u}))),o=v(n,mk(r),Jl(Tl,(a,u)=>qh(a,{_tag:RA,supervisor:u})));return qh(s,o)},f8=a8({empty:Tl,patch:c8,combine:qh,diff:l8}),d8=$g("effect_fiber_started",{incremental:!0}),a$=$g("effect_fiber_active"),h8=$g("effect_fiber_successes",{incremental:!0}),m8=$g("effect_fiber_failures",{incremental:!0}),p8=GK(JK("effect_fiber_lifetimes",HW({start:.5,factor:2,count:35})),"time_unit","milliseconds"),nl="Continue",g8="Done",c$="Yield",_8={_E:e=>e,_A:e=>e},th=e=>{throw new Error(`BUG: FiberRuntime - ${ra(e)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},zs=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Bs=Te("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),rl={[Gh]:(e,t,n)=>gt(()=>t.effect_instruction_i1(n)),OnStep:(e,t,n)=>Ge(Ge(n)),[Qh]:(e,t,n)=>gt(()=>t.effect_instruction_i2(n)),[US]:(e,t,n)=>(e.patchRuntimeFlags(e.currentRuntimeFlags,t.patch),Wo(e.currentRuntimeFlags)&&e.isInterrupted()?st(e.getInterruptedCause()):Ge(n)),[Yh]:(e,t,n)=>(gt(()=>t.effect_instruction_i2(n)),gt(()=>t.effect_instruction_i0())?(e.pushStack(t),gt(()=>t.effect_instruction_i1())):Qe),[$l]:(e,t,n)=>{const r=gt(()=>t.effect_instruction_i0.next(n));return r.done?Ge(r.value):(e.pushStack(t),f1(r.value))}},y8={[lv]:(e,t,n,r)=>(e.processNewInterruptSignal(r.cause),Wo(t)?st(r.cause):n),[dv]:(e,t,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[fv]:(e,t,n,r)=>(r.onFiber(e,Qq(t)),n),[hv]:(e,t,n,r)=>U(ug(),()=>n)},b8=e=>Gc(fH(e),t=>uo($H(t),([n,r])=>{const s=new Map,o=[];for(const u of r){o.push(pr(u));for(const f of u)s.set(f.request,f)}const a=o.flat();return Ao(L8(n.runAll(o),a,()=>a.forEach(u=>{u.listeners.interrupted=!0})),iA,s)},!1,!1)),S8=gp();var eI,tI;class qA extends Po{constructor(n,r,s){super();d(this,tI,yW);d(this,eI,_8);d(this,"_fiberRefs");d(this,"_fiberId");d(this,"_queue",new Array);d(this,"_children",null);d(this,"_observers",new Array);d(this,"_running",!1);d(this,"_stack",[]);d(this,"_asyncInterruptor",null);d(this,"_asyncBlockingOn",null);d(this,"_exitValue",null);d(this,"_steps",[]);d(this,"_isYielding",!1);d(this,"currentRuntimeFlags");d(this,"currentOpCount",0);d(this,"currentSupervisor");d(this,"currentScheduler");d(this,"currentTracer");d(this,"currentSpan");d(this,"currentContext");d(this,"currentDefaultServices");d(this,"run",()=>{this.drainQueueOnCurrentThread()});if(this.currentRuntimeFlags=s,this._fiberId=n,this._fiberRefs=r,bk(s)){const o=this.getFiberRef(rb);d8.unsafeUpdate(1,o),a$.unsafeUpdate(1,o)}this.refreshRefCache()}commit(){return eu(this)}id(){return this._fiberId}resume(n){this.tell(Xa(n))}get status(){return this.ask((n,r)=>r)}get runtimeFlags(){return this.ask((n,r)=>AV(r)?n.currentRuntimeFlags:r.runtimeFlags)}scope(){return pW(this)}get children(){return this.ask(n=>Array.from(n.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Zd)}fiberRefs(){return this.ask(n=>n.getFiberRefs())}ask(n){return pe(()=>{const r=Iu(this._fiberId);return this.tell(Oh((s,o)=>{dd(r,K(()=>n(s,o)))})),rs(r)})}tell(n){this._queue.push(n),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return ns(n=>{const r=s=>n(J(s));return this.tell(Oh((s,o)=>{s._exitValue!==null?r(this._exitValue):s.addObserver(r)})),K(()=>this.tell(Oh((s,o)=>{s.removeObserver(r)})))},this.id())}get inheritAll(){return Fe((n,r)=>{const s=n.id(),o=n.getFiberRefs(),a=r.runtimeFlags,u=this.getFiberRefs(),f=l5(o,s,u);n.setFiberRefs(f);const h=n.getFiberRef(d$),p=v(ei(a,h),wk(Su),wk(eb));return HO(p)})}get poll(){return K(()=>Ta(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(n){return K(()=>this.tell(ey(Ir(n))))}unsafeInterruptAsFork(n){this.tell(ey(Ir(n)))}addObserver(n){this._exitValue!==null?n(this._exitValue):this._observers.push(n)}removeObserver(n){this._observers=this._observers.filter(r=>r!==n)}getFiberRefs(){return this.setFiberRef(d$,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(n){this._fiberRefs=Eq(this._fiberRefs,n)}getFiberRef(n){return this._fiberRefs.locals.has(n)?this._fiberRefs.locals.get(n)[0][1]:n.initial}setFiberRef(n,r){this._fiberRefs=ub(this._fiberRefs,{fiberId:this._fiberId,fiberRef:n,value:r}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(qs),this.currentTracer=this.currentDefaultServices.unsafeMap.get(pd.key),this.currentSupervisor=this.getFiberRef(D8),this.currentScheduler=this.getFiberRef(_d),this.currentContext=this.getFiberRef(os),this.currentSpan=this.currentContext.unsafeMap.get(Os.key)}setFiberRefs(n){this._fiberRefs=n,this.refreshRefCache()}addChild(n){this.getChildren().add(n)}removeChild(n){this.getChildren().delete(n)}transferChildren(n){const r=this._children;if(this._children=null,r!==null&&r.size>0)for(const s of r)s._exitValue===null&&n.add(this.currentRuntimeFlags,s)}drainQueueOnCurrentThread(){let n=!0;for(;n;){let r=nl;const s=globalThis[Vo];globalThis[Vo]=this;try{for(;r===nl;)r=this._queue.length===0?g8:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[Vo]=s}this._queue.length>0&&!this._running?(this._running=!0,r===c$?(this.drainQueueLaterOnExecutor(),n=!1):n=!0):n=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(bi))}drainQueueWhileRunning(n,r){let s=r;for(;this._queue.length>0;){const o=this._queue.splice(0,1)[0];s=y8[o._tag](this,n,s,o)}return s}isInterrupted(){return!kw(this.getFiberRef(Zd))}addInterruptedCause(n){const r=this.getFiberRef(Zd);this.setFiberRef(Zd,en(r,n))}processNewInterruptSignal(n){this.addInterruptedCause(n),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let n=!1;for(const r of this._children)r.tell(ey(Ir(this.id()))),n=!0;return n}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const n=this._children.values();this._children=null;let r=!1;return qw({while:()=>!r,body:()=>{const o=n.next();return o.done?K(()=>{r=!0}):or(o.value.await)},step:()=>{}})}return null}reportExitValue(n){if(bk(this.currentRuntimeFlags)){const r=this.getFiberRef(rb),s=this.id().startTimeMillis,o=Date.now();switch(p8.unsafeUpdate(o-s,r),a$.unsafeUpdate(-1,r),n._tag){case hn:{h8.unsafeUpdate(1,r);break}case dn:{m8.unsafeUpdate(1,r);break}}}if(n._tag==="Failure"){const r=this.getFiberRef(QO);!Xp(n.cause)&&r._tag==="Some"&&this.log("Fiber terminated with an unhandled error",n.cause,r)}}setExitValue(n){this._exitValue=n,this.reportExitValue(n);for(let r=this._observers.length-1;r>=0;r--)this._observers[r](n);this._observers=[]}getLoggers(){return this.getFiberRef(Ig)}log(n,r,s){const o=lt(s)?s.value:this.getFiberRef(p4),a=this.getFiberRef(AA);if(w5(a,o))return;const u=this.getFiberRef(g4),f=this.getFiberRef(GO),h=this.getLoggers(),p=this.getFiberRefs();if(mw(h)>0){const g=Xn(this.getFiberRef(qs),Na),k=new Date(g.unsafeCurrentTimeMillis());XM(p,()=>{for(const T of h)T.log({fiberId:this.id(),logLevel:o,message:n,cause:r,context:p,spans:u,annotations:f,date:k})})}}evaluateMessageWhileSuspended(n){switch(n._tag){case hv:return c$;case lv:return this.processNewInterruptSignal(n.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(st(n.cause)),this._asyncInterruptor=null),nl;case dv:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(n.effect),nl;case fv:return n.onFiber(this,this._exitValue!==null?OV:qV(this.currentRuntimeFlags,this._asyncBlockingOn)),nl;default:return th(n)}}evaluateEffect(n){this.currentSupervisor.onResume(this);try{let r=Wo(this.currentRuntimeFlags)&&this.isInterrupted()?st(this.getInterruptedCause()):n;for(;r!==null;){const s=r,o=this.runLoop(s);if(o===zs){const a=Bs.currentOp;Bs.currentOp=null,a._op===bh?iH(this.currentRuntimeFlags)?(this.tell(fW()),this.tell(Xa(qn)),r=null):r=qn:a._op===kl&&(r=null)}else{this.currentRuntimeFlags=v(this.currentRuntimeFlags,aH(eb));const a=this.interruptAllChildren();a!==null?r=U(a,()=>o):(this._queue.length===0?this.setExitValue(o):this.tell(Xa(o)),r=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(n){if(this._running)this.tell(Xa(n));else{this._running=!0;const r=globalThis[Vo];globalThis[Vo]=this;try{this.evaluateEffect(n)}finally{this._running=!1,globalThis[Vo]=r,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(n){this.tell(Xa(n))}patchRuntimeFlags(n,r){const s=Ec(n,r);return globalThis[Vo]=this,this.currentRuntimeFlags=s,s}initiateAsync(n,r){let s=!1;const o=a=>{s||(s=!0,this.tell(Xa(a)))};Wo(n)&&(this._asyncInterruptor=o);try{r(o)}catch(a){o($t(Bn(a)))}}pushStack(n){this._stack.push(n),n._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const n=this._stack.pop();if(n)return n._op==="OnStep"&&this._steps.pop(),n}getNextSuccessCont(){let n=this.popStack();for(;n;){if(n._op!==yh)return n;n=this.popStack()}}getNextFailCont(){let n=this.popStack();for(;n;){if(n._op!==Gh&&n._op!==Yh&&n._op!==$l)return n;n=this.popStack()}}[(tI=_W,eI=SW,ZM)](n){return K(()=>Ap(this.currentContext,n))}Left(n){return St(n.left)}None(n){return St(new ud)}Right(n){return Ge(n.right)}Some(n){return Ge(n.value)}Micro(n){return Yl(r=>{let s=r;const o=iW(ZV(n,this.currentContext));return o.addObserver(a=>{if(a._tag==="Success")return s(Ge(a.value));switch(a.cause._tag){case"Interrupt":return s(st(Ir(zn)));case"Fail":return s(St(a.cause.error));case"Die":return s(Xl(a.cause.defect))}}),Yl(a=>{s=u=>{a(Qe)},o.unsafeInterrupt()})})}[g1](n){const r=gt(()=>n.effect_instruction_i0()),s=this.getNextSuccessCont();return s!==void 0?(s._op in rl||th(s),rl[s._op](this,s,r)):(Bs.currentOp=Ge(r),zs)}[hn](n){const r=n,s=this.getNextSuccessCont();return s!==void 0?(s._op in rl||th(s),rl[s._op](this,s,r.effect_instruction_i0)):(Bs.currentOp=r,zs)}[dn](n){const r=n.effect_instruction_i0,s=this.getNextFailCont();if(s!==void 0)switch(s._op){case yh:case Qh:return Wo(this.currentRuntimeFlags)&&this.isInterrupted()?st(vk(r)):gt(()=>s.effect_instruction_i1(r));case"OnStep":return Wo(this.currentRuntimeFlags)&&this.isInterrupted()?st(vk(r)):Ge(st(r));case US:return this.patchRuntimeFlags(this.currentRuntimeFlags,s.patch),Wo(this.currentRuntimeFlags)&&this.isInterrupted()?st(en(r,this.getInterruptedCause())):st(r);default:th(s)}else return Bs.currentOp=st(r),zs}[_1](n){return gt(()=>n.effect_instruction_i0(this,Qq(this.currentRuntimeFlags)))}Blocked(n){const r=this.getFiberRefs(),s=this.currentRuntimeFlags;if(this._steps.length>0){const o=[],a=this._steps[this._steps.length-1];let u=this.popStack();for(;u&&u._op!=="OnStep";)o.push(u),u=this.popStack();this.setFiberRefs(a.refs),this.currentRuntimeFlags=a.flags;const f=cf(a.refs,r),h=ei(a.flags,s);return Ge(FO(n.effect_instruction_i0,Fe(p=>{for(;o.length>0;)p.pushStack(o.pop());return p.setFiberRefs(uf(p.id(),p.getFiberRefs())(f)),p.currentRuntimeFlags=Ec(h)(p.currentRuntimeFlags),n.effect_instruction_i1})))}return Sr(o=>U(Rg(HH(n.effect_instruction_i0)),()=>o(n.effect_instruction_i1)))}RunBlocked(n){return b8(n.effect_instruction_i0)}[mu](n){const r=n.effect_instruction_i0,s=this.currentRuntimeFlags,o=Ec(s,r);if(Wo(o)&&this.isInterrupted())return st(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,r),n.effect_instruction_i1){const a=ei(o,s);return this.pushStack(new VH(a,n)),gt(()=>n.effect_instruction_i1(s))}else return qn}[Gh](n){return this.pushStack(n),n.effect_instruction_i0}OnStep(n){return this.pushStack(n),n.effect_instruction_i0}[yh](n){return this.pushStack(n),n.effect_instruction_i0}[Qh](n){return this.pushStack(n),n.effect_instruction_i0}[kl](n){return this._asyncBlockingOn=n.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,n.effect_instruction_i0),Bs.currentOp=n,zs}[bh](n){return this._isYielding=!1,Bs.currentOp=n,zs}[Yh](n){const r=n.effect_instruction_i0,s=n.effect_instruction_i1;return r()?(this.pushStack(n),s()):qn}[$l](n){return rl[$l](this,n,void 0)}[Vf](n){return gt(()=>n.commit())}runLoop(n){let r=n;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&oH)!==0&&this.currentSupervisor.onEffect(this,r),this._queue.length>0&&(r=this.drainQueueWhileRunning(this.currentRuntimeFlags,r)),!this._isYielding){this.currentOpCount+=1;const s=this.currentScheduler.shouldYield(this);if(s!==!1){this._isYielding=!0,this.currentOpCount=0;const o=r;r=U(ug({priority:s}),()=>o)}}try{if(r=this.currentTracer.context(()=>S8!==r[ya]._V?nb(`Cannot execute an Effect versioned ${r[ya]._V} with a Runtime of version ${gp()}`):this[r._op](r),this),r===zs){const s=Bs.currentOp;return s._op===bh||s._op===kl?zs:(Bs.currentOp=null,s._op===hn||s._op===dn?s:st(Bn(s)))}}catch(s){r!==zs&&!ne(r,"_op")||!(r._op in this)?r=nb(`Not a valid effect: ${ra(r)}`):T4(s)?r=st(en(Bn(s),Ir(zn))):r=Xl(s)}}}}const AA=Te("effect/FiberRef/currentMinimumLogLevel",()=>wn(v5("Info"))),w8=e=>bd(t=>{const n=wg(t.context,qs);Xn(n,Sg).unsafe.log(e.log(t))}),PA=Te(Symbol.for("effect/Logger/defaultLogger"),()=>w8(OW)),FA=Te(Symbol.for("effect/Logger/tracerLogger"),()=>bd(({annotations:e,cause:t,context:n,fiberId:r,logLevel:s,message:o})=>{const a=Lr(rf(n,os),Os);if(a._tag==="None"||a.value._tag==="ExternalSpan")return;const u=Ap(rf(n,qs),Na),f={};for(const[h,p]of e)f[h]=p;f["effect.fiberId"]=Wz(r),f["effect.logLevel"]=s.label,t!==null&&t._tag!=="Empty"&&(f["effect.cause"]=_i(t,{renderErrorCause:!0})),a.value.event(ra(Array.isArray(o)?o[0]:o),u.unsafeCurrentTimeNanos(),f)})),Ig=Te(Symbol.for("effect/FiberRef/currentLoggers"),()=>d4(Bp(PA,FA))),gv=y(e=>wr(e[0]),(e,t)=>yi(cg(e,n=>xA(r=>t(n,r))))),xA=e=>Fe(t=>{const n=t.getFiberRefs(),r=t.currentRuntimeFlags;return U(DA,s=>Zl(s,o=>Fe(a=>{const u=a.getFiberRefs(),f=a.currentRuntimeFlags,h=cf(u,n),p=ei(f,r),g=cf(n,u);return a.setFiberRefs(uf(h,a.id(),n)),lf(e4(e(o),p),K(()=>{a.setFiberRefs(uf(g,a.id(),a.getFiberRefs()))}))})))}),v8=e=>{if(Array.isArray(e)||MS(e))return[e,V()];const t=Object.keys(e),n=t.length;return[t.map(r=>e[r]),W(r=>{const s={};for(let o=0;o<n;o++)s[t[o]]=r[o];return s})]},E8=(e,t,n)=>{const r=[];for(const s of e)r.push(Jc(s));return U(tu(r,ce,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>{const o=V(),a=s.length,u=new Array(a),f=new Array(a);let h=!1;for(let p=0;p<a;p++){const g=s[p];g._tag==="Left"?(u[p]=W(g.left),h=!0):(f[p]=g.right,u[p]=o)}return h?t._tag==="Some"?St(t.value(u)):St(u):n!=null&&n.discard?Qe:t._tag==="Some"?J(t.value(f)):J(f)})},k8=(e,t,n)=>{const r=[];for(const s of e)r.push(Jc(s));return n!=null&&n.discard?tu(r,ce,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,discard:!0,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}):Se(tu(r,ce,{concurrency:n==null?void 0:n.concurrency,batching:n==null?void 0:n.batching,concurrentFinalizers:n==null?void 0:n.concurrentFinalizers}),s=>t._tag==="Some"?t.value(s):s)},_v=(e,t)=>{const[n,r]=v8(e);return(t==null?void 0:t.mode)==="validate"?E8(n,r,t):(t==null?void 0:t.mode)==="either"?k8(n,r,t):(t==null?void 0:t.discard)!==!0&&r._tag==="Some"?Se(tu(n,ce,t),r.value):tu(n,ce,t)},tu=y(e=>MS(e[0]),(e,t,n)=>Fe(r=>{const s=(n==null?void 0:n.batching)===!0||(n==null?void 0:n.batching)==="inherit"&&r.getFiberRef(S4);return n!=null&&n.discard?n$(n.concurrency,()=>Za(af,n==null?void 0:n.concurrentFinalizers)(o=>s?uo(e,(a,u)=>o(t(a,u)),!0,!1,1):Gc(e,(a,u)=>o(t(a,u)))),()=>Za(pb,n==null?void 0:n.concurrentFinalizers)(o=>uo(e,(a,u)=>o(t(a,u)),s,!1)),o=>Za(gb(o),n==null?void 0:n.concurrentFinalizers)(a=>uo(e,(u,f)=>a(t(u,f)),s,!1,o))):n$(n==null?void 0:n.concurrency,()=>Za(af,n==null?void 0:n.concurrentFinalizers)(o=>s?Ib(e,1,(a,u)=>o(t(a,u)),!0):Zs(e,(a,u)=>o(t(a,u)))),()=>Za(pb,n==null?void 0:n.concurrentFinalizers)(o=>yv(e,(a,u)=>o(t(a,u)),s)),o=>Za(gb(o),n==null?void 0:n.concurrentFinalizers)(a=>Ib(e,o,(u,f)=>a(t(u,f)),s)))})),yv=(e,t,n)=>pe(()=>{const r=ze(e),s=new Array(r.length);return It(uo(r,(a,u)=>U(t(a,u),f=>K(()=>s[u]=f)),n,!1),J(s))}),uo=(e,t,n,r,s)=>Sr(o=>YH(a=>Fe(u=>{let f=Array.from(e).reverse(),h=f.length;if(h===0)return Qe;let p=0,g=!1;const k=s?Math.min(f.length,s):f.length,T=new Set,O=new Array,L=()=>T.forEach(M=>{M.currentScheduler.scheduleTask(()=>{M.unsafeInterruptAsFork(u.id())},0)}),E=new Array,S=new Array,_=new Array,C=()=>{const M=O.filter(({exit:B})=>B._tag==="Failure").sort((B,F)=>B.index<F.index?-1:B.index===F.index?0:1).map(({exit:B})=>B);return M.length===0&&M.push(qn),M},$=(M,B=!1)=>{const F=yi(a(M)),j=C8(F,u,u.currentRuntimeFlags,yd);return u.currentScheduler.scheduleTask(()=>{B&&j.unsafeInterruptAsFork(u.id()),j.resume(F)},0),j},q=()=>{r||(h-=f.length,f=[]),g=!0,L()},P=n?KH:ks,N=$(ns(M=>{const B=(j,Z)=>{j._op==="Blocked"?_.push(j):(O.push({index:Z,exit:j}),j._op==="Failure"&&!g&&q())},F=()=>{if(f.length>0){const j=f.pop();let Z=p++;const we=()=>{const We=f.pop();return Z=p++,U(ug(),()=>U(P(o(t(We,Z))),G))},G=We=>f.length>0&&(B(We,Z),f.length>0)?we():J(We),ke=U(P(o(t(j,Z))),G),qe=$(ke);E.push(qe),T.add(qe),g&&qe.currentScheduler.scheduleTask(()=>{qe.unsafeInterruptAsFork(u.id())},0),qe.addObserver(We=>{let tt;if(We._op==="Failure"?tt=We:tt=We.effect_instruction_i0,S.push(qe),T.delete(qe),B(tt,Z),O.length===h)M(J(Et(kc(C(),{parallel:!0}),()=>qn)));else if(_.length+O.length===h){const Ke=C(),jt=_.map(Nn=>Nn.effect_instruction_i0).reduce(EO);M(J(FO(jt,uo([Et(kc(Ke,{parallel:!0}),()=>qn),..._.map(Nn=>Nn.effect_instruction_i1)],Nn=>Nn,n,!0,s))))}else F()})}};for(let j=0;j<k;j++)F()}));return or(Rs($u(o(eu(N))),_g({onFailure:M=>{q();const B=_.length+1,F=Math.min(typeof s=="number"?s:_.length,_.length),j=Array.from(_);return ns(Z=>{let we=0,G=0;const ke=(We,tt)=>Ke=>{we++,we===B&&Z(Ge(st(M))),j.length>0&&tt&&qe()},qe=()=>{$(j.pop(),!0).addObserver(ke(G,!0)),G++};N.addObserver(ke(G,!1)),G++;for(let We=0;We<F;We++)qe()})},onSuccess:()=>Zs(S,M=>M.inheritAll)})))}))),Ib=(e,t,n,r)=>pe(()=>{const s=ze(e),o=new Array(s.length);return It(uo(s,(u,f)=>Se(n(u,f),h=>o[f]=h),r,!1,t),J(o))}),$8=e=>Fe((t,n)=>J(bv(e,t,n.runtimeFlags))),Rg=e=>T8(e,yd),bv=(e,t,n,r=null)=>{const s=Cm(e,t,n,r);return s.resume(e),s},C8=(e,t,n,r=null)=>Cm(e,t,n,r),Cm=(e,t,n,r=null)=>{const s=iO(),o=t.getFiberRefs(),a=f5(o,s),u=new qA(s,a,n),f=rf(a,os),h=u.currentSupervisor;return h.onStart(f,e,W(t),u),u.addObserver(g=>h.onEnd(g,u)),(r!==null?r:v(t.getFiberRef(sb),Et(()=>t.scope()))).add(n,u),u},T8=(e,t)=>Fe((n,r)=>J(bv(e,n,r.runtimeFlags,t))),u$=e=>Ou(t=>ot(Lr(t,Fo),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Parallel":return e;case"Sequential":case"ParallelN":return U(mg(n,pb),r=>Au(e,r))}}})),l$=e=>t=>Ou(n=>ot(Lr(n,Fo),{onNone:()=>t,onSome:r=>r.strategy._tag==="ParallelN"&&r.strategy.parallelism===e?t:U(mg(r,gb(e)),s=>Au(t,s))})),Za=(e,t)=>n=>Ou(r=>ot(Lr(r,Fo),{onNone:()=>n(ce),onSome:s=>{if(t===!0){const o=e._tag==="Parallel"?u$:e._tag==="Sequential"?f$:l$(e.parallelism);switch(s.strategy._tag){case"Parallel":return o(n(u$));case"Sequential":return o(n(f$));case"ParallelN":return o(n(l$(s.strategy.parallelism)))}}else return n(ce)}})),Sv=e=>U(Fo,e),NA=e=>U(kd(),t=>Rs(e(t),n=>t.close(n))),I8=e=>U(kd(),t=>F8(e,t)),f$=e=>Ou(t=>ot(Lr(t,Fo),{onNone:()=>e,onSome:n=>{switch(n.strategy._tag){case"Sequential":return e;case"Parallel":case"ParallelN":return U(mg(n,af),r=>Au(e,r))}}})),R8=y(e=>wr(e[1]),(e,t,n)=>Ed(e,t,(r,s)=>[r,s],n)),O8=y(e=>wr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?Aw(e,t):Ed(e,t,(r,s)=>r,n)),q8=y(e=>wr(e[1]),(e,t,n)=>(n==null?void 0:n.concurrent)!==!0&&((n==null?void 0:n.batching)===void 0||n.batching===!1)?It(e,t):Ed(e,t,(r,s)=>s,n)),Ed=y(e=>wr(e[1]),(e,t,n,r)=>Se(_v([e,t],{concurrency:r!=null&&r.concurrent?2:1,batching:r==null?void 0:r.batching,concurrentFinalizers:r==null?void 0:r.concurrentFinalizers}),([s,o])=>n(s,o))),Fo=sr("effect/Scope"),DA=Fo,A8=(e,t)=>{e.state._tag==="Open"&&e.state.finalizers.set({},t)},P8={[Ck]:Ck,[Tk]:Tk,pipe(){return ee(this,arguments)},fork(e){return K(()=>{const t=MA(e);if(this.state._tag==="Closed")return t.state=this.state,t;const n={},r=s=>t.close(s);return this.state.finalizers.set(n,r),A8(t,s=>K(()=>{this.state._tag==="Open"&&this.state.finalizers.delete(n)})),t})},close(e){return pe(()=>{if(this.state._tag==="Closed")return Qe;const t=Array.from(this.state.finalizers.values()).reverse();return this.state={_tag:"Closed",exit:e},t.length===0?Qe:SV(this.strategy)?v(Zs(t,n=>ks(n(e))),U(n=>v(kc(n),Zo(Y_),Et(()=>qn)))):wV(this.strategy)?v(yv(t,n=>ks(n(e)),!1),U(n=>v(kc(n,{parallel:!0}),Zo(Y_),Et(()=>qn)))):v(Ib(t,this.strategy.parallelism,n=>ks(n(e)),!1),U(n=>v(kc(n,{parallel:!0}),Zo(Y_),Et(()=>qn))))})},addFinalizer(e){return pe(()=>this.state._tag==="Closed"?e(this.state.exit):(this.state.finalizers.set({},e),Qe))}},MA=(e=gd)=>{const t=Object.create(P8);return t.strategy=e,t.state={_tag:"Open",finalizers:new Map},t},kd=(e=gd)=>K(()=>MA(e)),Au=y(2,(e,t)=>oq(e,qo(Zf(Fo,t)))),F8=y(2,(e,t)=>v(e,Au(t),Rs(n=>t.close(n)))),x8=e=>Tu(e,{differ:f8,fork:Tl}),N8=y(2,(e,t)=>or(gv(U(ad(e),n=>tn(hm(e,t),n)),n=>hm(e,n)))),wv=y(2,(e,t)=>Cu(e,n=>N8(e,t(n)))),d$=m4(cH),D8=x8(Tg),LA=y(3,(e,t,n)=>UA(e,t,{onSelfWin:(r,s)=>U(r.await,o=>{switch(o._tag){case hn:return U(r.inheritAll,()=>n.onSelfDone(o,s));case dn:return n.onSelfDone(o,s)}}),onOtherWin:(r,s)=>U(r.await,o=>{switch(o._tag){case hn:return U(r.inheritAll,()=>n.onOtherDone(o,s));case dn:return n.onOtherDone(o,s)}})})),M8=e=>Sr(t=>Aa(n=>U(Rg(t(e)),r=>v(t(eu(r)),Pa(()=>v(r,cA(n))))))),jA=y(2,(e,t)=>Aa(n=>LA(e,t,{onSelfDone:(r,s)=>ab(r,{onFailure:o=>v(eu(s),Qk(a=>So(o,a))),onSuccess:o=>v(s,eo(n),tn(o))}),onOtherDone:(r,s)=>ab(r,{onFailure:o=>v(eu(s),Qk(a=>So(a,o))),onSuccess:o=>v(s,eo(n),tn(o))})}))),UA=y(3,(e,t,n)=>Fe((r,s)=>{const o=s.runtimeFlags,a=Ra(!0),u=Cm(e,r,o,n.selfScope),f=Cm(t,r,o,n.otherScope);return ns(h=>{u.addObserver(()=>h$(u,f,n.onSelfWin,a,h)),f.addObserver(()=>h$(f,u,n.onOtherWin,a,h)),u.startFork(e),f.startFork(t)},gr(u.id(),f.id()))})),h$=(e,t,n,r,s)=>{xz(!0,!1)(r)&&s(n(e,t))},lf=y(2,(e,t)=>Sr(n=>Vn(n(e),{onFailure:r=>Vn(t,{onFailure:s=>$t(en(r,s)),onSuccess:()=>$t(r)}),onSuccess:r=>tn(t,r)}))),L8=(e,t,n)=>Aa(r=>U(U(Rg(ig(e)),s=>ns(o=>{const a=t.map(h=>h.listeners.count),u=()=>{a.every(h=>h===0)&&t.every(h=>h.result.state.current._tag==="Pending"?!0:!!(h.result.state.current._tag==="Done"&&gg(h.result.state.current.effect)&&h.result.state.current.effect._tag==="Failure"&&$w(h.result.state.current.effect.cause)))&&(f.forEach(h=>h()),n==null||n(),o(Pw(s)))};s.addObserver(h=>{f.forEach(p=>p()),o(h)});const f=t.map((h,p)=>{const g=k=>{a[p]=k,u()};return h.listeners.addObserver(g),()=>h.listeners.removeObserver(g)});return u(),K(()=>{f.forEach(h=>h())})})),()=>pe(()=>{const s=t.flatMap(o=>o.state.completed?[]:[o]);return Gc(s,o=>r8(o.request,xw(r)))}))),m$=(e,t)=>(t=co(t),yi(Fe(n=>{const r=Ap(n.getFiberRef(os),Fo),s=ev(n,e,t),o=n.getFiberRef(hg),a=Xn(n.getFiberRef(qs),Na);return tn(Zl(r,u=>_m(s,u,a,o)),s)}))),j8=e=>wv(qs,_s(pd,e)),U8=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return U(m$(t,co(n)),s=>of(r,Os,s))}return r=>U(m$(t,co(n)),s=>of(r,Os,s))},z8=bo,Pu=_a,wa=Bn,Og=Ir,B8=So,H8=en,V8=vw,zA=IH,W8=Ew,ff=$w,lo=Xp,K8=Cw,qg=Zp,vv=OH,Ag=OO,Ev=E4,kv=ng,J8=I4,Pg=ud,Tm=_i,G8=Tw,Q8="effect/ScheduleInterval",Im=Symbol.for(Q8),BA={[Im]:Im,startMillis:0,endMillis:0},$v=(e,t)=>e>t?BA:{[Im]:Im,startMillis:e,endMillis:t},Y8=y(2,(e,t)=>X8(e,t)===e),X8=y(2,(e,t)=>e.endMillis<=t.startMillis?e:t.endMillis<=e.startMillis?t:e.startMillis<t.startMillis?e:t.startMillis<e.startMillis?t:e.endMillis<=t.endMillis?e:t),Z8=e=>e.startMillis>=e.endMillis,eJ=y(2,(e,t)=>{const n=Math.max(e.startMillis,t.startMillis),r=Math.min(e.endMillis,t.endMillis);return $v(n,r)}),tJ=e=>fa(e.endMillis-e.startMillis),nJ=e=>$v(e,Number.POSITIVE_INFINITY),p$=$v,HA=BA,rJ=Y8,sJ=Z8,oJ=eJ,iJ=tJ,aJ=nJ,cJ="effect/ScheduleIntervals",g$=Symbol.for(cJ),VA=e=>({[g$]:g$,intervals:e}),uJ=y(2,(e,t)=>lJ(e.intervals,t.intervals,yt())),lJ=(e,t,n)=>{let r=e,s=t,o=n;for(;yo(r)&&yo(s);){const a=v(Ss(r),oJ(Ss(s))),u=sJ(a)?o:v(o,Tn(a));v(Ss(r),rJ(Ss(s)))?r=Xs(r):s=Xs(s),o=u}return VA(_o(o))},Rb=e=>v(e.intervals,Fp,Et(()=>HA)).startMillis,fJ=e=>v(e.intervals,Fp,Et(()=>HA)).endMillis,dJ=y(2,(e,t)=>Rb(e)<Rb(t)),hJ=e=>yo(e.intervals),mJ=VA,pJ=uJ,Ob=Rb,qb=fJ,gJ=dJ,_J=hJ,Cv="Continue",WA="Done",yJ=e=>({_tag:Cv,intervals:e}),bJ=e=>({_tag:Cv,intervals:mJ(ft(e))}),SJ={_tag:WA},wJ=e=>e._tag===Cv,vJ=e=>e._tag===WA,EJ=yJ,KA=bJ,df=SJ,_$=wJ,hf=vJ,kJ=Fo,ni=ZO,$J=Zl,kn=ob,Tv=Au,Iv=mg,Rv=kd,CJ=Gp,Ov=(function(){const e=Symbol.for("effect/Data/Error/plainArgs");return{BaseEffectError:class extends Fw{constructor(n){super(n==null?void 0:n.message,n!=null&&n.cause?{cause:n.cause}:void 0),n&&(Object.assign(this,n),Object.defineProperty(this,e,{value:n,enumerable:!1}))}toJSON(){return{...this[e],...this}}}}.BaseEffectError})(),TJ=e=>{const t={BaseEffectError:class extends Ov{constructor(){super(...arguments);d(this,"_tag",e)}}};return t.BaseEffectError.prototype.name=e,t.BaseEffectError},IJ="effect/Schedule",JA=Symbol.for(IJ),GA=e=>ne(e,JA),RJ="effect/ScheduleDriver",OJ=Symbol.for(RJ),qJ={_Out:e=>e,_In:e=>e,_R:e=>e},AJ={_Out:e=>e,_In:e=>e,_R:e=>e};var nI;nI=JA;class PJ{constructor(t,n){d(this,"initial");d(this,"step");d(this,nI,qJ);this.initial=t,this.step=n}pipe(){return ee(this,arguments)}}var rI;rI=OJ;class FJ{constructor(t,n){d(this,"schedule");d(this,"ref");d(this,rI,AJ);this.schedule=t,this.ref=n}get state(){return Se(ti(this.ref),t=>t[1])}get last(){return U(ti(this.ref),([t,n])=>{switch(t._tag){case"None":return od(()=>new ud);case"Some":return J(t.value)}})}get reset(){return sf(this.ref,[V(),this.schedule.initial])}next(t){return v(Se(ti(this.ref),n=>n[1]),U(n=>v(s5,U(r=>v(pe(()=>this.schedule.step(r,t,n)),U(([s,o,a])=>{const u=sf(this.ref,[W(o),s]);if(hf(a))return It(u,St(V()));const f=Ob(a.intervals)-r;return f<=0?tn(u,o):v(u,It(Zw(fa(f))),tn(o))}))))))}}const Fu=(e,t)=>new PJ(e,t),xJ=y(2,(e,t)=>NJ(e,n=>K(()=>t(n)))),NJ=y(2,(e,t)=>zJ(e,(n,r)=>Se(t(n),s=>QU(r,br(s))))),DJ=y(2,(e,t)=>qv(e,(n,r)=>K(()=>t(n,r)))),qv=y(2,(e,t)=>Fu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>hf(u)?J([o,a,df]):Se(t(r,a),f=>f?[o,a,u]:[o,a,df])))),MJ=e=>xJ(e,t=>t),QA=e=>v(gm([V(),e.initial]),Se(t=>new FJ(e,t))),LJ=(e,t=2)=>{const n=br(e);return MJ(XA(Fg,r=>GU(n,Math.pow(t,r))))},YA=y(2,(e,t)=>jJ(e,t,pJ)),jJ=y(3,(e,t,n)=>Fu([e.initial,t.initial],(r,s,o)=>v(VO(e.step(r,s,o[0]),t.step(r,s,o[1]),(a,u)=>[a,u]),U(([[a,u,f],[h,p,g]])=>_$(f)&&_$(g)?Ab(e,t,s,a,u,f.intervals,h,p,g.intervals,n):J([[a,h],[u,p],df]))))),Ab=(e,t,n,r,s,o,a,u,f,h)=>{const p=h(o,f);return _J(p)?J([[r,a],[s,u],EJ(p)]):v(o,gJ(f))?U(e.step(qb(o),n,r),([g,k,T])=>hf(T)?J([[g,a],[k,u],df]):Ab(e,t,n,g,k,T.intervals,a,u,f,h)):U(t.step(qb(f),n,a),([g,k,T])=>hf(T)?J([[r,g],[s,k],df]):Ab(e,t,n,r,s,o,g,k,T.intervals,h))},XA=y(2,(e,t)=>UJ(e,n=>K(()=>t(n)))),UJ=y(2,(e,t)=>Fu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>Se(t(a),f=>[o,f,u])))),zJ=y(2,(e,t)=>Fu(e.initial,(n,r,s)=>U(e.step(n,r,s),([o,a,u])=>{if(hf(u))return J([o,a,u]);const f=u.intervals,h=iJ(p$(n,Ob(f)));return Se(t(a,h),p=>{const g=br(p),k=Ob(f),T=n+Dc(g),O=T-k,L=Math.max(0,qb(f)+O),E=p$(T,L);return[o,a,KA(E)]})}))),BJ=e=>Fu(e.initial,(t,n,r)=>v(e.step(t,n,r),Se(([s,o,a])=>[s,n,a]))),ZA=e=>VJ(Fg,t=>t<e),HJ=(e,t)=>Fu(e,(n,r,s)=>K(()=>[t(s),s,KA(aJ(n))])),eP=y(2,(e,t)=>qv(e,(n,r)=>X5(t(n)))),tP=y(2,(e,t)=>qv(e,(n,r)=>t(n))),VJ=y(2,(e,t)=>DJ(e,(n,r)=>t(r))),Ah=Symbol.for("effect/Schedule/ScheduleDefect");var sI;sI=Ah;class WJ{constructor(t){d(this,"error");d(this,sI);this.error=t,this[Ah]=Ah}}const KJ=e=>ne(e,Ah),Rm=e=>Kc(e,t=>Xl(new WJ(t))),nP=e=>sg(e,t=>ot(eg(t,n=>Ew(n)&&KJ(n.defect)?W(n.defect):V()),{onNone:()=>$t(t),onSome:n=>St(n.error)})),y$=y(2,(e,t)=>GJ(e,t,(n,r)=>St(n))),JJ=y(2,(e,t)=>{if(GA(t))return y$(e,t);const n=t.schedule??BJ(Fg),r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):Rm(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):Rm(u)}):r,o=t.times?YA(s,ZA(t.times)).pipe(XA(a=>a[0])):s;return nP(y$(e,o))}),GJ=y(3,(e,t,n)=>U(QA(t),r=>wo(e,{onFailure:s=>n(s,V()),onSuccess:s=>rP(e,r,n,s)}))),rP=(e,t,n,r)=>wo(t.next(r),{onFailure:()=>Ow(t.last),onSuccess:s=>wo(e,{onFailure:o=>n(o,W(s)),onSuccess:o=>rP(e,t,n,o)})}),b$=y(2,(e,t)=>YJ(e,t,(n,r)=>St(n))),QJ=y(2,(e,t)=>{if(GA(t))return b$(e,t);const n=t.schedule??Fg,r=t.while?tP(n,a=>{const u=t.while(a);return typeof u=="boolean"?J(u):Rm(u)}):n,s=t.until?eP(r,a=>{const u=t.until(a);return typeof u=="boolean"?J(u):Rm(u)}):r,o=t.times?YA(s,ZA(t.times)):s;return nP(b$(e,o))}),YJ=y(3,(e,t,n)=>U(QA(t),r=>sP(e,r,n))),sP=(e,t,n)=>Kc(e,r=>wo(t.next(r),{onFailure:()=>v(t.last,Ow,U(s=>n(r,s))),onSuccess:()=>sP(e,t,n)})),Fg=HJ(0,e=>e+1);class XJ{constructor(t){d(this,"permits");d(this,"waiters",new Set);d(this,"taken",0);d(this,"take",t=>Go(n=>{if(this.free<t){const r=()=>{this.free<t||(this.waiters.delete(r),this.taken+=t,n(J(t)))};return this.waiters.add(r),K(()=>{this.waiters.delete(r)})}return this.taken+=t,n(J(t))}));d(this,"updateTaken",t=>Fe(n=>(this.taken=t(this.taken),this.waiters.size>0&&n.getFiberRef(_d).scheduleTask(()=>{const r=this.waiters.values();let s=r.next();for(;s.done===!1&&this.free>0;)s.value(),s=r.next()},n.getFiberRef(bi)),J(this.free))));d(this,"release",t=>this.updateTaken(n=>n-t));d(this,"releaseAll",this.updateTaken(t=>0));d(this,"withPermits",t=>n=>Sr(r=>U(r(this.take(t)),s=>lf(r(n),this.release(s)))));d(this,"withPermitsIfAvailable",t=>n=>Sr(r=>pe(()=>this.free<t?tV:(this.taken+=t,lf(r(D5(n)),this.release(t))))));this.permits=t}get free(){return this.permits-this.taken}}const oP=e=>new XJ(e),ZJ=e=>K(()=>oP(e));class eG extends Po{constructor(n){super();d(this,"isOpen");d(this,"waiters",[]);d(this,"scheduled",!1);d(this,"flushWaiters",()=>{this.scheduled=!1;const n=this.waiters;this.waiters=[];for(let r=0;r<n.length;r++)n[r](qn)});d(this,"open",Fe(n=>this.isOpen?Qe:(this.isOpen=!0,this.unsafeSchedule(n))));d(this,"release",Fe(n=>this.isOpen?Qe:this.unsafeSchedule(n)));d(this,"await",Go(n=>this.isOpen?n(Qe):(this.waiters.push(n),K(()=>{const r=this.waiters.indexOf(n);r!==-1&&this.waiters.splice(r,1)}))));d(this,"close",K(()=>{this.isOpen=!1}));d(this,"whenOpen",n=>It(this.await,n));this.isOpen=n}commit(){return this.await}unsafeSchedule(n){return this.scheduled||this.waiters.length===0||(this.scheduled=!0,n.currentScheduler.scheduleTask(this.flushWaiters,n.getFiberRef(bi))),Qe}unsafeOpen(){this.isOpen||(this.isOpen=!0,this.flushWaiters())}unsafeClose(){this.isOpen=!1}}const iP=e=>new eG(e??!1),tG=e=>K(()=>iP(e)),aP=y(2,(e,t)=>Fe((n,r)=>{const s=t,o=bv(e,n,r.runtimeFlags,yd);if(s.state._tag==="Open"){const a=()=>Aa(f=>me(f,o.id())?Qe:or(Pw(o))),u={};s.state.finalizers.set(u,a),o.addObserver(()=>{s.state._tag!=="Closed"&&s.state.finalizers.delete(u)})}else o.unsafeInterruptAsFork(n.id());return J(o)})),nG=e=>Sv(t=>aP(e,t)),rG=y(2,(e,t)=>v(ks(e),jA(ks(t)),n=>$u(n))),sG=y(2,(e,t)=>oG(e,{onTimeout:()=>O4(t),duration:t})),oG=y(2,(e,{duration:t,onTimeout:n})=>$u(iG(e,{onTimeout:()=>od(n),onSuccess:J,duration:t}))),iG=y(2,(e,{duration:t,onSuccess:n,onTimeout:r})=>Aa(s=>Sr(o=>UA(o(e),ig(Zw(t)),{onSelfWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>tn(eo(u,s),n(f.value))):U(eo(u,s),()=>st(f.cause))),onOtherWin:(a,u)=>U(a.await,f=>f._tag==="Success"?U(a.inheritAll,()=>tn(eo(u,s),r())):U(eo(u,s),()=>st(f.cause))),otherScope:yd})))),aG="effect/Ref/SynchronizedRef",cP=Symbol.for(aG),uP={_A:e=>e};var oI,iI,aI,cI;class cG extends(cI=Po,aI=cP,iI=Qw,oI=ci,cI){constructor(n,r){super();d(this,"ref");d(this,"withLock");d(this,aI,uP);d(this,iI,Yw);d(this,oI,ci);d(this,"get");this.ref=n,this.withLock=r,this.get=ti(this.ref)}commit(){return this.get}modify(n){return this.modifyEffect(r=>J(n(r)))}modifyEffect(n){return this.withLock(v(U(ti(this.ref),n),U(([r,s])=>tn(sf(this.ref,s),r))))}}const uG=e=>K(()=>lP(e)),lP=e=>{const t=Iq(e),n=oP(1);return new cG(t,n.withPermits(1))},lG=Symbol.for("effect/ManagedRuntime"),fG="Fold",dG="Fresh",hG="FromEffect",mG="Scoped",pG="Suspend",gG="Provide",fP="ProvideMerge",_G="ZipWith",dP=aA,yG=EW,S$=wW,Dr=Pw,xg=eo,hP=vW,Om=eu,$d=e=>function(){if(arguments.length===1){const t=arguments[0];return(n,...r)=>e(t,n,...r)}return e.apply(this,arguments)},Ng=$d((e,t,n)=>{const r=iO(),s=[[os,[[r,e.context]]]];n!=null&&n.scheduler&&s.push([_d,[[r,n.scheduler]]]);let o=h5(e.fiberRefs,{entries:s,forkAs:r});n!=null&&n.updateRefs&&(o=n.updateRefs(o,r));const a=new qA(r,o,e.runtimeFlags);let u=t;n!=null&&n.scope&&(u=U(Iv(n.scope,gd),h=>It(ZO(h,Aa(p=>me(p,a.id())?Qe:eo(a,p))),Rs(t,p=>kn(h,p)))));const f=a.currentSupervisor;return f!==Tg&&(f.onStart(e.context,u,V(),a),a.addObserver(h=>f.onEnd(h,a))),yd.add(e.runtimeFlags,a),(n==null?void 0:n.immediate)===!1?a.resume(u):a.start(u),a}),bG=$d((e,t)=>{const n=EG(e)(t);if(n._tag==="Failure")throw mP(n.effect_instruction_i0);return n.effect_instruction_i0});class SG extends Error{constructor(n){super(`Fiber #${n.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`);d(this,"fiber");d(this,"_tag","AsyncFiberException");this.fiber=n,this.name=this._tag,this.stack=this.message}}const wG=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new SG(e);return Error.stackTraceLimit=t,n},ty=Symbol.for("effect/Runtime/FiberFailure"),nh=Symbol.for("effect/Runtime/FiberFailure/Cause");var uI,lI;class vG extends Error{constructor(n){const r=Tw(n)[0];super((r==null?void 0:r.message)||"An error has occurred");d(this,lI);d(this,uI);this[ty]=ty,this[nh]=n,this.name=r?`(FiberFailure) ${r.name}`:"FiberFailure",r!=null&&r.stack&&(this.stack=r.stack)}toJSON(){return{_id:"FiberFailure",cause:this[nh].toJSON()}}toString(){return"(FiberFailure) "+_i(this[nh],{renderErrorCause:!0})}[(lI=ty,uI=nh,Be)](){return this.toString()}}const mP=e=>{const t=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new vG(e);return Error.stackTraceLimit=t,n},pP=e=>{const t=e;switch(t._op){case"Failure":case"Success":return t;case"Left":return ef(t.left);case"Right":return Ge(t.right);case"Some":return Ge(t.value);case"None":return ef(ud())}},EG=$d((e,t)=>{const n=pP(t);if(n)return n;const r=new oA,s=Ng(e)(t,{scheduler:r});r.flush();const o=s.unsafePoll();return o||dc(Iw(wG(s),jw(s)))}),kG=$d((e,t,n)=>gP(e,t,n).then(r=>{switch(r._tag){case hn:return r.effect_instruction_i0;case dn:throw mP(r.effect_instruction_i0)}})),gP=$d((e,t,n)=>new Promise(r=>{const s=pP(t);s&&r(s);const o=Ng(e)(t);o.addObserver(a=>{r(a)}),(n==null?void 0:n.signal)!==void 0&&(n.signal.aborted?o.unsafeInterruptAsFork(o.id()):n.signal.addEventListener("abort",()=>{o.unsafeInterruptAsFork(o.id())},{once:!0}))}));class _P{constructor(t,n,r){d(this,"context");d(this,"runtimeFlags");d(this,"fiberRefs");this.context=t,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return ee(this,arguments)}}const yP=e=>new _P(e.context,e.runtimeFlags,e.fiberRefs),$G=()=>Fe((e,t)=>J(new _P(e.getFiberRef(os),t.runtimeFlags,e.getFiberRefs()))),CG=wO(Su,bO,yO),mf=yP({context:po(),runtimeFlags:CG,fiberRefs:m5()}),TG=y(2,(e,t)=>yP({context:t(e.context),runtimeFlags:e.runtimeFlags,fiberRefs:e.fiberRefs})),IG=Ng(mf),RG=kG(mf),OG=bG(mf),qG=y(2,(e,t)=>e.modifyEffect(t)),AG="effect/Layer",bP=Symbol.for(AG),PG={_RIn:e=>e,_E:e=>e,_ROut:e=>e},ui={[bP]:PG,pipe(){return ee(this,arguments)}},FG="effect/Layer/MemoMap",ny=Symbol.for(FG),xG=yu()("effect/Layer/CurrentMemoMap",{defaultValue:()=>MG()}),SP=e=>ne(e,bP),NG=e=>e._op_layer===dG;var fI;fI=ny;class wP{constructor(t){d(this,"ref");d(this,fI);this.ref=t,this[ny]=ny}getOrElseMemoize(t,n){return v(qG(this.ref,r=>{const s=r.get(t);if(s!==void 0){const[o,a]=s,u=v(o,U(([f,h])=>v(Bq(f),tn(h))),Rs(_g({onFailure:()=>Qe,onSuccess:()=>Zl(n,a)})));return J([u,r])}return v(gm(0),U(o=>v(Ru(),U(a=>v(gm(()=>Qe),Se(u=>{const f=Sr(p=>v(kd(),U(g=>v(p(U(vP(t,g,!0),k=>H5(k(this)))),ks,U(k=>{switch(k._tag){case dn:return v(sq(a,k.effect_instruction_i0),It(ob(g,k)),It($t(k.effect_instruction_i0)));case hn:return v(sf(u,T=>v(ob(g,T),id(Rq(o,O=>[O===1,O-1])),or)),It(fb(o,T=>T+1)),It(Zl(n,T=>v(K(()=>r.delete(t)),It(ti(u)),U(O=>O(T))))),It(fd(a,k.effect_instruction_i0)),tn(k.effect_instruction_i0[1]))}}))))),h=[v(rs(a),Rs(ab({onFailure:()=>Qe,onSuccess:()=>fb(o,p=>p+1)}))),p=>v(ti(u),U(g=>g(p)))];return[f,NG(t)?r:r.set(t,h)]}))))))}),$u)}}const DG=pe(()=>Se(uG(new Map),e=>new wP(e))),MG=()=>new wP(lP(new Map)),Av=y(2,(e,t)=>U(DG,n=>LG(e,n,t))),LG=y(3,(e,t,n)=>U(vP(e,n),r=>of(r(t),xG,t))),vP=(e,t,n=!1)=>{const r=e;switch(r._op_layer){case"Locally":return K(()=>s=>r.f(s.getOrElseMemoize(r.self,t)));case"ExtendScope":return K(()=>s=>Sv(o=>s.getOrElseMemoize(r.layer,o)));case"Fold":return K(()=>s=>v(s.getOrElseMemoize(r.layer,t),Vn({onFailure:o=>s.getOrElseMemoize(r.failureK(o),t),onSuccess:o=>s.getOrElseMemoize(r.successK(o),t)})));case"Fresh":return K(()=>s=>v(r.layer,Av(t)));case"FromEffect":return K(n?()=>s=>r.effect:()=>s=>s.getOrElseMemoize(e,t));case"Provide":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),U(o=>v(s.getOrElseMemoize(r.second,t),Mw(o)))));case"Scoped":return K(n?()=>s=>Au(r.effect,t):()=>s=>s.getOrElseMemoize(e,t));case"Suspend":return K(()=>s=>s.getOrElseMemoize(r.evaluate(),t));case"ProvideMerge":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),VO(s.getOrElseMemoize(r.second,t),r.zipK)));case"ZipWith":return K(()=>s=>v(s.getOrElseMemoize(r.first,t),Ed(s.getOrElseMemoize(r.second,t),r.zipK,{concurrent:!0})))}},jG=()=>xu(hd()),UG=e=>EP(Pu(e)),EP=e=>xu($t(e)),Pv=y(2,(e,t)=>BG(e,{onFailure:UG,onSuccess:t})),kP=y(2,(e,t)=>{const n=qp(e),r=n?e:t;return xu(Se(n?t:e,o=>Zf(r,o)))});function xu(e){const t=Object.create(ui);return t._op_layer=hG,t.effect=e,t}const zG=y(2,(e,{onFailure:t,onSuccess:n})=>{const r=Object.create(ui);return r._op_layer=fG,r.layer=e,r.failureK=t,r.successK=n,r}),BG=y(2,(e,{onFailure:t,onSuccess:n})=>zG(e,{onFailure:r=>{const s=qg(r);switch(s._tag){case"Left":return t(s.left);case"Right":return EP(s.right)}},onSuccess:n})),HG=y(2,(e,t)=>QG(e,t,(n,r)=>qo(n,r))),$P=(...e)=>{let t=e[0];for(let n=1;n<e.length;n++)t=HG(t,e[n]);return t},CP=y(2,(e,t)=>{const n=qp(e),r=n?e:t;return TP(Se(n?t:e,o=>Zf(r,o)))}),Dg=e=>TP(v(e,tn(po()))),TP=e=>{const t=Object.create(ui);return t._op_layer=mG,t.effect=e,t},VG=y(2,(e,t)=>{const n=qp(e);return xu(J(Zf(n?e:t,n?t:e)))}),WG=e=>xu(J(e)),KG=WG(po()),IP=e=>{const t=Object.create(ui);return t._op_layer=pG,t.evaluate=e,t},JG=y(2,(e,t)=>{const n=qp(e),r=n?e:t,s=n?t:e;return xu(K(()=>Zf(r,s())))}),RP=y(2,(e,t)=>IP(()=>{const n=Object.create(ui);return n._op_layer=gG,n.first=Object.create(ui,{_op_layer:{value:fP,enumerable:!0},first:{value:jG(),enumerable:!0},second:{value:Array.isArray(t)?$P(...t):t},zipK:{value:(r,s)=>v(r,qo(s))}}),n.second=e,n})),GG=y(2,(e,t)=>{const n=Object.create(ui);return n._op_layer=fP,n.first=t,n.second=RP(e,t),n.zipK=(r,s)=>v(r,qo(s)),n}),QG=y(3,(e,t,n)=>IP(()=>{const r=Object.create(ui);return r._op_layer=_G,r.first=e,r.second=t,r.zipK=n,r})),YG=e=>{const t=sr("effect/Layer/unwrapEffect/Layer.Layer<R1, E1, A>");return Pv(kP(t,e),n=>Xn(n,t))},XG=e=>{const t=sr("effect/Layer/unwrapScoped/Layer.Layer<R1, E1, A>");return Pv(CP(t,e),n=>Xn(n,t))},w$=y(2,(e,t)=>NA(n=>U(Av(t,n),r=>Lw(e,r)))),v$=y(2,(e,t)=>{const n=cf(mf.fiberRefs,t.fiberRefs),r=ei(mf.runtimeFlags,t.runtimeFlags);return Sr(s=>Fe(o=>{const a=o.getFiberRef(os),u=o.getFiberRefs(),f=uf(o.id(),u)(n),h=o.currentRuntimeFlags,p=Ec(r)(h),g=cf(f,u),k=ei(p,h);return o.setFiberRefs(f),o.currentRuntimeFlags=p,lf(Lw(s(e),qo(a,t.context)),Fe(T=>(T.setFiberRefs(uf(T.id(),T.getFiberRefs())(g)),T.currentRuntimeFlags=Ec(k)(T.currentRuntimeFlags),Qe)))}))}),ZG=y(2,(e,t)=>Array.isArray(t)?w$(e,$P(...t)):SP(t)?w$(e,t):CU(t)?Lw(e,t):lG in t?U(t.runtimeEffect,n=>v$(e,n)):v$(e,t)),eQ=n8,E$=ya,jr=wr,ry=Y5,Cd=_v,$n=tu,OP=ns,As=Fe,Hn=St,Zn=$t,li=Xl,qP=nb,z=XH,Fv=t4,Mg=eV,Ve=J,_t=pe,Re=K,he=Qe,Lg=Kc,$s=sg,tQ=M5,nQ=LO,sy=L5,xv=j5,Nv=Uq,Td=K5,Dv=QJ,xo=Mq,rQ=cV,Il=aV,sQ=M8,ms=_n,Pt=ig,oQ=Pa,Qo=yi,fi=Sr,fo=tn,Ps=or,Ee=Se,AP=Rw,vo=ag,at=gv,PP=DO,nr=xA,Li=lf,iQ=JH,aQ=Rs,jg=DA,cQ=Sv,qm=NA,di=I8,Mv=Aa,Ug=$8,Lv=Rg,_r=aP,Jt=nG,uQ=lW,lQ=y4,fQ=z5,dQ=B5,nu=Zw,zg=sG,FP=hd,hQ=oq,An=ZG,Ph=of,mQ=fV,pQ=dV,Oi=Jc,Qt=ks,Id=BO,xP=lV,X=U,Qr=WH,Ai=$u,oy=jA,NP=rG,jv=LA,Eo=cg,gQ=rV,Nu=sV,pf=W5,k$=JJ,_Q=fg,yQ=Lq,gf=UO,Rr=Vn,bQ=J5,ps=zq,to=G5,ru=Q5,Cc=N5,SQ=w4,Or=Ow,No=$G,Bg=ZJ,wQ=iP,Pb=tG,Do=IG,DP=RG,Cs=OG,Am=R8,Uv=O8,pt=q8,su=Ed,vQ=iV,EQ=mV,Fb=hV,Hg=Vq,kQ=pV,$Q=hb,Oe=gV,Rd=U8,ji=mb,Vg=function(e,...t){const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;if(Error.stackTraceLimit=n,typeof e!="string")return $$(e.length,function(...a){const u=Error.stackTraceLimit;Error.stackTraceLimit=2;const f=new Error;return Error.stackTraceLimit=u,C$({self:this,body:e,args:a,pipeables:t,spanName:"<anonymous>",spanOptions:{context:pm.context(!0)},errorDef:r,errorCall:f})});const s=e,o=t[0];return(a,...u)=>$$(a.length,{[s](...f){const h=Error.stackTraceLimit;Error.stackTraceLimit=2;const p=new Error;return Error.stackTraceLimit=h,C$({self:this,body:a,args:f,pipeables:u,spanName:s,spanOptions:o,errorDef:r,errorCall:p})}}[s])};function $$(e,t){return Object.defineProperty(t,"length",{value:e,configurable:!0})}function C$(e){let t,n;if(JM(e.body))t=dm(()=>e.body.apply(e.self,e.args));else try{t=e.body.apply(e.self,e.args)}catch(a){n=a,t=li(a)}if(e.pipeables.length>0)try{for(const a of e.pipeables)t=a(t,...e.args)}catch(a){t=n?Zn(en(Bn(n),Bn(a))):li(a)}let r=!1;const s=()=>{if(r!==!1)return r;if(e.errorCall.stack){const a=e.errorDef.stack.trim().split(`
`),u=e.errorCall.stack.trim().split(`
`);let f=a.slice(2).join(`
`).trim();f.includes("(")||(f=f.replace(/at (.*)/,"at ($1)"));let h=u.slice(2).join(`
`).trim();return h.includes("(")||(h=h.replace(/at (.*)/,"at ($1)")),r=`${f}
${h}`,r}},o=e.spanOptions&&"captureStackTrace"in e.spanOptions?e.spanOptions:{captureStackTrace:s,...e.spanOptions};return Oe(t,e.spanName,o)}const Pm=ZH,zv=wn,CQ=ad,TQ=Cu,MP=os,IQ=bi,RQ=Ig,LP=_d,OQ=YO,qQ=hg,AQ=y(2,(e,t)=>Ao(AA,t)(e)),PQ=e=>Dg(wv(Ig,vc(e))),FQ=e=>Dg(wv(Ig,pw(e))),xQ=y(2,(e,t)=>Pv(FQ(e),()=>PQ(t))),NQ=e=>Dg(j8(e)),DQ=SP,jP=Av,UP=kP,MQ=KG,LQ=CP,jQ=Dg,Bv=VG,UQ=JG,Hv=RP,zP=GG,BP=YG,Vv=XG,HP=NQ,zQ="effect/QueueEnqueue",VP=Symbol.for(zQ),BQ="effect/QueueDequeue",Wv=Symbol.for(BQ),HQ="effect/QueueStrategy",Kv=Symbol.for(HQ),VQ="effect/BackingQueue",WQ=Symbol.for(VQ),Jv={_A:e=>e},KQ={_A:e=>e},WP={_In:e=>e},Gv={_Out:e=>e};var dI,hI,mI;class JQ extends(mI=Po,hI=VP,dI=Wv,mI){constructor(n,r,s,o,a){super();d(this,"queue");d(this,"takers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,hI,WP);d(this,dI,Gv);this.queue=n,this.takers=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}pipe(){return ee(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return pe(()=>Kc(this.unsafeSize(),()=>_n))}unsafeSize(){return He(this.shutdownFlag)?V():W(this.queue.length()-Vw(this.takers)+this.strategy.surplusSize())}get isEmpty(){return Se(this.size,n=>n<=0)}get isFull(){return Se(this.size,n=>n>=this.capacity())}get shutdown(){return yi(Fe(n=>(v(this.shutdownFlag,Oa(!0)),v(uo(Tc(this.takers),r=>Dw(r,n.id()),!1,!1),It(this.strategy.shutdown),id(fd(this.shutdownHook,void 0)),or))))}get isShutdown(){return K(()=>He(this.shutdownFlag))}get awaitShutdown(){return rs(this.shutdownHook)}isActive(){return!He(this.shutdownFlag)}unsafeOffer(n){if(He(this.shutdownFlag))return!1;let r;if(this.queue.length()===0){const o=v(this.takers,ao(Wt));o!==Wt?(Qi(o,n),r=!0):r=!1}else r=!1;if(r)return!0;const s=this.queue.offer(n);return Ui(this.strategy,this.queue,this.takers),s}offer(n){return pe(()=>{if(He(this.shutdownFlag))return _n;let r;if(this.queue.length()===0){const o=v(this.takers,ao(Wt));o!==Wt?(Qi(o,n),r=!0):r=!1}else r=!1;if(r)return J(!0);const s=this.queue.offer(n);return Ui(this.strategy,this.queue,this.takers),s?J(!0):this.strategy.handleSurplus([n],this.queue,this.takers,this.shutdownFlag)})}offerAll(n){return pe(()=>{if(He(this.shutdownFlag))return _n;const r=ze(n),s=this.queue.length()===0?ze(m9(this.takers,r.length)):oi,[o,a]=v(r,M1(s.length));for(let f=0;f<s.length;f++){const h=s[f],p=o[f];Qi(h,p)}if(a.length===0)return J(!0);const u=this.queue.offerAll(a);return Ui(this.strategy,this.queue,this.takers),ed(u)?J(!0):this.strategy.handleSurplus(u,this.queue,this.takers,this.shutdownFlag)})}get take(){return Fe(n=>{if(He(this.shutdownFlag))return _n;const r=this.queue.poll(Wt);if(r!==Wt)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),J(r);{const s=Iu(n.id());return v(pe(()=>(v(this.takers,Yc(s)),Ui(this.strategy,this.queue,this.takers),He(this.shutdownFlag)?_n:rs(s))),Pa(()=>K(()=>p9(this.takers,s))))}})}get takeAll(){return pe(()=>He(this.shutdownFlag)?_n:K(()=>{const n=this.queue.pollUpTo(Number.POSITIVE_INFINITY);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),go(n)}))}takeUpTo(n){return pe(()=>He(this.shutdownFlag)?_n:K(()=>{const r=this.queue.pollUpTo(n);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),go(r)}))}takeBetween(n,r){return pe(()=>KP(this,n,r,yt()))}}const KP=(e,t,n,r)=>n<t?J(r):v(a9(e,n),U(s=>{const o=t-s.length;return o===1?v(xb(e),Se(a=>v(r,Rt(s),Hl(a)))):o>1?v(xb(e),U(a=>KP(e,o-1,n-s.length-1,v(r,Rt(s),Hl(a))))):J(v(r,Rt(s)))})),GQ=e=>v(K(()=>Hw(e)),U(t=>Wg(Kg(t),u9()))),QQ=e=>v(K(()=>Hw(e)),U(t=>Wg(Kg(t),JP()))),YQ=e=>v(K(()=>Hw(e)),U(t=>Wg(Kg(t),l9()))),XQ=()=>v(K(()=>yg()),U(e=>Wg(Kg(e),JP()))),ZQ=(e,t,n,r,s)=>new JQ(e,t,n,r,s),Wg=(e,t)=>v(Ru(),Se(n=>ZQ(e,yg(),n,Ra(!1),t)));var pI;pI=WQ;class e9{constructor(t){d(this,"mutable");d(this,pI,KQ);this.mutable=t}poll(t){return ao(this.mutable,t)}pollUpTo(t){return bg(this.mutable,t)}offerAll(t){return Ww(this.mutable,t)}offer(t){return Yc(this.mutable,t)}capacity(){return i6(this.mutable)}length(){return Vw(this.mutable)}}const Kg=e=>new e9(e),t9=e=>e.size,n9=e=>e.isShutdown,r9=e=>e.shutdown,s9=y(2,(e,t)=>e.offer(t)),o9=y(2,(e,t)=>e.offerAll(t)),xb=e=>e.take,i9=e=>e.takeAll,a9=y(2,(e,t)=>e.takeUpTo(t)),c9=y(3,(e,t,n)=>e.takeBetween(t,n)),u9=()=>new f9,JP=()=>new d9,l9=()=>new h9;var gI;gI=Kv;class f9{constructor(){d(this,gI,Jv);d(this,"putters",yg())}surplusSize(){return Vw(this.putters)}onCompleteTakersWithEmptyQueue(t){for(;!Ji(this.putters)&&!Ji(t);){const n=ao(t,void 0),r=ao(this.putters,void 0);r[2]&&Qi(r[1],!0),Qi(n,r[0])}}get shutdown(){return v(og,U(t=>v(K(()=>Tc(this.putters)),U(n=>uo(n,([r,s,o])=>o?v(Dw(s,t),or):Qe,!1,!1)))))}handleSurplus(t,n,r,s){return Fe(o=>{const a=Iu(o.id());return v(pe(()=>(this.unsafeOffer(t,a),this.unsafeOnQueueEmptySpace(n,r),Ui(this,n,r),He(s)?_n:rs(a))),Pa(()=>K(()=>this.unsafeRemove(a))))})}unsafeOnQueueEmptySpace(t,n){let r=!0;for(;r&&(t.capacity()===Number.POSITIVE_INFINITY||t.length()<t.capacity());){const s=v(this.putters,ao(Wt));if(s===Wt)r=!1;else{const o=t.offer(s[0]);o&&s[2]?Qi(s[1],!0):o||Fm(this.putters,v(Tc(this.putters),Tn(s))),Ui(this,t,n)}}}unsafeOffer(t,n){const r=ze(t);for(let s=0;s<r.length;s++){const o=r[s];s===r.length-1?v(this.putters,Yc([o,n,!0])):v(this.putters,Yc([o,n,!1]))}}unsafeRemove(t){Fm(this.putters,v(Tc(this.putters),Pp(([,n])=>n!==t)))}}var _I;let d9=(_I=Kv,class{constructor(){d(this,_I,Jv)}surplusSize(){return 0}get shutdown(){return Qe}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return J(!1)}unsafeOnQueueEmptySpace(t,n){}});var yI;yI=Kv;class h9{constructor(){d(this,yI,Jv)}surplusSize(){return 0}get shutdown(){return Qe}onCompleteTakersWithEmptyQueue(){}handleSurplus(t,n,r,s){return K(()=>(this.unsafeOffer(n,t),Ui(this,n,r),!0))}unsafeOnQueueEmptySpace(t,n){}unsafeOffer(t,n){const r=n[Symbol.iterator]();let s,o=!0;for(;!(s=r.next()).done&&o;){if(t.capacity()===0)return;t.poll(Wt),o=t.offer(s.value)}}}const Qi=(e,t)=>dd(e,J(t)),Fm=(e,t)=>v(e,Ww(t)),Tc=e=>v(e,bg(Number.POSITIVE_INFINITY)),m9=(e,t)=>v(e,bg(t)),p9=(e,t)=>{Fm(e,v(Tc(e),Pp(n=>t!==n)))},Ui=(e,t,n)=>{let r=!0;for(;r&&t.length()!==0;){const s=v(n,ao(Wt));if(s!==Wt){const o=t.poll(Wt);o!==Wt?(Qi(s,o),e.unsafeOnQueueEmptySpace(t,n)):Fm(n,v(Tc(n),Tn(s))),r=!0}else r=!1}r&&t.length()===0&&!Ji(n)&&e.onCompleteTakersWithEmptyQueue(n)},gs=Symbol.for("effect/PubSub/AbsentValue"),GP=(e,t)=>n=>{n.has(e)||n.set(e,new Set),n.get(e).add(t)},g9=(e,t)=>n=>{if(!n.has(e))return;const r=n.get(e);r.delete(t),r.size===0&&n.delete(e)},_9=e=>pe(()=>{const t=w9(e);return I9(t,new x9)}),y9=e=>e.shutdown,b9=y(2,(e,t)=>e.publish(t)),S9=e=>e.subscribe,w9=e=>new k9(e!=null&&e.replay?new M9(e.replay):void 0),v9=(e,t,n)=>Se(Ru(),r=>E9(e,t,e.subscribe(),yg(),r,Ra(!1),n)),E9=(e,t,n,r,s,o,a)=>new C9(e,t,n,r,s,o,a,e.replayWindow());class k9{constructor(t){d(this,"replayBuffer");d(this,"publisherHead",{value:gs,subscribers:0,next:null});d(this,"publisherTail",this.publisherHead);d(this,"publisherIndex",0);d(this,"subscribersIndex",0);d(this,"capacity",Number.MAX_SAFE_INTEGER);this.replayBuffer=t}replayWindow(){return this.replayBuffer?new L9(this.replayBuffer):j9}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(t){const n=this.publisherTail.subscribers;return n!==0&&(this.publisherTail.next={value:t,subscribers:n,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(t),!0}publishAll(t){if(this.publisherTail.subscribers!==0)for(const n of t)this.publish(n);else this.replayBuffer&&this.replayBuffer.offerAll(t);return yt()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=gs,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new $9(this,this.publisherTail,this.publisherIndex,!1)}}class $9{constructor(t,n,r,s){d(this,"self");d(this,"subscriberHead");d(this,"subscriberIndex");d(this,"unsubscribed");this.self=t,this.subscriberHead=n,this.subscriberIndex=r,this.unsubscribed=s}isEmpty(){if(this.unsubscribed)return!0;let t=!0,n=!0;for(;n;)this.subscriberHead===this.self.publisherTail?n=!1:this.subscriberHead.next.value!==gs?(t=!1,n=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return t}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(t){if(this.unsubscribed)return t;let n=!0,r=t;for(;n;)if(this.subscriberHead===this.self.publisherTail)n=!1;else{const s=this.subscriberHead.next.value;s!==gs&&(r=s,this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=gs,this.self.subscribersIndex+=1),n=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return r}pollUpTo(t){const n=[],r=gs;let s=0;for(;s!==t;){const o=this.poll(r);o===r?s=t:(n.push(o),s+=1)}return go(n)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==gs&&(this.subscriberHead.subscribers-=1,this.subscriberHead.subscribers===0&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=gs,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}var bI,SI;class C9 extends(SI=Po,bI=Wv,SI){constructor(n,r,s,o,a,u,f,h){super();d(this,"pubsub");d(this,"subscribers");d(this,"subscription");d(this,"pollers");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,"replayWindow");d(this,bI,Gv);this.pubsub=n,this.subscribers=r,this.subscription=s,this.pollers=o,this.shutdownHook=a,this.shutdownFlag=u,this.strategy=f,this.replayWindow=h}commit(){return this.take}pipe(){return ee(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!He(this.shutdownFlag)}get size(){return pe(()=>He(this.shutdownFlag)?_n:J(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return He(this.shutdownFlag)?V():W(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return pe(()=>He(this.shutdownFlag)?_n:J(this.subscription.size()===this.capacity()))}get isEmpty(){return Se(this.size,n=>n===0)}get shutdown(){return yi(Fe(n=>(Oa(this.shutdownFlag,!0),v(yv(Qv(this.pollers),r=>Dw(r,n.id()),!1),It(K(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),id(fd(this.shutdownHook,void 0)),or))))}get isShutdown(){return K(()=>He(this.shutdownFlag))}get awaitShutdown(){return rs(this.shutdownHook)}get take(){return Fe(n=>{if(He(this.shutdownFlag))return _n;if(this.replayWindow.remaining>0){const s=this.replayWindow.take();return J(s)}const r=Ji(this.pollers)?this.subscription.poll(Wt):Wt;if(r===Wt){const s=Iu(n.id());return v(pe(()=>(v(this.pollers,Yc(s)),v(this.subscribers,GP(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),He(this.shutdownFlag)?_n:rs(s))),Pa(()=>K(()=>F9(this.pollers,s))))}else return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r)})}get takeAll(){return pe(()=>{if(He(this.shutdownFlag))return _n;const n=Ji(this.pollers)?q9(this.subscription):yt();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0?J(Rt(this.replayWindow.takeAll(),n)):J(n)})}takeUpTo(n){return pe(()=>{if(He(this.shutdownFlag))return _n;let r;if(this.replayWindow.remaining>=n){const o=this.replayWindow.takeN(n);return J(o)}else this.replayWindow.remaining>0&&(r=this.replayWindow.takeAll(),n=n-r.length);const s=Ji(this.pollers)?A9(this.subscription,n):yt();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),J(r?Rt(r,s):s)})}takeBetween(n,r){return pe(()=>QP(this,n,r,yt()))}}const QP=(e,t,n,r)=>n<t?J(r):v(e.takeUpTo(n),U(s=>{const o=t-s.length;return o===1?v(e.take,Se(a=>v(r,Rt(s),Hl(a)))):o>1?v(e.take,U(a=>QP(e,o-1,n-s.length-1,v(r,Rt(s),Hl(a))))):J(v(r,Rt(s)))}));var wI,vI;vI=VP,wI=Wv;class T9{constructor(t,n,r,s,o,a){d(this,"pubsub");d(this,"subscribers");d(this,"scope");d(this,"shutdownHook");d(this,"shutdownFlag");d(this,"strategy");d(this,vI,WP);d(this,wI,Gv);this.pubsub=t,this.subscribers=n,this.scope=r,this.shutdownHook=s,this.shutdownFlag=o,this.strategy=a}capacity(){return this.pubsub.capacity}get size(){return pe(()=>He(this.shutdownFlag)?_n:K(()=>this.pubsub.size()))}unsafeSize(){return He(this.shutdownFlag)?V():W(this.pubsub.size())}get isFull(){return Se(this.size,t=>t===this.capacity())}get isEmpty(){return Se(this.size,t=>t===0)}get awaitShutdown(){return rs(this.shutdownHook)}get isShutdown(){return K(()=>He(this.shutdownFlag))}get shutdown(){return yi(Fe(t=>(v(this.shutdownFlag,Oa(!0)),v(this.scope.close(xw(t.id())),It(this.strategy.shutdown),id(fd(this.shutdownHook,void 0)),or))))}publish(t){return pe(()=>He(this.shutdownFlag)?_n:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),J(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,ft(t),this.shutdownFlag))}isActive(){return!He(this.shutdownFlag)}unsafeOffer(t){return He(this.shutdownFlag)?!1:this.pubsub.publish(t)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0):!1}publishAll(t){return pe(()=>{if(He(this.shutdownFlag))return _n;const n=P9(this.pubsub,t);return this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),ed(n)?J(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,n,this.shutdownFlag)})}get subscribe(){const t=cg(_v([this.scope.fork(gd),v9(this.pubsub,this.subscribers,this.strategy)]),n=>n[0].addFinalizer(()=>n[1].shutdown));return Se(gv(t,(n,r)=>n[0].close(r)),n=>n[1])}offer(t){return this.publish(t)}offerAll(t){return this.publishAll(t)}pipe(){return ee(this,arguments)}}const I9=(e,t)=>U(kd(),n=>Se(Ru(),r=>R9(e,new Map,n,r,Ra(!1),t))),R9=(e,t,n,r,s,o)=>new T9(e,t,n,r,s,o),O9=(e,t)=>{dd(e,J(t))},YP=(e,t)=>v(e,Ww(t)),Qv=e=>v(e,bg(Number.POSITIVE_INFINITY)),q9=e=>e.pollUpTo(Number.POSITIVE_INFINITY),A9=(e,t)=>e.pollUpTo(t),P9=(e,t)=>e.publishAll(t),F9=(e,t)=>{YP(e,v(Qv(e),Pp(n=>n!==t)))};class x9{get shutdown(){return Qe}handleSurplus(t,n,r,s){return J(!1)}unsafeOnPubSubEmptySpace(t,n){}unsafeCompletePollers(t,n,r,s){return N9(this,t,n,r,s)}unsafeCompleteSubscribers(t,n){return D9(this,t,n)}}const N9=(e,t,n,r,s)=>{let o=!0;for(;o&&!r.isEmpty();){const a=v(s,ao(Wt));if(a===Wt)v(n,g9(r,s)),Ji(s)?o=!1:v(n,GP(r,s));else{const u=r.poll(Wt);u===Wt?YP(s,v(Qv(s),Tn(a))):(O9(a,u),e.unsafeOnPubSubEmptySpace(t,n))}}},D9=(e,t,n)=>{for(const[r,s]of n)for(const o of s)e.unsafeCompletePollers(t,n,r,o)};class M9{constructor(t){d(this,"capacity");d(this,"head",{value:gs,next:null});d(this,"tail",this.head);d(this,"size",0);d(this,"index",0);this.capacity=t}slide(){this.index++}offer(t){this.tail.value=t,this.tail.next={value:gs,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(t){for(const n of t)this.offer(n)}}class L9{constructor(t){d(this,"buffer");d(this,"head");d(this,"index");d(this,"remaining");this.buffer=t,this.index=t.index,this.remaining=t.size,this.head=t.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(this.remaining===0)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;const t=this.head.value;return this.head=this.head.next,t}takeN(t){if(this.remaining===0)return yt();this.index<this.buffer.index&&this.fastForward();const n=Math.min(t,this.remaining),r=new Array(n);for(let s=0;s<n;s++){const o=this.head.value;this.head=this.head.next,r[s]=o}return this.remaining-=n,Bt(r)}takeAll(){return this.takeN(this.remaining)}}const j9={remaining:0,take:()=>{},takeN:()=>yt(),takeAll:()=>yt()},Yv=_9,xm=y9,Jg=b9,T$=S9,ou=GQ,Gg=QQ,Qg=YQ,yn=XQ,U9=t9,z9=n9,Mt=r9,Ze=s9,Xv=o9,ko=xb,B9=i9,XP=c9,ZP="Continue",H9="Close",V9="Yield",W9="effect/ChannelChildExecutorDecision",I$=Symbol.for(W9),K9={[I$]:I$},eF=e=>{const t=Object.create(K9);return t._tag=ZP,t},Fh="ContinuationK",J9="ContinuationFinalizer",tF=Symbol.for("effect/ChannelContinuation"),nF={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};var EI;EI=tF;class Zv{constructor(t,n){d(this,"onSuccess");d(this,"onHalt");d(this,"_tag",Fh);d(this,EI,nF);this.onSuccess=t,this.onHalt=n}onExit(t){return xa(t)?this.onHalt(t.cause):this.onSuccess(t.value)}}var kI;kI=tF;class G9{constructor(t){d(this,"finalizer");d(this,"_tag",J9);d(this,kI,nF);this.finalizer=t}}const rF="PullAfterNext",Q9="PullAfterAllEnqueued",Y9="effect/ChannelUpstreamPullStrategy",X9=Symbol.for(Y9),Z9={_A:e=>e},e7={[X9]:Z9},sF=e=>{const t=Object.create(e7);return t._tag=rF,t.emitSeparator=e,t},oF="BracketOut",iF="Bridge",eE="ConcatAll",aF="Emit",cF="Ensuring",uF="Fail",tE="Fold",lF="FromEffect",fF="PipeTo",dF="Provide",hF="Read",mF="Succeed",pF="SucceedNow",gF="Suspend",t7="effect/Channel",Nm=Symbol.for(t7),n7={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},xn={[Nm]:n7,pipe(){return ee(this,arguments)}},_F=e=>ne(e,Nm)||jr(e),r7=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=oF,n.acquire=()=>e,n.finalizer=t,n}),yF=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=tE,n.channel=e,n.k=new Zv(Da,t),n}),bF=(e,t,n)=>{const r=Object.create(xn);return r._tag=eE,r.combineInners=t,r.combineAll=n,r.onPull=()=>sF(V()),r.onEmit=()=>eF,r.value=()=>e,r.k=ce,r},s7=y(4,(e,t,n,r)=>{const s=Object.create(xn);return s._tag=eE,s.combineInners=n,s.combineAll=r,s.onPull=()=>sF(V()),s.onEmit=()=>eF,s.value=()=>e,s.k=t,s}),nE=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=iF,n.input=t,n.channel=e,n}),rE=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=cF,n.channel=e,n.finalizer=t,n}),Od=e=>qt(Pu(e)),qt=e=>SF(()=>e),SF=e=>{const t=Object.create(xn);return t._tag=uF,t.error=e,t},Ne=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=tE,n.channel=e,n.k=new Zv(t,qt),n}),Ct=e=>{const t=Object.create(xn);return t._tag=lF,t.effect=()=>e,t},mn=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=fF,n.left=()=>e,n.right=()=>t,n}),Nb=y(2,(e,t)=>{const n=Object.create(xn);return n._tag=dF,n.context=()=>t,n.inner=e,n}),Yg=e=>vr({onInput:e.onInput,onFailure:t=>un(qg(t),{onLeft:e.onFailure,onRight:qt}),onDone:e.onDone}),vr=e=>{const t=Object.create(xn);return t._tag=hF,t.more=e.onInput,t.done=new Zv(e.onDone,e.onFailure),t},Da=e=>wF(()=>e),hi=e=>{const t=Object.create(xn);return t._tag=pF,t.terminal=e,t},qd=e=>{const t=Object.create(xn);return t._tag=gF,t.channel=e,t},wF=e=>{const t=Object.create(xn);return t._tag=mF,t.evaluate=e,t},bn=hi(void 0),rt=e=>{const t=Object.create(xn);return t._tag=aF,t.out=e,t},Ad="Done",Pd="Emit",Du="FromEffect",Fd="Read",o7=Symbol.for("effect/ChannelState"),i7={_E:e=>e,_R:e=>e},Xg={[o7]:i7},ec=()=>{const e=Object.create(Xg);return e._tag=Ad,e},iy=()=>{const e=Object.create(Xg);return e._tag=Pd,e},sl=e=>{const t=Object.create(Xg);return t._tag=Du,t.effect=e,t},ay=(e,t,n,r)=>{const s=Object.create(Xg);return s._tag=Fd,s.upstream=e,s.onEffect=t,s.onEmit=n,s.onDone=r,s},Dm=e=>e._tag===Du,a7=e=>Dm(e)?e.effect:he,R$=e=>Dm(e)?Nv(e.effect):void 0,vF="PullFromChild",Db="PullFromUpstream",Mb="DrainChildExecutors",EF="Emit";class rh{constructor(t,n,r){d(this,"childExecutor");d(this,"parentSubexecutor");d(this,"onEmit");d(this,"_tag",vF);this.childExecutor=t,this.parentSubexecutor=n,this.onEmit=r}close(t){const n=this.childExecutor.close(t),r=this.parentSubexecutor.close(t);return n!==void 0&&r!==void 0?su(Qt(n),Qt(r),(s,o)=>v(s,nf(o))):n!==void 0?n:r!==void 0?r:void 0}enqueuePullFromChild(t){return this}}class Pi{constructor(t,n,r,s,o,a,u,f){d(this,"upstreamExecutor");d(this,"createChild");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"onEmit");d(this,"_tag",Db);this.upstreamExecutor=t,this.createChild=n,this.lastDone=r,this.activeChildExecutors=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u,this.onEmit=f}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?su(o,Qt(a),(u,f)=>nf(u,f)):o!==void 0?o:a!==void 0?Qt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new Pi(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,t],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class hc{constructor(t,n,r,s,o,a,u){d(this,"upstreamExecutor");d(this,"lastDone");d(this,"activeChildExecutors");d(this,"upstreamDone");d(this,"combineChildResults");d(this,"combineWithChildResult");d(this,"onPull");d(this,"_tag",Mb);this.upstreamExecutor=t,this.lastDone=n,this.activeChildExecutors=r,this.upstreamDone=s,this.combineChildResults=o,this.combineWithChildResult=a,this.onPull=u}close(t){const n=this.upstreamExecutor.close(t),s=[...this.activeChildExecutors.map(o=>o!==void 0?o.childExecutor.close(t):void 0),n].reduce((o,a)=>o!==void 0&&a!==void 0?su(o,Qt(a),(u,f)=>nf(u,f)):o!==void 0?o:a!==void 0?Qt(a):void 0,void 0);return s}enqueuePullFromChild(t){return new hc(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,t],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class cy{constructor(t,n){d(this,"value");d(this,"next");d(this,"_tag",EF);this.value=t,this.next=n}close(t){const n=this.next.close(t);return n}enqueuePullFromChild(t){return this}}const c7="Pulled",u7="NoUpstream",l7="effect/ChannelUpstreamPullRequest",f7=Symbol.for(l7),d7={_A:e=>e},kF={[f7]:d7},O$=e=>{const t=Object.create(kF);return t._tag=c7,t.value=e,t},h7=e=>{const t=Object.create(kF);return t._tag=u7,t.activeDownstreamCount=e,t};class zi{constructor(t,n,r){d(this,"_activeSubexecutor");d(this,"_cancelled");d(this,"_closeLastSubstream");d(this,"_currentChannel");d(this,"_done");d(this,"_doneStack",[]);d(this,"_emitted");d(this,"_executeCloseLastSubstream");d(this,"_input");d(this,"_inProgressFinalizer");d(this,"_providedEnv");this._currentChannel=t,this._executeCloseLastSubstream=r,this._providedEnv=n}run(){let t;for(;t===void 0;)if(this._cancelled!==void 0)t=this.processCancellation();else if(this._activeSubexecutor!==void 0)t=this.runSubexecutor();else try{if(this._currentChannel===void 0)t=ec();else switch(jr(this._currentChannel)&&(this._currentChannel=Ct(this._currentChannel)),this._currentChannel._tag){case oF:{t=this.runBracketOut(this._currentChannel);break}case iF:{const n=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,this._input!==void 0){const r=this._input;this._input=void 0;const s=()=>X(n.awaitRead(),()=>_t(()=>{const o=r.run();switch(o._tag){case Ad:return Zr(r.getDone(),{onFailure:a=>n.error(a),onSuccess:a=>n.done(a)});case Pd:return X(n.emit(r.getEmit()),()=>s());case Du:return Rr(o.effect,{onFailure:a=>n.error(a),onSuccess:()=>s()});case Fd:return sE(o,()=>s(),a=>n.error(a))}}));t=sl(X(Lv(Pt(s())),o=>Re(()=>this.addFinalizer(a=>X(Dr(o),()=>_t(()=>{const u=this.restorePipe(a,r);return u!==void 0?u:he}))))))}break}case eE:{const n=new zi(this._currentChannel.value(),this._providedEnv,s=>Re(()=>{const o=this._closeLastSubstream===void 0?he:this._closeLastSubstream;this._closeLastSubstream=v(o,pt(s))}));n._input=this._input;const r=this._currentChannel;this._activeSubexecutor=new Pi(n,s=>r.k(s),void 0,[],(s,o)=>r.combineInners(s,o),(s,o)=>r.combineAll(s,o),s=>r.onPull(s),s=>r.onEmit(s)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case aF:{this._emitted=this._currentChannel.out,this._currentChannel=this._activeSubexecutor!==void 0?void 0:bn,t=iy();break}case cF:{this.runEnsuring(this._currentChannel);break}case uF:{t=this.doneHalt(this._currentChannel.error());break}case tE:{this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break}case lF:{const n=this._providedEnv===void 0?this._currentChannel.effect():v(this._currentChannel.effect(),An(this._providedEnv));t=sl(Rr(n,{onFailure:r=>{const s=this.doneHalt(r);return s!==void 0&&Dm(s)?s.effect:he},onSuccess:r=>{const s=this.doneSucceed(r);return s!==void 0&&Dm(s)?s.effect:he}}));break}case fF:{const n=this._input,r=new zi(this._currentChannel.left(),this._providedEnv,s=>this._executeCloseLastSubstream(s));r._input=n,this._input=r,this.addFinalizer(s=>{const o=this.restorePipe(s,n);return o!==void 0?o:he}),this._currentChannel=this._currentChannel.right();break}case dF:{const n=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>Re(()=>{this._providedEnv=n}));break}case hF:{const n=this._currentChannel;t=ay(this._input,ce,r=>{try{this._currentChannel=n.more(r)}catch(s){this._currentChannel=n.done.onExit(tf(s))}},r=>{const s=o=>n.done.onExit(o);this._currentChannel=s(r)});break}case mF:{t=this.doneSucceed(this._currentChannel.evaluate());break}case pF:{t=this.doneSucceed(this._currentChannel.terminal);break}case gF:{this._currentChannel=this._currentChannel.channel();break}}}catch(n){this._currentChannel=qt(wa(n))}return t}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(t){this._cancelled=t}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(t){this._inProgressFinalizer=t}popAllFinalizers(t){const n=[];let r=this._doneStack.pop();for(;r;)r._tag==="ContinuationFinalizer"&&n.push(r.finalizer),r=this._doneStack.pop();const s=n.length===0?he:ly(n,t);return this.storeInProgressFinalizer(s),s}popNextFinalizers(){const t=[];for(;this._doneStack.length!==0;){const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fh)return t;t.push(n),this._doneStack.pop()}return t}restorePipe(t,n){const r=this._input;return this._input=n,r!==void 0?r.close(t):he}close(t){let n;const r=this._inProgressFinalizer;r!==void 0&&(n=v(r,Li(Re(()=>this.clearInProgressFinalizer()))));let s;const o=this.popAllFinalizers(t);o!==void 0&&(s=v(o,Li(Re(()=>this.clearInProgressFinalizer()))));const a=this._activeSubexecutor===void 0?void 0:this._activeSubexecutor.close(t);if(!(a===void 0&&n===void 0&&s===void 0))return v(Qt(uy(a)),Am(Qt(uy(n))),Am(Qt(uy(s))),Ee(([[u,f],h])=>v(u,nf(f),nf(h))),Qo,X(u=>_t(()=>u)))}doneSucceed(t){if(this._doneStack.length===0)return this._done=Kt(t),this._currentChannel=void 0,ec();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fh){this._doneStack.pop(),this._currentChannel=n.onSuccess(t);return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=Kt(t),this._currentChannel=void 0,ec();const s=ly(r.map(a=>a.finalizer),Kt(t));this.storeInProgressFinalizer(s);const o=v(s,Li(Re(()=>this.clearInProgressFinalizer())),Qo,X(()=>Re(()=>this.doneSucceed(t))));return sl(o)}doneHalt(t){if(this._doneStack.length===0)return this._done=ln(t),this._currentChannel=void 0,ec();const n=this._doneStack[this._doneStack.length-1];if(n._tag===Fh){this._doneStack.pop();try{this._currentChannel=n.onHalt(t)}catch(a){this._currentChannel=qt(wa(a))}return}const r=this.popNextFinalizers();if(this._doneStack.length===0)return this._doneStack=r.reverse(),this._done=ln(t),this._currentChannel=void 0,ec();const s=ly(r.map(a=>a.finalizer),ln(t));this.storeInProgressFinalizer(s);const o=v(s,Li(Re(()=>this.clearInProgressFinalizer())),Qo,X(()=>Re(()=>this.doneHalt(t))));return sl(o)}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,ec()}runBracketOut(t){const n=Qo(Rr(this.provide(t.acquire()),{onFailure:r=>Re(()=>{this._currentChannel=qt(r)}),onSuccess:r=>Re(()=>{this.addFinalizer(s=>this.provide(t.finalizer(r,s))),this._currentChannel=rt(r)})}));return sl(n)}provide(t){return this._providedEnv===void 0?t:v(t,An(this._providedEnv))}runEnsuring(t){this.addFinalizer(t.finalizer),this._currentChannel=t.channel}addFinalizer(t){this._doneStack.push(new G9(t))}runSubexecutor(){const t=this._activeSubexecutor;switch(t._tag){case vF:return this.pullFromChild(t.childExecutor,t.parentSubexecutor,t.onEmit,t);case Db:return this.pullFromUpstream(t);case Mb:return this.drainChildExecutors(t);case EF:return this._emitted=t.value,this._activeSubexecutor=t.next,iy()}}replaceSubexecutor(t){this._currentChannel=void 0,this._activeSubexecutor=t}finishWithExit(t){const n=Zr(t,{onFailure:r=>this.doneHalt(r),onSuccess:r=>this.doneSucceed(r)});return this._activeSubexecutor=void 0,n===void 0?he:a7(n)}finishSubexecutorWithCloseEffect(t,...n){this.addFinalizer(()=>v(n,$n(s=>v(Re(()=>s(t)),X(o=>o!==void 0?o:he)),{discard:!0})));const r=v(t,Zr({onFailure:s=>this.doneHalt(s),onSuccess:s=>this.doneSucceed(s)}));return this._activeSubexecutor=void 0,r}applyUpstreamPullStrategy(t,n,r){switch(r._tag){case rF:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[void 0,...n]:n]}case Q9:{const s=!t||n.some(o=>o!==void 0);return[r.emitSeparator,s?[...n,void 0]:n]}}}pullFromChild(t,n,r,s){return ay(t,ce,o=>{const a=r(o);switch(a._tag){case ZP:break;case H9:{this.finishWithDoneValue(t,n,a.value);break}case V9:{const u=n.enqueuePullFromChild(s);this.replaceSubexecutor(u);break}}this._activeSubexecutor=new cy(o,this._activeSubexecutor)},Zr({onFailure:o=>{const a=this.handleSubexecutorFailure(t,n,o);return a===void 0?void 0:R$(a)},onSuccess:o=>{this.finishWithDoneValue(t,n,o)}}))}finishWithDoneValue(t,n,r){const s=n;switch(s._tag){case Db:{const o=new Pi(s.upstreamExecutor,s.createChild,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.combineChildResults,s.combineWithChildResult,s.onPull,s.onEmit);this._closeLastSubstream=t.close(Kt(r)),this.replaceSubexecutor(o);break}case Mb:{const o=new hc(s.upstreamExecutor,s.lastDone!==void 0?s.combineChildResults(s.lastDone,r):r,s.activeChildExecutors,s.upstreamDone,s.combineChildResults,s.combineWithChildResult,s.onPull);this._closeLastSubstream=t.close(Kt(r)),this.replaceSubexecutor(o);break}}}handleSubexecutorFailure(t,n,r){return this.finishSubexecutorWithCloseEffect(ln(r),s=>n.close(s),s=>t.close(s))}pullFromUpstream(t){if(t.activeChildExecutors.length===0)return this.performPullFromUpstream(t);const n=t.activeChildExecutors[0],r=new Pi(t.upstreamExecutor,t.createChild,t.lastDone,t.activeChildExecutors.slice(1),t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);if(n===void 0)return this.performPullFromUpstream(r);this.replaceSubexecutor(new rh(n.childExecutor,r,n.onEmit))}performPullFromUpstream(t){return ay(t.upstreamExecutor,n=>{const r=this._closeLastSubstream===void 0?he:this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(r),pt(n))},n=>{if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(a),Ee(()=>{const u=new zi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);u._input=this._input;const[f,h]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(O$(n)));this._activeSubexecutor=new rh(u,new Pi(t.upstreamExecutor,t.createChild,t.lastDone,h,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),lt(f)&&(this._activeSubexecutor=new cy(f.value,this._activeSubexecutor))}))}const r=new zi(t.createChild(n),this._providedEnv,this._executeCloseLastSubstream);r._input=this._input;const[s,o]=this.applyUpstreamPullStrategy(!1,t.activeChildExecutors,t.onPull(O$(n)));this._activeSubexecutor=new rh(r,new Pi(t.upstreamExecutor,t.createChild,t.lastDone,o,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit),t.onEmit),lt(s)&&(this._activeSubexecutor=new cy(s.value,this._activeSubexecutor))},n=>{if(t.activeChildExecutors.some(o=>o!==void 0)){const o=new hc(t.upstreamExecutor,t.lastDone,[void 0,...t.activeChildExecutors],t.upstreamExecutor.getDone(),t.combineChildResults,t.combineWithChildResult,t.onPull);if(this._closeLastSubstream!==void 0){const a=this._closeLastSubstream;return this._closeLastSubstream=void 0,v(this._executeCloseLastSubstream(a),Ee(()=>this.replaceSubexecutor(o)))}this.replaceSubexecutor(o);return}const r=this._closeLastSubstream,s=this.finishSubexecutorWithCloseEffect(v(n,K4(o=>t.combineWithChildResult(t.lastDone,o))),()=>r,o=>t.upstreamExecutor.close(o));return s===void 0?void 0:R$(s)})}drainChildExecutors(t){if(t.activeChildExecutors.length===0){const o=this._closeLastSubstream;return o!==void 0&&this.addFinalizer(()=>Ve(o)),this.finishSubexecutorWithCloseEffect(t.upstreamDone,()=>o,a=>t.upstreamExecutor.close(a))}const n=t.activeChildExecutors[0],r=t.activeChildExecutors.slice(1);if(n===void 0){const[o,a]=this.applyUpstreamPullStrategy(!0,r,t.onPull(h7(r.reduce((u,f)=>f!==void 0?u+1:u,0))));return this.replaceSubexecutor(new hc(t.upstreamExecutor,t.lastDone,a,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull)),lt(o)?(this._emitted=o.value,iy()):void 0}const s=new hc(t.upstreamExecutor,t.lastDone,r,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this.replaceSubexecutor(new rh(n.childExecutor,s,n.onEmit))}}const uy=e=>e!==void 0?e:he,ly=(e,t)=>v($n(e,n=>Qt(n(t))),Ee(n=>v(V4(n),Et(()=>tr))),X(n=>_t(()=>n))),sE=(e,t,n)=>{const r=[e],s=()=>{const o=r.pop();if(o===void 0||o.upstream===void 0)return qP("Unexpected end of input for channel execution");const a=o.upstream.run();switch(a._tag){case Pd:{const u=o.onEmit(o.upstream.getEmit());return r.length===0?u===void 0?_t(t):v(u,Rr({onFailure:n,onSuccess:t})):u===void 0?_t(()=>s()):v(u,Rr({onFailure:n,onSuccess:()=>s()}))}case Ad:{const u=o.onDone(o.upstream.getDone());return r.length===0?u===void 0?_t(t):v(u,Rr({onFailure:n,onSuccess:t})):u===void 0?_t(()=>s()):v(u,Rr({onFailure:n,onSuccess:()=>s()}))}case Du:return r.push(o),v(o.onEffect(a.effect),$s(u=>_t(()=>{const f=o.onDone(ln(u));return f===void 0?he:f})),Rr({onFailure:n,onSuccess:()=>s()}));case Fd:return r.push(o),r.push(a),_t(()=>s())}};return s()},oE=y(2,(e,t)=>{const n=(r,s,o)=>PP(Re(()=>new zi(e,void 0,ce)),a=>_t(()=>xh(a.run(),a).pipe(Id(r),pt(Vt(r)),Uv(Vt(s)))),(a,u)=>{const f=a.close(u);return f===void 0?he:Nu(f,h=>ni(o,Zn(h)))});return fi(r=>Cd([Iv(t,af),Ue(),Ue()]).pipe(X(([s,o,a])=>r(n(o,a,s)).pipe(_r(t),X(u=>t.addFinalizer(f=>{const h=xa(f)?K8(f.cause):void 0;return cb(o).pipe(X(p=>p?ut(a,void 0).pipe(pt(dP(u)),pt(S$(u))):ut(a,void 0).pipe(pt(h&&mw(h)>0?xg(u,Vz(h)):Dr(u)),pt(S$(u)))))}).pipe(pt(r(Vt(o)))))))))}),xh=(e,t)=>{const n=e;switch(n._tag){case Du:return v(n.effect,X(()=>xh(t.run(),t)));case Pd:return xh(t.run(),t);case Ad:return _t(()=>t.getDone());case Fd:return sE(n,()=>xh(t.run(),t),Zn)}},$F="Done",m7="Await",p7="effect/ChannelMergeDecision",g7=Symbol.for(p7),CF={[g7]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},_7=e=>{const t=Object.create(CF);return t._tag=$F,t.effect=e,t},Lb=e=>{const t=Object.create(CF);return t._tag=m7,t.f=e,t},TF="BothRunning",IF="LeftDone",RF="RightDone",y7="effect/ChannelMergeState",q$=Symbol.for(y7),iE={[q$]:q$},fy=(e,t)=>{const n=Object.create(iE);return n._tag=TF,n.left=e,n.right=t,n},A$=e=>{const t=Object.create(iE);return t._tag=IF,t.f=e,t},P$=e=>{const t=Object.create(iE);return t._tag=RF,t.f=e,t},OF="BackPressure",qF="BufferSliding",b7="effect/ChannelMergeStrategy",F$=Symbol.for(b7),AF={[F$]:F$},S7=e=>{const t=Object.create(AF);return t._tag=OF,t},w7=e=>{const t=Object.create(AF);return t._tag=qF,t},v7=y(2,(e,{onBackPressure:t,onBufferSliding:n})=>{switch(e._tag){case OF:return t();case qF:return n()}}),oc="Empty",hl="Emit",ml="Error",pl="Done",PF=e=>({_tag:oc,notifyProducer:e}),dy=e=>({_tag:hl,notifyConsumers:e}),E7=e=>({_tag:ml,cause:e}),k7=e=>({_tag:pl,done:e});class $7{constructor(t){d(this,"ref");this.ref=t}awaitRead(){return Ai(qi(this.ref,t=>t._tag===oc?[Vt(t.notifyProducer),t]:[he,t]))}get close(){return Mv(t=>this.error(Og(t)))}done(t){return Ai(qi(this.ref,n=>{switch(n._tag){case oc:return[Vt(n.notifyProducer),n];case hl:return[$n(n.notifyConsumers,r=>ut(r,ae(t)),{discard:!0}),k7(t)];case ml:return[ms,n];case pl:return[ms,n]}}))}emit(t){return X(Ue(),n=>Ai(qi(this.ref,r=>{switch(r._tag){case oc:return[Vt(r.notifyProducer),r];case hl:{const s=r.notifyConsumers[0],o=r.notifyConsumers.slice(1);if(s!==void 0)return[ut(s,le(t)),o.length===0?PF(n):dy(o)];throw new Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case ml:return[ms,r];case pl:return[ms,r]}})))}error(t){return Ai(qi(this.ref,n=>{switch(n._tag){case oc:return[Vt(n.notifyProducer),n];case hl:return[$n(n.notifyConsumers,r=>iq(r,t),{discard:!0}),E7(t)];case ml:return[ms,n];case pl:return[ms,n]}}))}get take(){return this.takeWith(t=>ln(Ag(t,ae)),t=>Kt(t),t=>md(le(t)))}takeWith(t,n,r){return X(Ue(),s=>Ai(qi(this.ref,o=>{switch(o._tag){case oc:return[pt(ut(o.notifyProducer,void 0),gf(Vt(s),{onFailure:t,onSuccess:un({onLeft:r,onRight:n})})),dy([s])];case hl:return[gf(Vt(s),{onFailure:t,onSuccess:un({onLeft:r,onRight:n})}),dy([...o.notifyConsumers,s])];case ml:return[Ve(t(o.cause)),o];case pl:return[Ve(r(o.done)),o]}})))}}const aE=()=>v(Ue(),X(e=>Si(PF(e))),Ee(e=>new $7(e))),x$=(e,t,n)=>Ne(Ct(Si(()=>he)),r=>v(Ct(Qo(Eo(e,s=>Xc(r,o=>n(s,o))))),Ne(t),rE(s=>X(Gi(r),o=>o(s))))),C7=y(2,(e,t)=>yF(e,n=>un(qg(n),{onLeft:t,onRight:qt}))),Mm=y(2,(e,t)=>s7(e,t,()=>{},()=>{})),Zg=e=>{const t=vr({onInput:()=>t,onFailure:qt,onDone:Da});return mn(e,t)},FF=y(2,(e,t)=>rE(e,()=>t)),T7=e=>Ne(e,ce),e_=e=>Mr(e.takeWith(qt,t=>Ne(rt(t),()=>e_(e)),Da)),xF=()=>Yg({onInput:e=>Ne(rt(e),()=>xF()),onFailure:Od,onDone:hi}),NF=y(2,(e,t)=>Ne(e,n=>wF(()=>t(n)))),I7=y(2,(e,t)=>R7(e,Ag(t))),R7=y(2,(e,t)=>yF(e,n=>qt(t(n)))),t_=y(2,(e,t)=>{const n=Yg({onInput:r=>Ne(rt(t(r)),()=>n),onFailure:Od,onDone:hi});return mn(e,n)}),DF=y(2,(e,t)=>{const n=vr({onInput:r=>v(Ct(t(r)),Ne(rt),Ne(()=>n)),onFailure:qt,onDone:hi});return mn(e,n)}),O7=y(3,(e,t,n)=>cE(r=>z(function*(){const s=yield*aE(),o=e_(s),a=yield*ou(n);yield*ni(r,Mt(a));const u=yield*Ue(),f=n===Number.POSITIVE_INFINITY?g=>ce:(yield*Bg(n)).withPermits;yield*(yield*o.pipe(mn(e),Yi(r))).pipe(Rr({onFailure:g=>Ze(a,Zn(g)),onSuccess:un({onLeft:g=>pt(Pt(f(n)(he)),Ps(Ze(a,Ve(ae(g))))),onRight:g=>z(function*(){const k=yield*Ue(),T=yield*Ue();yield*Ze(a,Ee(Vt(k),le)),yield*ut(T,void 0).pipe(pt(fi(O=>Qt(O(Vt(u))).pipe(NP(Qt(O(t(g)))),X(ce))).pipe(Nu(O=>iq(u,O)),Id(k))),f(1),_r(r)),yield*Vt(T)})})}),pf,Pt,_r(r));const p=Mr(gf(Ai(ko(a)),{onFailure:qt,onSuccess:un({onLeft:hi,onRight:g=>Ne(rt(g),()=>p)})}));return nE(p,s)}))),q7=e=>t=>A7(e)(t,jl),A7=({bufferSize:e=16,concurrency:t,mergeStrategy:n=S7()})=>(r,s)=>cE(o=>z(function*(){const a=t==="unbounded"?Number.MAX_SAFE_INTEGER:t,u=yield*aE(),f=e_(u),h=yield*ou(e);yield*ni(o,Mt(h));const p=yield*yn();yield*ni(o,Mt(p));const g=yield*Si(V()),k=yield*Ue(),T=(yield*Bg(a)).withPermits,O=yield*Yi(mn(f,r),o);function L(S){return S.pipe(X(un({onLeft:_=>Ve(W(_)),onRight:_=>fo(Ze(h,Ve(le(_))),V())})),k$({until:_=>lt(_)}),X(_=>R5(g,ot({onNone:()=>W(_.value),onSome:C=>W(s(C,_.value))}))),$s(_=>ff(_)?Zn(_):Ze(h,Zn(_)).pipe(pt(ut(k,void 0)),Ps)))}yield*O.pipe(Rr({onFailure:S=>Ze(h,Zn(S)).pipe(pt(Ve(!1))),onSuccess:un({onLeft:S=>jv(Pt(Vt(k)),Pt(T(a)(he)),{onSelfDone:(_,C)=>fo(Dr(C),!1),onOtherDone:(_,C)=>pt(Dr(C),Gi(g).pipe(X(ot({onNone:()=>Ze(h,Ve(ae(S))),onSome:$=>Ze(h,Ve(ae(s($,S))))})),fo(!1)))}),onRight:S=>v7(n,{onBackPressure:()=>z(function*(){const _=yield*Ue(),C=qm(q=>Yi(mn(f,S),q).pipe(X(P=>oy(Qt(L(P)),Qt(Pt(Vt(k))))),X(ce)));return yield*ut(_,void 0).pipe(pt(C),T(1),_r(o)),yield*Vt(_),!(yield*cb(k))}),onBufferSliding:()=>z(function*(){const _=yield*Ue(),C=yield*Ue(),$=yield*U9(p);yield*ko(p).pipe(X(N=>ut(N,void 0)),xP(()=>$>=a)),yield*Ze(p,_);const q=qm(N=>Yi(mn(f,S),N).pipe(X(M=>Qt(L(M)).pipe(oy(Qt(Pt(Vt(k)))),oy(Qt(Pt(Vt(_)))))),X(ce)));return yield*ut(C,void 0).pipe(pt(q),T(1),_r(o)),yield*Vt(C),!(yield*cb(k))})})})}),k$({while:S=>S}),_r(o));const E=v(ko(h),Ai,gf({onFailure:qt,onSuccess:un({onLeft:hi,onRight:S=>Ne(rt(S),()=>E)})}),Mr);return nE(E,u)})),MF=y(3,(e,t,n)=>q7(n)(t_(e,t))),LF=y(2,(e,t)=>{function n(r){return z(function*(){const s=yield*aE(),o=e_(s),a=yield*Yi(mn(o,e),r),u=yield*Yi(mn(o,t.other),r);function f(p,g,k){return(T,O,L)=>{function E(S){const _=S;return _._tag===$F?Ve(Ct(pt(Dr(g),_.effect))):Ee(dP(g),Zr({onFailure:C=>Ct(_.f(ln(C))),onSuccess:un({onLeft:C=>Ct(_.f(Kt(C))),onRight:C=>xd(rt(C),h(L(_.f)))})}))}return Zr(p,{onFailure:S=>E(T(ln(S))),onSuccess:un({onLeft:S=>E(T(Kt(S))),onRight:S=>Ve(Ne(rt(S),()=>Ne(Ct(_r(Pt(k),r)),_=>h(O(_,g)))))})})}}function h(p){switch(p._tag){case TF:{const g=Pt(Om(p.left)),k=Pt(Om(p.right));return Mr(jv(g,k,{onSelfDone:(T,O)=>pt(Dr(O),f(T,p.right,a)(t.onSelfDone,fy,L=>A$(L))),onOtherDone:(T,O)=>pt(Dr(O),f(T,p.left,u)(t.onOtherDone,(L,E)=>fy(E,L),L=>P$(L)))}))}case IF:return Mr(Ee(Qt(u),Zr({onFailure:g=>Ct(p.f(ln(g))),onSuccess:un({onLeft:g=>Ct(p.f(Kt(g))),onRight:g=>Ne(rt(g),()=>h(A$(p.f)))})})));case RF:return Mr(Ee(Qt(a),Zr({onFailure:g=>Ct(p.f(ln(g))),onSuccess:un({onLeft:g=>Ct(p.f(Kt(g))),onRight:g=>Ne(rt(g),()=>h(P$(p.f)))})})))}}return Ct(As(p=>{const g=As(O=>(O.transferChildren(p.scope()),he)),k=Pt(a).pipe(Li(g),_r(r)),T=Pt(u).pipe(Li(g),_r(r));return su(k,T,(O,L)=>fy(O,L))})).pipe(Ne(h),nE(s))})}return cE(n)}),P7=y(2,(e,t)=>C7(e,n=>SF(()=>wa(t(n))))),jF=y(2,(e,t)=>qd(()=>{let n;const r=Yg({onInput:o=>Ne(rt(o),()=>r),onFailure:o=>(n=M7(o),qt(wa(n))),onDone:hi}),s=vr({onInput:o=>v(rt(o),Ne(()=>s)),onFailure:o=>W8(o)&&L7(o.defect)&&me(o.defect,n)?Od(o.defect.error):qt(o),onDone:hi});return mn(mn(mn(e,r),t),s)})),F7=e=>qm(t=>oE(e,t)),x7=e=>F7(Zg(e)),UF=e=>cQ(t=>oE(e,t)),zF=e=>Mr(fi(t=>Ee(Rv(),n=>r7(Nu(t(Tv(e,n)),r=>kn(n,ln(r))),(r,s)=>kn(n,s))))),BF=e=>n_(Ee(jg,t=>Ne(Ct(e(t)),rt))),N7=e=>X(jg,t=>Yi(e,t)),Yi=y(2,(e,t)=>Am(Re(()=>new zi(e,void 0,ce)),No()).pipe(Eo(([n,r])=>$J(t,s=>{const o=n.close(s);return o!==void 0?An(o,r):he})),Qo,Ee(([n])=>_t(()=>jb(n.run(),n))))),jb=(e,t)=>{const n=e;switch(n._tag){case Ad:return Zr(t.getDone(),{onFailure:Zn,onSuccess:r=>Ve(ae(r))});case Pd:return Ve(le(t.getEmit()));case Du:return v(n.effect,X(()=>jb(t.run(),t)));case Fd:return sE(n,()=>jb(t.run(),t),r=>Zn(r))}},Mr=e=>T7(Ct(e)),n_=e=>bF(zF(e),(t,n)=>t,(t,n)=>t),cE=e=>bF(BF(e),(t,n)=>t,(t,n)=>t),N$=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]),r=Cd([kQ(t,n),FP(),fQ,CQ(qQ)]);if(e){const s=arguments[0];return x$(r,([o,a])=>Nb(s,_s(a,Os,o)),([o,,a,u],f)=>_m(o,f,a,u))}return s=>x$(r,([o,a])=>Nb(s,_s(a,Os,o)),([o,,a,u],f)=>_m(o,f,a,u))},r_=e=>HF(0,e.length,e),HF=(e,t,n)=>e===t?bn:v(rt(v(n,oo(e))),Ne(()=>HF(e+1,t,n))),D7=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?LF(e,{other:t,onSelfDone:r=>Lb(s=>_t(()=>Pk(r,s))),onOtherDone:r=>Lb(s=>_t(()=>Pk(s,r)))}):Ne(e,r=>NF(t,s=>[r,s]))),xd=y(e=>_F(e[1]),(e,t,n)=>n!=null&&n.concurrent?NF(D7(e,t,{concurrent:!0}),r=>r[1]):Ne(e,()=>t)),Ub=Symbol.for("effect/Channel/ChannelException"),M7=e=>({_tag:"ChannelException",[Ub]:Ub,error:e}),L7=e=>ne(e,Ub),zb=Symbol.for("effect/Sink"),j7={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};var $I;$I=zb;class s_{constructor(t){d(this,"channel");d(this,$I,j7);this.channel=t}pipe(){return ee(this,arguments)}}const U7=()=>new s_(VF(yt())),VF=e=>vr({onInput:t=>VF(v(e,Rt(t))),onFailure:qt,onDone:()=>Da(e)}),z7=new s_(Zg(xF())),B7=e=>{const t=vr({onInput:n=>v(Ct(e(n)),Ne(()=>t)),onFailure:qt,onDone:()=>bn});return new s_(t)},H7=e=>new s_(Ct(e)),WF=e=>jr(e)?WF(H7(e)):e.channel,V7=_7,W7=Lb,KF=Ng,K7=gP,J7=TG,JF=LJ,G7="Left",Q7="Right",Y7="Both",X7="Either",Z7={_tag:G7},eY={_tag:Q7},GF={_tag:Y7},tY={_tag:X7},nY=e=>{switch(e){case"left":return Z7;case"right":return eY;case"both":return GF;case"either":return tY;default:return e}},rY=GF;class QF{constructor(t){d(this,"value");this.value=t}}const YF=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),XF=e=>e.newValue,ZF=(e,t)=>{e.isChanged=!0,e.newValue=t},sY=e=>{e.ref.versioned=new QF(e.newValue)},oY=e=>e.ref.versioned!==e.expected,iY=e=>e.isChanged,Lm="Invalid",uE="ReadWrite",aY="ReadOnly",ex=e=>{for(const t of e)sY(t[1])},tx=e=>{let t=aY;for(const[,n]of e)if(t=oY(n)?Lm:iY(n)?uE:t,t===Lm)return t;return t},cY=e=>{const t=new Map;for(const[,n]of e){for(const r of n.ref.todos)t.set(r[0],r[1]);n.ref.todos=new Map}return t},uY=e=>{const t=Array.from(e.entries()).sort((n,r)=>n[0]-r[0]);for(const[n,r]of t)r()},lY=(e,t,n)=>{let r=!1;for(const[,s]of t)s.ref.todos.has(e)||(s.ref.todos.set(e,n),r=!0);return r},nx="WithSTMRuntime",Bb="OnFailure",D$="OnRetry",Hb="OnSuccess",fY="Provide",rx="Sync",sx="Succeed",ox="Retry",ix="Fail",ax="Die",cx="Interrupt",Ic="Fail",Rc="Die",Oc="Interrupt",Xi="Succeed",Mu="Retry",lE="Done",fE="Suspend",Nh="Done",Vb="Interrupted",jm="Running",o_="effect/STM/State",va=Symbol.for(o_),dE=e=>ne(e,va),ux=e=>e._tag===jm,dY=e=>e._tag===Nh,sh=e=>({[va]:va,_tag:Nh,exit:e,[_e](){return v(Q(o_),fe(Q(Nh)),fe(Q(e)),ct(this))},[ye](t){return dE(t)&&t._tag===Nh&&me(e,t.exit)}}),hY=v(Q(o_),fe(Q(Vb)),fe(Q("interrupted"))),mY={[va]:va,_tag:Vb,[_e](){return hY},[ye](e){return dE(e)&&e._tag===Vb}},pY=v(Q(o_),fe(Q(jm)),fe(Q("running"))),gY={[va]:va,_tag:jm,[_e](){return pY},[ye](e){return dE(e)&&e._tag===jm}},oh=e=>{switch(e._tag){case Ic:return sh(md(e.error));case Rc:return sh(tf(e.defect));case Oc:return sh(W4(e.fiberId));case Xi:return sh(Kt(e.value));case Mu:throw new Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},Lu="effect/TExit",ju=Symbol.for(Lu),Nd={_A:e=>e,_E:e=>e},Dd=e=>ne(e,ju),_Y=e=>e._tag===Xi,yY=e=>e._tag===Mu,bY=e=>({[ju]:Nd,_tag:Ic,error:e,[_e](){return v(Q(Lu),fe(Q(Ic)),fe(Q(e)),ct(this))},[ye](t){return Dd(t)&&t._tag===Ic&&me(e,t.error)}}),SY=e=>({[ju]:Nd,_tag:Rc,defect:e,[_e](){return v(Q(Lu),fe(Q(Rc)),fe(Q(e)),ct(this))},[ye](t){return Dd(t)&&t._tag===Rc&&me(e,t.defect)}}),wY=e=>({[ju]:Nd,_tag:Oc,fiberId:e,[_e](){return v(Q(Lu),fe(Q(Oc)),fe(Q(e)),ct(this))},[ye](t){return Dd(t)&&t._tag===Oc&&me(e,t.fiberId)}}),M$=e=>({[ju]:Nd,_tag:Xi,value:e,[_e](){return v(Q(Lu),fe(Q(Xi)),fe(Q(e)),ct(this))},[ye](t){return Dd(t)&&t._tag===Xi&&me(e,t.value)}}),vY=v(Q(Lu),fe(Q(Mu)),fe(Q("retry"))),EY={[ju]:Nd,_tag:Mu,[_e](){return vY},[ye](e){return Dd(e)&&yY(e)}},kY=e=>({_tag:lE,exit:e}),lx=e=>({_tag:fE,journal:e}),L$={ref:0},$Y=()=>{const e=L$.ref+1;return L$.ref=e,e},CY="effect/STM",TY=Symbol.for(CY),ih={_R:e=>e,_E:e=>e,_A:e=>e};var CI,TI,II,RI;class Mo{constructor(t){d(this,"effect_instruction_i0");d(this,"_op",Vf);d(this,"effect_instruction_i1");d(this,"effect_instruction_i2");d(this,RI);d(this,II);d(this,TI);d(this,CI);this.effect_instruction_i0=t,this[E$]=oa,this[xy]=ih,this[zb]=ih,this[Nm]=ih}get[(RI=E$,II=xy,TI=zb,CI=Nm,TY)](){return ih}[ye](t){return this===t}[_e](){return ct(this,Sp(this))}[Symbol.iterator](){return new ku(new hu(this))}commit(){return IY(this,jl)}pipe(){return ee(this,arguments)}}const IY=(e,t,n)=>Fe(r=>{const s=r.id(),o=r.getFiberRef(MP),a=r.getFiberRef(LP),u=r.getFiberRef(IQ),f=OY(s,e,o,a,u);switch(f._tag){case lE:return t(f.exit),f.exit;case fE:{const h=$Y(),p={value:gY},g=OP(k=>fx(s,e,h,p,o,a,u,k));return fi(k=>v(k(g),$s(T=>{let O=p.value;return ux(O)&&(p.value=mY),O=p.value,dY(O)?(t(O.exit),O.exit):Zn(T)})))}}}),RY=(e,t,n,r,s,o)=>{const a=new Map,u=new dx(t,a,e,r).run(),f=tx(a);if(f===uE)ex(a);else if(f===Lm)throw new Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(u._tag){case Xi:return n.value=oh(u),Yo(Kt(u.value),a,s,o);case Ic:{n.value=oh(u);const h=Pu(u.error);return Yo(ln(h),a,s,o)}case Rc:{n.value=oh(u);const h=wa(u.defect);return Yo(ln(h),a,s,o)}case Oc:{n.value=oh(u);const h=Og(e);return Yo(ln(h),a,s,o)}case Mu:return lx(a)}},OY=(e,t,n,r,s)=>{const o=new Map,a=new dx(t,o,e,n).run(),u=tx(o);if(u===uE&&_Y(a))ex(o);else if(u===Lm)throw new Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(a._tag){case Xi:return Yo(Kt(a.value),o,r,s);case Ic:{const f=Pu(a.error);return Yo(ln(f),o,r,s)}case Rc:{const f=wa(a.defect);return Yo(ln(f),o,r,s)}case Oc:{const f=Og(e);return Yo(ln(f),o,r,s)}case Mu:return lx(o)}},fx=(e,t,n,r,s,o,a,u)=>{if(ux(r.value)){const f=RY(e,t,r,s,o,a);switch(f._tag){case lE:{qY(f.exit,u);break}case fE:{lY(n,f.journal,()=>fx(e,t,n,r,s,o,a,u));break}}}},Yo=(e,t,n,r)=>{const s=cY(t);return s.size>0&&n.scheduleTask(()=>uY(s),r),kY(e)},qY=(e,t)=>{t(e)};class dx{constructor(t,n,r,s){d(this,"self");d(this,"journal");d(this,"fiberId");d(this,"contStack",[]);d(this,"env");this.self=t,this.journal=n,this.fiberId=r,this.env=s}getEnv(){return this.env}pushStack(t){this.contStack.push(t)}popStack(){return this.contStack.pop()}nextSuccess(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Hb;)t=this.popStack();return t}nextFailure(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==Bb;)t=this.popStack();return t}nextRetry(){let t=this.popStack();for(;t!==void 0&&t.effect_instruction_i0!==D$;)t=this.popStack();return t}run(){let t=this.self,n;for(;n===void 0&&t!==void 0;)try{const r=t;if(r)switch(r._op){case"Tag":{t=i_((s,o,a)=>Ap(a,r));break}case"Left":{t=Wb(r.left);break}case"None":{t=Wb(new Pg);break}case"Right":{t=Zt(r.right);break}case"Some":{t=Zt(r.value);break}case"Commit":{switch(r.effect_instruction_i0){case ax:{n=SY(gt(()=>r.effect_instruction_i1()));break}case ix:{const s=this.nextFailure();s===void 0?n=bY(gt(()=>r.effect_instruction_i1())):t=gt(()=>s.effect_instruction_i2(gt(()=>r.effect_instruction_i1())));break}case ox:{const s=this.nextRetry();s===void 0?n=EY:t=gt(()=>s.effect_instruction_i2());break}case cx:{n=wY(this.fiberId);break}case nx:{t=gt(()=>r.effect_instruction_i1(this));break}case Hb:case Bb:case D$:{this.pushStack(r),t=r.effect_instruction_i1;break}case fY:{const s=this.env;this.env=gt(()=>r.effect_instruction_i2(s)),t=v(r.effect_instruction_i1,xY(hE(()=>this.env=s)));break}case sx:{const s=r.effect_instruction_i1,o=this.nextSuccess();o===void 0?n=M$(s):t=gt(()=>o.effect_instruction_i2(s));break}case rx:{const s=gt(()=>r.effect_instruction_i1()),o=this.nextSuccess();o===void 0?n=M$(s):t=gt(()=>o.effect_instruction_i2(s));break}}break}}}catch(r){t=PY(r)}return n}}const AY=y(2,(e,t)=>{const n=new Mo(Bb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),PY=e=>FY(()=>e),FY=e=>{const t=new Mo(ax);return t.effect_instruction_i1=e,t},i_=e=>fs(t=>Zt(e(t.journal,t.fiberId,t.getEnv()))),xY=y(2,(e,t)=>DY(e,{onFailure:n=>j$(t,Wb(n)),onSuccess:n=>j$(t,Zt(n))})),Wb=e=>NY(()=>e),NY=e=>{const t=new Mo(ix);return t.effect_instruction_i1=e,t},Uu=y(2,(e,t)=>{const n=new Mo(Hb);return n.effect_instruction_i1=e,n.effect_instruction_i2=t,n}),DY=y(2,(e,{onFailure:t,onSuccess:n})=>v(e,_f(le),AY(r=>v(t(r),_f(ae))),Uu(r=>{switch(r._tag){case"Left":return Zt(r.left);case"Right":return n(r.right)}}))),fs=e=>{const t=new Mo(nx);return t.effect_instruction_i1=e,t},Bo=e=>{const t=new Mo(cx);return t.effect_instruction_i1=e,t},_f=y(2,(e,t)=>v(e,Uu(n=>hE(()=>t(n))))),ic=new Mo(ox),Zt=e=>{const t=new Mo(sx);return t.effect_instruction_i1=e,t},hE=e=>{const t=new Mo(rx);return t.effect_instruction_i1=e,t},j$=y(2,(e,t)=>v(e,Uu(()=>t))),U$="BackPressure",Kb="Dropping",z$="Sliding",MY=e=>Uu(e,ce),LY=(...e)=>jY(()=>{const n=(e.length===1?e[0]:e[1].bind(e[0]))(v),r=n.next(),s=o=>o.done?Zt(o.value):Uu(f1(o.value),a=>s(n.next(a)));return s(r)}),jY=e=>MY(hE(e)),B$=Zt(void 0),UY="effect/TRef",zY=Symbol.for(UY),BY={_A:e=>e};var OI;OI=zY;class HY{constructor(t){d(this,OI,BY);d(this,"todos");d(this,"versioned");this.versioned=new QF(t),this.todos=new Map}modify(t){return i_(n=>{const r=mE(this,n),[s,o]=t(XF(r));return ZF(r,o),s})}pipe(){return ee(this,arguments)}}const hx=e=>i_(t=>{const n=new HY(e);return t.set(n,YF(n,!0)),n}),VY=e=>e.modify(t=>[t,t]),WY=y(2,(e,t)=>e.modify(()=>[void 0,t])),KY=y(2,(e,t)=>e.modify(n=>[void 0,t(n)])),mE=(e,t)=>{if(t.has(e))return t.get(e);const n=YF(e,!1);return t.set(e,n),n},Hs=y(2,(e,t)=>XF(mE(e,t))),Vs=y(3,(e,t,n)=>{const r=mE(e,n);ZF(r,t)}),JY="effect/TQueue/TEnqueue",GY=Symbol.for(JY),QY="effect/TQueue/TDequeue",YY=Symbol.for(QY),XY={_tag:Kb},ZY={_Out:e=>e},eX={_In:e=>e};var qI,AI;AI=YY,qI=GY;class tX{constructor(t,n,r){d(this,"ref");d(this,"requestedCapacity");d(this,"strategy");d(this,AI,ZY);d(this,qI,eX);d(this,"size",fs(t=>{const n=Hs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):Zt(n.length)}));d(this,"isFull",_f(this.size,t=>t===this.requestedCapacity));d(this,"isEmpty",_f(this.size,t=>t===0));d(this,"shutdown",fs(t=>(Vs(this.ref,void 0,t.journal),B$)));d(this,"isShutdown",i_(t=>Hs(this.ref,t)===void 0));d(this,"awaitShutdown",Uu(this.isShutdown,t=>t?B$:ic));d(this,"peek",fs(t=>{const n=Hs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):n.length===0?ic:Zt(n[0])}));d(this,"peekOption",fs(t=>{const n=Hs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):Zt(Ta(n[0]))}));d(this,"take",fs(t=>{const n=Hs(this.ref,t.journal);if(n===void 0)return Bo(t.fiberId);if(n.length===0)return ic;const r=n.shift();return Vs(this.ref,n,t.journal),Zt(r)}));d(this,"takeAll",fs(t=>{const n=Hs(this.ref,t.journal);return n===void 0?Bo(t.fiberId):(Vs(this.ref,[],t.journal),Zt(n))}));this.ref=t,this.requestedCapacity=n,this.strategy=r}capacity(){return this.requestedCapacity}offer(t){return fs(n=>{const r=v(this.ref,Hs(n.journal));if(r===void 0)return Bo(n.fiberId);if(r.length<this.requestedCapacity)return r.push(t),Vs(this.ref,r,n.journal),Zt(!0);switch(this.strategy._tag){case U$:return ic;case Kb:return Zt(!1);case z$:return r.length===0||(r.shift(),r.push(t),Vs(this.ref,r,n.journal)),Zt(!0)}})}offerAll(t){return fs(n=>{const r=Array.from(t),s=Hs(this.ref,n.journal);if(s===void 0)return Bo(n.fiberId);if(s.length+r.length<=this.requestedCapacity)return Vs(this.ref,[...s,...r],n.journal),Zt(!0);switch(this.strategy._tag){case U$:return ic;case Kb:{const o=r.slice(0,this.requestedCapacity-s.length);return Vs(this.ref,[...s,...o],n.journal),Zt(!1)}case z$:{const o=r.slice(0,this.requestedCapacity-s.length),a=s.length+o.length-this.requestedCapacity,u=s.slice(a);return Vs(this.ref,[...u,...o],n.journal),Zt(!0)}}})}takeUpTo(t){return fs(n=>{const r=Hs(this.ref,n.journal);if(r===void 0)return Bo(n.fiberId);const[s,o]=DR(Bt(r),t);return Vs(this.ref,Array.from(o),n.journal),Zt(Array.from(s))})}}const nX=y(2,(e,t)=>e.offer(t)),rX=e=>e.peek,sX=e=>e.take,oX=()=>iX(Number.MAX_SAFE_INTEGER,XY),iX=(e,t)=>_f(hx([]),n=>new tX(n,e,t)),aX=nX,cX=rX,uX=sX,lX=oX,fX=e=>Object.assign(e,{chunk(n){return this(Ve(n))},die(n){return this(li(n))},dieMessage(n){return this(qP(n))},done(n){return this(_t(()=>J4(n,{onFailure:W,onSuccess:ft})))},end(){return this(Hn(V()))},fail(n){return this(Hn(W(n)))},fromEffect(n){return this(AP(n,{onFailure:W,onSuccess:ft}))},fromEffectChunk(n){return this(v(n,vo(W)))},halt(n){return this(Zn(v(n,Ag(W))))},single(n){return this(Ve(ft(n)))}}),dX=(e,t)=>{let n=!1,r=[],s=!1;function o(f){if(n)return!1;if(f.length<=5e4)r.push.apply(r,f);else for(let h=0;h<f.length;h++)r.push(f[0]);return s||(s=!0,t.scheduleTask(a,0)),!0}function a(){s=!1,r.length>0&&(e.unsafeOffer(r),r=[])}function u(f){n||(n=!0,f._tag==="Success"&&r.push(f.value),a(),e.unsafeOffer(f._tag==="Success"?tr:f))}return{single(f){return n?!1:(r.push(f),s||(s=!0,t.scheduleTask(a,0)),!0)},array:o,chunk(f){return o(pr(f))},done:u,end(){n||(n=!0,a(),e.unsafeOffer(tr))},halt(f){return u(ln(f))},fail(f){return u(md(f))},die(f){return u(tf(f))},dieMessage(f){return u(tf(new Error(f)))}}},hX="effect/Take",mX=Symbol.for(hX),pX={_A:e=>e,_E:e=>e};var PI;PI=mX;class a_{constructor(t){d(this,"exit");d(this,PI,pX);this.exit=t}pipe(){return ee(this,arguments)}}const yf=e=>new a_(Kt(e)),gX=e=>_t(()=>e.exit),bf=new a_(md(V())),c_=e=>new a_(ln(v(e,Ag(W)))),_X=e=>gf(e,{onFailure:t=>ot(vv(t),{onNone:()=>bf,onSome:c_}),onSuccess:yf}),mx=y(2,(e,{onEnd:t,onFailure:n,onSuccess:r})=>Zr(e.exit,{onFailure:s=>ot(vv(s),{onNone:t,onSome:n}),onSuccess:r})),yX=e=>new a_(Kt(ft(e))),px=()=>Hn(V()),bX=e=>vo(Zn(e),W),SX="effect/Stream",gx=Symbol.for(SX),wX={_R:e=>e,_E:e=>e,_A:e=>e};var FI;FI=gx;class et{constructor(t){d(this,"channel");d(this,FI,wX);this.channel=t}pipe(){return ee(this,arguments)}}const Md=e=>ne(e,gx)||jr(e),pE=4096,vX=e=>{if(e==="unbounded")return yn();if(typeof e=="number"||e===void 0)return ou(e??16);switch(e.strategy){case"dropping":return Gg(e.bufferSize??16);case"sliding":return Qg(e.bufferSize??16);default:return ou(e.bufferSize??16)}},EX=e=>{if((e==null?void 0:e.bufferSize)==="unbounded"||(e==null?void 0:e.bufferSize)===void 0&&(e==null?void 0:e.strategy)===void 0)return yn();switch(e==null?void 0:e.strategy){case"sliding":return Qg(e.bufferSize??16);default:return Gg((e==null?void 0:e.bufferSize)??16)}},kX=(e,t)=>at(EX(t),Mt).pipe(Eo(n=>TQ(LP,r=>e(dX(n,r)))),Ee(n=>{const r=Ne(ko(n),s=>B4(s)?Qc(s)?bn:qt(s.cause):xd(rt(Bt(s)),r));return r}),n_,DX),$X=(e,t)=>v(at(vX(t),n=>Mt(n)),X(n=>v(No(),X(r=>v(e(fX(s=>v(_X(s),X(o=>Ze(n,o)),Ps,K7(r)).then(o=>{if(xa(o)&&!ff(o.cause))throw Ev(o.cause)}))),pt(Si(!1)),X(s=>v(Gi(s),Ee(o=>o?px():v(ko(n),X(gX),iQ(()=>v(Xc(s,!0),pt(Mt(n)))))))))))),yE,ri(l_)),CX=y(2,(e,t)=>{if(t.strategy==="dropping")return TX(e,t.capacity);if(t.strategy==="sliding")return IX(e,t.capacity);const n=rZ(e,t);return new et(n_(Ee(n,r=>{const s=v(Ct(ko(r)),Ne(mx({onEnd:()=>bn,onFailure:qt,onSuccess:o=>v(rt(o),Ne(()=>s))})));return s})))}),TX=y(2,(e,t)=>{const n=at(Gg(t),r=>Mt(r));return new et(_x(n,Ye(e)))}),IX=y(2,(e,t)=>{const n=at(Qg(t),r=>Mt(r));return new et(_x(n,Ye(e)))}),_x=(e,t)=>{const n=(s,o)=>{const a=u=>v(Gi(o),Eo(Vt),pt(Ue()),X(f=>v(Ze(s,[u,f]),pt(Xc(o,f)),pt(Vt(f)))),Ps,Ct);return vr({onInput:u=>v(Ue(),X(f=>v(Ze(s,[yf(u),f]),X(h=>v(Xc(o,f),xP(()=>h))))),Ps,Ct,Ne(()=>n(s,o))),onFailure:u=>a(c_(u)),onDone:()=>a(bf)})},r=s=>{const o=v(Ct(ko(s)),Ne(([a,u])=>xd(Ct(ut(u,void 0)),mx(a,{onEnd:()=>bn,onFailure:qt,onSuccess:f=>v(rt(f),Ne(()=>o))}))));return o};return n_(v(e,X(s=>v(Ue(),Eo(o=>ut(o,void 0)),X(o=>v(Si(o),X(a=>v(t,mn(n(s,a)),UF,Jt)),fo(r(s))))))))},yx=y(2,(e,t)=>new et(v(Ye(e),xd(Ye(t))))),RX=e=>zu(li(e)),Jb=y(2,(e,t)=>new et(v(Ye(e),FF(t)))),OX=y(2,(e,t)=>new et(rE(Ye(e),t))),qX=e=>gE(Hn(W(e))),AX=y(2,(e,t)=>Ex(e,Pp(t))),PX=y(2,(e,t)=>{const n=r=>{const s=r.next();return s.done?vr({onInput:o=>n(o[Symbol.iterator]()),onFailure:qt,onDone:Da}):v(t(s.value),Ee(o=>o?v(rt(ft(s.value)),Ne(()=>n(r))):n(r)),Mr)};return new et(qd(()=>v(Ye(e),mn(n(yt()[Symbol.iterator]())))))}),FX=y(2,(e,t)=>Ex(e,NR(t))),ri=y(e=>Md(e[0]),(e,t,n)=>{const r=(n==null?void 0:n.bufferSize)??16;return n!=null&&n.switch?Gb(n==null?void 0:n.concurrency,()=>H$(e,1,r,t),s=>H$(e,s,r,t)):Gb(n==null?void 0:n.concurrency,()=>new et(Mm(Ye(e),s=>v(s,lc(o=>Ye(t(o))),MU(bn,(o,a)=>v(o,xd(a)))))),s=>new et(v(Ye(e),Mm(r_),MF(o=>Ye(t(o)),n))))}),Gb=(e,t,n)=>{switch(e){case void 0:return t();case"unbounded":return n(Number.MAX_SAFE_INTEGER);default:return e>1?n(e):t()}},H$=y(4,(e,t,n,r)=>new et(v(Ye(e),Mm(r_),MF(s=>Ye(r(s)),{concurrency:t,mergeStrategy:w7(),bufferSize:n})))),u_=y(e=>Md(e[0]),(e,t)=>ri(e,ce,t)),bx=e=>{const t=vr({onInput:n=>Ne(r_(n),()=>t),onFailure:qt,onDone:()=>bn});return new et(v(Ye(e),mn(t)))},xX=e=>{const t=(r,s)=>{const[o,a]=v(r,NU(f=>!Qc(f))),u=v(Fp(a),ot({onNone:()=>s,onSome:Zr({onFailure:f=>ot(vv(f),{onNone:()=>bn,onSome:qt}),onSuccess:()=>bn})}));return v(rt(v(o,NR(f=>Qc(f)?W(f.value):V()))),Ne(()=>u))},n=vr({onInput:r=>t(r,n),onFailure:r=>qt(r),onDone:()=>bn});return new et(v(Ye(e),mn(n)))},NX=e=>v(e,wf(go),bx),Sx=e=>bx(xX(v(e,wf(t=>t.exit)))),DX=e=>new et(e),Ye=e=>{if("channel"in e)return e.channel;if(jr(e))return Ye(zu(e));throw new TypeError("Expected a Stream.")},Qb=e=>new et(ed(e)?bn:rt(e)),zu=e=>v(e,vo(W),gE),gE=e=>new et(Mr(yQ(e,{onFailure:ot({onNone:()=>bn,onSome:Od}),onSuccess:t=>rt(ft(t))}))),wx=(e,t)=>{const n=(t==null?void 0:t.maxChunkSize)??pE;if(t!=null&&t.scoped){const s=Ee(T$(e),o=>Sf(o,{maxChunkSize:n,shutdown:!0}));return t.shutdown?Ee(s,Jb(xm(e))):s}const r=ri(yE(T$(e)),s=>Sf(s,{maxChunkSize:n}));return t!=null&&t.shutdown?Jb(r,xm(e)):r},MX=e=>bE(()=>Wi(e)?Qb(e):LX(e[Symbol.iterator]())),LX=(e,t=pE)=>v(Re(()=>{let n=[];const r=s=>v(Re(()=>{let o=s.next();if(t===1)return o.done?bn:v(rt(ft(o.value)),Ne(()=>r(s)));n=[];let a=0;for(;o.done===!1&&(n.push(o.value),a=a+1,!(a>=t));)o=s.next();return a>0?v(rt(Bt(n)),Ne(()=>r(s))):bn}),Mr);return new et(r(e))}),$x),jX=e=>v(e,Ee(l_),f_),Sf=(e,t)=>v(XP(e,1,(t==null?void 0:t.maxChunkSize)??pE),$s(n=>v(z9(e),X(r=>r&&ff(n)?px():bX(n)))),l_,t!=null&&t.shutdown?Jb(Mt(e)):ce),UX=(...e)=>{const t=e.length===1?e[0].evaluate:e[0],n=e.length===1?e[0].onError:e[1],r=e.length===1?e[0].releaseLockOnEnd===!0:!1;return f_(Ee(at(Re(()=>t().getReader()),s=>r?Re(()=>s.releaseLock()):Mg(()=>s.cancel())),s=>Yb(X(Il({try:()=>s.read(),catch:o=>W(n(o))}),({done:o,value:a})=>o?Hn(V()):Ve(a)))))},vx=(...e)=>MX(e),wf=y(2,(e,t)=>new et(v(Ye(e),t_(lc(t))))),Ex=y(2,(e,t)=>new et(v(Ye(e),t_(t)))),zX=y(2,(e,t)=>new et(v(Ye(e),DF(t)))),Um=y(2,(e,t)=>{const n=r=>{const s=r.next();if(s.done)return vr({onInput:o=>n(o[Symbol.iterator]()),onFailure:qt,onDone:Da});{const o=s.value;return Mr(Ee(t(o),a=>Ne(rt(ft(a)),()=>n(r))))}};return new et(v(Ye(e),mn(qd(()=>n(yt()[Symbol.iterator]())))))}),BX=y(3,(e,t,n)=>new et(v(Ye(e),Mm(r_),O7(n,t),t_(ft)))),HX=y(2,(e,t)=>new et(v(Ye(e),I7(t)))),VX=y(2,(e,t)=>WX(e,t,{onSelf:ae,onOther:le})),WX=y(3,(e,t,n)=>{const r=n.haltStrategy?nY(n.haltStrategy):rY,s=o=>a=>o||!Qc(a)?V7(_t(()=>a)):W7(u=>_t(()=>u));return new et(LF(Ye(wf(e,n.onSelf)),{other:Ye(wf(t,n.onOther)),onSelfDone:s(r._tag==="Either"||r._tag==="Left"),onOtherDone:s(r._tag==="Either"||r._tag==="Right")}))}),KX=zu(Fv),JX=e=>v(e,GX(ce)),GX=y(2,(e,t)=>new et(v(Ye(e),P7(t)))),QX=y(2,(e,t)=>new et(v(Ye(e),Nb(t)))),l_=e=>aZ(e,t=>v(Ee(t,n=>W([n,t])),Lg(ot({onNone:()=>Ve(V()),onSome:Hn})))),Yb=e=>l_(v(e,Ee(ft))),_E=y(2,(e,t)=>Ye(e).pipe(jF(WF(t)),x7)),YX=e=>_E(e,U7()),XX=e=>_E(e,z7),kx=y(2,(e,t)=>_E(e,B7(t))),ZX=y(2,(e,t)=>{const n=vr({onInput:r=>Ne(rt(yf(r)),()=>n),onFailure:r=>rt(c_(r)),onDone:()=>rt(bf)});return v(mn(Ye(e),n),DF(r=>Ze(t,r)),Zg,UF,Ps)}),yE=e=>new et(FF(zF(v(e,Ee(ft))),he)),eZ=e=>new et(BF(t=>e(t).pipe(Ee(ft)))),bE=e=>new et(qd(()=>Ye(e()))),tZ=y(2,(e,t)=>{if(!Number.isInteger(t))return RX(new J8(`${t} must be an integer`));const n=r=>Yg({onInput:s=>{const o=v(s,Nc(Math.min(r,Number.POSITIVE_INFINITY))),a=Math.max(0,r-o.length);return a>0?v(rt(o),Ne(()=>n(a))):rt(o)},onFailure:Od,onDone:Da});return new et(v(Ye(e),jF(0<t?n(t):bn)))}),nZ=y(2,(e,t)=>Um(e,n=>fo(t(n),n))),hy=e=>Ee(N7(Ye(e)),t=>v(t,vo(W),X(un({onLeft:()=>Hn(V()),onRight:Ve})))),rZ=y(e=>Md(e[0]),(e,t)=>Eo(at((t==null?void 0:t.strategy)==="unbounded"?yn():(t==null?void 0:t.strategy)==="dropping"?Gg(t.capacity??2):(t==null?void 0:t.strategy)==="sliding"?Qg(t.capacity??2):ou((t==null?void 0:t.capacity)??2),n=>Mt(n)),n=>Jt(ZX(e,n)))),sZ=y(e=>Md(e[0]),(e,t)=>Ee(No(),n=>oZ(e,n,t))),oZ=y(e=>Md(e[0]),(e,t,n)=>{const r=KF(t);let s,o;const a=wQ(!1);return new ReadableStream({start(u){o=r(kx(e,f=>a.whenOpen(Re(()=>{a.unsafeClose();for(const h of f)u.enqueue(h);s(),s=void 0})))),o.addObserver(f=>{f._tag==="Failure"?u.error(Ev(f.cause)):u.close()})},pull(){return new Promise(u=>{s=u,Cs(a.open)})},cancel(){if(o)return DP(Ps(Dr(o)))}},n==null?void 0:n.strategy)}),iZ=(e,t)=>{const n=r=>ot(t(r),{onNone:()=>bn,onSome:([s,o])=>Ne(rt(s),()=>n(o))});return new et(qd(()=>n(e)))},aZ=(e,t)=>bE(()=>{const n=r=>Mr(Ee(t(r),ot({onNone:()=>bn,onSome:([s,o])=>Ne(rt(s),()=>n(o))})));return new et(n(e))}),$x=e=>u_(zu(e)),f_=e=>u_(yE(e)),cZ=e=>u_(eZ(t=>e(t))),uZ=function(){const e=typeof arguments[0]!="string",t=e?arguments[1]:arguments[0],n=co(e?arguments[2]:arguments[1]);if(e){const r=arguments[0];return new et(N$(Ye(r),t,n))}return r=>new et(N$(Ye(r),t,n))},lZ=y(2,(e,t)=>v(e,fZ(t,(n,r)=>[n,r]))),fZ=y(3,(e,t,n)=>{const r=s=>v(s,X(o=>ed(o)?r(s):Ve(o)));return v(hy(e),Ee(r),Am(v(hy(t),Ee(r))),X(([s,o])=>v(gE(jv(s,o,{onSelfDone:(a,u)=>v(_t(()=>a),su(Om(u),(f,h)=>[f,h,!0])),onOtherDone:(a,u)=>v(_t(()=>a),su(Om(u),(f,h)=>[h,f,!1]))})),ri(([a,u,f])=>v(zu(Si([Ya(a),Ya(u)])),ri(h=>v(Qb(f?v(u,lc(p=>n(Ya(a),p))):v(a,lc(p=>n(p,Ya(u))))),yx(v(Yb(s),VX(Yb(o)),Um(un({onLeft:p=>v(qi(h,([g,k])=>[v(p,lc(T=>n(T,k))),[Ya(p),k]])),onRight:p=>v(qi(h,([g,k])=>[v(p,lc(T=>n(g,T))),[g,Ya(p)]]))})),ri(Qb))))))),hy)),jX)}),dZ=(e,t,n)=>kX(r=>at(Re(()=>e.addEventListener(t,r.single,n)),()=>Re(()=>e.removeEventListener(t,r.single,n))),{bufferSize:typeof n=="object"?n.bufferSize:void 0}),Cx="effect/Redacted",Dh=Te("effect/Redacted/redactedRegistry",()=>new WeakMap),Tx=Symbol.for(Cx),hZ={[Tx]:{_A:e=>e},pipe(){return ee(this,arguments)},toString(){return"<redacted>"},toJSON(){return"<redacted>"},[Be](){return"<redacted>"},[_e](){return v(Q(Cx),fe(Q(Dh.get(this))),ct(this))},[ye](e){return mZ(e)&&me(Dh.get(this),Dh.get(e))}},mZ=e=>ne(e,Tx),pZ=e=>{const t=Object.create(hZ);return Dh.set(t,e),t},V$=Symbol.for("effect/Encoding/errors/Decode"),Mh=(e,t)=>{const n={_tag:"DecodeException",[V$]:V$,input:e};return Pn(t)&&(n.message=t),n},W$=Symbol.for("effect/Encoding/errors/Encode"),gZ=(e,t)=>{const n={_tag:"EncodeException",[W$]:W$,input:e};return Pn(t)&&(n.message=t),n},_Z=new TextEncoder,K$=e=>{const t=e.length;let n="",r;for(r=2;r<t;r+=3)n+=Ws[e[r-2]>>2],n+=Ws[(e[r-2]&3)<<4|e[r-1]>>4],n+=Ws[(e[r-1]&15)<<2|e[r]>>6],n+=Ws[e[r]&63];return r===t+1&&(n+=Ws[e[r-2]>>2],n+=Ws[(e[r-2]&3)<<4],n+="=="),r===t&&(n+=Ws[e[r-2]>>2],n+=Ws[(e[r-2]&3)<<4|e[r-1]>>4],n+=Ws[(e[r-1]&15)<<2],n+="="),n},yZ=e=>{const t=bZ(e),n=t.length;if(n%4!==0)return ae(Mh(t,`Length must be a multiple of 4, but is ${n}`));const r=t.indexOf("=");if(r!==-1&&(r<n-2||r===n-2&&t[n-1]!=="="))return ae(Mh(t,"Found a '=' character, but it is not at the end"));try{const s=t.endsWith("==")?2:t.endsWith("=")?1:0,o=new Uint8Array(3*(n/4)-s);for(let a=0,u=0;a<n;a+=4,u+=3){const f=ah(t.charCodeAt(a))<<18|ah(t.charCodeAt(a+1))<<12|ah(t.charCodeAt(a+2))<<6|ah(t.charCodeAt(a+3));o[u]=f>>16,o[u+1]=f>>8&255,o[u+2]=f&255}return le(o)}catch(s){return ae(Mh(t,s instanceof Error?s.message:"Invalid input"))}},bZ=e=>e.replace(/[\n\r]/g,"");function ah(e){if(e>=J$.length)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);const t=J$[e];if(t===255)throw new TypeError(`Invalid character ${String.fromCharCode(e)}`);return t}const Ws=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],J$=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],SZ=e=>K$(typeof e=="string"?_Z.encode(e):e),wZ=e=>yZ(e),vZ=e=>VS({try:()=>encodeURIComponent(e),catch:t=>$Z(e,t instanceof Error?t.message:"Invalid input")}),EZ=e=>VS({try:()=>decodeURIComponent(e),catch:t=>kZ(e,t instanceof Error?t.message:"Invalid input")}),kZ=Mh,$Z=gZ,Xb=Symbol.for("effect/FiberHandle"),CZ=e=>ne(e,Xb),TZ={[Xb]:Xb,toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberHandle",state:this.state}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},IZ=e=>{const t=Object.create(TZ);return t.state={_tag:"Open",fiber:void 0},t.deferred=e,t},Ix=()=>at(Ee(Ue(),e=>IZ(e)),e=>As(t=>{const n=e.state;return n._tag==="Closed"?he:(e.state={_tag:"Closed"},n.fiber?Id(Ps(xg(n.fiber,gr(t.id(),Rl))),e.deferred):Fa(e.deferred,tr))})),Rx=-1,Rl=yw(Rx,0),RZ=kv(void 0,{emptyCase:Yn,failCase:Yn,dieCase:Yn,interruptCase:(e,t)=>Hp(Kp(t),Rx),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),OZ=y(e=>CZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(gr((n==null?void 0:n.interruptAs)??zn,Rl));return}else if(e.state.fiber!==void 0){if((n==null?void 0:n.onlyIfMissing)===!0){t.unsafeInterruptAsFork(gr((n==null?void 0:n.interruptAs)??zn,Rl));return}else if(e.state.fiber===t)return;e.state.fiber.unsafeInterruptAsFork(gr((n==null?void 0:n.interruptAs)??zn,Rl)),e.state.fiber=void 0}e.state.fiber=t,t.addObserver(r=>{e.state._tag==="Open"&&t===e.state.fiber&&(e.state.fiber=void 0),xa(r)&&((n==null?void 0:n.propagateInterruption)===!0?!RZ(r.cause):!lo(r.cause))&&Di(e.deferred,r)})}),qZ=e=>fi(t=>As(n=>e.state._tag==="Closed"||e.state.fiber===void 0?he:pt(t(xg(e.state.fiber,gr(n.id(),Rl))),Re(()=>{e.state._tag==="Open"&&(e.state.fiber=void 0)})))),AZ=(function(){let e;return()=>(e===void 0&&(e=Do(ms)),e)})(),zm=function(){const e=arguments[0];if(jr(arguments[1]))return G$(e,arguments[1],arguments[2]);const t=arguments[1];return n=>G$(e,n,t)},G$=(e,t,n)=>Mv(r=>e.state._tag==="Closed"?ms:e.state.fiber!==void 0&&(n==null?void 0:n.onlyIfMissing)===!0?Re(AZ):Eo(Lv(t),s=>OZ(e,s,{...n,interruptAs:r}))),Zb=Symbol.for("effect/FiberMap"),PZ=e=>ne(e,Zb),FZ={[Zb]:Zb,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},xZ=(e,t)=>{const n=Object.create(FZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},NZ=()=>at(Ee(Ue(),e=>xZ(aq(),e)),e=>As(t=>{const n=e.state;return n._tag==="Closed"?he:(e.state={_tag:"Closed"},hP(xL(n.backing,([,r])=>r),gr(t.id(),Ol)).pipe(Id(e.deferred)))})),Ox=-1,Ol=yw(Ox,0),DZ=kv(void 0,{emptyCase:Yn,failCase:Yn,dieCase:Yn,interruptCase:(e,t)=>Hp(Kp(t),Ox),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),MZ=y(e=>PZ(e[0]),(e,t,n,r)=>{if(e.state._tag==="Closed"){n.unsafeInterruptAsFork(gr((r==null?void 0:r.interruptAs)??zn,Ol));return}const s=hs(e.state.backing,t);if(s._tag==="Some"){if((r==null?void 0:r.onlyIfMissing)===!0){n.unsafeInterruptAsFork(gr((r==null?void 0:r.interruptAs)??zn,Ol));return}else if(s.value===n)return;s.value.unsafeInterruptAsFork(gr((r==null?void 0:r.interruptAs)??zn,Ol))}sc(e.state.backing,t,n),n.addObserver(o=>{if(e.state._tag==="Closed")return;const a=hs(e.state.backing,t);lt(a)&&n===a.value&&X4(e.state.backing,t),xa(o)&&((r==null?void 0:r.propagateInterruption)===!0?!DZ(o.cause):!lo(o.cause))&&Di(e.deferred,o)})}),LZ=y(2,(e,t)=>e.state._tag==="Closed"?!1:rc(e.state.backing,t)),my=y(2,(e,t)=>As(n=>{if(e.state._tag==="Closed")return he;const r=hs(e.state.backing,t);return r._tag==="None"?he:xg(r.value,gr(n.id(),Ol))})),jZ=(function(){let e;return()=>(e===void 0&&(e=Do(ms)),e)})(),py=function(){const e=arguments[0];if(jr(arguments[2]))return Q$(e,arguments[1],arguments[2],arguments[3]);const t=arguments[1],n=arguments[2];return r=>Q$(e,t,r,n)},Q$=(e,t,n,r)=>Mv(s=>e.state._tag==="Closed"?ms:(r==null?void 0:r.onlyIfMissing)===!0&&LZ(e,t)?Re(jZ):Eo(Lv(n),o=>MZ(e,t,o,{...r,interruptAs:s}))),eS=Symbol.for("effect/FiberSet"),UZ=e=>ne(e,eS),zZ={[eS]:eS,[Symbol.iterator](){return this.state._tag==="Closed"?q1():this.state.backing[Symbol.iterator]()},toString(){return dt(this.toJSON())},toJSON(){return{_id:"FiberMap",state:this.state}},[Be](){return this.toJSON()},pipe(){return ee(this,arguments)}},BZ=(e,t)=>{const n=Object.create(zZ);return n.state={_tag:"Open",backing:e},n.deferred=t,n},HZ=()=>at(Ee(Ue(),e=>BZ(new Set,e)),e=>As(t=>{const n=e.state;if(n._tag==="Closed")return he;e.state={_tag:"Closed"};const r=n.backing;return hP(r,gr(t.id(),Ax)).pipe(Id(e.deferred))})),qx=-1,Ax=yw(qx,0),VZ=kv(void 0,{emptyCase:Yn,failCase:Yn,dieCase:Yn,interruptCase:(e,t)=>Hp(Kp(t),qx),sequentialCase:(e,t,n)=>t||n,parallelCase:(e,t,n)=>t||n}),Y$=y(e=>UZ(e[0]),(e,t,n)=>{if(e.state._tag==="Closed"){t.unsafeInterruptAsFork(gr((n==null?void 0:n.interruptAs)??zn,Ax));return}else if(e.state.backing.has(t))return;e.state.backing.add(t),t.addObserver(r=>{e.state._tag!=="Closed"&&(e.state.backing.delete(t),xa(r)&&((n==null?void 0:n.propagateInterruption)===!0?!VZ(r.cause):!lo(r.cause))&&Di(e.deferred,r))})}),WZ="effect/GroupBy",Px=Symbol.for(WZ),KZ={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},JZ=e=>ne(e,Px),GZ=y(e=>JZ(e[0]),(e,t,n)=>ri(e.grouped,([r,s])=>t(r,Sx(Sf(s,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:(n==null?void 0:n.bufferSize)??16})),QZ=e=>({[Px]:KZ,pipe(){return ee(this,arguments)},grouped:e}),YZ=y(e=>typeof e[0]!="function",(e,t,n)=>n!=null&&n.key?GZ(XZ(e,n.key,{bufferSize:n.bufferSize}),(r,s)=>Um(s,t)):Gb(n==null?void 0:n.concurrency,()=>Um(e,t),r=>n!=null&&n.unordered?ri(e,s=>zu(t(s)),{concurrency:r}):BX(e,r,t))),XZ=y(e=>typeof e[0]!="function",(e,t,n)=>{const r=(s,o)=>vr({onInput:a=>Ne(Ct($n(ZZ(a,t),([u,f])=>{const h=s.get(u);return h===void 0?v(ou((n==null?void 0:n.bufferSize)??16),X(p=>v(Re(()=>{s.set(u,p)}),pt(Ze(o,yX([u,p]))),pt(v(Ze(p,yf(f)),sy(g=>lo(g)?W(he):V())))))):sy(Ze(h,yf(f)),p=>lo(p)?W(he):V())},{discard:!0})),()=>r(s,o)),onFailure:a=>Ct(Ze(o,c_(a))),onDone:()=>v(Ct(v($n(s.entries(),([a,u])=>v(Ze(u,bf),sy(f=>lo(f)?W(he):V())),{discard:!0}),pt(Ze(o,bf)))))});return QZ(cZ(s=>z(function*(){const o=new Map,a=yield*yn();return yield*ni(s,Mt(a)),yield*Ye(e).pipe(mn(r(o,a)),Zg,oE(s),_r(s),fo(Sx(Sf(a,{shutdown:!0}))))})))}),ZZ=y(2,(e,t)=>{const n=[],r=e[Symbol.iterator](),s=new Map;let o;for(;(o=r.next())&&!o.done;){const a=o.value,u=t(a);if(s.has(u))s.get(u).push(a);else{const f=[a];n.push([u,f]),s.set(u,f)}}return Bt(n.map(a=>[a[0],Bt(a[1])]))});class En{constructor(t,n,r){d(this,"path");d(this,"actual");d(this,"issue");d(this,"_tag","Pointer");this.path=t,this.actual=n,this.issue=r}}class X${constructor(t,n){d(this,"actual");d(this,"message");d(this,"_tag","Unexpected");this.actual=t,this.message=n}}class ol{constructor(t,n){d(this,"ast");d(this,"message");d(this,"_tag","Missing");d(this,"actual");this.ast=t,this.message=n}}class Ut{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"issues");d(this,"output");d(this,"_tag","Composite");this.ast=t,this.actual=n,this.issues=r,this.output=s}}class gy{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Refinement");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class _y{constructor(t,n,r,s){d(this,"ast");d(this,"actual");d(this,"kind");d(this,"issue");d(this,"_tag","Transformation");this.ast=t,this.actual=n,this.kind=r,this.issue=s}}class Yt{constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Type");this.ast=t,this.actual=n,this.message=r}}class Z${constructor(t,n,r){d(this,"ast");d(this,"actual");d(this,"message");d(this,"_tag","Forbidden");this.ast=t,this.actual=n,this.message=r}}const eC=Symbol.for("effect/Schema/ParseErrorTypeId");var xI;class eee extends TJ("ParseError"){constructor(){super(...arguments);d(this,xI,eC)}get message(){return this.toString()}toString(){return Al.formatIssueSync(this.issue)}toJSON(){return{_id:"ParseError",message:this.toString()}}[(xI=eC,Be)](){return this.toJSON()}}const Bu=e=>new eee({issue:e}),es=le,Hu=ae,tC=VS,Ln=T1,Xo=y(2,(e,t)=>Ln(e)?un(e,{onLeft:ae,onRight:t}):X(e,t)),dr=y(2,(e,t)=>Ln(e)?pL(e,t):Ee(e,t)),ql=y(2,(e,t)=>Ln(e)?ia(e,t):vo(e,t)),tee=y(2,(e,t)=>Ln(e)?mL(e,{onLeft:t.onFailure,onRight:t.onSuccess}):AP(e,t)),Fx=y(2,(e,t)=>Ln(e)?un(e,{onLeft:t,onRight:le}):Lg(e,t)),d_=(e,t)=>t===void 0||mo(t)?e:e===void 0?t:{...e,...t},h_=(e,t,n)=>{const r=gn(e,t);return(s,o)=>r(s,d_(n,o))},SE=(e,t,n)=>{const r=h_(e,t,n);return(s,o)=>I1(r(s,o),Bu)},xx=(e,t,n)=>{const r=gn(e,t);return(s,o)=>r(s,{...d_(n,o),isEffectAllowed:!0})},Bm=(e,t)=>SE(e.ast,!0,t),nee=(e,t)=>h_(e.ast,!0,t),Ld=(e,t)=>xx(e.ast,!0,t),Nx=(e,t)=>SE(e.ast,!1,t),ree=(e,t)=>h_(e.ast,!1,t),Vu=(e,t)=>xx(e.ast,!1,t),wE=Bm,see=Ld,m_=(e,t)=>SE(Dt(e.ast),!0,t),oee=(e,t)=>h_(Dt(e.ast),!0,t),On=(e,t)=>{const n=gn(Dt(e.ast),!0);return(r,s)=>bs(n(r,{exact:!0,...d_(t,s)}))},ws=Nx,iee=Vu,aee=Te(Symbol.for("effect/ParseResult/decodeMemoMap"),()=>new WeakMap),cee=Te(Symbol.for("effect/ParseResult/encodeMemoMap"),()=>new WeakMap),gn=(e,t)=>{const n=t?aee:cee,r=n.get(e);if(r)return r;const s=uee(e,t),o=$j(e),a=lt(o)?(h,p)=>s(h,d_(p,o.value)):s,u=Cj(e),f=t&&lt(u)?(h,p)=>_l(Fx(a(h,p),u.value),e,h,p):a;return n.set(e,f),f},yy=e=>hr(vj(e)),by=e=>hr(Ej(e)),uee=(e,t)=>{switch(e._tag){case"Refinement":if(t){const n=gn(e.from,!0);return(r,s)=>{s=s??W_;const o=(s==null?void 0:s.errors)==="all",a=Xo(Fx(n(r,s),u=>{const f=new gy(e,r,"From",u);return o&&Ij(e)&&jx(u)?ot(e.filter(r,s,e),{onNone:()=>ae(f),onSome:h=>ae(new Ut(e,r,[f,new gy(e,r,"Predicate",h)]))}):ae(f)}),u=>ot(e.filter(u,s,e),{onNone:()=>le(u),onSome:f=>ae(new gy(e,r,"Predicate",f))}));return _l(a,e,r,s)}}else{const n=gn(Dt(e),!0),r=gn(Dx(e.from),!1);return(s,o)=>_l(Xo(n(s,o),a=>r(a,o)),e,s,o)}case"Transformation":{const n=dee(e.transformation,t),r=t?gn(e.from,!0):gn(e.to,!1),s=t?gn(e.to,!0):gn(e.from,!1);return(o,a)=>_l(Xo(ql(r(o,a),u=>new _y(e,o,t?"Encoded":"Type",u)),u=>Xo(ql(n(u,a??W_,e,o),f=>new _y(e,o,"Transformation",f)),f=>ql(s(f,a),h=>new _y(e,o,t?"Type":"Encoded",h)))),e,o,a)}case"Declaration":{const n=t?e.decodeUnknown(...e.typeParameters):e.encodeUnknown(...e.typeParameters);return(r,s)=>_l(n(r,s??W_,e),e,r,s)}case"Literal":return ar(e,n=>n===e.literal);case"UniqueSymbol":return ar(e,n=>n===e.symbol);case"UndefinedKeyword":return ar(e,AM);case"NeverKeyword":return ar(e,PM);case"UnknownKeyword":case"AnyKeyword":case"VoidKeyword":return le;case"StringKeyword":return ar(e,Pn);case"NumberKeyword":return ar(e,mo);case"BooleanKeyword":return ar(e,na);case"BigIntKeyword":return ar(e,_p);case"SymbolKeyword":return ar(e,Kh);case"ObjectKeyword":return ar(e,Ls);case"Enums":return ar(e,n=>e.enums.some(([r,s])=>s===n));case"TemplateLiteral":{const n=ER(e);return ar(e,r=>Pn(r)&&n.test(r))}case"TupleType":{const n=e.elements.map(h=>gn(h.type,t)),r=e.rest.map(h=>gn(h.type,t));let s=e.elements.filter(h=>!h.isOptional);e.rest.length>0&&(s=s.concat(e.rest.slice(1)));const o=s.length,a=e.elements.length>0?e.elements.map((h,p)=>p).join(" | "):"never",u=yy(e),f=by(e);return(h,p)=>{if(!zL(h))return ae(new Yt(e,h));const g=(p==null?void 0:p.errors)==="all",k=[];let T=0;const O=[],L=h.length;for(let C=L;C<=o-1;C++){const $=new En(C,h,new ol(s[C-L]));if(g){k.push([T++,$]);continue}else return ae(new Ut(e,h,$,O))}if(e.rest.length===0)for(let C=e.elements.length;C<=L-1;C++){const $=new En(C,h,new X$(h[C],`is unexpected, expected: ${a}`));if(g){k.push([T++,$]);continue}else return ae(new Ut(e,h,$,O))}let E=0,S;for(;E<n.length;E++)if(L<E+1){if(e.elements[E].isOptional)continue}else{const C=n[E],$=C(h[E],p);if(Ln($)){if(on($)){const q=new En(E,h,$.left);if(g){k.push([T++,q]);continue}else return ae(new Ut(e,h,q,Wr(O)))}O.push([T++,$.right])}else{const q=T++,P=E;S||(S=[]),S.push(({es:N,output:M})=>X(Oi($),B=>{if(on(B)){const F=new En(P,h,B.left);return g?(N.push([q,F]),he):ae(new Ut(e,h,F,Wr(M)))}return M.push([q,B.right]),he}))}}if(bt(r)){const[C,...$]=r;for(;E<L-$.length;E++){const q=C(h[E],p);if(Ln(q))if(on(q)){const P=new En(E,h,q.left);if(g){k.push([T++,P]);continue}else return ae(new Ut(e,h,P,Wr(O)))}else O.push([T++,q.right]);else{const P=T++,N=E;S||(S=[]),S.push(({es:M,output:B})=>X(Oi(q),F=>{if(on(F)){const j=new En(N,h,F.left);return g?(M.push([P,j]),he):ae(new Ut(e,h,j,Wr(B)))}else return B.push([P,F.right]),he}))}}for(let q=0;q<$.length;q++)if(E+=q,!(L<E+1)){const P=$[q](h[E],p);if(Ln(P)){if(on(P)){const N=new En(E,h,P.left);if(g){k.push([T++,N]);continue}else return ae(new Ut(e,h,N,Wr(O)))}O.push([T++,P.right])}else{const N=T++,M=E;S||(S=[]),S.push(({es:B,output:F})=>X(Oi(P),j=>{if(on(j)){const Z=new En(M,h,j.left);return g?(B.push([N,Z]),he):ae(new Ut(e,h,Z,Wr(F)))}return F.push([N,j.right]),he}))}}}const _=({es:C,output:$})=>Sh(C)?ae(new Ut(e,h,Wr(C),Wr($))):le(Wr($));if(S&&S.length>0){const C=S;return _t(()=>{const $={es:fl(k),output:fl(O)};return X($n(C,q=>q($),{concurrency:u,batching:f,discard:!0}),()=>_($))})}return _({output:O,es:k})}}case"TypeLiteral":{if(e.propertySignatures.length===0&&e.indexSignatures.length===0)return ar(e,FM);const n=[],r={},s=[];for(const p of e.propertySignatures)n.push([gn(p.type,t),p]),r[p.name]=null,s.push(p.name);const o=e.indexSignatures.map(p=>[gn(p.parameter,t),gn(p.type,t),p.parameter]),a=an.make(e.indexSignatures.map(p=>p.parameter).concat(s.map(p=>Kh(p)?new mR(p):new nm(p)))),u=gn(a,t),f=yy(e),h=by(e);return(p,g)=>{if(!NM(p))return ae(new Yt(e,p));const k=(g==null?void 0:g.errors)==="all",T=[];let O=0;const L=(g==null?void 0:g.onExcessProperty)==="error",E=(g==null?void 0:g.onExcessProperty)==="preserve",S={};let _;if(L||E){_=Es(p);for(const P of _){const N=u(P,g);if(Ln(N)&&on(N))if(L){const M=new En(P,p,new X$(p[P],`is unexpected, expected: ${String(a)}`));if(k){T.push([O++,M]);continue}else return ae(new Ut(e,p,M,S))}else S[P]=p[P]}}let C;const $=(g==null?void 0:g.exact)===!0;for(let P=0;P<n.length;P++){const N=n[P][1],M=N.name,B=Object.prototype.hasOwnProperty.call(p,M);if(!B){if(N.isOptional)continue;if($){const Z=new En(M,p,new ol(N));if(k){T.push([O++,Z]);continue}else return ae(new Ut(e,p,Z,S))}}const F=n[P][0],j=F(p[M],g);if(Ln(j)){if(on(j)){const Z=new En(M,p,B?j.left:new ol(N));if(k){T.push([O++,Z]);continue}else return ae(new Ut(e,p,Z,S))}S[M]=j.right}else{const Z=O++,we=M;C||(C=[]),C.push(({es:G,output:ke})=>X(Oi(j),qe=>{if(on(qe)){const We=new En(we,p,B?qe.left:new ol(N));return k?(G.push([Z,We]),he):ae(new Ut(e,p,We,ke))}return ke[we]=qe.right,he}))}}for(let P=0;P<o.length;P++){const N=o[P],M=N[0],B=N[1],F=H1(p,N[2]);for(const j of F){const Z=M(j,g);if(Ln(Z)&&bs(Z)){const we=B(p[j],g);if(Ln(we))if(on(we)){const G=new En(j,p,we.left);if(k){T.push([O++,G]);continue}else return ae(new Ut(e,p,G,S))}else Object.prototype.hasOwnProperty.call(r,j)||(S[j]=we.right);else{const G=O++,ke=j;C||(C=[]),C.push(({es:qe,output:We})=>X(Oi(we),tt=>{if(on(tt)){const Ke=new En(ke,p,tt.left);return k?(qe.push([G,Ke]),he):ae(new Ut(e,p,Ke,We))}else return Object.prototype.hasOwnProperty.call(r,j)||(We[j]=tt.right),he}))}}}}const q=({es:P,output:N})=>{if(Sh(P))return ae(new Ut(e,p,Wr(P),N));if((g==null?void 0:g.propertyOrder)==="original"){const M=_||Es(p);for(const F of s)M.indexOf(F)===-1&&M.push(F);const B={};for(const F of M)Object.prototype.hasOwnProperty.call(N,F)&&(B[F]=N[F]);return le(B)}return le(N)};if(C&&C.length>0){const P=C;return _t(()=>{const N={es:fl(T),output:Object.assign({},S)};return X($n(P,M=>M(N),{concurrency:f,batching:h,discard:!0}),()=>q(N))})}return q({es:T,output:S})}}case"Union":{const n=lee(e.types,t),r=Es(n.keys),s=r.length,o=e.types.length,a=new Map;for(let h=0;h<o;h++)a.set(e.types[h],gn(e.types[h],t));const u=yy(e)??1,f=by(e);return(h,p)=>{const g=[];let k=0,T=[];if(s>0)if(DS(h))for(let E=0;E<s;E++){const S=r[E],_=n.keys[S].buckets;if(Object.prototype.hasOwnProperty.call(h,S)){const C=String(h[S]);if(Object.prototype.hasOwnProperty.call(_,C))T=T.concat(_[C]);else{const{candidates:$,literals:q}=n.keys[S],P=an.make(q),N=$.length===o?new Nr([new Nt(S,P,!1,!0)],[]):an.make($);g.push([k++,new Ut(N,h,new En(S,h,new Yt(P,h[S])))])}}else{const{candidates:C,literals:$}=n.keys[S],q=new Nt(S,an.make($),!1,!0),P=C.length===o?new Nr([q],[]):an.make(C);g.push([k++,new Ut(P,h,new En(S,h,new ol(q)))])}}else{const E=n.candidates.length===o?e:an.make(n.candidates);g.push([k++,new Yt(E,h)])}n.otherwise.length>0&&(T=T.concat(n.otherwise));let O;for(let E=0;E<T.length;E++){const S=T[E],_=a.get(S)(h,p);if(Ln(_)&&(!O||O.length===0)){if(bs(_))return _;g.push([k++,_.left])}else{const C=k++;O||(O=[]),O.push($=>_t(()=>"finalResult"in $?he:X(Oi(_),q=>(bs(q)?$.finalResult=q:$.es.push([C,q.left]),he))))}}const L=E=>Sh(E)?E.length===1&&E[0][1]._tag==="Type"?ae(E[0][1]):ae(new Ut(e,h,Wr(E))):ae(new Yt(e,h));if(O&&O.length>0){const E=O;return _t(()=>{const S={es:fl(g)};return X($n(E,_=>_(S),{concurrency:u,batching:f,discard:!0}),()=>"finalResult"in S?S.finalResult:L(S.es))})}return L(g)}}case"Suspend":{const n=V1(()=>gn(ua(e.f(),e.annotations),t));return(r,s)=>n()(r,s)}}},ar=(e,t)=>n=>t(n)?le(n):ae(new Yt(e,n)),gl=(e,t)=>{switch(e._tag){case"Declaration":{const n=gu(e);if(lt(n))return gl(n.value,t);break}case"TypeLiteral":{const n=[];for(let r=0;r<e.propertySignatures.length;r++){const s=e.propertySignatures[r],o=t?zy(s.type):Dt(s.type);Cl(o)&&!s.isOptional&&n.push([s.name,o])}return n}case"TupleType":{const n=[];for(let r=0;r<e.elements.length;r++){const s=e.elements[r],o=t?zy(s.type):Dt(s.type);Cl(o)&&!s.isOptional&&n.push([r,o])}return n}case"Refinement":return gl(e.from,t);case"Suspend":return gl(e.f(),t);case"Transformation":return gl(t?e.from:e.to,t)}return[]},lee=(e,t)=>{const n={},r=[],s=[];for(let o=0;o<e.length;o++){const a=e[o],u=gl(a,t);if(u.length>0){s.push(a);for(let f=0;f<u.length;f++){const[h,p]=u[f],g=String(p.literal);n[h]=n[h]||{buckets:{},literals:[],candidates:[]};const k=n[h].buckets;if(Object.prototype.hasOwnProperty.call(k,g)){if(f<u.length-1)continue;k[g].push(a),n[h].literals.push(p),n[h].candidates.push(a)}else{k[g]=[a],n[h].literals.push(p),n[h].candidates.push(a);break}}}else r.push(a)}return{keys:n,otherwise:r,candidates:s}},Dx=e=>Sc(e)?Dx(e.from):e,_l=(e,t,n,r)=>{if((r==null?void 0:r.isEffectAllowed)===!0||Ln(e))return e;const s=new oA,o=Do(e,{scheduler:s});s.flush();const a=o.unsafePoll();if(a){if(Qc(a))return le(a.value);const u=a.cause;return zA(u)?ae(u.error):ae(new Z$(t,n,Tm(u)))}return ae(new Z$(t,n,"cannot be be resolved synchronously, this is caused by using runSync on an effect that performs async work"))},fee=([e],[t])=>e>t?1:e<t?-1:0;function Wr(e){return e.sort(fee).map(t=>t[1])}const dee=(e,t)=>{switch(e._tag){case"FinalTransformation":return t?e.decode:e.encode;case"ComposeTransformation":return le;case"TypeLiteralTransformation":return n=>{let r=le(n);for(const s of e.propertySignatureTransformations){const[o,a]=t?[s.from,s.to]:[s.to,s.from],u=t?s.decode:s.encode;r=dr(r,h=>{const p=u(Object.prototype.hasOwnProperty.call(h,o)?W(h[o]):V());return delete h[o],lt(p)&&(h[a]=p.value),h})}return r}}},Dn=(e,t=[])=>({value:e,forest:t}),Al={formatIssue:e=>dr(ac(e),hee),formatIssueSync:e=>{const t=Al.formatIssue(e);return Ln(t)?_L(t):Cs(t)},formatError:e=>Al.formatIssue(e.issue),formatErrorSync:e=>Al.formatIssueSync(e.issue)},hee=e=>e.value+Mx(`
`,e.forest),Mx=(e,t)=>{let n="";const r=t.length;let s;for(let o=0;o<r;o++){s=t[o];const a=o===r-1;n+=e+(a?"":"")+" "+s.value,n+=Mx(e+(r>1&&!a?"  ":"   "),s.forest)}return n},mee=e=>{switch(e){case"Encoded":return"Encoded side transformation failure";case"Transformation":return"Transformation process failure";case"Type":return"Type side transformation failure"}},pee=e=>{switch(e){case"From":return"From side refinement failure";case"Predicate":return"Predicate refinement failure"}},Lx=e=>"ast"in e?W(e.ast):V(),tS=le(void 0),gee=e=>Lx(e).pipe(pu(Sj),ot({onNone:()=>tS,onSome:t=>{const n=t(e);return Pn(n)?le({message:n,override:!1}):jr(n)?Ee(n,r=>({message:r,override:!1})):Pn(n.message)?le({message:n.message,override:n.override}):Ee(n.message,r=>({message:r,override:n.override}))}})),vE=e=>t=>t._tag===e,jx=vE("Composite"),nC=vE("Refinement"),rC=vE("Transformation"),Pl=e=>Xo(gee(e),t=>t!==void 0?!t.override&&(jx(e)||nC(e)&&e.kind==="From"||rC(e)&&e.kind!=="Transformation")?rC(e)||nC(e)?Pl(e.issue):tS:le(t.message):tS),Ux=e=>Lx(e).pipe(pu(kj),EL(t=>t(e)),hr);function _ee(e){return hR(e).pipe(ro(()=>fR(e)),ro(()=>dR(e)),ro(()=>Cp(e)),Et(()=>`{ ${e.from} | filter }`))}function yee(e){return e.message!==void 0?e.message:`Expected ${Sc(e.ast)?_ee(e.ast):String(e.ast)}, actual ${xr(e.actual)}`}const bee=e=>dr(Pl(e),t=>t??Ux(e)??yee(e)),ch=e=>Ux(e)??String(e.ast),See=e=>e.message??"is forbidden",wee=e=>e.message??"is unexpected",vee=e=>{const t=wj(e.ast);if(lt(t)){const n=t.value();return Pn(n)?le(n):n}return le(e.message??"is missing")},ac=e=>{switch(e._tag){case"Type":return dr(bee(e),Dn);case"Forbidden":return le(Dn(ch(e),[Dn(See(e))]));case"Unexpected":return le(Dn(wee(e)));case"Missing":return dr(vee(e),Dn);case"Transformation":return Xo(Pl(e),t=>t!==void 0?le(Dn(t)):dr(ac(e.issue),n=>Dn(ch(e),[Dn(mee(e.kind),[n])])));case"Refinement":return Xo(Pl(e),t=>t!==void 0?le(Dn(t)):dr(ac(e.issue),n=>Dn(ch(e),[Dn(pee(e.kind),[n])])));case"Pointer":return dr(ac(e.issue),t=>Dn(J1(e.path),[t]));case"Composite":return Xo(Pl(e),t=>{if(t!==void 0)return le(Dn(t));const n=ch(e);return K1(e.issues)?dr($n(e.issues,ac),r=>Dn(n,r)):dr(ac(e.issues),r=>Dn(n,[r]))})}},Eee=xQ,kee=AQ,$ee=PA,Cee=MW,Tee=FA,sC=Symbol.for("effect/Mailbox"),oC=Symbol.for("effect/Mailbox/ReadonlyMailbox"),Fi=yt(),iC=Ge(Fi),uh=Ge(!1),lh=Ge(!0),aC=[Fi,!0];var NI,DI;class Iee extends Po{constructor(n,r,s){super();d(this,"scheduler");d(this,"capacity");d(this,"strategy");d(this,DI,sC);d(this,NI,oC);d(this,"state",{_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set});d(this,"messages",[]);d(this,"messagesChunk",yt());d(this,"shutdown",K(()=>{if(this.state._tag==="Done")return!0;this.messages=[],this.messagesChunk=Fi;const n=this.state.offers;if(this.finalize(this.state._tag==="Open"?qn:this.state.exit),n.size>0){for(const r of n)r._tag==="Single"?r.resume(uh):r.resume(Ge(Bt(r.remaining.slice(r.offset))));n.clear()}return!0}));d(this,"end",this.done(qn));d(this,"clear",pe(()=>{if(this.state._tag==="Done")return Ih(this.state.exit,Fi);const n=this.unsafeTakeAll();return this.releaseCapacity(),J(n)}));d(this,"takeAll",pe(()=>{if(this.state._tag==="Done")return Ih(this.state.exit,aC);const n=this.unsafeTakeAll();return n.length===0?It(this.awaitTake,this.takeAll):J([n,this.releaseCapacity()])}));d(this,"take",pe(()=>this.unsafeTake()??It(this.awaitTake,this.take)));d(this,"await",Go(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.awaiters.add(n),K(()=>{this.state._tag!=="Done"&&this.state.awaiters.delete(n)}))));d(this,"size",K(()=>this.unsafeSize()));d(this,"awaitTake",Go(n=>this.state._tag==="Done"?n(this.state.exit):(this.state.takers.add(n),K(()=>{this.state._tag!=="Done"&&this.state.takers.delete(n)}))));d(this,"scheduleRunning",!1);d(this,"releaseTaker",()=>{if(this.scheduleRunning=!1,this.state._tag==="Done")return;if(this.state.takers.size===0)return;const n=qL(this.state.takers);this.state.takers.delete(n),n(qn)});this.scheduler=n,this.capacity=r,this.strategy=s}offer(n){return pe(()=>{if(this.state._tag!=="Open")return uh;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return uh;case"suspend":return this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),lh):this.offerRemainingSingle(n);case"sliding":return this.unsafeTake(),this.messages.push(n),lh}return this.messages.push(n),this.scheduleReleaseTaker(),lh})}unsafeOffer(n){return this.state._tag!=="Open"?!1:this.messages.length+this.messagesChunk.length>=this.capacity?this.strategy==="sliding"?(this.unsafeTake(),this.messages.push(n),!0):this.capacity<=0&&this.state.takers.size>0?(this.messages.push(n),this.releaseTaker(),!0):!1:(this.messages.push(n),this.scheduleReleaseTaker(),!0)}offerAll(n){return pe(()=>{if(this.state._tag!=="Open")return J(go(n));const r=this.unsafeOfferAllArray(n);return r.length===0?iC:this.strategy==="dropping"?J(Bt(r)):this.offerRemainingArray(r)})}unsafeOfferAll(n){return Bt(this.unsafeOfferAllArray(n))}unsafeOfferAllArray(n){if(this.state._tag!=="Open")return ze(n);if(this.capacity===Number.POSITIVE_INFINITY||this.strategy==="sliding")return this.messages.length>0&&(this.messagesChunk=Rt(this.messagesChunk,Bt(this.messages))),this.strategy==="sliding"?this.messagesChunk=this.messagesChunk.pipe(Rt(go(n)),DU(this.capacity)):Wi(n)?this.messagesChunk=Rt(this.messagesChunk,n):this.messages=ze(n),this.scheduleReleaseTaker(),[];const r=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(r===0)return ze(n);const s=[];let o=0;for(const a of n)o<r?this.messages.push(a):s.push(a),o++;return this.scheduleReleaseTaker(),s}fail(n){return this.done(ef(n))}failCause(n){return this.done(st(n))}unsafeDone(n){return this.state._tag!=="Open"?!1:this.state.offers.size===0&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(n),!0):(this.state={...this.state,_tag:"Closing",exit:n},!0)}done(n){return K(()=>this.unsafeDone(n))}takeN(n){return pe(()=>{if(this.state._tag==="Done")return Ih(this.state.exit,aC);if(n<=0)return J([Fi,!1]);n=Math.min(n,this.capacity);let r;if(n<=this.messagesChunk.length)r=Nc(this.messagesChunk,n),this.messagesChunk=Ys(this.messagesChunk,n);else if(n<=this.messages.length+this.messagesChunk.length)this.messagesChunk=Rt(this.messagesChunk,Bt(this.messages)),this.messages=[],r=Nc(this.messagesChunk,n),this.messagesChunk=Ys(this.messagesChunk,n);else return It(this.awaitTake,this.takeN(n));return J([r,this.releaseCapacity()])})}unsafeTake(){if(this.state._tag==="Done")return nq(this.state.exit,ef(new Pg));let n;if(this.messagesChunk.length>0)n=xp(this.messagesChunk),this.messagesChunk=Ys(this.messagesChunk,1);else if(this.messages.length>0)n=this.messages[0],this.messagesChunk=Ys(Bt(this.messages),1),this.messages=[];else return this.capacity<=0&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?Ge(this.messages.pop()):void 0):void 0;return this.releaseCapacity(),Ge(n)}unsafeSize(){const n=this.messages.length+this.messagesChunk.length;return this.state._tag==="Done"?V():W(n)}commit(){return this.takeAll}pipe(){return ee(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return dt(this)}[(DI=sC,NI=oC,Be)](){return dt(this)}offerRemainingSingle(n){return Go(r=>{if(this.state._tag!=="Open")return r(uh);const s={_tag:"Single",message:n,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}offerRemainingArray(n){return Go(r=>{if(this.state._tag!=="Open")return r(Ge(Bt(n)));const s={_tag:"Array",remaining:n,offset:0,resume:r};return this.state.offers.add(s),K(()=>{this.state._tag==="Open"&&this.state.offers.delete(s)})})}releaseCapacity(){if(this.state._tag==="Done")return this.state.exit._tag==="Success";if(this.state.offers.size===0)return this.state._tag==="Closing"&&this.messages.length===0&&this.messagesChunk.length===0?(this.finalize(this.state.exit),this.state.exit._tag==="Success"):!1;let n=this.capacity-this.messages.length-this.messagesChunk.length;for(const r of this.state.offers){if(n===0)return!1;if(r._tag==="Single")this.messages.push(r.message),n--,r.resume(lh),this.state.offers.delete(r);else{for(;r.offset<r.remaining.length;r.offset++){if(n===0)return!1;this.messages.push(r.remaining[r.offset]),n--}r.resume(iC),this.state.offers.delete(r)}}return!1}scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}unsafeTakeAll(){if(this.messagesChunk.length>0){const n=this.messages.length>0?Rt(this.messagesChunk,Bt(this.messages)):this.messagesChunk;return this.messagesChunk=Fi,this.messages=[],n}else if(this.messages.length>0){const n=Bt(this.messages);return this.messages=[],n}else if(this.state._tag!=="Done"&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,ft(this.messages.pop());return Fi}finalize(n){if(this.state._tag==="Done")return;const r=this.state;this.state={_tag:"Done",exit:n};for(const s of r.takers)s(n);r.takers.clear();for(const s of r.awaiters)s(n);r.awaiters.clear()}}const Ree=e=>Fe(t=>J(new Iee(t.currentScheduler,typeof e=="number"?e:(e==null?void 0:e.capacity)??Number.POSITIVE_INFINITY,typeof e=="number"?"suspend":(e==null?void 0:e.strategy)??"suspend"))),Oee=Ree,qee=Symbol.for("@effect/matcher/Matcher"),Aee={[qee]:{_input:ce,_filters:ce,_result:ce,_return:ce},_tag:"ValueMatcher",add(e){return this.value._tag==="Right"?this:e._tag==="When"&&e.guard(this.provided)===!0?nS(this.provided,le(e.evaluate(this.provided))):e._tag==="Not"&&e.guard(this.provided)===!1?nS(this.provided,le(e.evaluate(this.provided))):this},pipe(){return ee(this,arguments)}};function nS(e,t){const n=Object.create(Aee);return n.provided=e,n.value=t,n}const zx=(e,t)=>({_tag:"When",guard:e,evaluate:t}),rS=e=>{if(typeof e=="function")return e;if(Array.isArray(e)){const t=e.map(rS),n=t.length;return r=>{if(!Array.isArray(r))return!1;for(let s=0;s<n;s++)if(t[s](r[s])===!1)return!1;return!0}}else if(e!==null&&typeof e=="object"){const t=Object.entries(e).map(([r,s])=>[r,rS(s)]),n=t.length;return r=>{if(typeof r!="object"||r===null)return!1;for(let s=0;s<n;s++){const[o,a]=t[s];if(!(o in r)||a(r[o])===!1)return!1}return!0}}return t=>t===e},Pee=e=>nS(e,ae(e)),Fee=(e,t)=>n=>n.add(zx(rS(e),t)),xee=e=>(...t)=>{const n=t[t.length-1],r=t.slice(0,-1),s=r.length===1?o=>o[e]===r[0]:o=>r.includes(o[e]);return o=>o.add(zx(s,n))},Nee=xee("_tag"),Dee=e=>{if(e._tag==="ValueMatcher")return e.value;const t=e.cases.length;if(t===1){const n=e.cases[0];return r=>n._tag==="When"&&n.guard(r)===!0||n._tag==="Not"&&n.guard(r)===!1?le(n.evaluate(r)):ae(r)}return n=>{for(let r=0;r<t;r++){const s=e.cases[r];if(s._tag==="When"&&s.guard(n)===!0)return le(s.evaluate(n));if(s._tag==="Not"&&s.guard(n)===!1)return le(s.evaluate(n))}return ae(n)}},cC="effect/Match/exhaustive: absurd",Mee=e=>{const t=Dee(e);if(T1(t)){if(t._tag==="Right")return t.right;throw new Error(cC)}return n=>{const r=t(n);if(r._tag==="Right")return r.right;throw new Error(cC)}},Bx=Pee,Sy=Fee,wy=Nee,Hx=Mee,uC=pZ,Vx=LY,Lee=ic,jee=y(e=>Ls(e[0]),(e,...t)=>{const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}),Uee=y(e=>Ls(e[0]),(e,...t)=>{const n={...e};for(const r of t)delete n[r];return n}),iu=Symbol.for("effect/Schema");function it(e){var t,n,r;return n=iu,t=iu,r=class{constructor(){d(this,n,sS)}static annotations(o){return it(is(this.ast,o))}static pipe(){return ee(this,arguments)}static toString(){return String(e)}},d(r,"ast",e),d(r,"Type"),d(r,"Encoded"),d(r,"Context"),d(r,t,sS),r}const sS={_A:e=>e,_I:e=>e,_R:e=>e},lC={schemaId:_j,message:X1,missingMessage:QS,identifier:YS,title:js,description:Gf,examples:Z1,default:eR,documentation:yj,jsonSchema:tR,arbitrary:nR,pretty:rR,equivalence:sR,concurrency:oR,batching:iR,parseIssueTitle:aR,parseOptions:cR,decodingFallback:uR},wi=e=>{if(!e)return{};const t={...e};for(const n in lC)if(n in e){const r=lC[n];t[r]=e[n],delete t[n]}return t},is=(e,t)=>ua(e,wi(t));const jd=e=>String(e.ast),EE=e=>it(zy(e.ast)),Fs=e=>it(Dt(e.ast)),Wx=(e,t)=>{const n=Vu(e,t);return(r,s)=>ql(n(r,s),Bu)},zee=(e,t)=>{const n=ree(e,t);return(r,s)=>ia(n(r,s),Bu)},Wu=Wx,Kx=zee,au=(e,t)=>{const n=Ld(e,t);return(r,s)=>ql(n(r,s),Bu)},Jx=(e,t)=>{const n=nee(e,t);return(r,s)=>ia(n(r,s),Bu)},Bee=au,p_=Jx,Hee=(e,t)=>{const n=oee(e,t);return(r,s)=>ia(n(r,s),Bu)},ss=e=>ne(e,iu)&&Ls(e[iu]);function Vee(e){return XS(e)?an.make(Jj(e,t=>new nm(t))):new nm(e[0])}function Gx(e,t=Vee(e)){var n;return n=class extends it(t){static annotations(s){return Gx(this.literals,is(this.ast,s))}},d(n,"literals",[...e]),n}function oe(...e){return bt(e)?Gx(e):g_}const Wee=e=>it(new mR(e)),Kee=(e,t,n)=>kE(e,new Ip(e.map(r=>r.ast),(...r)=>t.decode(...r.map(it)),(...r)=>t.encode(...r.map(it)),wi(n))),Jee=(e,t)=>{const n=()=>(s,o,a)=>e(s)?es(s):Hu(new Yt(a,s)),r=n;return kE([],new Ip([],n,r,wi(t)))};function kE(e,t){var n;return n=class extends it(t){static annotations(s){return kE(this.typeParameters,is(this.ast,s))}},d(n,"typeParameters",[...e]),n}const Ma=function(){if(Array.isArray(arguments[0])){const n=arguments[0],r=arguments[1],s=arguments[2];return Kee(n,r,s)}const e=arguments[0],t=arguments[1];return Jee(e,t)},fC=Symbol.for("effect/SchemaId/Brand"),Qx=(e,t)=>n=>IE(n,new Xf(n.ast,function(o,a,u){const f=e.either(o);return on(f)?W(new Yt(u,o,f.left.map(h=>h.message).join(", "))):V()},wi({schemaId:fC,[fC]:{constructor:e},...t})));class Yx extends it(xc){}class vs extends it(xj){}class lr extends it(Aj){}class g_ extends it(Rp){}class oS extends it(pR){}class Sn extends it(gR){}class D extends it(Dy){}class je extends it(Ly){}class Ea extends it(jy){}const Gee=e=>an.make(e.map(t=>t.ast));function Xx(e,t=Gee(e)){var n;return n=class extends it(t){static annotations(s){return Xx(this.members,is(this.ast,s))}},d(n,"members",[...e]),n}function ie(...e){return XS(e)?Xx(e):bt(e)?e[0]:g_}const Zx=e=>ie(e,lr),__=e=>ie(e,Yx),Qee=(e,t)=>new Yf(e.map(n=>ss(n)?new pi(n.ast,!1):n.ast),t.map(n=>ss(n)?new Qf(n.ast):n.ast),!0);function Hm(e,t,n=Qee(e,t)){var r;return r=class extends it(n){static annotations(o){return Hm(this.elements,this.rest,is(this.ast,o))}},d(r,"elements",[...e]),d(r,"rest",[...t]),r}function Yee(...e){return Array.isArray(e[0])?Hm(e[0],e.slice(1)):Hm(e,[])}function eN(e,t){var n;return n=class extends Hm([],[e],t){static annotations(s){return eN(this.value,is(this.ast,s))}},d(n,"value",e),n}const Me=e=>eN(e),iS=e=>e?'"?:"':'":"';class y_ extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");d(this,"_tag","PropertySignatureDeclaration");this.isReadonly=s,this.defaultValue=a}toString(){const n=iS(this.isOptional),r=String(this.type);return`PropertySignature<${n}, ${r}, never, ${n}, ${r}>`}}class Xee extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"fromKey");this.isReadonly=s,this.fromKey=a}}class Vm extends pi{constructor(n,r,s,o,a){super(n,r,o);d(this,"isReadonly");d(this,"defaultValue");this.isReadonly=s,this.defaultValue=a}}const Zee=e=>e===void 0?"never":Pn(e)?JSON.stringify(e):String(e);class Wm{constructor(t,n,r,s){d(this,"from");d(this,"to");d(this,"decode");d(this,"encode");d(this,"_tag","PropertySignatureTransformation");this.from=t,this.to=n,this.decode=r,this.encode=s}toString(){return`PropertySignature<${iS(this.to.isOptional)}, ${this.to.type}, ${Zee(this.from.fromKey)}, ${iS(this.from.isOptional)}, ${this.from.type}>`}}const tN=(e,t)=>{switch(e._tag){case"PropertySignatureDeclaration":return new y_(e.type,e.isOptional,e.isReadonly,{...e.annotations,...t},e.defaultValue);case"PropertySignatureTransformation":return new Wm(e.from,new Vm(e.to.type,e.to.isOptional,e.to.isReadonly,{...e.to.annotations,...t},e.to.defaultValue),e.decode,e.encode)}},nN=Symbol.for("effect/PropertySignature"),$E=e=>ne(e,nN);var MI,LI;LI=iu,MI=nN;const S0=class S0{constructor(t){d(this,"ast");d(this,LI);d(this,MI,null);d(this,"_TypeToken");d(this,"_Key");d(this,"_EncodedToken");d(this,"_HasDefault");this.ast=t}pipe(){return ee(this,arguments)}annotations(t){return new S0(tN(this.ast,wi(t)))}toString(){return String(this.ast)}};let Km=S0;const Jm=e=>new Km(e);class b_ extends Km{constructor(n,r){super(n);d(this,"from");this.from=r}annotations(n){return new b_(tN(this.ast,wi(n)),this.from)}}const rN=e=>new b_(new y_(e.ast,!1,!0,{},void 0),e),CE=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":return Jm(new y_(n.type,n.isOptional,n.isReadonly,n.annotations,t));case"PropertySignatureTransformation":return Jm(new Wm(n.from,new Vm(n.to.type,n.to.isOptional,n.to.isReadonly,n.to.annotations,t),n.decode,n.encode))}}),dC=(e,t)=>ot(e,{onNone:()=>W(t()),onSome:n=>W(n===void 0?t():n)}),Gm=e=>aU(e,Gm,t=>{const n=Gm(t.to);if(n)return new qr(t.from,n,t.transformation)}),ete=y(2,(e,t)=>{const n=e.ast;switch(n._tag){case"PropertySignatureDeclaration":{const r=Dt(n.type);return Jm(new Wm(new Xee(n.type,n.isOptional,n.isReadonly,n.annotations),new Vm(Gm(r)??r,!1,!0,{},n.defaultValue),s=>dC(s,t),ce))}case"PropertySignatureTransformation":{const r=n.to.type;return Jm(new Wm(n.from,new Vm(Gm(r)??r,!1,n.to.isReadonly,n.to.annotations,n.to.defaultValue),s=>dC(n.decode(s),t),n.encode))}}}),sN=y(2,(e,t)=>e.pipe(ete(t.decoding),CE(t.constructor))),be=e=>{const t=e.ast===xc||e.ast===Rp?xc:__(e).ast;return new b_(new y_(t,!0,!0,{},void 0),e)},tte=$R([QS]),nte=(e,t)=>{const n=Es(e),r=[];if(n.length>0){const o=[],a=[],u=[];for(let f=0;f<n.length;f++){const h=n[f],p=e[h];if($E(p)){const g=p.ast;switch(g._tag){case"PropertySignatureDeclaration":{const k=g.type,T=g.isOptional,O=g.annotations;o.push(new Nt(h,k,T,!0,tte(g))),a.push(new Nt(h,Dt(k),T,!0,O)),r.push(new Nt(h,k,T,!0,O));break}case"PropertySignatureTransformation":{const k=g.from.fromKey??h;o.push(new Nt(k,g.from.type,g.from.isOptional,!0,g.from.annotations)),a.push(new Nt(h,g.to.type,g.to.isOptional,!0,g.to.annotations)),u.push(new Xj(k,h,g.decode,g.encode));break}}}else o.push(new Nt(h,p.ast,!1,!0)),a.push(new Nt(h,Dt(p.ast),!1,!0)),r.push(new Nt(h,p.ast,!1,!0))}if(bt(u)){const f=[],h=[];for(const p of t){const{indexSignatures:g,propertySignatures:k}=ak(p.key.ast,p.value.ast);k.forEach(T=>{o.push(T),a.push(new Nt(T.name,Dt(T.type),T.isOptional,T.isReadonly,T.annotations))}),g.forEach(T=>{f.push(T),h.push(new _u(T.parameter,Dt(T.type),T.isReadonly))})}return new qr(new Nr(o,f,{[bc]:"Struct (Encoded side)"}),new Nr(a,h,{[bc]:"Struct (Type side)"}),new rm(u))}}const s=[];for(const o of t){const{indexSignatures:a,propertySignatures:u}=ak(o.key.ast,o.value.ast);u.forEach(f=>r.push(f)),a.forEach(f=>s.push(f))}return new Nr(r,s)},oN=(e,t)=>{const n=Es(e);for(const r of n){const s=e[r];if(t[r]===void 0&&$E(s)){const o=s.ast,a=o._tag==="PropertySignatureDeclaration"?o.defaultValue:o.to.defaultValue;a!==void 0&&(t[r]=a())}}return t};function TE(e,t,n=nte(e,t)){var r;return r=class extends it(n){static annotations(o){return TE(this.fields,this.records,is(this.ast,o))}static pick(...o){return Y(jee(e,...o))}static omit(...o){return Y(Uee(e,...o))}},d(r,"fields",{...e}),d(r,"records",[...t]),d(r,"make",(o,a)=>{const u=oN(e,{...o});return v_(a)?u:m_(r)(u)}),r}function Y(e,...t){return TE(e,t)}const rte=e=>oe(e).pipe(rN,CE(()=>e)),ge=(e,t)=>Y({_tag:rte(e),...t});function iN(e,t,n){var r;return r=class extends TE({},[{key:e,value:t}],n){static annotations(o){return iN(e,t,is(this.ast,o))}},d(r,"key",e),d(r,"value",t),r}const Ku=e=>iN(e.key,e.value),vf=(...e)=>t=>it(Ks(t.ast,e)),cu=y(2,(e,t)=>{const n=Ni(Dt(e.ast),t),r=it(n.isOptional?kh(n.type):n.type);return Er(e.pipe(vf(t)),r,{strict:!0,decode:o=>o[t],encode:o=>n.isOptional&&o===void 0?{}:{[t]:o}})});function IE(e,t){var n;return n=class extends it(t){static annotations(s){return IE(this.from,is(this.ast,s))}},d(n,"make",(s,o)=>v_(o)?s:m_(n)(s)),d(n,"from",e),n}const ste=(e,t)=>n=>{const r=ot(lR(n.ast),{onNone:()=>[e],onSome:o=>[...o,e]}),s=ua(n.ast,wi({[Y1]:r,...t}));return IE(n,s)},Qm=e=>it(dl(e.ast)),ote=e=>it(nc(e.ast)),il=(e,t,n)=>{if(ik(e)&&ik(t)){const r=[...e.propertySignatures];for(const s of t.propertySignatures){const o=s.name,a=r.findIndex(u=>u.name===o);if(a===-1)r.push(s);else{const{isOptional:u,type:f}=r[a];r[a]=new Nt(o,Ym(f,s.type,n.concat(o)),u,!0)}}return new Nr(r,e.indexSignatures.concat(t.indexSignatures))}throw new Error(G1(e,t,n))},ite=rU([YS]),al=(e,t)=>t.map(n=>new Xf(n,e.filter,ite(e))),Ym=(e,t,n)=>an.make(Js([e],[t],n)),$i=e=>ZS(e)?e.types:[e],Js=(e,t,n)=>Zh(e,r=>Zh(t,s=>{switch(s._tag){case"Literal":{if(Pn(s.literal)&&My(r)||mo(s.literal)&&rk(r)||na(s.literal)&&sk(r))return[s];break}case"StringKeyword":{if(s===Dy){if(My(r)||Cl(r)&&Pn(r.literal))return[r];if(Sc(r))return al(r,Js($i(r.from),[s],n))}else if(r===Dy)return[s];break}case"NumberKeyword":{if(s===Ly){if(rk(r)||Cl(r)&&mo(r.literal))return[r];if(Sc(r))return al(r,Js($i(r.from),[s],n))}else if(r===Ly)return[s];break}case"BooleanKeyword":{if(s===jy){if(sk(r)||Cl(r)&&na(r.literal))return[r];if(Sc(r))return al(r,Js($i(r.from),[s],n))}else if(r===jy)return[s];break}case"Union":return Js($i(r),s.types,n);case"Suspend":return[new ca(()=>Ym(r,s.f(),n))];case"Refinement":return al(s,Js($i(r),$i(s.from),n));case"TypeLiteral":{switch(r._tag){case"Union":return Js(r.types,[s],n);case"Suspend":return[new ca(()=>Ym(r.f(),s,n))];case"Refinement":return al(r,Js($i(r.from),[s],n));case"TypeLiteral":return[il(r,s,n)];case"Transformation":{const o=r.transformation,a=il(r.from,s,n),u=il(r.to,Dt(s),n);switch(o._tag){case"TypeLiteralTransformation":return[new qr(a,u,new rm(o.propertySignatureTransformations))];case"ComposeTransformation":return[new qr(a,u,ew)];case"FinalTransformation":return[new qr(a,u,new SR((f,h,p,g)=>dr(o.decode(f,h,p,g),k=>({...f,...k})),(f,h,p,g)=>dr(o.encode(f,h,p,g),k=>({...f,...k}))))]}}}break}case"Transformation":{if(Gj(r)){if(Uy(s.transformation)&&Uy(r.transformation))return[new qr(il(r.from,s.from,n),il(r.to,s.to,n),new rm(s.transformation.propertySignatureTransformations.concat(r.transformation.propertySignatureTransformations)))]}else return Js([s],[r],n);break}}throw new Error(G1(r,s,n))})),aN=y(2,(e,t)=>it(Ym(e.ast,t.ast,[]))),cN=y(e=>ss(e[1]),(e,t)=>RE(e,t,oU(e.ast,t.ast))),Ef=e=>it(new ca(()=>e().ast)),uN=Symbol.for("effect/SchemaId/Refine");function lN(e,t,n){var r,s,o;return o=class extends(s=it(n),r=uN,s){static annotations(u){return lN(this.from,this.filter,is(this.ast,u))}},d(o,r,e),d(o,"from",e),d(o,"filter",t),d(o,"make",(u,f)=>v_(f)?u:m_(o)(u)),o}const hC=(e,t,n)=>{if(na(e))return e?V():W(new Yt(t,n));if(Pn(e))return W(new Yt(t,n,e));if(e!==void 0){if("_tag"in e)return W(e);const r=new Yt(t,n,e.message);return W(bt(e.path)?new En(e.path,n,r):r)}return V()},ate=(e,t,n)=>{if(aj(e))return hC(e,t,n);if(bt(e)){const r=U1(e,s=>hC(s,t,n));if(bt(r))return W(r.length===1?r[0]:new Ut(t,n,r))}return V()};function S_(e,t){return n=>{function r(o,a,u){return ate(e(o,a,u),u,o)}const s=new Xf(n.ast,r,wi(t));return lN(n,r,s)}}function RE(e,t,n){var r;return r=class extends it(n){static annotations(o){return RE(this.from,this.to,is(this.ast,o))}},d(r,"from",e),d(r,"to",t),r}const $o=y(e=>ss(e[0])&&ss(e[1]),(e,t,n)=>RE(e,t,new qr(e.ast,t.ast,new SR(n.decode,n.encode)))),Er=y(e=>ss(e[0])&&ss(e[1]),(e,t,n)=>$o(e,t,{strict:!0,decode:(r,s,o,a)=>es(n.decode(r,a)),encode:(r,s,o,a)=>es(n.encode(r,a))})),cte=y(2,(e,t)=>e.annotations(t)),mC=e=>e instanceof Error?e.message:String(e),ute=e=>$o(D.annotations({description:"a string to be decoded into JSON"}),oS,{strict:!0,decode:(t,n,r)=>tC({try:()=>JSON.parse(t,e==null?void 0:e.reviver),catch:s=>new Yt(r,t,mC(s))}),encode:(t,n,r)=>tC({try:()=>JSON.stringify(t,e==null?void 0:e.replacer,e==null?void 0:e.space),catch:s=>new Yt(r,t,mC(s))})}).annotations({title:"parseJson",schemaId:qj}),xs=(e,t)=>ss(e)?cN(xs(t),e):ute(e),lte=mj,fte=(e,t)=>n=>n.pipe(S_(r=>r>=e,{schemaId:lte,title:`greaterThanOrEqualTo(${e})`,description:"a non-negative number",jsonSchema:{minimum:e},...t})),dte=pj,hte=e=>t=>t.pipe(S_(n=>Number.isSafeInteger(n),{schemaId:dte,title:"int",description:"an integer",jsonSchema:{type:"integer"},...e})),mte=gj,pte=(e,t,n)=>r=>r.pipe(S_(s=>s>=e&&s<=t,{schemaId:mte,title:`between(${e}, ${t})`,description:`a number between ${e} and ${t}`,jsonSchema:{minimum:e,maximum:t},...n})),gte=e=>fte(0,{title:"nonNegative",...e});class Xm extends je.pipe(hte({identifier:"Int"})){}class _te extends je.pipe(gte({identifier:"NonNegative"})){}const OE=(e,t,n,r)=>tee(e,{onFailure:s=>new Ut(n,r,s),onSuccess:t});class yte extends Ma(sw,{identifier:"DurationFromSelf",pretty:()=>String,arbitrary:()=>t=>t.oneof(t.constant(jR),t.bigInt({min:0n}).map(n=>$h(n)),t.maxSafeNat().map(n=>fa(n))),equivalence:()=>BR}){}class bte extends Er(_te.annotations({description:"a non-negative number to be decoded into a Duration"}),yte,{strict:!0,decode:t=>fa(t),encode:t=>Dc(t)}).annotations({identifier:"DurationFromMillis"}){}class w_ extends Ma(xM,{identifier:"Uint8ArrayFromSelf",pretty:()=>t=>`new Uint8Array(${JSON.stringify(Array.from(t))})`,arbitrary:()=>t=>t.uint8Array(),equivalence:()=>Jf(me)}){}class Ste extends je.pipe(pte(0,255,{identifier:"Uint8",description:"a 8-bit unsigned integer"})){}class fN extends Er(Me(Ste).annotations({description:"an array of 8-bit unsigned integers to be decoded into a Uint8Array"}),w_,{strict:!0,decode:t=>Uint8Array.from(t),encode:t=>Array.from(t)}).annotations({identifier:"Uint8Array"}){}const wte=(e,t,n)=>$o(D.annotations({description:"a string to be decoded into a Uint8Array"}),w_,{strict:!0,decode:(r,s,o)=>ia(t(r),a=>new Yt(o,r,a.message)),encode:r=>es(n(r))}).annotations({identifier:e}),vte=wte("Uint8ArrayFromBase64",wZ,SZ),Ete=$o(D.annotations({description:"A string that is interpreted as being UriComponent-encoded and will be decoded into a UTF-8 string"}),D,{strict:!0,decode:(e,t,n)=>ia(EZ(e),r=>new Yt(n,e,r.message)),encode:(e,t,n)=>ia(vZ(e),r=>new Yt(n,e,r.message))}).annotations({identifier:"StringFromUriComponent"}),dN=e=>it(Eh(e.ast));function kte(e){return Er(e,mN(dN(Fs(e))),{strict:!1,decode:t=>yc(t),encode:t=>ot(t,{onNone:()=>[],onSome:fr})})}const yl=y(e=>ss(e[0]),(e,t)=>$o(e,dN(Fs(e)),{strict:!0,decode:(n,r,s)=>n.length>0?es(n[0]):t?es(t()):Hu(new Yt(s,n,"Unable to retrieve the first element of an empty array")),encode:n=>es(fr(n))})),pC=Symbol.for("effect/SchemaId/ValidDate"),$te=e=>t=>t.pipe(S_(n=>!Number.isNaN(n.getTime()),{schemaId:pC,[pC]:{noInvalidDate:!0},title:"validDate",description:"a valid Date",...e})),gC=hj;class qE extends Ma(a1,{identifier:"DateFromSelf",schemaId:gC,[gC]:{noInvalidDate:!1},description:"a potentially invalid Date instance",pretty:()=>t=>`new Date(${JSON.stringify(t)})`,arbitrary:()=>t=>t.date({noInvalidDate:!1}),equivalence:()=>IM}){}class Cte extends Er(D.annotations({description:"a string to be decoded into a Date"}),qE,{strict:!0,decode:t=>new Date(t),encode:t=>W1(t)}).annotations({identifier:"DateFromString"}){}class Gt extends Cte.pipe($te({identifier:"Date"})){}class sn extends Er(je.annotations({description:"a number to be decoded into a Date"}),qE,{strict:!0,decode:t=>new Date(t),encode:t=>t.getTime()}).annotations({identifier:"DateFromNumber"}){}const Tte=Y({_tag:oe("None")}).annotations({description:"NoneEncoded"}),Ite=e=>Y({_tag:oe("Some"),value:e}).annotations({description:`SomeEncoded<${jd(e)}>`}),Rte=e=>ie(Tte,Ite(e)).annotations({description:`OptionEncoded<${jd(e)}>`}),hN=e=>e._tag==="None"?V():W(e.value),Ote=(e,t)=>n=>n.oneof(t,n.record({_tag:n.constant("None")}),n.record({_tag:n.constant("Some"),value:e(n)})).map(hN),qte=e=>ot({onNone:()=>"none()",onSome:t=>`some(${e(t)})`}),_C=e=>(t,n,r)=>SL(t)?Ft(t)?es(V()):OE(e(t.value,n),W,r,t):Hu(new Yt(r,t)),mN=e=>Ma([e],{decode:t=>_C(Ld(t)),encode:t=>_C(Vu(t))},{description:`Option<${jd(e)}>`,pretty:qte,arbitrary:Ote,equivalence:$L}),Ate={_tag:"None"},Pte=e=>({_tag:"Some",value:e});function Zi(e){const t=e;return Er(Rte(t),mN(Fs(t)),{strict:!0,decode:r=>hN(r),encode:r=>ot(r,{onNone:()=>Ate,onSome:Pte})})}const Fte=(e,t)=>n=>{const r=n.array(e(n));return(t.depthIdentifier!==void 0?n.oneof(t,n.constant([]),r):r).map(s=>new Set(s))},xte=e=>t=>`new Set([${Array.from(t.values()).map(n=>e(n)).join(", ")}])`,Nte=e=>{const t=Jf(e);return Bf((n,r)=>t(Array.from(n.values()),Array.from(r.values())))},yC=e=>(t,n,r)=>qM(t)?OE(e(Array.from(t.values()),n),s=>new Set(s),r,t):Hu(new Yt(r,t)),Dte=(e,t)=>Ma([e],{decode:n=>yC(Ld(Me(n))),encode:n=>yC(Vu(Me(n)))},{description:t,pretty:xte,arbitrary:Fte,equivalence:Nte}),Mte=e=>Dte(e,`ReadonlySet<${jd(e)}>`);function Lte(e){return Er(Me(e),Mte(Fs(e)),{strict:!0,decode:t=>new Set(t),encode:t=>Array.from(t)})}const jte=e=>ss(e)||$E(e),pN=e=>Es(e).every(t=>jte(e[t])),AE=e=>"fields"in e?e.fields:AE(e[uN]),PE=e=>pN(e)?Y(e):ss(e)?e:Y(AE(e)),FE=e=>pN(e)?e:AE(e),La=e=>(t,n)=>qc({kind:"Class",identifier:e,schema:PE(t),fields:FE(t),Base:CJ,annotations:n}),gN=e=>CE(rN(oe(e)),()=>e),Ur=e=>(t,n,r)=>{class s extends Ov{}s.prototype.name=t;const o=FE(n),a=PE(n),u={_tag:gN(t)},f=Fl(u,o),h="message"in f;class p extends qc({kind:"TaggedError",identifier:t,schema:aN(a,Y(u)),fields:f,Base:s,annotations:r,disableToString:!0}){}return d(p,"_tag",t),h||Object.defineProperty(p.prototype,"message",{get(){return`{ ${Es(o).map(g=>`${GS(g)}: ${xr(this[g])}`).join(", ")} }`},enumerable:!1,configurable:!0}),p},Fl=(e,t)=>{const n={...e};for(const r of Es(t)){if(r in e)throw new Error(Q1(r));n[r]=t[r]}return n};function v_(e){return na(e)?e:(e==null?void 0:e.disableValidation)??!1}const bC=Te("effect/Schema/astCache",()=>new WeakMap),Ute=e=>e===void 0?[]:Array.isArray(e)?e:[e],qc=({Base:e,annotations:t,disableToString:n,fields:r,identifier:s,kind:o,schema:a})=>{var C,$;const u=Symbol.for(`effect/Schema/${o}/${s}`),[f,h,p]=Ute(t),g=Fs(a),k=g.annotations({identifier:s,...f}),T=g.annotations({[bc]:`${s} (Type side)`,...f}),O=a.annotations({[bc]:`${s} (Constructor)`,...f}),L=a.annotations({[bc]:`${s} (Encoded side)`,...p}),E=a.annotations({[Tp]:s,...p,...f,...h}),S=q=>ne(q,u)&&On(T)(q),_=($=class extends e{constructor(q={},P=!1){q={...q},o!=="Class"&&delete q._tag,q=oN(r,q),v_(P)||(q=m_(O)(q)),super(q,!0)}static get ast(){let q=bC.get(this);if(q)return q;const P=Ma([a],{decode:()=>(N,M,B)=>N instanceof this||S(N)?es(N):Hu(new Yt(B,N)),encode:()=>(N,M)=>N instanceof this?es(N):dr(Vu(T)(N,M),B=>new this(B,!0))},{identifier:s,pretty:N=>M=>`${s}(${N(M)})`,arbitrary:N=>M=>N(M).map(B=>new this(B)),equivalence:ce,[tm]:k.ast,...f});return q=Er(L,P,{strict:!0,decode:N=>new this(N,!0),encode:ce}).annotations({[tm]:E.ast,...h}).ast,bC.set(this,q),q}static pipe(){return ee(this,arguments)}static annotations(q){return it(this.ast).annotations(q)}static toString(){return`(${String(L)} <-> ${s})`}static make(...q){return new this(...q)}static extend(q){return(P,N)=>{const M=FE(P),B=PE(P),F=Fl(r,M);return qc({kind:o,identifier:q,schema:aN(a,B),fields:F,Base:this,annotations:N})}}static transformOrFail(q){return(P,N,M)=>{const B=Fl(r,P);return qc({kind:o,identifier:q,schema:$o(a,Fs(Y(B)),N),fields:B,Base:this,annotations:M})}}static transformOrFailFrom(q){return(P,N,M)=>{const B=Fl(r,P);return qc({kind:o,identifier:q,schema:$o(EE(a),Y(B),N),fields:B,Base:this,annotations:M})}}get[(C=iu,u)](){return u}},d($,C,sS),d($,"fields",{...r}),d($,"identifier",s),$);return n!==!0&&Object.defineProperty(_.prototype,"toString",{value(){return`${s}({ ${Es(r).map(q=>`${GS(q)}: ${xr(this[q])}`).join(", ")} })`},configurable:!0,writable:!0}),_},zte=Y({_tag:oe("None")}).annotations({identifier:"FiberIdNoneEncoded"}),Bte=Y({_tag:oe("Runtime"),id:Xm,startTimeMillis:Xm}).annotations({identifier:"FiberIdRuntimeEncoded"}),Hte=Y({_tag:oe("Composite"),left:Ef(()=>aS),right:Ef(()=>aS)}).annotations({identifier:"FiberIdCompositeEncoded"}),aS=ie(zte,Bte,Hte).annotations({identifier:"FiberIdEncoded"}),Vte=e=>e.letrec(t=>({None:e.record({_tag:e.constant("None")}),Runtime:e.record({_tag:e.constant("Runtime"),id:e.integer(),startTimeMillis:e.integer()}),Composite:e.record({_tag:e.constant("Composite"),left:t("FiberId"),right:t("FiberId")}),FiberId:e.oneof(t("None"),t("Runtime"),t("Composite"))})).FiberId.map(Zm),cS=e=>{switch(e._tag){case"None":return"FiberId.none";case"Runtime":return`FiberId.runtime(${e.id}, ${e.startTimeMillis})`;case"Composite":return`FiberId.composite(${cS(e.right)}, ${cS(e.left)})`}},Zm=e=>{switch(e._tag){case"None":return zn;case"Runtime":return Bz(e.id,e.startTimeMillis);case"Composite":return Hz(Zm(e.left),Zm(e.right))}},Wte=e=>Y({_tag:oe("Die"),defect:e}),Kte=Y({_tag:oe("Empty")}),Jte=e=>Y({_tag:oe("Fail"),error:e}),Gte=Y({_tag:oe("Interrupt"),fiberId:aS});let Qte=0;const uS=(e,t)=>{const n=e,r=t,s=Ef(()=>o),o=ie(Kte,Jte(n),Wte(r),Gte,Y({_tag:oe("Sequential"),left:s,right:s}),Y({_tag:oe("Parallel"),left:s,right:s})).annotations({title:`CauseEncoded<${jd(e)}>`,[Tp]:`CauseEncoded${Qte++}`});return o},Yte=(e,t)=>n=>n.letrec(r=>({Empty:n.record({_tag:n.constant("Empty")}),Fail:n.record({_tag:n.constant("Fail"),error:e(n)}),Die:n.record({_tag:n.constant("Die"),defect:t(n)}),Interrupt:n.record({_tag:n.constant("Interrupt"),fiberId:Vte(n)}),Sequential:n.record({_tag:n.constant("Sequential"),left:r("Cause"),right:r("Cause")}),Parallel:n.record({_tag:n.constant("Parallel"),left:r("Cause"),right:r("Cause")}),Cause:n.oneof(r("Empty"),r("Fail"),r("Die"),r("Interrupt"),r("Sequential"),r("Parallel"))})).Cause.map(Bi),Xte=e=>t=>{const n=r=>{switch(r._tag){case"Empty":return"Cause.empty";case"Fail":return`Cause.fail(${e(r.error)})`;case"Die":return`Cause.die(${Tm(r)})`;case"Interrupt":return`Cause.interrupt(${cS(r.fiberId)})`;case"Sequential":return`Cause.sequential(${n(r.left)}, ${n(r.right)})`;case"Parallel":return`Cause.parallel(${n(r.left)}, ${n(r.right)})`}};return n(t)},SC=e=>(t,n,r)=>V8(t)?OE(e(mc(t),n),Bi,r,t):Hu(new Yt(r,t)),Zte=({defect:e,error:t})=>Ma([t,e],{decode:(n,r)=>SC(Ld(uS(n,r))),encode:(n,r)=>SC(Vu(uS(n,r)))},{title:`Cause<${t.ast}>`,pretty:Xte,arbitrary:Yte});function Bi(e){switch(e._tag){case"Empty":return z8;case"Fail":return Pu(e.error);case"Die":return wa(e.defect);case"Interrupt":return Og(Zm(e.fiberId));case"Sequential":return H8(Bi(e.left),Bi(e.right));case"Parallel":return B8(Bi(e.left),Bi(e.right))}}function mc(e){switch(e._tag){case"Empty":return{_tag:"Empty"};case"Fail":return{_tag:"Fail",error:e.error};case"Die":return{_tag:"Die",defect:e.defect};case"Interrupt":return{_tag:"Interrupt",fiberId:e.fiberId};case"Sequential":return{_tag:"Sequential",left:mc(e.left),right:mc(e.right)};case"Parallel":return{_tag:"Parallel",left:mc(e.left),right:mc(e.right)}}}const ene=({defect:e,error:t})=>{const n=t,r=e;return Er(uS(n,r),Zte({error:Fs(n),defect:Fs(r)}),{strict:!1,decode:o=>Bi(o),encode:o=>mc(o)})};class ka extends Er(oS,oS,{strict:!0,decode:t=>{if(Ls(t)&&"message"in t&&typeof t.message=="string"){const n=new Error(t.message,{cause:t});return"name"in t&&typeof t.name=="string"&&(n.name=t.name),n.stack="stack"in t&&typeof t.stack=="string"?t.stack:"",n}return String(t)},encode:t=>t instanceof Error?{name:t.name,message:t.message}:AO(t)}).annotations({identifier:"Defect"}){}const tne=Symbol.for("effect/Schema/Serializable/symbol"),xE=Symbol.for("effect/Schema/Serializable/symbolResult"),nne=y(2,(e,t)=>Wu(e[xE].failure)(t)),rne=y(2,(e,t)=>Wu(e[xE].success)(t)),Mn=e=>(t,n,r)=>{var o;const s=Fl({_tag:gN(t)},n.payload);return o=class extends qc({kind:"TaggedRequest",identifier:t,schema:Y(s),fields:s,Base:eQ,annotations:r}){get[tne](){return this.constructor}get[xE](){return{failure:n.failure,success:n.success}}},d(o,"_tag",t),d(o,"success",n.success),d(o,"failure",n.failure),o},sne=$X,one=CX,ine=OX,ane=qX,Ns=AX,_N=PX,yN=FX,kf=u_,cne=NX,ep=wx,Co=Sf,une=UX,lne=vx,vi=wf,fne=zX,dne=YZ,hne=HX,mne=KX,pne=JX,gne=QX,_ne=YX,fn=XX,yne=kx,bN=bE,uu=tZ,Cn=nZ,bne=sZ,Sne=iZ,SN=$x,wN=f_,wne=uZ,vne=lZ,NE=dZ,wC=Symbol.for("effect/Subscribable"),Ene=cP,kne="effect/SubscriptionRef",$ne=Symbol.for(kne),Cne={_A:e=>e};var jI,UI,zI,BI,HI,VI;class Tne extends(VI=Po,HI=ci,BI=wC,zI=T5,UI=Ene,jI=$ne,VI){constructor(n,r,s){super();d(this,"ref");d(this,"pubsub");d(this,"semaphore");d(this,HI,ci);d(this,BI,wC);d(this,zI,Yw);d(this,UI,uP);d(this,jI,Cne);d(this,"get");this.ref=n,this.pubsub=r,this.semaphore=s,this.get=Gi(this.ref)}commit(){return this.get}get changes(){return v(Gi(this.ref),X(n=>Ee(wx(this.pubsub,{scoped:!0}),r=>yx(vx(n),r))),this.semaphore.withPermits(1),f_)}modify(n){return this.modifyEffect(r=>Ve(n(r)))}modifyEffect(n){return v(Gi(this.ref),X(n),X(([r,s])=>v(Xc(this.ref,s),fo(r),Uv(Jg(this.pubsub,s)))),this.semaphore.withPermits(1))}}const Ine=e=>v(Cd([Yv(),Si(e),Bg(1)]),Ee(([t,n,r])=>new Tne(n,t,r))),Rne=y(2,(e,t)=>v(Xc(e.ref,t),Uv(Jg(e.pubsub,t)),e.semaphore.withPermits(1))),$f=Ine,Ar=Rne,DE=VY,One=hx,ME=WY,qne=KY,vN=e=>t=>fne(t,n=>v(e(n),Ee(()=>n))),vC=()=>One([]),bl=(e,t)=>qne(e,n=>$p(n,t)),Ane=e=>ME(e,[]),EN=(e,t,n)=>Vx(function*(){const r=yield*DE(e);if(r.length<t)return yield*Lee;{const s=r.splice(0,Math.min(n,r.length));return yield*ME(e,r),s}}),Pne=(e,t)=>Vx(function*(){const n=yield*DE(e),[r,s]=j1(n,t);return yield*ME(e,s),r}),EC=e=>DE(e).pipe(Ee(t=>t.length)),Cf=y(2,(e,t)=>v(e.changes,Ns(t),uu(1),_ne,Ee(xp))),kC=Symbol.for("effect/Subscribable");var WI,KI,JI;class Fne extends(JI=Po,KI=kC,WI=ci,JI){constructor(n,r){super();d(this,"get");d(this,"changes");d(this,KI,kC);d(this,WI,ci);this.get=n,this.changes=r}commit(){return this.get}}const E_=e=>new Fne(e.get,e.changes);y(2,(e,t)=>E_({get:Ee(e.get,t),changes:vi(e.changes,t)}));y(2,(e,t)=>E_({get:X(e.get,t),changes:dne(e.changes,t)}));E_({get:Fv,changes:mne});const xne=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}`,Nne=e=>Eee($ee,Cee({formatDate:t=>`${xne(t)} ${e}`})),Dne={};var Mne={};const k_=()=>typeof process<"u"&&Mne!==void 0||Dne!==void 0?!1:!!(typeof globalThis<"u"&&globalThis.__DEV__),Lne=e=>{const t=e==null?void 0:e.toString();if(t!=="[object Object]")return t;try{return JSON.stringify(e,null,2)}catch(n){return console.log(e),"Error while printing error: "+n}},lS=e=>e!==void 0&&e.toLowerCase()!=="false"&&e.toLowerCase()!=="0",Ce=(e,...t)=>{if(console.error(e,...t),k_())debugger;throw new Error(`This should never happen: ${e}`)};var jne=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Hi="1.9.0",$C=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Une(e){var t=new Set([e]),n=new Set,r=e.match($C);if(!r)return function(){return!1};var s={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(s.prerelease!=null)return function(f){return f===e};function o(u){return n.add(u),!1}function a(u){return t.add(u),!0}return function(f){if(t.has(f))return!0;if(n.has(f))return!1;var h=f.match($C);if(!h)return o(f);var p={major:+h[1],minor:+h[2],patch:+h[3],prerelease:h[4]};return p.prerelease!=null||s.major!==p.major?o(f):s.major===0?s.minor===p.minor&&s.patch<=p.patch?a(f):o(f):s.minor<=p.minor?a(f):o(f)}}var zne=Une(Hi),Bne=Hi.split(".")[0],Tf=Symbol.for("opentelemetry.js.api."+Bne),If=jne;function LE(e,t,n,r){var s;r===void 0&&(r=!1);var o=If[Tf]=(s=If[Tf])!==null&&s!==void 0?s:{version:Hi};if(!r&&o[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(o.version!==Hi){var a=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+Hi);return n.error(a.stack||a.message),!1}return o[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+Hi+"."),!0}function Rf(e){var t,n,r=(t=If[Tf])===null||t===void 0?void 0:t.version;if(!(!r||!zne(r)))return(n=If[Tf])===null||n===void 0?void 0:n[e]}function jE(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+Hi+".");var n=If[Tf];n&&delete n[e]}var Hne=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Vne=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Wne=(function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return cl("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return cl("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return cl("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return cl("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return cl("verbose",this._namespace,t)},e})();function cl(e,t,n){var r=Rf("diag");if(r)return n.unshift(t),r[e].apply(r,Vne([],Hne(n),!1))}var ur;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(ur||(ur={}));function Kne(e,t){e<ur.NONE?e=ur.NONE:e>ur.ALL&&(e=ur.ALL),t=t||{};function n(r,s){var o=t[r];return typeof o=="function"&&e>=s?o.bind(t):function(){}}return{error:n("error",ur.ERROR),warn:n("warn",ur.WARN),info:n("info",ur.INFO),debug:n("debug",ur.DEBUG),verbose:n("verbose",ur.VERBOSE)}}var Jne=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},Gne=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},Qne="diag",tp=(function(){function e(){function t(s){return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=Rf("diag");if(u)return u[s].apply(u,Gne([],Jne(o),!1))}}var n=this,r=function(s,o){var a,u,f;if(o===void 0&&(o={logLevel:ur.INFO}),s===n){var h=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((a=h.stack)!==null&&a!==void 0?a:h.message),!1}typeof o=="number"&&(o={logLevel:o});var p=Rf("diag"),g=Kne((u=o.logLevel)!==null&&u!==void 0?u:ur.INFO,s);if(p&&!o.suppressOverrideMessage){var k=(f=new Error().stack)!==null&&f!==void 0?f:"<failed to generate stacktrace>";p.warn("Current logger will be overwritten from "+k),g.warn("Current logger will overwrite one already registered from "+k)}return LE("diag",g,n,!0)};n.setLogger=r,n.disable=function(){jE(Qne,n)},n.createComponentLogger=function(s){return new Wne(s)},n.verbose=t("verbose"),n.debug=t("debug"),n.info=t("info"),n.warn=t("warn"),n.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e})();function Yne(e){return Symbol.for(e)}var Xne=(function(){function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,s){var o=new e(n._currentContext);return o._currentContext.set(r,s),o},n.deleteValue=function(r){var s=new e(n._currentContext);return s._currentContext.delete(r),s}}return e})(),Zne=new Xne,ere=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},tre=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},nre=(function(){function e(){}return e.prototype.active=function(){return Zne},e.prototype.with=function(t,n,r){for(var s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return n.call.apply(n,tre([r],ere(s),!1))},e.prototype.bind=function(t,n){return n},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e})(),rre=function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),s,o=[],a;try{for(;(t===void 0||t-- >0)&&!(s=r.next()).done;)o.push(s.value)}catch(u){a={error:u}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o},sre=function(e,t,n){if(n||arguments.length===2)for(var r=0,s=t.length,o;r<s;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},vy="context",ore=new nre,UE=(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return LE(vy,t,tp.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,n,r){for(var s,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return(s=this._getContextManager()).with.apply(s,sre([t,n,r],rre(o),!1))},e.prototype.bind=function(t,n){return this._getContextManager().bind(t,n)},e.prototype._getContextManager=function(){return Rf(vy)||ore},e.prototype.disable=function(){this._getContextManager().disable(),jE(vy,tp.instance())},e})(),lu;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})(lu||(lu={}));var kN="0000000000000000",$N="00000000000000000000000000000000",ire={traceId:$N,spanId:kN,traceFlags:lu.NONE},xl=(function(){function e(t){t===void 0&&(t=ire),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,n){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,n){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,n){},e})(),zE=Yne("OpenTelemetry Context Key SPAN");function BE(e){return e.getValue(zE)||void 0}function are(){return BE(UE.getInstance().active())}function HE(e,t){return e.setValue(zE,t)}function cre(e){return e.deleteValue(zE)}function ure(e,t){return HE(e,new xl(t))}function CN(e){var t;return(t=BE(e))===null||t===void 0?void 0:t.spanContext()}var lre=/^([0-9a-f]{32})$/i,fre=/^[0-9a-f]{16}$/i;function dre(e){return lre.test(e)&&e!==$N}function hre(e){return fre.test(e)&&e!==kN}function TN(e){return dre(e.traceId)&&hre(e.spanId)}function mre(e){return new xl(e)}var Ey=UE.getInstance(),IN=(function(){function e(){}return e.prototype.startSpan=function(t,n,r){r===void 0&&(r=Ey.active());var s=!!(n!=null&&n.root);if(s)return new xl;var o=r&&CN(r);return pre(o)&&TN(o)?new xl(o):new xl},e.prototype.startActiveSpan=function(t,n,r,s){var o,a,u;if(!(arguments.length<2)){arguments.length===2?u=n:arguments.length===3?(o=n,u=r):(o=n,a=r,u=s);var f=a??Ey.active(),h=this.startSpan(t,o,f),p=HE(f,h);return Ey.with(p,u,void 0,h)}},e})();function pre(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var gre=new IN,_re=(function(){function e(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}return e.prototype.startSpan=function(t,n,r){return this._getTracer().startSpan(t,n,r)},e.prototype.startActiveSpan=function(t,n,r,s){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):gre},e})(),yre=(function(){function e(){}return e.prototype.getTracer=function(t,n,r){return new IN},e})(),bre=new yre,CC=(function(){function e(){}return e.prototype.getTracer=function(t,n,r){var s;return(s=this.getDelegateTracer(t,n,r))!==null&&s!==void 0?s:new _re(this,t,n,r)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:bre},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(t,n,r)},e})(),xi;(function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"})(xi||(xi={}));var pc;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(pc||(pc={}));var ky=UE.getInstance(),$y="trace",Sre=(function(){function e(){this._proxyTracerProvider=new CC,this.wrapSpanContext=mre,this.isSpanContextValid=TN,this.deleteSpan=cre,this.getSpan=BE,this.getActiveSpan=are,this.getSpanContext=CN,this.setSpan=HE,this.setSpanContext=ure}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var n=LE($y,this._proxyTracerProvider,tp.instance());return n&&this._proxyTracerProvider.setDelegate(t),n},e.prototype.getTracerProvider=function(){return Rf($y)||this._proxyTracerProvider},e.prototype.getTracer=function(t,n){return this.getTracerProvider().getTracer(t,n)},e.prototype.disable=function(){jE($y,tp.instance()),this._proxyTracerProvider=new CC},e})(),fS=Sre.getInstance();const TC=1000000000n,Cy=e=>[Number(e/TC),Number(e%TC)],Ty=e=>Object.entries(e).reduce((t,[n,r])=>(t[n]=RN(r),t),{}),RN=e=>typeof e=="string"||typeof e=="number"||typeof e=="boolean"?e:typeof e=="bigint"?Number(e):ra(e),Lh=Symbol.for("@effect/opentelemetry/Tracer/OtelSpan"),wre={internal:xi.INTERNAL,client:xi.CLIENT,server:xi.SERVER,producer:xi.PRODUCER,consumer:xi.CONSUMER};var GI;GI=Lh;class ON{constructor(t,n,r,s,o,a,u,f){d(this,"name");d(this,"parent");d(this,"context");d(this,"links");d(this,"kind");d(this,GI);d(this,"_tag","Span");d(this,"span");d(this,"spanId");d(this,"traceId");d(this,"attributes",new Map);d(this,"sampled");d(this,"status");this.name=r,this.parent=s,this.context=o,this.links=a,this.kind=f,this[Lh]=Lh;const h=t.active();this.span=n.startSpan(r,{startTime:Cy(u),links:a.length>0?a.map(g=>({context:dS(g.span),attributes:Ty(g.attributes)})):void 0,kind:wre[this.kind]},s._tag==="Some"?AN(h,s.value,o):fS.deleteSpan(h));const p=this.span.spanContext();this.spanId=p.spanId,this.traceId=p.traceId,this.status={_tag:"Started",startTime:u},this.sampled=(p.traceFlags&lu.SAMPLED)===lu.SAMPLED}attribute(t,n){this.span.setAttribute(t,RN(n)),this.attributes.set(t,n)}addLinks(t){this.links.push(...t),this.span.addLinks(t.map(n=>({context:dS(n.span),attributes:Ty(n.attributes)})))}end(t,n){const r=Cy(t);if(this.status={_tag:"Ended",endTime:t,exit:n,startTime:this.status.startTime},n._tag==="Success")this.span.setStatus({code:pc.OK});else if(lo(n.cause))this.span.setStatus({code:pc.OK,message:Tm(n.cause)}),this.span.setAttribute("span.label"," Interrupted"),this.span.setAttribute("status.interrupted",!0);else{const s=G8(n.cause)[0];s?(s.stack=Tm(n.cause,{renderErrorCause:!0}),this.span.recordException(s,r),this.span.setStatus({code:pc.ERROR,message:s.message})):this.span.setStatus({code:pc.OK})}this.span.end(r)}event(t,n,r){this.span.addEvent(t,r?Ty(r):void 0,Cy(n))}}const qN=sr("@effect/opentelemetry/Tracer/OtelTracer"),vre=Ee(qN,e=>Oq({span(t,n,r,s,o,a){return new ON(ky,e,t,n,r,s.slice(),o,a)},context(t,n){const r=n.currentSpan;return r===void 0?t():ky.with(AN(ky.active(),r),t)}})),IC=sr("@effect/opentelemetry/Tracer/OtelTraceFlags"),RC=sr("@effect/opentelemetry/Tracer/OtelTraceState"),Ere=X(Hg,e=>Lh in e?Ve(e.span):Hn(new Pg)),AN=(e,t,n)=>t instanceof ON?fS.setSpan(e,t.span):fS.setSpanContext(e,dS(t,n)),dS=(e,t)=>({spanId:e.spanId,traceId:e.traceId,isRemote:e._tag==="ExternalSpan",traceFlags:Et(t?OC(e,t,IC):Lr(e.context,IC),()=>lu.SAMPLED),traceState:hr(t?OC(e,t,RC):Lr(e.context,RC))}),OC=(e,t,n)=>ro(Lr(t,n),()=>Lr(e.context,n)),kre=vre,VE=Ere,$re=qN,fh=(e,t,n=" ")=>e.split(`
`).map(r=>n.repeat(t)+r).join(`
`),PN=e=>e!==void 0,Cre=e=>e==null,qC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var AC={};const Of=e=>{if(typeof process<"u"&&AC!==void 0)return AC[e];if(qC!==void 0)return qC[e]},no=Of("LS_TRACE_VERBOSE")!==void 0||Of("VITE_LS_TRACE_VERBOSE")!==void 0,Ds=lS(Of("LS_DEV"))||lS(Of("VITE_LS_DEV"));lS(Of("CI"));const Tre=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Ire=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Rre=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],Ore=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],PC=(e,t,n)=>{let r=e;return typeof t=="string"||Array.isArray(t)?r=e.toLocaleString(t,n):(t===!0||n!==void 0)&&(r=e.toLocaleString(void 0,n)),r};function qre(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const n=t.bits?t.binary?Ore:Rre:t.binary?Ire:Tre,r=t.space?" ":"";if(t.signed&&e===0)return` 0${r}${n[0]}`;const s=e<0,o=s?"-":t.signed?"+":"";s&&(e=-e);let a;if(t.minimumFractionDigits!==void 0&&(a={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(a={maximumFractionDigits:t.maximumFractionDigits,...a}),e<1){const p=PC(e,t.locale,a);return o+p+r+n[0]}const u=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),n.length-1);e/=(t.binary?1024:1e3)**u,a||(e=e.toPrecision(3));const f=PC(Number(e),t.locale,a),h=n[u];return o+f+r+h}const FN=e=>Array.isArray(e);function To(e){debugger;throw new Error(`A case was not handled for value: ${Are(Lne(e),1e3)}`)}const Are=(e,t)=>e.length>t?e.slice(0,t)+"...":e,Pre=e=>{const t=new Map;return((...n)=>{const r=JSON.stringify(n);if(t.has(r))return t.get(r);const s=e(...n);return t.set(r,s),s})},Fre=e=>{const t=new Map;return(n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r})},xre=e=>typeof(e==null?void 0:e.then)=="function",Ju=e=>z(function*(){const t=yield*Rv();return yield*nr(n=>kn(t,n)),yield*e(t).pipe(Tv(t))}),dh=e=>xo(()=>e()).pipe(Qr(t=>jr(t)?t:xre(t)?Mg(()=>t):Ve(t))),vt=e=>Nu(e,t=>z(function*(){if(lo(t))return;const n=yield*VE.pipe(xv("NoSuchElementException",s=>Ve(void 0))),r=t.toString().split(`
`)[0];yield*ru(r,t).pipe(s=>n===void 0?s:Cc({spanId:n.spanContext().spanId,traceId:n.spanContext().traceId})(s))})),hh=(e,t,n,r)=>z(function*(){const s=yield*No(),o=a=>n(a).pipe(An(s),Do);e.addEventListener(t,o,{once:!1}),yield*nr(()=>Re(()=>e.removeEventListener(t,o)))}),Qn=(e,t)=>_Q(bQ(e).pipe(Cc(t??{})),RQ,()=>Bp(Tee)),WE=e=>t=>PP(Re(()=>performance.mark(`${e}:start`)),()=>t,()=>Re(()=>{performance.mark(`${e}:end`),performance.measure(e,`${e}:start`,`${e}:end`)})),xN=()=>{const e=yG();return e._tag==="None"||e.value.currentSpan===void 0?"No current fiber":""},Nre=()=>console.log(xN());globalThis.getSpanTrace=xN;globalThis.logSpanTrace=Nre;const NN=(e,t)=>{class n extends Ov{constructor(){super(...arguments);d(this,"_tag",t)}}return n.prototype[e]=e,n.prototype.name=t,n},FC=Symbol.for("@effect/platform/Cookies"),xC=Symbol.for("@effect/platform/Cookies/Cookie"),Dre={[FC]:FC,...vp,toJSON(){return{_id:"@effect/platform/Cookies",cookies:NL(this.cookies,e=>e.toJSON())}},pipe(){return ee(this,arguments)}},Mre=e=>{const t=Object.create(Dre);return t.cookies=e,t},Lre=e=>{const t={};for(const n of e)t[n.name]=n;return Mre(t)},jre=e=>{const t=typeof e=="string"?[e]:e,n=[];for(const r of t){const s=Ure(r.trim());lt(s)&&n.push(s.value)}return Lre(n)};function Ure(e){const t=e.split(";").map(u=>u.trim()).filter(u=>u!=="");if(t.length===0)return V();const n=t[0].indexOf("=");if(n===-1)return V();const r=t[0].slice(0,n);if(!zre.test(r))return V();const s=t[0].slice(n+1),o=Bre(s);if(t.length===1)return W(Object.assign(Object.create(NC),{name:r,value:o,valueEncoded:s}));const a={};for(let u=1;u<t.length;u++){const f=t[u],h=f.indexOf("="),p=h===-1?f:f.slice(0,h).trim(),g=h===-1?void 0:f.slice(h+1).trim();switch(p.toLowerCase()){case"domain":{if(g===void 0)break;const k=g.trim().replace(/^\./,"");k&&(a.domain=k);break}case"expires":{if(g===void 0)break;const k=new Date(g);isNaN(k.getTime())||(a.expires=k);break}case"max-age":{if(g===void 0)break;const k=parseInt(g,10);isNaN(k)||(a.maxAge=ow(k));break}case"path":{if(g===void 0)break;g[0]==="/"&&(a.path=g);break}case"priority":{if(g===void 0)break;switch(g.toLowerCase()){case"low":a.priority="low";break;case"medium":a.priority="medium";break;case"high":a.priority="high";break}break}case"httponly":{a.httpOnly=!0;break}case"secure":{a.secure=!0;break}case"partitioned":{a.partitioned=!0;break}case"samesite":{if(g===void 0)break;switch(g.toLowerCase()){case"lax":a.sameSite="lax";break;case"strict":a.sameSite="strict";break;case"none":a.sameSite="none";break}break}}}return W(Object.assign(Object.create(NC),{name:r,value:o,valueEncoded:s,options:Object.keys(a).length>0?a:void 0}))}const zre=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,NC={[xC]:xC,...vp,toJSON(){return{_id:"@effect/platform/Cookies/Cookie",name:this.name,value:this.value,options:this.options}}},Bre=e=>{try{return decodeURIComponent(e)}catch{return e}},DC=Symbol.for("@effect/platform/Headers"),qf=Object.assign(Object.create(null),{[DC]:DC,[Ep](e){return mS(this,wg(e,MN))}}),$_=e=>Object.assign(Object.create(qf),e),DN=Object.create(qf),KE=e=>{if(e===void 0)return DN;if(Symbol.iterator in e){const n=Object.create(qf);for(const[r,s]of e)n[r.toLowerCase()]=s;return n}const t=Object.create(qf);for(const[n,r]of Object.entries(e))Array.isArray(r)?t[n.toLowerCase()]=r.join(", "):r!==void 0&&(t[n.toLowerCase()]=r);return t},Hre=e=>Object.setPrototypeOf(e,qf),hS=y(3,(e,t,n)=>{const r=$_(e);return r[t.toLowerCase()]=n,r}),Vre=y(2,(e,t)=>$_({...e,...KE(t)})),Wre=y(2,(e,t)=>{const n=$_(e);return Object.assign(n,t),n}),Kre=y(2,(e,t)=>{const n=$_(e),r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&delete n[o]}else for(const o in e)s.test(o)&&delete n[o]};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),mS=y(2,(e,t)=>{const n={...e},r=s=>{if(typeof s=="string"){const o=s.toLowerCase();o in e&&(n[o]=uC(e[o]))}else for(const o in e)s.test(o)&&(n[o]=uC(e[o]))};if(Array.isArray(t))for(let s=0;s<t.length;s++)r(t[s]);else r(t);return n}),MN=Te("@effect/platform/Headers/currentRedactedNames",()=>zv(["authorization","cookie","set-cookie","x-api-key"])),Jre=Symbol.for("@effect/platform/HttpClientError"),LN=Jre;class jN extends NN(LN,"RequestError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class Ci extends NN(LN,"ResponseError"){get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){const t=`${this.response.status} ${this.methodAndUrl}`;return this.description?`${this.reason}: ${this.description} (${t})`:`${this.reason} error (${t})`}}const C_=e=>{const t=UN(e),n=[];for(let r=0;r<t.length;r++)if(Array.isArray(t[r][0])){const[s,o]=t[r];n.push([`${s[0]}[${s.slice(1).join("][")}]`,o])}else n.push(t[r]);return n},UN=e=>{const t=Symbol.iterator in e?ze(e):Object.entries(e),n=[];for(const[r,s]of t)if(Array.isArray(s))for(let o=0;o<s.length;o++)s[o]!==void 0&&n.push([r,String(s[o])]);else if(typeof s=="object"){const o=UN(s);for(const[a,u]of o)n.push([[r,...typeof a=="string"?[a]:a],u])}else s!==void 0&&n.push([r,String(s)]);return n},Gre=[],Qre=y(2,(e,t)=>{const n=C_(t),r=n.map(([s])=>s);return $p(z1(e,([s])=>r.includes(s)),n)}),Yre=(e,t,n)=>{try{const r=new URL(e,Zre());for(let s=0;s<t.length;s++){const[o,a]=t[s];a!==void 0&&r.searchParams.append(o,a)}return n._tag==="Some"&&(r.hash=n.value),le(r)}catch(r){return ae(r)}},Xre=e=>new URLSearchParams(e).toString(),Zre=()=>{if("location"in globalThis&&globalThis.location!==void 0&&globalThis.location.origin!==void 0&&globalThis.location.pathname!==void 0)return location.origin+location.pathname},Nl=Symbol.for("@effect/platform/HttpIncomingMessage"),ese=(e,t)=>{const n=e.headers["content-type"]??"";let r;if(n.includes("application/json"))try{r=Cs(e.json)}catch{}else if(n.includes("text/")||n.includes("urlencoded"))try{r=Cs(e.text)}catch{}const s={...t,headers:sa(e.headers),remoteAddress:e.remoteAddress.toJSON()};return r!==void 0&&(s.body=r),s},tse=e=>Hre({b3:`${e.traceId}-${e.spanId}-${e.sampled?"1":"0"}${e.parent._tag==="Some"?`-${e.parent.value.spanId}`:""}`,traceparent:`00-${e.traceId}-${e.spanId}-${e.sampled?"01":"00"}`}),Iy=Symbol.for("@effect/platform/HttpBody");var QI;class nse{constructor(){d(this,QI);this[Iy]=Iy}[(QI=Iy,Be)](){return this.toJSON()}toString(){return dt(this)}}class rse extends nse{constructor(){super(...arguments);d(this,"_tag","Empty")}toJSON(){return{_id:"@effect/platform/HttpBody",_tag:"Empty"}}}const sse=new rse,MC=Symbol.for("@effect/platform/HttpClientRequest"),ose={[MC]:MC,...vp,toJSON(){return{_id:"@effect/platform/HttpClientRequest",method:this.method,url:this.url,urlParams:this.urlParams,hash:this.hash,headers:sa(this.headers),body:this.body.toJSON()}},pipe(){return ee(this,arguments)}};function Io(e,t,n,r,s,o){const a=Object.create(ose);return a.method=e,a.url=t,a.urlParams=n,a.hash=r,a.headers=s,a.body=o,a}const ise=Io("GET","",Gre,V(),DN,sse),ja=e=>(t,n)=>mse(ise,{method:e,url:t,...n??void 0}),ase=ja("GET"),cse=ja("POST"),use=ja("PUT"),lse=ja("PATCH"),fse=ja("DELETE"),dse=ja("HEAD"),hse=ja("OPTIONS"),mse=y(2,(e,t)=>{let n=e;return t.method&&(n=_se(n,t.method)),t.url&&(n=yse(n,t.url)),t.headers&&(n=zN(n,t.headers)),t.urlParams&&(n=bse(n,t.urlParams)),t.hash&&(n=Sse(n,t.hash)),t.body&&(n=wse(n,t.body)),t.accept&&(n=BN(n,t.accept)),t.acceptJson&&(n=gse(n)),n}),pse=y(3,(e,t,n)=>Io(e.method,e.url,e.urlParams,e.hash,hS(e.headers,t,n),e.body)),zN=y(2,(e,t)=>Io(e.method,e.url,e.urlParams,e.hash,Vre(e.headers,t),e.body)),BN=y(2,(e,t)=>pse(e,"Accept",t)),gse=BN("application/json"),_se=y(2,(e,t)=>Io(t,e.url,e.urlParams,e.hash,e.headers,e.body)),yse=y(2,(e,t)=>{if(typeof t=="string")return Io(e.method,t,e.urlParams,e.hash,e.headers,e.body);const n=new URL(t.toString()),r=C_(n.searchParams),s=n.hash?W(n.hash.slice(1)):V();return n.search="",n.hash="",Io(e.method,n.toString(),r,s,e.headers,e.body)}),bse=y(2,(e,t)=>Io(e.method,e.url,Qre(e.urlParams,t),e.hash,e.headers,e.body)),Sse=y(2,(e,t)=>Io(e.method,e.url,e.urlParams,W(t),e.headers,e.body)),wse=y(2,(e,t)=>{let n=e.headers;if(t._tag==="Empty"||t._tag==="FormData")n=Kre(n,["Content-type","Content-length"]);else{const r=t.contentType;r&&(n=hS(n,"content-type",r));const s=t.contentLength;s&&(n=hS(n,"content-length",s.toString()))}return Io(e.method,e.url,e.urlParams,e.hash,n,t)}),Dl=Symbol.for("@effect/platform/HttpClientResponse"),vse=(e,t)=>new Ese(e,t);var YI,XI,ZI;class Ese extends(ZI=YM,XI=Nl,YI=Dl,ZI){constructor(n,r){super();d(this,"request");d(this,"source");d(this,XI);d(this,YI);d(this,"cachedCookies");d(this,"textBody");d(this,"formDataBody");d(this,"arrayBufferBody");this.request=n,this.source=r,this[Nl]=Nl,this[Dl]=Dl}toJSON(){return ese(this,{_id:"@effect/platform/HttpClientResponse",request:this.request.toJSON(),status:this.status})}get status(){return this.source.status}get headers(){return KE(this.source.headers)}get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=jre(this.source.headers.getSetCookie())}get remoteAddress(){return V()}get stream(){return this.source.body?une(()=>this.source.body,n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})):ane(new Ci({request:this.request,response:this,reason:"EmptyBody",description:"can not create stream from empty body"}))}get json(){return rQ(this.text,{try:n=>n===""?null:JSON.parse(n),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})})}get text(){return this.textBody??(this.textBody=Il({try:()=>this.source.text(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ry,Cs))}get urlParamsBody(){return X(this.text,n=>xo({try:()=>C_(new URLSearchParams(n)),catch:r=>new Ci({request:this.request,response:this,reason:"Decode",cause:r})}))}get formData(){return this.formDataBody??(this.formDataBody=Il({try:()=>this.source.formData(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ry,Cs))}get arrayBuffer(){return this.arrayBufferBody??(this.arrayBufferBody=Il({try:()=>this.source.arrayBuffer(),catch:n=>new Ci({request:this.request,response:this,reason:"Decode",cause:n})}).pipe(ry,Cs))}}const LC=Symbol.for("@effect/platform/HttpClient"),JE=sr("@effect/platform/HttpClient"),kse=Te(Symbol.for("@effect/platform/HttpClient/tracerDisabledWhen"),()=>zv(Yn)),$se=Te(Symbol.for("@effect/platform/HttpClient/currentTracerPropagation"),()=>zv(!0)),Cse=yu()("@effect/platform/HttpClient/SpanNameGenerator",{defaultValue:()=>e=>`http.client ${e.method}`}),Tse={[LC]:LC,pipe(){return ee(this,arguments)},...vp,toJSON(){return{_id:"@effect/platform/HttpClient"}},get(e,t){return this.execute(ase(e,t))},head(e,t){return this.execute(dse(e,t))},post(e,t){return this.execute(cse(e,t))},put(e,t){return this.execute(use(e,t))},patch(e,t){return this.execute(lse(e,t))},del(e,t){return this.execute(fse(e,t))},options(e,t){return this.execute(hse(e,t))}},HN=(e,t)=>{const n=Object.create(Tse);return n.preprocess=t,n.postprocess=e,n.execute=function(r){return e(t(r))},n},np=Te("@effect/platform/HttpClient/responseRegistry",()=>{if("FinalizationRegistry"in globalThis&&globalThis.FinalizationRegistry){const t=new FinalizationRegistry(n=>{n.abort()});return{register(n,r){t.register(n,r,n)},unregister(n){t.unregister(n)}}}const e=new Map;return{register(t,n){e.set(t,setTimeout(()=>n.abort(),5e3))},unregister(t){const n=e.get(t);n!==void 0&&(clearTimeout(n),e.delete(t))}}}),Ise=e=>HN(t=>X(t,n=>As(r=>{const s=new AbortController,o=Yre(n.url,n.urlParams,n.hash);if(o._tag==="Left")return Hn(new jN({request:n,reason:"InvalidUrl",cause:o.left}));const a=o.right;if(!r.getFiberRef(OQ)||r.getFiberRef(kse)(n))return fi(h=>Rr(h(e(n,a,s.signal,r)),{onSuccess(p){return np.register(p,s),Ve(new jC(p,s))},onFailure(p){return ff(p)&&s.abort(),Zn(p)}}));const f=Xn(r.currentContext,Cse);return $Q(f(n),{kind:"client",captureStackTrace:!1},h=>{h.attribute("http.request.method",n.method),h.attribute("server.address",a.origin),a.port!==""&&h.attribute("server.port",+a.port),h.attribute("url.full",a.toString()),h.attribute("url.path",a.pathname),h.attribute("url.scheme",a.protocol.slice(0,-1));const p=a.search.slice(1);p!==""&&h.attribute("url.query",p);const g=r.getFiberRef(MN),k=mS(n.headers,g);for(const T in k)h.attribute(`http.request.header.${T}`,String(k[T]));return n=r.getFiberRef($se)?zN(n,tse(h)):n,fi(T=>T(e(n,a,s.signal,r)).pipe(ji(h),Rr({onSuccess:O=>{h.attribute("http.response.status_code",O.status);const L=mS(O.headers,g);for(const E in L)h.attribute(`http.response.header.${E}`,String(L[E]));return np.register(O,s),Ve(new jC(O,s))},onFailure(O){return ff(O)&&s.abort(),Zn(O)}})))})})),Ve);var e1,t1;class jC{constructor(t,n){d(this,"original");d(this,"controller");d(this,t1,Dl);d(this,e1,Nl);this.original=t,this.controller=n}applyInterrupt(t){return _t(()=>(np.unregister(this.original),oQ(t,()=>Re(()=>{this.controller.abort()}))))}get request(){return this.original.request}get status(){return this.original.status}get headers(){return this.original.headers}get cookies(){return this.original.cookies}get remoteAddress(){return this.original.remoteAddress}get formData(){return this.applyInterrupt(this.original.formData)}get text(){return this.applyInterrupt(this.original.text)}get json(){return this.applyInterrupt(this.original.json)}get urlParamsBody(){return this.applyInterrupt(this.original.urlParamsBody)}get arrayBuffer(){return this.applyInterrupt(this.original.arrayBuffer)}get stream(){return bN(()=>(np.unregister(this.original),ine(this.original.stream,t=>(H4(t)&&this.controller.abort(),he))))}toJSON(){return this.original.toJSON()}[(t1=Dl,e1=Nl,Be)](){return this.original[Be]()}}const{del:kce,execute:$ce,get:Cce,head:Tce,options:Ice,patch:Rce,post:Oce,put:qce}=mQ(JE),Rse=y(2,(e,t)=>{const n=e;return HN(r=>t(n.postprocess(r)),n.preprocess)}),Ose=e=>UP(JE,X(FP(),t=>Ee(e,n=>Rse(n,hQ(r=>qo(t,r)))))),qse="@effect/platform/FetchHttpClient/Fetch",Ase="@effect/platform/FetchHttpClient/FetchOptions",Pse=Ise((e,t,n,r)=>{const s=r.getFiberRef(MP),o=s.unsafeMap.get(qse)??globalThis.fetch,a=s.unsafeMap.get(Ase)??{},u=a.headers?Wre(KE(a.headers),e.headers):e.headers,f=h=>Ee(Il({try:()=>o(t,{...a,method:e.method,headers:u,body:h,duplex:e.body._tag==="Stream"?"half":void 0,signal:n}),catch:p=>new jN({request:e,reason:"Transport",cause:p})}),p=>vse(e,p));switch(e.body._tag){case"Raw":case"Uint8Array":return f(e.body.body);case"FormData":return f(e.body.formData);case"Stream":return X(bne(e.body.stream),f)}return f(void 0)}),Fse=Ose(Ve(Pse)),xse=Fse,Nse=JE;class Ac extends rw("@effect/platform/Transferable/Collector")(){}const VN=()=>{let e=[];const t=s=>{e.push(...s)},n=()=>e,r=()=>{const s=e;return e=[],s};return Ac.of({unsafeAddAll:t,addAll:s=>Re(()=>t(s)),unsafeRead:n,read:Re(n),unsafeClear:r,clear:Re(r)})},Dse=Re(VN),Mse=e=>X(pQ(Ac),ot({onNone:()=>he,onSome:t=>t.addAll(e)})),WN=y(2,(e,t)=>$o(EE(e),e,{strict:!0,decode:es,encode:n=>fo(Mse(t(n)),n)})),T_=WN(Sn,e=>[e]),Pc=WN(w_,e=>[e.buffer]),Lse=Symbol.for("@effect/platform/WorkerError"),pS=Lse,jse=e=>ne(e,pS);var n1,r1;const Ko=class Ko extends(r1=Ur()("WorkerError",{reason:oe("spawn","decode","send","unknown","encode"),cause:ka}),n1=pS,r1){constructor(){super(...arguments);d(this,n1,pS)}get message(){switch(this.reason){case"send":return"An error occurred calling .postMessage";case"spawn":return"An error occurred while spawning a worker";case"decode":return"An error occurred during decoding";case"encode":return"An error occurred during encoding";case"unknown":return"An unexpected error occurred"}}};d(Ko,"Cause",ene({error:Ko,defect:ka})),d(Ko,"encodeCause",ws(Ko.Cause)),d(Ko,"decodeCause",wE(Ko.Cause));let Ts=Ko;const Use=Symbol.for("@effect/platform/Runner/PlatformRunner"),KN=sr("@effect/platform/Runner/PlatformRunner"),GE=yu()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>z4(zn)}),JN=UP(GE,Ue()),zse=Pm(function*(e,t){const n=yield*As(Ve),r=yield*KN,s=yield*GE,o=yield*r.start(s),a=new Map;yield*Vt(s).pipe(aQ(()=>(n.currentScheduler.scheduleTask(()=>{n.unsafeInterruptAsFork(n.id())},0),he)),Jt),yield*o.run((u,[f,h,p,g])=>{if(h===1){const k=a.get(f);return k?Dr(k):he}return As(k=>(a.set(f,k),t!=null&&t.decode?t.decode(p):Ve(p))).pipe(X(k=>{const T=VN(),O=e(k);let L=jr(O)?X(O,E=>v(t!=null&&t.encodeOutput?Ph(t.encodeOutput(k,E),Ac,T):Ve(E),X(S=>o.send(u,[f,0,[S]],T.unsafeRead())))):v(O,yne(E=>{if((t==null?void 0:t.encodeOutput)===void 0){const S=pr(E);return o.send(u,[f,0,S])}return T.unsafeClear(),v($n(E,S=>t.encodeOutput(k,S)),Ph(Ac,T),X(S=>o.send(u,[f,0,S],T.unsafeRead())))}),Qr(o.send(u,[f,1])));return g&&(L=ji(L,{_tag:"ExternalSpan",traceId:g[0],spanId:g[1],sampled:g[2],context:po()})),fi(E=>E(L).pipe(nQ(jse,S=>o.send(u,[f,3,Ts.encodeCause(Pu(S))])),$s(S=>un(qg(S),{onLeft:_=>(T.unsafeClear(),v(t!=null&&t.encodeError?Ph(t.encodeError(k,_),Ac,T):Ve(_),X(C=>o.send(u,[f,2,C],T.unsafeRead())),$s(C=>o.send(u,[f,3,Ts.encodeCause(C)])))),onRight:_=>o.send(u,[f,3,Ts.encodeCause(_)])}))))}),Li(Re(()=>a.delete(f))))})}),Bse=(e,t)=>z(function*(){const n=yield*jg;let r=po();const s=au(e);return yield*zse(o=>{const a=t[o._tag](o);return DQ(a)?X(jP(a,n),u=>Re(()=>{r=qo(r,u)})):jr(a)?An(a,r):gne(a,r)},{decode(o){return vo(s(o),a=>new Ts({reason:"decode",cause:a}))},encodeError(o,a){return vo(nne(o,a),u=>new Ts({reason:"encode",cause:u}))},encodeOutput(o,a){return $s(rne(o,a),u=>new Ts({reason:"encode",cause:u}))}})}),Hse=(e,t)=>jQ(Bse(e,t)).pipe(Hv(JN)),Vse=e=>qm(Pm(function*(t){const n=yield*jP(zP(e,JN),t),r=Xn(n,GE);return yield*Vt(r)})),UC=Use,QE=KN,GN=Hse,QN=Vse,YE=e=>{try{return Tt(JSON.stringify(e.ast,null,2))}catch{return console.warn("Schema hashing failed, falling back to hashing the shortend schema AST string. This is less reliable and may cause false positives."),Q(e.ast.toString())}},YN=(e,t)=>(n,r)=>z(function*(){const s=yield*Dse;return[yield*Wu(e,t)(n,r).pipe(Ph(Ac,s)),s.unsafeRead()]}),mh=(e,t)=>(n,r)=>{const s=Kx(e,t)(n,r);return s._tag==="Left"?Ce("encodeSyncDebug failed:",s.left):s.right},Wse=e=>$o(Fs(e),EE(e),{decode:iee(e),encode:see(e)});Wse(vte);const Ro=ie(D,je,Ea,lr,Me(Ef(()=>Ro)),Ku({key:D,value:Ef(()=>Ro)})).annotations({title:"JsonValue"}),rr=Symbol("WebChannel"),Af=ge("WebChannel.DebugPing",{message:D,payload:be(D)}),rp=ge("WebChannel.Ping",{requestId:D}),sp=ge("WebChannel.Pong",{requestId:D}),Kse=ie(rp,sp),zC=e=>({send:ie(e.send,Af,rp,sp),listen:ie(e.listen,Af,rp,sp)}),I_=e=>ne(e,"send")&&ne(e,"listen")?zC(e):zC({send:e,listen:e}),XE=e=>t=>t.pipe(_N(Vg(function*(n){return n._tag==="Right"&&On(Af)(n.right)?(yield*ps(`WebChannel:ping [${e}] ${n.right.message}`,n.right.payload),!1):!0}))),Jse=({channelName:e,schema:t})=>Ju(n=>z(function*(){const r=I_(t),s=new BroadcastChannel(e);yield*nr(()=>xo(()=>s.close()).pipe(Td));const o=h=>z(function*(){const p=yield*Wu(r.send)(h);s.postMessage(p)}),a=NE(s,"message").pipe(vi(h=>p_(r.listen)(h.data)),XE(e)),u=yield*Ue().pipe(at(Fa(tr))),f=!1;return{[rr]:rr,send:o,listen:a,closedDeferred:u,shutdown:kn(n,Kt("shutdown")),schema:r,supportsTransferables:f}}).pipe(Oe(`WebChannel:broadcastChannel(${e})`))),Gse=({port:e,schema:t,debugId:n})=>Ju(r=>z(function*(){const s=I_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=p=>z(function*(){const[g,k]=yield*YN(s.send)(p);e.postMessage(g,k)}),u=NE(e,"message").pipe(vi(p=>p_(s.listen)(p.data)),XE(o));e.start();const f=yield*Ue().pipe(at(Fa(tr))),h=!0;return yield*nr(()=>xo(()=>e.close()).pipe(Td)),{[rr]:rr,send:a,listen:u,closedDeferred:f,shutdown:kn(r,Kt("shutdown")),schema:s,supportsTransferables:h}}).pipe(Oe("WebChannel:messagePortChannel")));Te("livestore:sameThreadChannels",()=>new Map);const BC=({port:e,schema:t,debugId:n})=>Ju(r=>z(function*(){const s=I_(t),o=n===void 0?"messagePort":`messagePort:${n}`,a=new Map,u=ge("ChannelRequest",{id:D,payload:ie(s.listen,s.send)}).annotations({title:"webmesh.ChannelRequest"}),f=ge("ChannelRequestAck",{reqId:D}).annotations({title:"webmesh.ChannelRequestAck"}),h=ie(u,f).annotations({title:"webmesh.ChannelMessage"}),p={sendTotal:0,sendPending:0,listenTotal:0,id:n},g=L=>z(function*(){p.sendTotal++,p.sendPending++;const E=crypto.randomUUID(),[S,_]=yield*YN(h)({_tag:"ChannelRequest",id:E,payload:L}),C=yield*Ue();a.set(E,C),e.postMessage(S,_),yield*C,a.delete(E),p.sendPending--}),k=NE(e,"message").pipe(vi(L=>p_(h)(L.data)),Cn(L=>z(function*(){L._tag==="Right"&&(L.right._tag==="ChannelRequestAck"?yield*ut(a.get(L.right.reqId),void 0):L.right._tag==="ChannelRequest"&&(p.listenTotal++,e.postMessage(ws(h)({_tag:"ChannelRequestAck",reqId:L.right.id}))))})),yN(L=>L._tag==="Left"?W(L):L.right._tag==="ChannelRequest"?W(le(L.right.payload)):V()),L=>L,XE(o));e.start();const T=yield*Ue().pipe(at(Fa(tr))),O=!0;return yield*nr(()=>xo(()=>e.close()).pipe(Td)),{[rr]:rr,send:g,listen:k,closedDeferred:T,shutdown:kn(r,Kt("shutdown")),schema:s,supportsTransferables:O,debugInfo:p}}).pipe(Oe("WebChannel:messagePortChannelWithAck"))),HC=(e,t)=>z(function*(){const n=yield*yn().pipe(at(Mt)),r={current:void 0};if(yield*e.listen.pipe(t!=null&&t.heartbeat?_N(Vg(function*(o){if(o._tag==="Right"&&On(Kse)(o.right)){if(o.right._tag==="WebChannel.Ping")yield*e.send(sp.make({requestId:o.right.requestId}));else{const{deferred:a,requestId:u}=r.current??Ce("No pending ping");u!==o.right.requestId&&Ce("Received pong for unexpected requestId",u,o.right.requestId),yield*ut(a,void 0)}return!1}return!0})):ce,vN(o=>Xv(n,o)),fn,Jt),t!=null&&t.heartbeat){const{interval:o,timeout:a}=t.heartbeat;yield*z(function*(){for(;;){yield*nu(o);const u=crypto.randomUUID();yield*e.send(rp.make({requestId:u}));const f=yield*Ue();r.current={deferred:f,requestId:u},yield*f.pipe(zg(a),xv("TimeoutException",()=>e.shutdown))}}).pipe(Oe("WebChannel:heartbeat"),Jt)}const s=Co(n,{maxChunkSize:1});return{[rr]:rr,send:e.send,listen:s,closedDeferred:e.closedDeferred,shutdown:e.shutdown,schema:e.schema,supportsTransferables:e.supportsTransferables,debugInfo:{innerDebugInfo:e.debugInfo,listenQueueSize:n}}});class Sl extends Ur()("WebSocketError",{cause:ka}){}const Qse=({url:e,reconnect:t})=>z(function*(){yield*Yse(e);const n=yield*OP((r,s)=>{try{const o=new globalThis.WebSocket(e);if(o.readyState===globalThis.WebSocket.OPEN){r(Ve(o));return}s.addEventListener("abort",()=>{o.close(3e3,"abort signal")}),o.addEventListener("open",()=>r(Ve(o)),{once:!0}),o.addEventListener("error",a=>{r(Hn(new Sl({cause:a})))},{once:!0}),o.addEventListener("close",a=>r(Hn(new Sl({cause:a}))),{once:!0})}catch(o){r(Hn(new Sl({cause:o})))}}).pipe(gQ("WebSocketError",()=>Xse(e)),t?Dv(t):ce);return yield*nr(Vg(function*(r){try{xa(r)?n.close(3e3):n.close(1e3)}catch(s){yield*li(new Sl({cause:s}))}})),n}),Yse=e=>xo({try:()=>new URL(e),catch:t=>new Sl({cause:t})}),Xse=e=>z(function*(){const n=yield*(yield*Nse).get(e),r=yield*n.text;yield*ru(`Failed to connect to '${e}' (status: ${n.status}). Error:`,r)}).pipe(Nv),Zse=e=>t=>{if(ne(console,"createTask")===!1)return t;const n=z(function*(){const s=yield*vQ;return Oq({span:(o,...a)=>{const u=s.span(o,...a),f=e(o);return u.runInTask=h=>f.run(h),u},context:(o,a)=>{const u=Lr(O5)(a.currentContext);if(u._tag==="None")return s.context(o,a);const f=u.value;if(f._tag==="ExternalSpan")return s.context(o,a);const h=f;return"runInTask"in h&&typeof h.runInTask=="function"?h.runInTask(()=>s.context(o,a)):s.context(o,a)}})}),r=v(n,Ee(HP),BP);return An(t,r)},gS=Te("@effect/platform-browser/Worker/cachedPorts",()=>new Set);function eoe(e){gS.add(e.ports[0])}typeof self<"u"&&"onconnect"in self&&(self.onconnect=eoe);const XN=e=>QE.of({[UC]:UC,start:Pm(function*(t){const n=yield*Oee();let r=0;const s=new Map,o=(u,f,h)=>Re(()=>{var p;(((p=s.get(u))==null?void 0:p[0])??e).postMessage([1,f],{transfer:h})}),a=Pm(function*(u){const f=yield*jg,h=(yield*Pt(No())).pipe(J7(TU(kJ))),p=yield*HZ(),g=KF(h);function k(_){_._tag==="Failure"&&!lo(_.cause)&&Di(t,tf(Ev(_.cause)))}function T(_){return function(C){const $=C.data;if($[0]===0){const q=u(_,$[1]);if(jr(q)){const P=g(q);P.addObserver(k),Y$(p,P)}}else{const q=s.get(_);if(q){if(s.size===1)return Di(t,tr)}else return;s.delete(_),Do(kn(q[1],tr))}}}function O(_){Di(t,new Ts({reason:"decode",cause:_.data}))}function L(_){Di(t,new Ts({reason:"unknown",cause:_.data}))}function E(_){const C=Iv(f,af).pipe(X($=>{const q=r++;s.set(q,[_,$]);const P=T(q);return _.addEventListener("message",P),_.addEventListener("messageerror",O),"start"in _&&_.start(),_.postMessage([0]),ni($,Re(()=>{_.removeEventListener("message",P),_.removeEventListener("messageerror",L),_.close()}))}),g);C.addObserver(k),Y$(p,C)}e.addEventListener("error",L);let S;if("onconnect"in e){S=e.onconnect,e.onconnect=function(_){const C=_.ports[0];E(C)};for(const _ of gS)E(_);gS.clear(),yield*ni(f,Re(()=>e.close()))}else E(e);yield*ni(f,Re(()=>{e.removeEventListener("error",L),"onconnect"in e&&(e.onconnect=S)}))});return ce({run:a,send:o,disconnects:n})})}),toe=e=>Bv(QE,XN(e)),noe=UQ(QE,()=>XN(self)),roe=noe,soe=toe,ooe=(e=uv)=>uW(t=>{const n=new MessageChannel;n.port1.postMessage(void 0),n.port2.onmessage=t},e),ioe=TR(),op=Qx(ioe)(Xm),aoe=TR(),fu=Qx(aoe)(Xm),mi=0,In=Y({global:fu,client:op}).annotations({title:"LiveStore.EventSequenceNumber"}),_S=(e,t)=>e.global!==t.global?e.global-t.global:e.client-t.client,yr=e=>e.client===0?`e${e.global}`:`e${e.global}+${e.client}`,R_=(e,t)=>e.global===t.global&&e.client===t.client,ts={global:0,client:mi},jh=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client,$a=(e,t)=>e.global>t.global||e.global===t.global&&e.client>=t.client,ZN=(e,t)=>e.global>t.global||e.global===t.global&&e.client>t.client?e:t,ZE=(e,t)=>t?{seqNum:{global:e.global,client:e.client+1},parentSeqNum:e}:{seqNum:{global:e.global+1,client:mi},parentSeqNum:{global:e.global,client:mi}},e2=e=>{const t=["text","integer","real","blob"];return typeof e=="object"&&e!==null&&"columnType"in e&&t.includes(e.columnType)},e0=Symbol.for("NoDefault"),t2=e=>typeof e=="object"&&e!==null&&"sql"in e&&typeof e.sql=="string",Ud=e=>t=>{const n=(t==null?void 0:t.nullable)??!1,r=(t==null?void 0:t.schema)??r2(e),s=n===!0?Zx(r):r,o=(t==null?void 0:t.default)===void 0||t.default===e0?V():W(t.default);return{columnType:e,schema:s,default:o,nullable:n,primaryKey:(t==null?void 0:t.primaryKey)??!1}},coe=e=>Ud(e),Yr=Ud("text"),mr=Ud("integer"),uoe=Ud("real"),n2=Ud("blob"),O_=(e,t)=>n=>{const r=(n==null?void 0:n.nullable)??!1,s=t._tag==="baseSchemaFn"?t.baseSchemaFn(n==null?void 0:n.schema):t.baseSchema,o=r===!0?Zx(s):s,a=(n==null?void 0:n.default)===void 0||n.default===e0?V():W(n.default);return{columnType:e,schema:o,default:a,nullable:r,primaryKey:(n==null?void 0:n.primaryKey)??!1}},t0=O_("text",{_tag:"baseSchemaFn",baseSchemaFn:e=>xs(e??Sn)}),loe=O_("text",{_tag:"baseSchema",baseSchema:Gt}),foe=O_("integer",{_tag:"baseSchema",baseSchema:Er(je,qE,{decode:e=>new Date(e),encode:e=>e.getTime()})}),doe=O_("integer",{_tag:"baseSchema",baseSchema:Er(je,Ea,{decode:e=>e===1,encode:e=>e?1:0})}),r2=e=>{switch(e){case"text":return D;case"integer":return je;case"real":return je;case"blob":return w_;default:return To(e)}},hoe=e=>Array.isArray(e)?Object.fromEntries(e.map(t=>[t.name,t])):e,s2=(e,t,n)=>{const r={_tag:"table",name:e,columns:moe(t),indexes:poe(n??[])};return{name:e,columns:t,indexes:n,ast:r}},o2=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.schema]))).annotations({title:e.name}),i2=e=>Y(Object.fromEntries(e.ast.columns.map(t=>[t.name,t.nullable===!0||t.default._tag==="Some"?be(t.schema):t.schema]))).annotations({title:e.name}),moe=e=>Object.entries(e).map(([t,n])=>({_tag:"column",name:t,schema:n.schema,default:n.default,nullable:n.nullable??!1,primaryKey:n.primaryKey??!1,type:{_tag:n.columnType}})),poe=e=>e.map(t=>({_tag:"index",columns:t.columns,name:t.name,unique:t.isUnique??!1}));var goe=Object.freeze({__proto__:null,NoDefault:e0,blob:n2,boolean:doe,column:coe,datetime:loe,datetimeInteger:foe,defaultSchemaForColumnType:r2,insertStructSchemaForTable:i2,integer:mr,isColumnDefinition:e2,isSqlDefaultValue:t2,json:t0,makeDbSchema:hoe,real:uoe,structSchemaForTable:o2,table:s2,text:Yr});const _oe=e=>{let t=0,n,r;if(e.length===0)return t;for(n=0;n<e.length;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t=Math.trunc(t);return t},n0=e=>_oe(JSON.stringify(Uh(e))),Uh=e=>{switch(e._tag){case"table":return{_tag:"table",name:e.name,columns:e.columns.map(t=>Uh(t)),indexes:e.indexes.map(t=>Uh(t))};case"column":return{_tag:"column",name:e.name,type:e.type._tag,primaryKey:e.primaryKey,nullable:e.nullable,default:e.default};case"index":return{_tag:"index",columns:e.columns,name:e.name,unique:e.unique,primaryKey:e.primaryKey};case"foreignKey":return{_tag:"foreignKey",references:e.references,key:e.key,columns:e.columns};case"dbSchema":return{_tag:"dbSchema",tables:e.tables.map(Uh)};default:throw new Error(`Unreachable: ${e}`)}},Pf=Symbol.for("QueryBuilderAst"),Ca=Symbol.for("QueryBuilder"),q_=e=>ne(e,Ca),yoe=Y({mergeCounter:je,eventNum:In});Y({fileName:D},{key:D,value:Sn}).annotations({title:"LiveStore.PersistenceInfo"});const Ry=Y({done:je,total:je}),boe=ie(Y({stage:oe("loading")}),Y({stage:oe("migrating"),progress:Ry}),Y({stage:oe("rehydrating"),progress:Ry}),Y({stage:oe("syncing"),progress:Ry}),Y({stage:oe("done")})).annotations({title:"BootStatus"}),ip=Symbol.for("@livestore/session-id"),Gs=class Gs extends Ur()("LiveStore.UnexpectedError",{cause:ka,note:be(D),payload:be(Sn)}){};d(Gs,"mapToUnexpectedError",t=>t.pipe(vo(n=>On(Gs)(n)?n:new Gs({cause:n})),tQ(n=>new Gs({cause:n})))),d(Gs,"mapToUnexpectedErrorStream",t=>t.pipe(hne(n=>On(Gs)(n)?n:new Gs({cause:n}))));let De=Gs;class yS extends Ur()("LiveStore.IntentionalShutdownCause",{reason:oe("devtools-reset","devtools-import","adapter-reset","manual")}){}class Ace extends Ur()("LiveStore.StoreInterrupted",{reason:D}){}class gc extends Ur()("LiveStore.SqliteError",{query:be(Y({sql:D,bindValues:ie(Ku({key:D,value:Sn}),Me(Sn))})),code:be(ie(je,D)),cause:ka,note:be(D)}){}const Soe=Y({tableName:D,hashes:Y({expected:je,actual:be(je)})}),woe=Y({migrations:Me(Soe)}),ph=(e,t,n)=>e.length===0?"":`WHERE ${e.map(({col:s,op:o,value:a})=>{if(a===null){if(o!=="="&&o!=="!=")throw new Error(`Unsupported operator for NULL value: ${o}`);return`${s} ${o==="="?"IS":"IS NOT"} NULL`}const u=t.sqliteDef.columns[s];if(u===void 0)throw new Error(`Column ${s} not found`);if(o==="IN"||o==="NOT IN"){if(!Array.isArray(a))return Ce(`Expected array value for ${o} operator but got`,a);if(a.length===0)return o==="IN"?"0=1":"1=1";const h=a.map(g=>ws(u.schema)(g));n.push(...h);const p=h.map(()=>"?").join(", ");return`${s} ${o} (${p})`}else{const h=ws(u.schema)(a);return n.push(h),`${s} ${o} ?`}}).join(" AND ")}`,Oy=e=>!e||e.length===0?"":` RETURNING ${e.join(", ")}`,VC=e=>{const t=[];if(e._tag==="InsertQuery"){const p=Object.keys(e.values),g=p.map(()=>"?").join(", "),k=ws(e.tableDef.insertSchema)(e.values);p.forEach(E=>{t.push(k[E])});let T="INSERT",O="";if(e.onConflict)if(e.onConflict.action._tag==="replace")T="INSERT OR REPLACE";else if(O=` ON CONFLICT (${e.onConflict.targets.join(", ")}) `,e.onConflict.action._tag==="ignore")O+="DO NOTHING";else{const E=e.onConflict.action.update,S=Object.keys(E);if(S.length===0)throw new Error("No update columns provided for ON CONFLICT DO UPDATE");const _=S.map(C=>E[C]===void 0?`${C} = excluded.${C}`:`${C} = ?`).join(", ");S.forEach(C=>{const $=E[C];if($!==void 0){const q=e.tableDef.sqliteDef.columns[C];if(q===void 0)throw new Error(`Column ${C} not found`);const P=ws(q.schema)($);t.push(P)}}),O+=`DO UPDATE SET ${_}`}let L=`${T} INTO '${e.tableDef.sqliteDef.name}' (${p.join(", ")}) VALUES (${g})`;return L+=O,L+=Oy(e.returning),{query:L,bindValues:t}}if(e._tag==="UpdateQuery"){const p=Object.keys(e.values);if(p.length===0)return console.warn(`UPDATE query requires at least one column to set (for table ${e.tableDef.sqliteDef.name}). Running no-op query instead to skip this update query.`),{query:"SELECT 1",bindValues:[]};const g=ws(Qm(e.tableDef.rowSchema))(e.values);p.forEach(O=>{t.push(g[O])});let k=`UPDATE '${e.tableDef.sqliteDef.name}' SET ${p.map(O=>`${O} = ?`).join(", ")}`;const T=ph(e.where,e.tableDef,t);return T&&(k+=` ${T}`),k+=Oy(e.returning),{query:k,bindValues:t}}if(e._tag==="DeleteQuery"){let p=`DELETE FROM '${e.tableDef.sqliteDef.name}'`;const g=ph(e.where,e.tableDef,t);return g&&(p+=` ${g}`),p+=Oy(e.returning),{query:p,bindValues:t}}if(e._tag==="CountQuery")return{query:[`SELECT COUNT(*) as count FROM '${e.tableDef.sqliteDef.name}'`,ph(e.where,e.tableDef,t)].filter(g=>g.length>0).join(" "),bindValues:t};if(e._tag==="RowQuery"){const p=e.tableDef.sqliteDef.columns.id;if(p===void 0)throw new Error("Column id not found for ROW query");const g=e.id===ip?e.id:ws(p.schema)(e.id);return{query:`SELECT * FROM '${e.tableDef.sqliteDef.name}' WHERE id = ?`,bindValues:[g]}}const r=`SELECT ${e.select.columns.length===0?"*":e.select.columns.join(", ")}`,s=`FROM '${e.tableDef.sqliteDef.name}'`,o=ph(e.where,e.tableDef,t),a=e.orderBy.length>0?`ORDER BY ${e.orderBy.map(({col:p,direction:g})=>`${p} ${g}`).join(", ")}`:"",u=e.limit._tag==="Some"?"LIMIT ?":"",f=e.offset._tag==="Some"?"OFFSET ?":"";return e.offset._tag==="Some"&&t.push(e.offset.value),e.limit._tag==="Some"&&t.push(e.limit.value),{query:[r,s,o,a,f,u].map(p=>p.trim()).filter(p=>p.length>0).join(" "),bindValues:t}},Rn=(e,t=voe(e))=>{const n={select(){ul(t);const r=[...arguments];if(r.length===1){const[o]=r;return Rn(e,{...t,resultSchemaSingle:t.resultSchemaSingle.pipe(cu(o)),select:{columns:[o]}})}const s=r;return Rn(e,{...t,resultSchemaSingle:s.length===0?t.resultSchemaSingle:t.resultSchemaSingle.pipe(vf(...s)),select:{columns:s}})},where:function(){if(t._tag==="InsertQuery")return ll("Cannot use where with insert");if(t._tag==="RowQuery")return ll("Cannot use where with row");if(arguments.length===1){const f=arguments[0],h=Object.entries(f).filter(([,p])=>p!==void 0).map(([p,g])=>ne(g,"op")&&ne(g,"value")?{col:p,op:g.op,value:g.value}:{col:p,op:"=",value:g});switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return Rn(e,{...t,where:[...t.where,...h]});default:return To(t)}}const[r,s,o]=arguments,a=o===void 0?"=":s,u=o===void 0?s:o;switch(t._tag){case"CountQuery":case"SelectQuery":case"UpdateQuery":case"DeleteQuery":return Rn(e,{...t,where:[...t.where,{col:r,op:a,value:u}]});default:return To(t)}},orderBy(){if(ul(t),arguments.length===0||arguments.length>2)return ll();if(arguments.length===1){const o=arguments[0];return Rn(e,{...t,orderBy:[...t.orderBy,...o]})}const[r,s]=arguments;return Rn(e,{...t,orderBy:[...t.orderBy,{col:r,direction:s}]})},limit:r=>(ul(t),Rn(e,{...t,limit:W(r)})),offset:r=>(ul(t),Rn(e,{...t,offset:W(r)})),count:()=>$oe(t)||t._tag==="InsertQuery"||t._tag==="UpdateQuery"||t._tag==="DeleteQuery"?ll():Rn(e,{_tag:"CountQuery",tableDef:e,where:t.where,resultSchema:Y({count:je}).pipe(cu("count"),Me,yl())}),first:r=>(ul(t),t.limit._tag==="Some"?ll(".first() can't be called after .limit()"):Rn(e,{...t,limit:W(1),pickFirst:(r==null?void 0:r.fallback)!==void 0&&r.fallback!=="throws"?{fallback:r.fallback}:"throws"})),insert:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return Rn(e,{_tag:"InsertQuery",tableDef:e,values:s,onConflict:void 0,returning:void 0,resultSchema:vs})},onConflict:(r,s,o)=>{const a=Array.isArray(r)?r:[r];Eoe(t);const u=Bx(s).pipe(Sy("ignore",()=>({targets:a,action:{_tag:"ignore"}})),Sy("replace",()=>({targets:a,action:{_tag:"replace"}})),Sy("update",()=>({targets:a,action:{_tag:"update",update:o}})),Hx);return Rn(e,{...t,onConflict:u})},returning:(...r)=>(koe(t),Rn(e,{...t,returning:r,resultSchema:e.rowSchema.pipe(vf(...r),Me)})),update:r=>{const s=Object.fromEntries(Object.entries(r).filter(([,o])=>o!==void 0));return Rn(e,{_tag:"UpdateQuery",tableDef:e,values:s,where:[],returning:void 0,resultSchema:vs})},delete:()=>Rn(e,{_tag:"DeleteQuery",tableDef:e,where:[],returning:void 0,resultSchema:vs})};return{[Ca]:Ca,[Pf]:t,ResultType:"only-for-type-inference",asSql:()=>VC(t),toString:()=>{try{return VC(t).query}catch(r){return console.debug("QueryBuilder.toString(): Error converting query builder to string",r,t),"Error converting query builder to string"}},...n}},voe=e=>({_tag:"SelectQuery",columns:[],pickFirst:!1,select:{columns:[]},orderBy:[],offset:V(),limit:V(),tableDef:e,where:[],resultSchemaSingle:e.rowSchema});function ul(e){if(e._tag!=="SelectQuery")return Ce("Expected SelectQuery but got "+e._tag)}function Eoe(e){if(e._tag!=="InsertQuery")return Ce("Expected InsertQuery but got "+e._tag)}function koe(e){if(e._tag!=="InsertQuery"&&e._tag!=="UpdateQuery"&&e._tag!=="DeleteQuery")return Ce("Expected WriteQuery but got "+e._tag)}const $oe=e=>e._tag==="RowQuery",ll=e=>Ce("Invalid query builder"+(e?`: ${e}`:"")),a2=e=>{const t=e[Pf];switch(t._tag){case"SelectQuery":{const n=Me(t.resultSchemaSingle);if(t.pickFirst===!1)return n;if(t.pickFirst==="throws")return n.pipe(yl());{const r=t.pickFirst.fallback();return ie(n,Yee(oe(r))).pipe(yl(()=>r))}}case"CountQuery":return Y({count:je}).pipe(cu("count"),Me,yl());case"InsertQuery":case"UpdateQuery":case"DeleteQuery":return t.returning&&t.returning.length>0?t.tableDef.rowSchema.pipe(vf(...t.returning),Me):je;case"RowQuery":return t.tableDef.rowSchema.pipe(cu("value"),cte({title:`${t.tableDef.sqliteDef.name}.value`}),Me,yl());default:To(t)}},{integer:xt,text:Ae}=goe,Gn=e=>{const{name:t,columns:n,...r}=e,s=t,o={isClientDocumentTable:!1},a=e2(n)?{value:n}:n,u=s2(s,a,(r==null?void 0:r.indexes)??[]),f=o2(u),h=i2(u),p={sqliteDef:u,options:o,rowSchema:f,insertSchema:h},g=Rn(p);for(const k of Object.keys(g))p[k]=g[k];return p[Pf]=g[Pf],p[Ca]=g[Ca],p},A_="__livestore_schema",Coe=Gn({name:A_,columns:{tableName:Yr({primaryKey:!0}),schemaHash:mr({nullable:!1}),updatedAt:Yr({nullable:!1})}}),ap="__livestore_schema_event_defs",c2=Gn({name:ap,columns:{eventName:Yr({primaryKey:!0}),schemaHash:mr({nullable:!1}),updatedAt:Yr({nullable:!1})}}),Ff="__livestore_session_changeset",cp=Gn({name:Ff,columns:{seqNumGlobal:mr({schema:fu}),seqNumClient:mr({schema:op}),changeset:n2({nullable:!0}),debug:t0({nullable:!0})},indexes:[{columns:["seqNumGlobal","seqNumClient"],name:"idx_session_changeset_id"}]}),r0="__livestore_leader_merge_counter",Toe=Gn({name:r0,columns:{id:mr({primaryKey:!0,schema:oe(0)}),mergeCounter:mr({primaryKey:!0})}}),xf=[Coe,c2,cp,Toe],Ioe=e=>xf.some(t=>t.sqliteDef.name===e),Ms="eventlog",Nf=Gn({name:Ms,columns:{seqNumGlobal:mr({primaryKey:!0,schema:fu}),seqNumClient:mr({primaryKey:!0,schema:op}),parentSeqNumGlobal:mr({schema:fu}),parentSeqNumClient:mr({schema:op}),name:Yr({}),argsJson:Yr({schema:xs(Sn)}),clientId:Yr({}),sessionId:Yr({}),schemaHash:mr({}),syncMetadataJson:Yr({schema:xs(Zi(Ro))})},indexes:[{columns:["seqNumGlobal"],name:"idx_eventlog_seqNumGlobal"},{columns:["seqNumGlobal","seqNumClient"],name:"idx_eventlog_seqNum"}]}),Df="__livestore_sync_status",Roe=Gn({name:Df,columns:{head:mr({primaryKey:!0})}}),Ooe=[Nf,Roe],WC=ie(D,je,fN,lr);ie(Me(WC),Ku({key:D,value:WC})).pipe(ste("PreparedBindValues"));const kt=(e,...t)=>{let n="";for(const[r,s]of t.entries())n+=e[r]+String(s);return n+e[e.length-1]},ea=(e,t)=>{if(Array.isArray(e))return e;const n={};for(const[r,s]of Object.entries(e))t.includes(r)&&(n[`$${r}`]=s);return n},zh=(e,t,n)=>{const r=e.prepare(t),s=n?ea(n,t):void 0;r.execute(s),r.finalize()},u2=(e,t,n)=>{const r=e.prepare(t),s=r.select(void 0);return r.finalize(),s},qoe=(e,t)=>z(function*(){const n=t.getEventDefInfos(),r=n.filter(s=>!e.eventsDefsMap.has(s.eventName));r.length>0&&(yield*new De({cause:`Missing mutation definitions: ${r.map(s=>s.eventName).join(", ")}`}));for(const[,s]of e.eventsDefsMap){const o=n.find(a=>a.eventName===s.name);Aoe(s,t,o)}}),Aoe=(e,t,n)=>{const r=YE(e.schema);if(n===void 0){t.setEventDefInfo({schemaHash:r,eventName:e.name});return}r!==n.schemaHash&&t.setEventDefInfo({schemaHash:r,eventName:e.name})},Poe=Pre(()=>new Date().toISOString()),Foe=e=>z(function*(){return yield*up({db:e,tableAst:c2.sqliteDef.ast,behaviour:"create-if-not-exists"}),{getEventDefInfos:()=>u2(e,kt`SELECT * FROM ${ap}`),setEventDefInfo:t=>{zh(e,kt`INSERT OR REPLACE INTO ${ap} (eventName, schemaHash, updatedAt) VALUES ($eventName, $schemaHash, $updatedAt)`,{eventName:t.eventName,schemaHash:t.schemaHash,updatedAt:new Date().toISOString()})}}}),xoe=({db:e,schema:t,onProgress:n})=>z(function*(){for(const g of xf)yield*up({db:e,tableAst:g.sqliteDef.ast,behaviour:"create-if-not-exists"});const r=yield*Foe(e);yield*qoe(t,r);const s=u2(e,kt`SELECT * FROM ${A_}`),o=Object.fromEntries(s.map(({tableName:g,schemaHash:k})=>[g,k])),a=[...xf,...Array.from(t.state.sqlite.tables.values()).filter(g=>!Ioe(g.sqliteDef.name))],u=new Set,f=[];for(const g of a){const k=g.sqliteDef.ast,T=k.name,O=o[T],L=n0(k);L!==O&&(u.add({tableAst:k,schemaHash:L}),f.push({tableName:T,hashes:{expected:L,actual:O}}))}let h=0;const p=u.size;for(const{tableAst:g,schemaHash:k}of u)yield*up({db:e,tableAst:g,schemaHash:k,behaviour:"create-if-not-exists"}),n!==void 0&&(h++,yield*n({done:h,total:p}));return{migrations:f}}),up=({db:e,tableAst:t,schemaHash:n=n0(t),behaviour:r,skipMetaTable:s=!1})=>z(function*(){const o=t.name,a=Doe(t);zh(e,kt`create table if not exists '${o}' (${a}) strict`);for(const u of t.indexes)zh(e,Noe(o,u));if(s!==!0){const u=Poe();zh(e,kt`
      INSERT INTO ${A_} (tableName, schemaHash, updatedAt) VALUES ($tableName, $schemaHash, $updatedAt)
        ON CONFLICT (tableName) DO UPDATE SET schemaHash = $schemaHash, updatedAt = $updatedAt;
    `,{tableName:o,schemaHash:n,updatedAt:u})}}).pipe(Oe("@livestore/common:migrateTable",{attributes:{"span.label":t.name,tableName:t.name}})),Noe=(e,t)=>{const n=t.unique?"UNIQUE":"";return kt`create ${n} index if not exists '${t.name}' on '${e}' (${t.columns.join(", ")})`},Doe=e=>{const t=e.columns.filter(r=>r.primaryKey).map(r=>`'${r.name}'`),n=e.columns.map(Moe);return t.length>0&&n.push(`PRIMARY KEY (${t.join(", ")})`),n.join(", ")},Moe=e=>{const t=e.type._tag,n=e.nullable===!1?"not null":"",r=(()=>{if(e.default._tag==="None")return"";if(e.default.value===null)return"default null";if(t2(e.default.value))return`default ${e.default.value.sql}`;const o=ws(e.schema)(e.default.value);return t==="text"?`default '${o}'`:`default ${o}`})();return`'${e.name}' ${t} ${n} ${r}`},s0=e=>{const{name:t,schema:n,...r}=e,s=o=>{const a=Hee(n)(o);return a._tag==="Left"&&Ce(`Invalid event args for event '${t}':`,a.left.message,`
`),{name:t,args:o}};return Object.defineProperty(s,"name",{value:t}),Object.defineProperty(s,"schema",{value:n}),Object.defineProperty(s,"encoded",{value:o=>({name:t,args:o})}),Object.defineProperty(s,"options",{value:{clientOnly:(r==null?void 0:r.clientOnly)??!1,facts:r!=null&&r.facts?(o,a)=>{var f,h;const u=r.facts(o,a);return{modify:{set:(f=u.modify)!=null&&f.set?new Set(u.modify.set):new Set,unset:(h=u.modify)!=null&&h.unset?new Set(u.modify.unset):new Set},require:u.require?new Set(u.require):new Set}}:void 0,derived:(r==null?void 0:r.derived)??!1}}),s},pn=e=>s0({...e,clientOnly:!1}),l2=(e,t)=>t,Loe=(e,t)=>t,lp=s0({name:"livestore.RawSql",schema:Y({sql:D,bindValues:be(Ku({key:D,value:Sn})),writeTables:be(Lte(D))}),clientOnly:!0,derived:!0}),joe=l2(lp,({sql:e,bindValues:t,writeTables:n})=>({sql:e,bindValues:t??{},writeTables:n})),Uoe=({name:e,schema:t,...n})=>{const r={partialSet:n.partialSet??!0,default:{id:n.default.id,value:n.default.value}},s={id:Yr({primaryKey:!0}),value:t0({schema:t})},o=Gn({name:e,columns:s});o.options.isClientDocumentTable=!0;const{eventDef:a,materializer:u}=Boe({name:e,valueSchema:t,defaultValue:r.default.value,partialSet:r.partialSet}),f=(...g)=>{const[k,T=r.default.id]=g;return a({id:T,value:k})};Object.defineProperty(f,"name",{value:`${e}Set`}),Object.defineProperty(f,"schema",{value:Y({id:D,value:r.partialSet?Qm(t):t}).annotations({title:`${e}Set:Args`})}),Object.defineProperty(f,"options",{value:{derived:!0,clientOnly:!0,facts:void 0}});const h={get:Hoe(()=>p),set:f,Value:"only-for-type-inference",default:r.default,valueSchema:t,[Mf]:{derived:{setEventDef:a,setMaterializer:u},options:r}},p={...o,...h};return p},zoe=(e,t)=>typeof e!="object"||typeof t!="object"||e===null||t===null?t:Object.keys(e).reduce((n,r)=>(n[r]=t[r]??e[r],n),{}),Boe=({name:e,valueSchema:t,defaultValue:n,partialSet:r})=>{const s=s0({name:`${e}Set`,schema:Y({id:ie(D,Wee(ip)),value:r?Qm(t):t}).annotations({title:`${e}Set:Args`}),clientOnly:!0,derived:!0}),o=l2(s,({id:a,value:u})=>{if(a===ip)return Ce("SessionIdSymbol needs to be replaced before materializing the set event");if(vh(t.ast).length===0||r===!1){const h=xs(t),p=mh(h)(u??n),g=mh(h)(u);return{sql:`INSERT INTO '${e}' (id, value) VALUES (?, ?) ON CONFLICT (id) DO UPDATE SET value = ?`,bindValues:[a,p,g],writeTables:new Set([e])}}else{const h=xs(Qm(t)),p=mh(h)(zoe(n,u));let g="value";const k=[],T=Object.keys(u),O=t.pipe(vf(...T)),L=mh(O)(u);for(const _ in L){const C=L[_];C!==void 0&&(g=`json_set(${g}, ?, json(?))`,k.push(`$.${_}`,JSON.stringify(C)))}const E=k.length>0?`ON CONFLICT (id) DO UPDATE SET value = ${g}`:"ON CONFLICT (id) DO NOTHING";return{sql:`
      INSERT INTO '${e}' (id, value)
      VALUES (?, ?)
      ${E}
    `,bindValues:[a,p,...k],writeTables:new Set([e])}}});return{eventDef:s,materializer:o}},f2=e=>e.options.isClientDocumentTable===!0,Hoe=e=>((...t)=>{const n=e(),[r=n[Mf].options.default.id,s={}]=t,o=s.default??n[Mf].options.default.value,a={_tag:"RowQuery",tableDef:n,id:r,explicitDefaultValues:o},u=kt`SELECT * FROM '${n.sqliteDef.name}' WHERE id = ?`;return{[Ca]:Ca,[Pf]:a,ResultType:"only-for-type-inference",asSql:()=>({query:u,bindValues:[r]}),toString:()=>u.toString()}}),Mf=Symbol("ClientDocumentTableDef"),Voe=Symbol.for("livestore.LiveStoreSchema"),Woe=e=>{var s;const t=e.state,n=e.state.sqlite.tables;for(const o of xf)n.set(o.sqliteDef.name,o);const r=new Map;if(FN(e.events))for(const o of e.events)r.set(o.name,o);else for(const o of Object.values(e.events??{}))r.has(o.name)&&Ce(`Duplicate event name: ${o.name}. Please use unique names for events.`),r.set(o.name,o);r.set(lp.name,lp);for(const o of n.values())f2(o)&&r.has(o.set.name)===!1&&r.set(o.set.name,o.set);return{LiveStoreSchemaSymbol:Voe,_DbSchemaType:Symbol.for("livestore.DbSchemaType"),_EventDefMapType:Symbol.for("livestore.EventDefMapType"),state:t,eventsDefsMap:r,devtools:{alias:((s=e.devtools)==null?void 0:s.alias)??"default"}}},si=(e,t)=>{const n=e.eventsDefsMap.get(t);if(n===void 0)return Ce(`No mutation definition found for \`${t}\`.`);const r=e.state.materializers.get(t);return r===void 0?Ce(`No materializer found for \`${t}\`.`):{eventDef:n,materializer:r}},d2=({eventDef:e,materializer:t,dbState:n,event:r})=>{var f;const s=r.decoded===void 0?Bm(e.schema)(r.encoded.args):r.decoded.args,o=Cre((f=r.decoded)==null?void 0:f.args)?void 0:Nx(e.schema)(r.decoded.args);return h2(t(s,{eventDef:e,query:h=>{if(q_(h)){const{query:p,bindValues:g}=h.asSql(),k=n.select(p,ea(g,p)),T=a2(h);return wE(T)(k)}else{const{query:p,bindValues:g}=h;return n.select(p,ea(g,p))}},currentFacts:new Map})).map(h=>{const p=h.sql,g=typeof h=="string"?o:h.bindValues,k=typeof h=="string"?void 0:h.writeTables;return{statementSql:p,bindValues:ea(g??{},p),writeTables:k}})},Koe=({schema:e,dbState:t})=>n=>{if(k_()){const{eventDef:r,materializer:s}=si(e,n.name),o=d2({eventDef:r,materializer:s,dbState:t,event:{decoded:void 0,encoded:n}});return W(Tt(JSON.stringify(o)))}return V()},Joe=e=>Tt(JSON.stringify(e)),h2=e=>{if(FN(e))return e.flatMap(h2);if(q_(e)){const{query:t,bindValues:n}=e.asSql();return[{sql:t,bindValues:n,writeTables:void 0}]}else return typeof e=="string"?[{sql:e,bindValues:{},writeTables:void 0}]:[{sql:e.sql,bindValues:e.bindValues,writeTables:e.writeTables}]},Goe=e=>{const t=Array.isArray(e.tables)?e.tables:Object.values(e.tables),n=new Map;for(const o of t){const a=o.sqliteDef;n.has(a.ast.name)&&Ce(`Duplicate table name: ${a.ast.name}. Please use unique names for tables.`),n.set(a.ast.name,o)}for(const o of xf)n.set(o.sqliteDef.name,o);const r=new Map;for(const[o,a]of Object.entries(e.materializers))r.set(o,a);r.set(lp.name,joe);for(const o of t)f2(o)&&r.set(o[Mf].derived.setEventDef.name,o[Mf].derived.setMaterializer);const s=n0({_tag:"dbSchema",tables:[...n.values()].map(o=>o.sqliteDef.ast)});return{sqlite:{tables:n,migrations:e.migrations??{strategy:"auto"},hash:s},materializers:r}};Y({name:D,args:Sn,seqNum:In,parentSeqNum:In,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyDecoded"});const Qoe=Y({name:D,args:Sn,seqNum:In,parentSeqNum:In,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyEncoded"}),o0=Y({name:D,args:Sn,seqNum:fu,parentSeqNum:fu,clientId:D,sessionId:D}).annotations({title:"LiveStoreEvent.AnyEncodedGlobal"}),Yoe=Y({name:D,args:Sn}),Xoe=e=>ie(...[...e.eventsDefsMap.values()].map(t=>Y({name:oe(t.name),args:t.schema,seqNum:In,parentSeqNum:In,clientId:D,sessionId:D}))).annotations({title:"EventDef"}),Ll=class Ll extends La("LiveStoreEvent.EncodedWithMeta")({name:D,args:Sn,seqNum:In,parentSeqNum:In,clientId:D,sessionId:D,meta:Y({sessionChangeset:ie(ge("sessionChangeset",{data:fN,debug:Sn.pipe(be)}),ge("no-op",{}),ge("unset",{})),syncMetadata:Zi(Ro),materializerHashLeader:Zi(je),materializerHashSession:Zi(je)}).pipe(ote,be,sN({constructor:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()}),decoding:()=>({sessionChangeset:{_tag:"unset"},syncMetadata:V(),materializerHashLeader:V(),materializerHashSession:V()})}))}){constructor(){super(...arguments);d(this,"toJSON",()=>({seqNum:`${yr(this.seqNum)}  ${yr(this.parentSeqNum)} (${this.clientId}, ${this.sessionId})`,name:this.name,args:this.args}));d(this,"rebase",(n,r)=>new Ll({...this,...ZE(n,r)}));d(this,"toGlobal",()=>({...this,seqNum:this.seqNum.global,parentSeqNum:this.parentSeqNum.global}))}};d(Ll,"fromGlobal",(n,r)=>new Ll({...n,seqNum:{global:n.seqNum,client:mi},parentSeqNum:{global:n.parentSeqNum,client:mi},meta:{sessionChangeset:{_tag:"unset"},syncMetadata:r.syncMetadata,materializerHashLeader:r.materializerHashLeader,materializerHashSession:r.materializerHashSession}}));let Fn=Ll;const m2=(e,t)=>e.seqNum.global===t.seqNum.global&&e.seqNum.client===t.seqNum.client&&e.name===t.name&&e.clientId===t.clientId&&e.sessionId===t.sessionId&&JSON.stringify(e.args)===JSON.stringify(t.args),Zoe=({dbEventlog:e,schema:t,onProgress:n,materializeEvent:r})=>z(function*(){const s=e.select(`SELECT COUNT(*) AS count FROM ${Ms}`)[0].count,o=Fre(p=>YE(p.schema)),a=p=>z(function*(){const g=si(t,p.name);o(g.eventDef)!==p.schemaHash&&(yield*to(`Schema hash mismatch for event definition ${p.name}. Trying to materialize event anyway.`));const k=JSON.parse(p.argsJson);yield*au(g.eventDef.schema)(k).pipe(vo(O=>De.make({cause:O,note:`There was an error during rematerializing from the eventlog while decoding
the persisted event args for event definition "${p.name}".
This likely means the schema has changed in an incompatible way.
`})));const T=Fn.make({seqNum:{global:p.seqNumGlobal,client:p.seqNumClient},parentSeqNum:{global:p.parentSeqNumGlobal,client:p.parentSeqNumClient},name:p.name,args:k,clientId:p.clientId,sessionId:p.sessionId});yield*r(T,{skipEventlog:!0})}).pipe(Oe("@livestore/common:rematerializeFromEventlog:processEvent")),f=e.prepare(kt`\
SELECT * FROM ${Ms} 
WHERE seqNumGlobal > $seqNumGlobal OR (seqNumGlobal = $seqNumGlobal AND seqNumClient > $seqNumClient)
ORDER BY seqNumGlobal ASC, seqNumClient ASC
LIMIT ${100}
`);let h=0;yield*Sne({_tag:"Initial "},p=>{if(Wi(p)&&p.length===0)return V();const g=Wi(p)?xU(p).pipe(Zo(O=>({global:O.seqNumGlobal,client:O.seqNumClient})),Et(()=>ts)):ts,k=go(f.select({$seqNumGlobal:g==null?void 0:g.global,$seqNumClient:g==null?void 0:g.client})),T=Wi(p)?p:yt();return W([T,k])}).pipe(one({capacity:2}),Cn(p=>z(function*(){yield*a(p),h++,yield*n({done:h,total:s})})),fn)}).pipe(WE("@livestore/common:rematerializeFromEventlog"),Oe("@livestore/common:rematerializeFromEventlog"));class Pce extends Ur()("IsOfflineError",{}){}class eie extends Ur()("InvalidPushError",{reason:ie(ge("Unexpected",{message:D}),ge("ServerAhead",{minimumExpectedNum:je,providedNum:je}))}){}class tie extends Ur()("InvalidPullError",{message:D}){}class i0 extends Ur()("LeaderAheadError",{minimumExpectedNum:In,providedNum:In}){}class ys extends La("SyncState")({pending:Me(Fn),upstreamHead:In,localHead:In}){constructor(){super(...arguments);d(this,"toJSON",()=>({pending:this.pending.map(n=>n.toJSON()),upstreamHead:yr(this.upstreamHead),localHead:yr(this.localHead)}))}}class fp extends ge("upstream-rebase",{rollbackEvents:Me(Fn),newEvents:Me(Fn)}){}class ta extends ge("upstream-advance",{newEvents:Me(Fn)}){}class nie extends ge("local-push",{newEvents:Me(Fn)}){}class rie extends ie(fp,ta,nie){}class p2 extends ie(fp,ta){}class P_ extends La("MergeContext")({payload:rie,syncState:ys}){constructor(){super(...arguments);d(this,"toJSON",()=>({payload:Bx(this.payload).pipe(wy("local-push",()=>({_tag:"local-push",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),wy("upstream-advance",()=>({_tag:"upstream-advance",newEvents:this.payload.newEvents.map(r=>r.toJSON())})),wy("upstream-rebase",r=>({_tag:"upstream-rebase",newEvents:r.newEvents.map(s=>s.toJSON()),rollbackEvents:r.rollbackEvents.map(s=>s.toJSON())})),Hx),syncState:this.syncState.toJSON()}))}}class wl extends La("MergeResultAdvance")({_tag:oe("advance"),newSyncState:ys,newEvents:Me(Fn),confirmedEvents:Me(Fn),mergeContext:P_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),confirmedEvents:this.confirmedEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class bS extends La("MergeResultRebase")({_tag:oe("rebase"),newSyncState:ys,newEvents:Me(Fn),rollbackEvents:Me(Fn),mergeContext:P_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,newSyncState:this.newSyncState.toJSON(),newEvents:this.newEvents.map(n=>n.toJSON()),rollbackEvents:this.rollbackEvents.map(n=>n.toJSON()),mergeContext:this.mergeContext.toJSON()}))}}class g2 extends La("MergeResultReject")({_tag:oe("reject"),expectedMinimumId:In,mergeContext:P_}){constructor(){super(...arguments);d(this,"toJSON",()=>({_tag:this._tag,expectedMinimumId:yr(this.expectedMinimumId),mergeContext:this.mergeContext.toJSON()}))}}class _2 extends La("MergeResultUnexpectedError")({_tag:oe("unexpected-error"),cause:De}){}class Fce extends ie(wl,bS,g2,_2){}const SS=e=>{if(Ds)debugger;return _2.make({_tag:"unexpected-error",cause:new De({cause:e})})},y2=({syncState:e,payload:t,isClientEvent:n,isEqualEvent:r,ignoreClientEvents:s=!1})=>{var a,u,f;b2(e),sie(t);const o=P_.make({payload:t,syncState:e});switch(t._tag){case"upstream-rebase":{const h=[...t.rollbackEvents,...e.pending],p=((a=t.newEvents.at(-1))==null?void 0:a.seqNum)??e.upstreamHead,g=KC({events:e.pending,baseEventSequenceNumber:p,isClientEvent:n});return Ti(bS.make({_tag:"rebase",newSyncState:new ys({pending:g,upstreamHead:p,localHead:((u=g.at(-1))==null?void 0:u.seqNum)??p}),newEvents:[...t.newEvents,...g],rollbackEvents:h,mergeContext:o}))}case"upstream-advance":{if(t.newEvents.length===0)return Ti(wl.make({_tag:"advance",newSyncState:new ys({pending:e.pending,upstreamHead:e.upstreamHead,localHead:e.localHead}),newEvents:[],confirmedEvents:[],mergeContext:o}));for(let g=1;g<t.newEvents.length;g++)if(jh(t.newEvents[g-1].seqNum,t.newEvents[g].seqNum))return SS(`Events must be sorted in ascending order by event number. Received: [${t.newEvents.map(k=>yr(k.seqNum)).join(", ")}]`);if(jh(e.upstreamHead,t.newEvents[0].seqNum)||R_(e.upstreamHead,t.newEvents[0].seqNum))return SS(`Incoming events must be greater than upstream head. Expected greater than: ${yr(e.upstreamHead)}. Received: [${t.newEvents.map(g=>yr(g.seqNum)).join(", ")}]`);const h=t.newEvents.at(-1).seqNum,p=wS({existingEvents:e.pending,incomingEvents:t.newEvents,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});if(p===-1){const g=new Set(e.pending.map(E=>`${E.seqNum.global},${E.seqNum.client}`)),k=t.newEvents.filter(E=>!g.has(`${E.seqNum.global},${E.seqNum.client}`));let T=0;const[O,L]=j1(e.pending,(E,S)=>{if(s&&n(E))return T++,!1;const _=t.newEvents.at(S-T);return _?r(E,_)===!1:!0});return Ti(wl.make({_tag:"advance",newSyncState:new ys({pending:L,upstreamHead:h,localHead:((f=L.at(-1))==null?void 0:f.seqNum)??ZN(e.localHead,h)}),newEvents:k,confirmedEvents:O,mergeContext:o}))}else{const g=e.pending.slice(p),k=KC({events:g,baseEventSequenceNumber:h,isClientEvent:n}),T=wS({existingEvents:t.newEvents,incomingEvents:e.pending,isEqualEvent:r,isClientEvent:n,ignoreClientEvents:s});return Ti(bS.make({_tag:"rebase",newSyncState:new ys({pending:k,upstreamHead:h,localHead:k.at(-1).seqNum}),newEvents:[...t.newEvents.slice(T),...k],rollbackEvents:g,mergeContext:o}))}}case"local-push":{if(t.newEvents.length===0)return Ti(wl.make({_tag:"advance",newSyncState:e,newEvents:[],confirmedEvents:[],mergeContext:o}));const h=t.newEvents.at(0);if(jh(h.seqNum,e.localHead)===!1){const g=ZE(e.localHead,!0).seqNum;return Ti(g2.make({_tag:"reject",expectedMinimumId:g,mergeContext:o}))}else return Ti(wl.make({_tag:"advance",newSyncState:new ys({pending:[...e.pending,...t.newEvents],upstreamHead:e.upstreamHead,localHead:t.newEvents.at(-1).seqNum}),newEvents:t.newEvents,confirmedEvents:[],mergeContext:o}))}default:To(t)}},wS=({existingEvents:e,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:s})=>{if(s){const o=e.filter(f=>!r(f)),a=wS({existingEvents:o,incomingEvents:t,isEqualEvent:n,isClientEvent:r,ignoreClientEvents:!1});if(a===-1)return-1;const u=e[a].seqNum;return e.findIndex(f=>R_(f.seqNum,u))}return e.findIndex((o,a)=>{const u=t[a];return u&&!n(o,u)})},KC=({events:e,baseEventSequenceNumber:t,isClientEvent:n})=>{let r=t;return e.map(s=>{const o=n(s),a=s.rebase(r,o);return r=a.seqNum,a})},sie=e=>{for(let t=1;t<e.newEvents.length;t++)if($a(e.newEvents[t-1].seqNum,e.newEvents[t].seqNum))return SS(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.newEvents.map(n=>yr(n.seqNum)).join(", ")}]`)},b2=e=>{for(let t=0;t<e.pending.length;t++){const n=e.pending[t],r=e.pending[t+1];if(r===void 0)break;$a(n.seqNum,r.seqNum)&&Ce(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.pending.map(o=>yr(o.seqNum)).join(", ")}]`,{event:n,nextEvent:r}),r.seqNum.global>n.seqNum.global?r.seqNum.client!==0&&Ce(`New global events must point to clientId 0 in the parentSeqNum. Received: (${yr(r.seqNum)})`,e.pending,{event:n,nextEvent:r}):R_(r.parentSeqNum,n.seqNum)===!1&&Ce("Events must be linked in a continuous chain via the parentSeqNum",e.pending,{event:n,nextEvent:r})}},Ti=e=>(e._tag==="unexpected-error"||e._tag==="reject"||(b2(e.newSyncState),jh(e.newSyncState.upstreamHead,e.newSyncState.localHead)&&Ce("Local head must be greater than or equal to upstream head",{localHead:e.newSyncState.localHead,upstreamHead:e.newSyncState.upstreamHead}),$a(e.newSyncState.localHead,e.mergeContext.syncState.localHead)===!1&&Ce("New local head must be greater than or equal to the previous local head",{localHead:e.newSyncState.localHead,previousLocalHead:e.mergeContext.syncState.localHead}),$a(e.newSyncState.upstreamHead,e.mergeContext.syncState.upstreamHead)===!1&&Ce("New upstream head must be greater than or equal to the previous upstream head",{upstreamHead:e.newSyncState.upstreamHead,previousUpstreamHead:e.mergeContext.syncState.upstreamHead})),e),oie="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ho=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=oie[n[e]&63];return t};const F_="0.3.1",JC=4,iie=Y({isConnected:Ea,timestampMs:je,latchClosed:Ea}),Bh=D,aie=D,Hh=oe(F_),S2=(e,t)=>ge(e,{liveStoreVersion:Hh,...t}).annotations({identifier:e}),cie=(e,t)=>S2(e,{clientId:aie,...t}),Lt=(e,t)=>cie(e,{requestId:Bh,...t}),a0=(e,t)=>{const n=ge(`${e}.Response.Success`,{requestId:Bh,liveStoreVersion:Hh,...t.success}).annotations({identifier:`${e}.Response.Success`}),r=t.error?ge(`${e}.Response.Error`,{requestId:Bh,liveStoreVersion:Hh,...t.error}).annotations({identifier:`${e}.Response.Error`}):g_;return{Request:ge(`${e}.Request`,{requestId:Bh,liveStoreVersion:Hh,...t.payload}).annotations({identifier:`${e}.Request`}),Response:ie(n,r),Success:n,Error:r}};class xce extends Lt("LSD.Leader.ResetAllDataReq",{mode:oe("all-data","only-app-db")}){}class uie extends Lt("LSD.Leader.DatabaseFileInfoReq",{}){}class GC extends Y({fileSize:je,persistenceInfo:Y({fileName:D},{key:D,value:Sn})}){}class w2 extends Lt("LSD.Leader.DatabaseFileInfoRes",{state:GC,eventlog:GC}){}class lie extends Lt("LSD.Leader.NetworkStatusSubscribe",{subscriptionId:D}){}class fie extends Lt("LSD.Leader.NetworkStatusUnsubscribe",{subscriptionId:D}){}class v2 extends Lt("LSD.Leader.NetworkStatusRes",{networkStatus:iie,subscriptionId:D}){}class die extends Lt("LSD.Leader.SyncingInfoReq",{}){}class E2 extends Y({enabled:Ea,metadata:Ku({key:D,value:Sn})}){}class k2 extends Lt("LSD.Leader.SyncingInfoRes",{syncingInfo:E2}){}class hie extends Lt("LSD.Leader.SyncHistorySubscribe",{subscriptionId:D}){}class mie extends Lt("LSD.Leader.SyncHistoryUnsubscribe",{subscriptionId:D}){}class $2 extends Lt("LSD.Leader.SyncHistoryRes",{eventEncoded:o0,metadata:Zi(Ro),subscriptionId:D}){}class pie extends Lt("LSD.Leader.SyncHeadSubscribe",{subscriptionId:D}){}class gie extends Lt("LSD.Leader.SyncHeadUnsubscribe",{subscriptionId:D}){}class C2 extends Lt("LSD.Leader.SyncHeadRes",{local:In,upstream:In,subscriptionId:D}){}class _ie extends Lt("LSD.Leader.SnapshotReq",{}){}class T2 extends Lt("LSD.Leader.SnapshotRes",{snapshot:Pc}){}const _c=a0("LSD.Leader.LoadDatabaseFile",{payload:{data:Pc},success:{},error:{cause:ie(ge("unsupported-file",{}),ge("unsupported-database",{}),ge("unexpected-error",{cause:ka}))}});class I2 extends S2("LSD.Leader.SyncPull",{payload:p2}){}class yie extends Lt("LSD.Leader.CommitEventReq",{eventEncoded:Yoe}){}class R2 extends Lt("LSD.Leader.CommitEventRes",{}){}class bie extends Lt("LSD.Leader.EventlogReq",{}){}class O2 extends Lt("LSD.Leader.EventlogRes",{eventlog:Pc}){}let Sie=class extends Lt("LSD.Leader.Ping",{}){},q2=class extends Lt("LSD.Leader.Pong",{}){};class A2 extends Lt("LSD.Leader.Disconnect",{}){}const c0=a0("LSD.Leader.SetSyncLatch",{payload:{closeLatch:Ea},success:{}}),u0=a0("LSD.Leader.ResetAllData",{payload:{mode:oe("all-data","only-app-db")},success:{}}),P2=ie(_ie,_c.Request,bie,u0.Request,lie,fie,A2,yie,Sie,uie,hie,mie,die,pie,gie,c0.Request).annotations({identifier:"LSD.Leader.MessageToApp"}),wie=ie(T2,_c.Response,O2,A2,I2,v2,R2,q2,w2,$2,k2,C2,u0.Success,c0.Success).annotations({identifier:"LSD.Leader.MessageFromApp"}),vie=ie(ge("node",{url:D}),ge("web",{}),ge("browser-extension",{}));vie.pipe(cu("_tag"),Fs);const Eie={client:{session:({storeId:e,clientId:t,sessionId:n})=>`client-session-${e}-${t}-${n}`,leader:({storeId:e,clientId:t})=>`client-leader-${e}-${t}`}},kie={sessionInfo:()=>"session-info",devtoolsClientSession:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-session-${e}-${t}-${n})`,devtoolsClientLeader:({storeId:e,clientId:t,sessionId:n})=>`devtools-channel(client-leader-${e}-${t}-${n})`},$ie={devtoolsClientSession:(e,{storeId:t,clientId:n,sessionId:r})=>e===kie.devtoolsClientSession({storeId:t,clientId:n,sessionId:r}),devtoolsClientLeader:(e,{storeId:t,clientId:n})=>e.startsWith(`devtools-channel(client-leader-${t}-${n}`)},zd=D.pipe(be,sN({constructor:()=>ho(10),decoding:()=>ho(10)})),Ua={id:zd,target:D,source:D,channelName:D,hops:Me(D)},F2=Yx.pipe(be);class Vh extends ge("DirectChannelRequest",{...Ua,remainingHops:Me(D).pipe(be),channelVersion:je,reqId:__(D),sourceId:D}){}class x2 extends ge("DirectChannelResponseSuccess",{...Ua,reqId:D,port:T_,remainingHops:Me(D),channelVersion:je}){}class l0 extends ge("DirectChannelResponseNoTransferables",{...Ua,reqId:D,remainingHops:Me(D)}){}class N2 extends ge("ProxyChannelRequest",{...Ua,remainingHops:F2,channelIdCandidate:D}){}class D2 extends ge("ProxyChannelResponseSuccess",{...Ua,reqId:D,remainingHops:Me(D),combinedChannelId:D,channelIdCandidate:D}){}class M2 extends ge("ProxyChannelPayload",{...Ua,remainingHops:F2,payload:Sn,combinedChannelId:D}){}class L2 extends ge("ProxyChannelPayloadAck",{...Ua,reqId:D,remainingHops:Me(D),combinedChannelId:D}){}class vS extends ge("NetworkEdgeAdded",{id:zd,source:D,target:D}){}class ES extends ge("NetworkTopologyRequest",{id:zd,hops:Me(D),source:D,target:oe("-")}){}class kS extends ge("NetworkTopologyResponse",{id:zd,reqId:D,remainingHops:Me(D),nodeName:D,edges:Me(D),source:D,target:oe("-")}){}const Wh=ge("BroadcastChannelPacket",{id:zd,channelName:D,payload:Sn,hops:Me(D),source:D,target:oe("-")});class $S extends ie(Vh,x2,l0){}class j2 extends ie(N2,D2,M2,L2){}class U2 extends ie($S,j2,vS,ES,kS,Wh){}class gh extends ge("DirectChannelPing",{}){}class _h extends ge("DirectChannelPong",{}){}class Cie extends Ur()("EdgeAlreadyExistsError",{target:D}){}const Ml=e=>({packetId:e.id,"span.label":e.id+(ne(e,"reqId")&&e.reqId!==void 0?` for ${e.reqId}`:""),...e._tag!=="DirectChannelResponseSuccess"&&e._tag!=="ProxyChannelPayload"?{packet:e}:{}});Y({channelName:D,source:D,mode:ie(oe("proxy"),oe("direct"))});const Tie=Ue,Iie=({nodeName:e,incomingPacketsQueue:t,target:n,checkTransferableEdges:r,channelName:s,schema:o,sendPacket:a,channelVersion:u,scope:f,sourceId:h})=>z(function*(){const p=yield*Tie(),g=yield*VE.pipe(Lg(()=>Ve(void 0))),k={send:ie(o.send,gh,_h),listen:ie(o.listen,gh,_h)},T={current:{_tag:"Initial"}},O=({packet:_,respondToSender:C})=>z(function*(){const $=T.current;if(g==null||g.addEvent(`process:${_._tag}`,{channelState:$._tag,packetId:_.id,packetReqId:_.reqId,packetChannelVersion:ne("channelVersion")(_)?_.channelVersion:void 0}),$._tag==="Initial")return Ce();if(_._tag==="DirectChannelResponseNoTransferables")return yield*Uw(p,_),"close";if(_.channelVersion>u)return g==null||g.addEvent(`incoming packet has higher version (${_.channelVersion}), closing channel`),yield*kn(f,Kt("higher-version-expected")),"close";if(_.channelVersion<u){const q=Vh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:void 0});g==null||g.addEvent(`incoming packet has lower version (${_.channelVersion}), sending request to reconnect (${q.id})`),yield*a(q);return}if($._tag==="Established"&&_._tag==="DirectChannelRequest")return _.sourceId===$.otherSourceId?void 0:(g==null||g.addEvent("force-new-channel"),yield*kn(f,Kt("force-new-channel")),"close");switch(_._tag){case"DirectChannelRequest":{if($._tag!=="RequestSent")return;if(_.reqId!==$.reqPacketId){const P=Vh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],remainingHops:_.hops,reqId:_.id});g==null||g.addEvent(`Re-sending new request (${P.id}) for incoming request (${_.id})`),yield*a(P)}if(e>n){g==null||g.addEvent("winner side: creating direct channel and sending response");const P=new MessageChannel,N=yield*BC({port:P.port1,schema:k,debugId:u}).pipe(Qr(HC));yield*C(x2.make({reqId:_.id,target:n,source:e,channelName:_.channelName,hops:[],remainingHops:_.hops.slice(0,-1),port:P.port2,channelVersion:u})),T.current={_tag:"winner:ResponseSent",channel:N,otherSourceId:_.sourceId},yield*N.listen.pipe(kf(),Ns(On(gh)),uu(1),fn),yield*N.send(_h.make({})),g==null||g.addEvent("winner side: established"),T.current={_tag:"Established",otherSourceId:_.sourceId},yield*ut(p,N)}else g==null||g.addEvent("loser side: waiting for response"),T.current={_tag:"loser:WaitingForResponse",otherSourceId:_.sourceId};break}case"DirectChannelResponseSuccess":{if($._tag!=="loser:WaitingForResponse")return Ce(`Expected to find direct channel response from ${n}, but was in ${$._tag} state`);const q=yield*BC({port:_.port,schema:k,debugId:u}).pipe(Qr(HC)),P=yield*q.listen.pipe(kf(),Ns(On(_h)),uu(1),fn,Ug);yield*q.send(gh.make({})).pipe(zg(10),Dv({times:2})),yield*P,g==null||g.addEvent("loser side: established"),T.current={_tag:"Established",otherSourceId:$.otherSourceId},yield*ut(p,q);return}default:return To(_)}}).pipe(Oe(`handleMessagePacket:${_._tag}:${_.source}${_.target}`,{attributes:Ml(_)}));yield*z(function*(){for(;;){const _=yield*ko(t);if((yield*O(_))==="close")return}}).pipe(Pt,vt,Jt);const L=T.current;return L._tag!=="Initial"?Ce(`Expected channel to be in Initial state, but was in ${L._tag} state`):(yield*z(function*(){const _=Vh.make({source:e,sourceId:h,target:n,channelName:s,channelVersion:u,hops:[],reqId:void 0});T.current={_tag:"RequestSent",reqPacketId:_.id};const C=r(_);if(C!==void 0)return yield*Qn(`No transferable edges found for ${_.source}${_.target}`),yield*Hn(C);yield*a(_),g==null||g.addEvent(`initial edge request sent (${_.id})`)}),yield*p)}).pipe(Rd(`makeDirectChannel:${u}`)),Rie=({schema:e,newEdgeAvailablePubSub:t,channelName:n,checkTransferableEdges:r,nodeName:s,incomingPacketsQueue:o,target:a,sendPacket:u})=>Ju(f=>z(function*(){const h=ho(),p=yield*yn(),g=yield*lX(),k=yield*Ue(),T={pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1,innerChannelRef:{current:void 0}};yield*z(function*(){const C=yield*Ue();for(;;){T.connectCounter++;const N=T.connectCounter;yield*Qn(`Connecting#${N}`);const M=yield*Rv();yield*nr(Z=>kn(M,Z));const B=yield*ep(t).pipe(Cn(Z=>Qn(`new-conn:${Z}`)),uu(1),fn,fo("new-edge"),Ug),F=Iie({nodeName:s,sourceId:h,incomingPacketsQueue:o,target:a,checkTransferableEdges:r,channelName:n,schema:e,channelVersion:N,sendPacket:u,scope:M}).pipe(Tv(M),_r(M),SQ(V())),j=yield*NP(F,B.pipe(sQ));if(j==="new-edge")yield*kn(M,md("new-edge"));else{const Z=yield*j.pipe(Qt);if(Z._tag==="Failure")yield*kn(M,Z),zA(Z.cause)&&On(l0)(Z.cause.error)&&(yield*B.pipe(Qt));else{const we=Z.value;yield*ut(C,{channel:we,makeDirectChannelScope:M,channelVersion:N});break}}}const{channel:$,makeDirectChannelScope:q,channelVersion:P}=yield*C;yield*Qn(`Connected#${P}`),T.isConnected=!0,T.innerChannelRef.current=$,yield*ut(k,void 0),yield*$.listen.pipe(kf(),vN(N=>Xv(p,N)),fn,vt,_r(q)),yield*z(function*(){for(;;){const[N,M]=yield*cX(g);yield*$.send(N),yield*ut(M,void 0),yield*uX(g)}}).pipe(_r(q)),yield*$.closedDeferred,yield*kn(q,Kt("channel-closed")),yield*Qn(`Disconnected#${P}`),T.isConnected=!1,T.innerChannelRef.current=void 0}).pipe(di,pf,vt,Jt);const O=yield*Hg.pipe(Or),L=C=>z(function*(){const $=yield*Ue();T.pendingSends++,T.totalSends++,yield*aX(g,[C,$]),yield*$,T.pendingSends--}).pipe(di,ji(O)),E=Co(p,{maxChunkSize:1}).pipe(vi(le)),S=yield*Ue().pipe(at(Fa(tr)));return{webChannel:{[rr]:rr,send:L,listen:E,closedDeferred:S,supportsTransferables:!0,schema:e,debugInfo:T,shutdown:kn(f,Kt("shutdown"))},initialEdgeDeferred:k}})),Oie=({queue:e,nodeName:t,newEdgeAvailablePubSub:n,sendPacket:r,target:s,channelName:o,schema:a})=>Ju(u=>z(function*(){const f={current:{_tag:"Initial"}},h={kind:"proxy-channel",pendingSends:0,totalSends:0,connectCounter:0,isConnected:!1},p=ho(5);yield*Fb({channelIdCandidate:p});const g=yield*Hg.pipe(Or),k=yield*$f(!1),T=z(function*(){return yield*Cf(k,j=>j!==!1)}),O=F=>z(function*(){yield*Qn(`Connected (${F})`).pipe(ji(g)),f.current={_tag:"Established",listenSchema:a.listen,listenQueue:C,ackMap:$,combinedChannelId:F},yield*Ar(k,f.current),h.isConnected=!0}),L=_t(()=>r(N2.make({channelName:o,hops:[],source:t,target:s,channelIdCandidate:p}))),E=F=>[p,F].sort().join("_"),S=yield*yn().pipe(at(Mt)),_=({packet:F,respondToSender:j})=>z(function*(){const we=`target:${F.source}, channelName:${F.channelName}`,G=f.current;switch(F._tag){case"ProxyChannelRequest":{const ke=E(F.channelIdCandidate);G._tag==="Established"?G.combinedChannelId===ke||(yield*to(`[${t}] Received ProxyChannelRequest with different channel ID (${ke}) while established with ${G.combinedChannelId}. Re-establishing.`),yield*Ar(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Qn("Reconnecting (received conflicting ProxyChannelRequest)").pipe(ji(g)),h.isConnected=!1,h.connectCounter++,yield*L):G._tag==="Initial"&&(yield*Ar(k,!1),f.current={_tag:"Pending",initiatedVia:"incoming-request"},yield*Qn("Connecting (received ProxyChannelRequest)").pipe(ji(g)),h.isConnected=!1,h.connectCounter++),yield*j(D2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:ke,channelIdCandidate:p}));return}case"ProxyChannelResponseSuccess":{if(G._tag!=="Pending"){if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return Ce(`ProxyChannel[${we}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(G._tag==="Established")return;yield*to(`[${t}] Ignoring ResponseSuccess ${F.id} received in unexpected state ${G._tag}`);return}const ke=E(F.channelIdCandidate);if(ke!==F.combinedChannelId)return yield*li(`ProxyChannel[${we}]: Expected proxy channel to have the same combinedChannelId as the packet:
${ke} (channel) === ${F.combinedChannelId} (packet)`);yield*O(F.combinedChannelId);const qe=f.current;if(qe._tag==="Established"){const We=yield*B9(S);for(const tt of We){if(qe.combinedChannelId!==tt.combinedChannelId){yield*to(`[${t}] Discarding buffered payload ${tt.id}: Combined channel ID mismatch during drain. Expected ${qe.combinedChannelId}, got ${tt.combinedChannelId}`);continue}const Ke=yield*au(qe.listenSchema)(tt.payload);yield*qe.listenQueue.pipe(Ze(Ke))}}else yield*ru(`[${t}] State is not Established immediately after setStateToEstablished was called. Cannot drain buffer. State: ${qe._tag}`);return}case"ProxyChannelPayload":{if(G._tag==="Established"&&G.combinedChannelId!==F.combinedChannelId)return yield*li(`ProxyChannel[${we}]: Expected proxy channel to have the same combinedChannelId as the packet:
${G.combinedChannelId} (channel) === ${F.combinedChannelId} (packet)`);if(yield*j(L2.make({reqId:F.id,remainingHops:F.hops,hops:[],target:s,source:t,channelName:o,combinedChannelId:G._tag==="Established"?G.combinedChannelId:F.combinedChannelId})),G._tag==="Established"){const ke=yield*au(G.listenSchema)(F.payload);yield*G.listenQueue.pipe(Ze(ke))}else yield*Ze(S,F);return}case"ProxyChannelPayloadAck":{if(G._tag!=="Established"){yield*Qn(`Not yet connected to ${s}. dropping message`),yield*to(`[${t}] Received Ack but not established (State: ${G._tag}). Dropping Ack for ${F.reqId}`);return}const ke=G.ackMap.get(F.reqId)??Ce(`[ProxyChannel[${we}]] Expected ack for ${F.reqId}`);yield*ut(ke,void 0),G.ackMap.delete(F.reqId);return}default:return To(F)}}).pipe(Oe(`handleProxyPacket:${F._tag}:${F.source}->${F.target}`,{attributes:Ml(F)}));yield*Co(e).pipe(Cn(_),fn,vt,Jt);const C=yield*yn();yield*Qn("Connecting");const $=new Map;{if(f.current._tag!=="Initial")return Ce("Expected proxy channel to be Initial");f.current={_tag:"Pending",initiatedVia:"outgoing-request"},yield*L;const F=yield*ep(n).pipe(Cn(()=>L),fn,Jt),{combinedChannelId:j}=yield*T;yield*Dr(F),yield*O(j)}const q=F=>z(function*(){const j=yield*Wx(a.send)(F),Z=yield*Ix(),we=yield*Ue();h.pendingSends++,h.totalSends++;const G=z(function*(){const{combinedChannelId:qe}=yield*Cf(k,tt=>tt!==!1);yield*z(function*(){const tt=yield*Ue(),Ke=M2.make({channelName:o,payload:j,hops:[],source:t,target:s,combinedChannelId:qe});$.set(Ke.id,tt),yield*r(Ke),yield*tt,yield*ut(we,void 0),h.pendingSends--}).pipe(zg(100),Dv(JF(10)),Or)}).pipe(Nu(ru)),ke=yield*k.changes.pipe(Ns(qe=>qe===!1),Cn(()=>zm(Z,G)),fn,Ug);yield*zm(Z,G),yield*we,yield*Dr(ke)}).pipe(di,Oe("sendAckWithRetry:ProxyChannelPayload"),ji(g)),P=Co(C).pipe(vi(le)),N=yield*Ue().pipe(at(Fa(tr))),M=yield*No();return{[rr]:rr,send:q,listen:P,closedDeferred:N,supportsTransferables:!1,schema:a,shutdown:kn(u,tr),debugInfo:h,debug:{ping:(F="ping")=>q(Af.make({message:F})).pipe(An(M),vt,Do)}}}).pipe(Rd("makeProxyChannel"))),hp=class hp{constructor({timeout:t}){d(this,"values",new Map);d(this,"timeoutHandle");d(this,"timeoutMs");d(this,"onShutdown",()=>clearTimeout(this.timeoutHandle));this.timeoutMs=Dc(t)}add(t){this.values.set(t,Date.now()),this.scheduleCleanup()}has(t){return this.values.has(t)}delete(t){this.values.delete(t)}scheduleCleanup(){this.timeoutHandle===void 0&&(this.timeoutHandle=setTimeout(()=>{this.cleanup(),this.timeoutHandle=void 0},this.timeoutMs))}cleanup(){const t=Date.now();for(const[n,r]of this.values.entries())t-r>=this.timeoutMs&&this.values.delete(n)}};d(hp,"make",t=>z(function*(){const n=new hp({timeout:t});return yield*nr(()=>Re(()=>n.onShutdown())),n}));let CS=hp;const qie=e=>z(function*(){const t=new Map,n=yield*CS.make(UR(1)),r=yield*Yv().pipe(at(xm)),s=new Map,o=yield*yn().pipe(at(Mt)),a=new Map,u=new Map,f=$=>{var q;if($._tag==="DirectChannelRequest"&&(t.size===0||((q=t.get($.target))==null?void 0:q.channel.supportsTransferables)===!1)||![...t.values()].some(P=>P.channel.supportsTransferables===!0))return l0.make({reqId:$.id,channelName:$.channelName,source:$.target,target:$.source,remainingHops:$.hops,hops:[]})},h=$=>z(function*(){var q,P;if(On(vS)($)){yield*Qn("NetworkEdgeAdded",{packet:$,nodeName:e}),yield*Jg(r,$.target);const N=Array.from(t).filter(([M])=>M!==$.source).map(([M,B])=>B.channel);yield*$n(N,M=>M.send($),{concurrency:"unbounded"});return}if(On(Wh)($)){const N=Array.from(t).filter(([F])=>!$.hops.includes(F)).map(([F,j])=>j.channel),M={...$,hops:[...$.hops,e]};if(yield*$n(N,F=>F.send(M),{concurrency:"unbounded"}),$.source===e)return;const B=u.get($.channelName);B!==void 0&&(yield*Ze(B,$));return}if(On(ES)($)){if($.source!==e){const B=$.hops.at(-1)??Ce(`${e}: Expected hops for packet`,$),F=t.get(B).channel,j=kS.make({reqId:$.id,source:$.source,target:$.target,remainingHops:$.hops.slice(0,-1),nodeName:e,edges:Array.from(t.keys())});yield*F.send(j)}const N=Array.from(t).filter(([B])=>!$.hops.includes(B)).map(([B,F])=>F.channel),M={...$,hops:[...$.hops,e]};yield*$n(N,B=>B.send(M),{concurrency:"unbounded"});return}if(On(kS)($)){if($.source===e)a.get($.reqId).set($.nodeName,new Set($.edges));else{const M=$.remainingHops.at(-1)??Ce(`${e}: Expected remaining hops for packet`,$);yield*(((q=t.get(M))==null?void 0:q.channel)??Ce(`${e}: Expected edge channel (${M}) for packet`,$,"Available edges:",Array.from(t.keys()))).send({...$,remainingHops:$.remainingHops.slice(0,-1)})}return}if(t.has($.target)){const N=t.get($.target).channel,M=$.source===e?[]:[...$.hops,e];yield*Fb({hasDirectEdge:!0}),yield*N.send({...$,hops:M})}else if($.remainingHops!==void 0){const N=$.remainingHops.at(-1)??Ce(`${e}: Expected remaining hops for packet`,$),M=(P=t.get(N))==null?void 0:P.channel;if(M===void 0){yield*to(`${e}: Expected to find hop target ${N} in edges. Dropping packet.`,$);return}yield*M.send({...$,remainingHops:$.remainingHops.slice(0,-1),hops:[...$.hops,e]})}else{const N=$.source===e?[]:[...$.hops,e],M=Array.from(t).filter(([F])=>F!==$.source).map(([F,j])=>({name:F,channel:j.channel}));N.length===0&&M.length===0&&Ds&&(yield*to(e,"no route found to",$.target,$._tag,"TODO handle better"));const B={...$,hops:N};yield*Fb({edgesToForwardTo:M.map(({name:F})=>F)}),yield*$n(M,({channel:F})=>F.send(B),{concurrency:"unbounded"})}}).pipe(Oe(`sendPacket:${$._tag}:${$.source}${$.target}`,{attributes:Ml($)}),Or),p=({target:$,edgeChannel:q,replaceIfExists:P=!1})=>z(function*(){if(t.has($))if(P)yield*g($).pipe(Or);else return yield*new Cie({target:$});const N=yield*q.listen.pipe(kf(),Cn(B=>z(function*(){const F=yield*au(U2)(B);if(!n.has(F.id))switch(n.add(F.id),F._tag){case"NetworkEdgeAdded":case"NetworkTopologyRequest":case"NetworkTopologyResponse":{yield*h(F);break}default:if(F.target===e){const j=`target:${F.source}, channelName:${F.channelName}`;if(!s.has(j)){const G=yield*yn().pipe(at(Mt));s.set(j,{queue:G,debugInfo:void 0})}const Z=s.get(j).queue,we=G=>q.send(G).pipe(Oe(`respondToSender:${G._tag}:${G.source}${G.target}`,{attributes:Ml(G)}),Or);On(j2)(F)?yield*Ze(Z,{packet:F,respondToSender:we}):On($S)(F)&&(yield*Ze(Z,{packet:F,respondToSender:we})),(F._tag==="ProxyChannelRequest"||F._tag==="DirectChannelRequest")&&(yield*Ze(o,{channelName:F.channelName,source:F.source,mode:F._tag==="ProxyChannelRequest"?"proxy":"direct"}))}else{if(On($S)(F)){const j=f(F);if(j!==void 0)return yield*Qn(`No transferable edges found for ${F.source}${F.target}`),yield*q.send(j).pipe(Oe(`sendNoTransferableResponse:${F.source}${F.target}`,{attributes:Ml(j)}))}yield*h(F)}}})),fn,Pt,Or,vt,Jt);t.set($,{channel:q,listenFiber:N});const M=vS.make({source:e,target:$});yield*h(M).pipe(Or)}).pipe(Cc({"addEdge:target":$,nodeName:e}),Oe(`addEdge:${e}${$}`,{attributes:{supportsTransferables:q.supportsTransferables}})),g=$=>z(function*(){t.has($)||(yield*new Pg(`No edge found for ${$}`)),yield*Dr(t.get($).listenFiber),t.delete($)}),k=({target:$,channelName:q})=>Re(()=>s.has(`target:${$}, channelName:${q}`)),T=({target:$,channelName:q,schema:P,mode:N,timeout:M=ow(1),closeExisting:B=!1})=>z(function*(){var we;const F=I_(P),j=`target:${$}, channelName:${q}`;if(s.has(j)){const G=(we=s.get(j).debugInfo)==null?void 0:we.channel;G&&(B?(yield*G.shutdown,s.delete(j)):Ce(`Channel ${j} already exists`,G))}if(s.has(j)===!1){const G=yield*yn().pipe(at(Mt));s.set(j,{queue:G,debugInfo:void 0})}const Z=s.get(j).queue;if(yield*nr(()=>Re(()=>s.delete(j))),N==="direct"){const G=yield*yn().pipe(at(Mt));yield*XP(Z,1,10).pipe(Eo(We=>Xv(G,We)),pf,Pt,vt,Jt);const{webChannel:ke,initialEdgeDeferred:qe}=yield*Rie({nodeName:e,incomingPacketsQueue:G,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,sendPacket:h,checkTransferableEdges:f});return s.set(j,{queue:Z,debugInfo:{channel:ke,target:$}}),yield*qe,ke}else{const G=yield*Oie({nodeName:e,newEdgeAvailablePubSub:r,target:$,channelName:q,schema:F,queue:Z,sendPacket:h});return s.set(j,{queue:Z,debugInfo:{channel:G,target:$}}),G}}).pipe(Rd(`makeChannel:${e}${$}(${q})`,{attributes:{target:$,channelName:q,mode:N,timeout:M}}),Cc({nodeName:e,target:$,channelName:q}));let O=!1;const L=bN(()=>{if(O)return Ce("listenForChannel already started");O=!0;const $=P=>`${P.channelName}:${P.source}:${P.mode}`,q=new Set;return Co(o).pipe(Ns(P=>{const N=$(P);return q.has(N)?!1:(q.add(N),!0)}))}),E=({channelName:$,schema:q})=>Ju(P=>z(function*(){if(u.has($))return Ce(`Broadcast channel ${$} already exists`,u.get($));const N={},M=yield*yn().pipe(at(Mt));u.set($,M);const B=Z=>z(function*(){const we=yield*Wu(q)(Z),G=Wh.make({channelName:$,payload:we,source:e,target:"-",hops:[]});yield*h(G)}),F=Co(M).pipe(Ns(On(Wh)),vi(Z=>p_(q)(Z.payload))),j=yield*Ue().pipe(at(Fa(tr)));return{[rr]:rr,send:B,listen:F,closedDeferred:j,supportsTransferables:!1,schema:{listen:q,send:q},shutdown:kn(P,tr),debugInfo:N}})),S=Re(()=>new Set(t.keys())),_=yield*No();return{nodeName:e,addEdge:p,removeEdge:g,hasChannel:k,makeChannel:T,listenForChannel:L,makeBroadcastChannel:E,edgeKeys:S,debug:{print:()=>{var $,q,P,N;console.log("Webmesh debug info for node:",e),console.log("Edges:",t.size);for(const[M,B]of t)console.log(`  ${M}: supportsTransferables=${B.channel.supportsTransferables}`);console.log("Channels:",s.size);for(const[M,B]of s)console.log(fh(M,2),`
`,Object.entries({target:($=B.debugInfo)==null?void 0:$.target,supportsTransferables:(q=B.debugInfo)==null?void 0:q.channel.supportsTransferables,...(P=B.debugInfo)==null?void 0:P.channel.debugInfo}).map(([F,j])=>fh(`${F}=${j}`,4)).join(`
`),"    ",(N=B.debugInfo)==null?void 0:N.channel,`
`,fh(`Queue: ${B.queue.unsafeSize().pipe(hr)}`,4),B.queue);console.log("Broadcast channels:",u.size);for(const[M,B]of u)console.log(fh(M,2))},ping:$=>{z(function*(){const q=P=>Af.make({message:`ping from ${e} via ${P}`,payload:$});for(const[P,N]of t)yield*ps(`sending ping via edge ${P}`),yield*N.channel.send(q(`edge ${P}`));for(const[P,N]of s){if(N.debugInfo===void 0){yield*ps(`channel ${P} has no debug info`);continue}yield*ps(`sending ping via channel ${P}`),yield*N.debugInfo.channel.send(q(`channel ${P}`))}}).pipe(An(_),vt,Do)},requestTopology:($=1e3)=>z(function*(){const q=ES.make({source:e,target:"-",hops:[]}),P=new Map;P.set(e,new Set(t.keys())),a.set(q.id,P),yield*h(q),yield*ps(`Waiting ${$}ms for topology response`),yield*nu($),yield*ps(`Topology response (from ${e}):`);for(const[N,M]of P)yield*ps(`  node '${N}' has edge to: ${Array.from(M.values()).join(", ")}`)}).pipe(An(_),vt,DP)}}}).pipe(Oe(`makeMeshNode:${e}`),Cc({"makeMeshNode.nodeName":e})),Aie=e=>(...t)=>{const[n,r,s]=t;if(q_(n)){const{query:o,bindValues:a}=n.asSql();return e(o,a,r)}else return e(n,r,s)},Pie=e=>(...t)=>{const[n,r]=t;if(q_(n)){const{query:s,bindValues:o}=n.asSql(),a=a2(n),u=e(s,o);return wE(a)(u)}else return e(n,r)},z2=(e,{foreignKeys:t,lockingMode:n})=>Bd(e,kt`
    -- disable WAL until we have it working properly
    -- PRAGMA journal_mode=WAL;
    PRAGMA page_size=8192;
    PRAGMA foreign_keys=${"ON"};
    ${n===void 0?"":kt`PRAGMA locking_mode=${n};`}
  `,{}),Bd=(e,t,n)=>{const r=ea(n,t);return xo({try:()=>e.execute(t,r),catch:s=>new gc({cause:s,query:{bindValues:r,sql:t},code:s.code})}).pipe(Ps,Oe("@livestore/common:execSql",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(r)}}))},Fie=(e,t,n)=>xo({try:()=>e.execute(t,n),catch:r=>new gc({cause:r,query:{bindValues:n,sql:t},code:r.code})}).pipe(Ps,Oe("@livestore/common:execSqlPrepared",{attributes:{"span.label":t,sql:t,bindValueKeys:Object.keys(n)}})),xie=ge("Skip",{}),Nie=ge("Blocking",{timeout:ie(bte,je)});ie(xie,Nie);class Ht extends rw("LeaderThreadCtx")(){}class Die extends ie(yS,De){}const Mie=e=>z(function*(){if(e.enabled===!1)return;const{syncProcessor:t,extraIncomingMessagesQueue:n,clientId:r,storeId:s}=yield*Ht;yield*QC({incomingMessages:Co(n),sendMessage:()=>he}).pipe(vt,Jt);const{node:o,persistenceInfo:a,mode:u}=yield*e.boot;yield*o.listenForChannel.pipe(Ns(f=>$ie.devtoolsClientLeader(f.channelName,{storeId:s,clientId:r})&&f.mode===u),Cn(({channelName:f,source:h})=>z(function*(){const p=yield*o.makeChannel({target:h,channelName:f,schema:{listen:P2,send:wie},mode:u}),g=O=>p.send(O).pipe(Oe("@livestore/common:leader-thread:devtools:sendToDevtools"),Pt,Td),k=yield*t.syncState,T=t.getMergeCounter();yield*t.pull({cursor:{mergeCounter:T,eventNum:k.localHead}}).pipe(Cn(({payload:O})=>g(I2.make({payload:O,liveStoreVersion:F_}))),fn,Jt),yield*QC({incomingMessages:p.listen.pipe(kf(),pne),sendMessage:g,persistenceInfo:a})}).pipe(vt,Jt)),fn)}).pipe(Oe("@livestore/common:leader-thread:devtools:boot")),QC=({incomingMessages:e,sendMessage:t,persistenceInfo:n})=>z(function*(){const{syncBackend:r,makeSqliteDb:s,dbState:o,dbEventlog:a,shutdownStateSubRef:u,shutdownChannel:f,syncProcessor:h,clientId:p,devtools:g}=yield*Ht,k=yield*NZ(),T=new Set;yield*e.pipe(Cn(O=>z(function*(){const{requestId:L}=O,E={requestId:L,liveStoreVersion:F_,clientId:p};if(O._tag!=="LSD.Leader.Disconnect"&&!T.has(L))switch(T.add(L),O._tag){case"LSD.Leader.Ping":{yield*t(q2.make({...E}));return}case"LSD.Leader.SnapshotReq":{const S=o.export();yield*t(T2.make({snapshot:S,...E}));return}case"LSD.Leader.LoadDatabaseFile.Request":{const{data:S}=O;let _;try{const C=yield*s({_tag:"in-memory"});C.import(S);const $=C.select("select name from sqlite_master where type = 'table'");_=new Set($.map(q=>q.name)),C.close()}catch(C){yield*ru("Error importing database file",C),yield*t(_c.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}try{if(_.has(Ms))yield*Ar(u,"shutting-down"),a.import(S),o.destroy();else if(_.has(A_)&&_.has(ap))yield*Ar(u,"shutting-down"),o.import(S),a.destroy();else{yield*t(_c.Error.make({...E,cause:{_tag:"unsupported-database"}}));return}yield*t(_c.Success.make({...E})),yield*f.send(yS.make({reason:"devtools-import"}))??he;return}catch(C){yield*ru("Error importing database file",C),yield*t(_c.Error.make({...E,cause:{_tag:"unexpected-error",cause:C}}));return}}case"LSD.Leader.ResetAllData.Request":{const{mode:S}=O;yield*Ar(u,"shutting-down"),o.destroy(),S==="all-data"&&a.destroy(),yield*t(u0.Success.make({...E})),yield*f.send(yS.make({reason:"devtools-reset"}))??he;return}case"LSD.Leader.DatabaseFileInfoReq":{if(n===void 0){console.log("[@livestore/common:leader-thread:devtools] persistenceInfo is required for this request");return}const S="SELECT page_count * page_size as size FROM pragma_page_count(), pragma_page_size();",_=o.select(S,void 0)[0].size,C=a.select(S,void 0)[0].size;yield*t(w2.make({state:{fileSize:_,persistenceInfo:n.state},eventlog:{fileSize:C,persistenceInfo:n.eventlog},...E}));return}case"LSD.Leader.EventlogReq":{const S=a.export();yield*t(O2.make({eventlog:S,...E}));return}case"LSD.Leader.CommitEventReq":{yield*h.pushPartial({event:O.eventEncoded,clientId:`devtools-${p}`,sessionId:`devtools-${p}`}),yield*t(R2.make({...E}));return}case"LSD.Leader.SyncHistorySubscribe":{const{subscriptionId:S}=O;r!==void 0&&(yield*r.pull(V()).pipe(vi(_=>_.batch),cne,Cn(({eventEncoded:_,metadata:C})=>t($2.make({eventEncoded:_,metadata:C,subscriptionId:S,...E,requestId:ho(10)}))),fn,Pt,vt,py(k,S)));return}case"LSD.Leader.SyncHistoryUnsubscribe":{const{requestId:S}=O;console.log("LSD.SyncHistoryUnsubscribe",S),yield*my(k,S);return}case"LSD.Leader.SyncingInfoReq":{const S=E2.make({enabled:r!==void 0,metadata:(r==null?void 0:r.metadata)??{}});yield*t(k2.make({syncingInfo:S,...E}));return}case"LSD.Leader.NetworkStatusSubscribe":{if(r!==void 0){const{subscriptionId:S}=O;yield*nu(1e3),yield*vne(r.isConnected.changes,g.enabled?g.syncBackendLatchState.changes:lne({latchClosed:!1})).pipe(Cn(([_,{latchClosed:C}])=>t(v2.make({networkStatus:{isConnected:_,timestampMs:Date.now(),latchClosed:C},subscriptionId:S,...E,requestId:ho(10)}))),fn,Pt,vt,py(k,S))}return}case"LSD.Leader.NetworkStatusUnsubscribe":{const{requestId:S}=O;yield*my(k,S);return}case"LSD.Leader.SyncHeadSubscribe":{const{subscriptionId:S}=O;yield*h.syncState.changes.pipe(Cn(_=>t(C2.make({local:_.localHead,upstream:_.upstreamHead,subscriptionId:S,...E,requestId:ho(10)}))),fn,Pt,vt,py(k,S));return}case"LSD.Leader.SyncHeadUnsubscribe":{const{subscriptionId:S}=O;yield*my(k,S);return}case"LSD.Leader.SetSyncLatch.Request":{const{closeLatch:S}=O;if(g.enabled===!1)return;S===!0?yield*g.syncBackendLatch.close:yield*g.syncBackendLatch.open,yield*Ar(g.syncBackendLatchState,{latchClosed:S}),yield*t(c0.Success.make({...E}));return}default:yield*to("TODO implement devtools message",O)}}).pipe(Oe(`@livestore/common:leader-thread:onDevtoolsMessage:${O._tag}`))),De.mapToUnexpectedErrorStream,fn)}),B2=e=>Object.entries(e),Lie=e=>[">","<","="].includes(e),H2=({tableName:e,columns:t,values:n,options:r={orReplace:!1}})=>[jie({tableName:e,columns:t,options:{orReplace:r==null?void 0:r.orReplace,keys:Object.keys(n)}}),TS({columns:t,values:n})],jie=({tableName:e,columns:t,options:n={orReplace:!1}})=>{const r=(n==null?void 0:n.keys)??Object.keys(t),s=r.join(", "),o=r.map(a=>`$${a}`).join(", ");return kt`INSERT ${n.orReplace?"OR REPLACE ":""}INTO ${e} (${s}) VALUES (${o})`},Uie=({columns:e,tableName:t,updateValues:n,where:r})=>{const s=Bie(n);if(Object.keys(s).length===0)return[kt`select 1`,{}];const o=Object.keys(s).map(h=>`${h} = $update_${h}`).join(", "),a={...TS({columns:e,values:s,variablePrefix:"update_"}),...TS({columns:e,values:r,variablePrefix:"where_",skipNil:!0})},u=zie({where:r}),f=u===""?"":`WHERE ${u}`;return[kt`UPDATE ${t} SET ${o} ${f}`,a]},TS=({columns:e,values:t,variablePrefix:n="",skipNil:r})=>{const s=v(e,B2,so(([o,a])=>[o,u=>{if(a.nullable===!0&&u==null)return null;const f=Kx(a.schema)(u);if(f._tag==="Left"){const h=Al.formatErrorSync(f.left),p=String(a.schema.ast);console.error(`Error making bind values for SQL query for column "${o}".

Expected schema: ${p}

Error: ${h}

Value:`,u);debugger;throw f.left}else return f.right}]),Object.fromEntries);return v(Object.entries(t).filter(([,o])=>r!==!0||o!=null).flatMap(([o,a])=>{const u=s[o]??Ce(`No codec found for column "${o}"`);if(typeof a=="object"&&a!==null&&"op"in a)switch(a.op){case"in":return a.val.map((f,h)=>[`${n}${o}_${h}`,u(f)]);case"=":case">":case"<":return[[`${n}${o}`,u(a.val)]];default:throw new Error(`Unknown op: ${a.op}`)}else return[[`${n}${o}`,u(a)]]}),Object.fromEntries)},zie=({where:e})=>{const t=(n,r)=>r===null?"IS NULL":typeof r=="object"&&typeof r.op=="string"&&Lie(r.op)?`${r.op} $where_${n}`:typeof r=="object"&&typeof r.op=="string"&&r.op==="in"?`in (${r.val.map((s,o)=>`$where_${n}_${o}`).join(", ")})`:`= $where_${n}`;return v(e,B2,so(([n,r])=>`${n} ${t(n,r)}`),Ia(" AND "))},Bie=e=>Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0)),Hie=e=>z(function*(){for(const t of Ooe)yield*up({db:e,behaviour:"create-if-not-exists",tableAst:t.sqliteDef.ast,skipMetaTable:!0});yield*Bd(e,kt`INSERT INTO ${Df} (head)
          SELECT ${ts.global}
          WHERE NOT EXISTS (SELECT 1 FROM ${Df})`,{})}),Vie=e=>z(function*(){const{dbEventlog:t,dbState:n}=yield*Ht,r=Nf.where("seqNumGlobal",">=",e.global).asSql(),s=t.select(r.query,ea(r.bindValues,r.query)),o=Bm(Nf.rowSchema.pipe(Me))(s),a=cp.where("seqNumGlobal",">=",e.global).asSql(),u=n.select(a.query,ea(a.bindValues,a.query)),f=Bm(cp.rowSchema.pipe(Me))(u);return o.map(h=>{const p=f.find(g=>g.seqNumGlobal===h.seqNumGlobal&&g.seqNumClient===h.seqNumClient);return Fn.make({name:h.name,args:h.argsJson,seqNum:{global:h.seqNumGlobal,client:h.seqNumClient},parentSeqNum:{global:h.parentSeqNumGlobal,client:h.parentSeqNumClient},clientId:h.clientId,sessionId:h.sessionId,meta:{sessionChangeset:p&&p.changeset!==null?{_tag:"sessionChangeset",data:p.changeset,debug:p.debug}:{_tag:"unset"},syncMetadata:h.syncMetadataJson,materializerHashLeader:V(),materializerHashSession:V()}})}).filter(h=>_S(h.seqNum,e)>0).sort((h,p)=>_S(h.seqNum,p.seqNum))}),V2=e=>{const t=e.select(kt`select seqNumGlobal, seqNumClient from ${Ms} order by seqNumGlobal DESC, seqNumClient DESC limit 1`)[0];return t?{global:t.seqNumGlobal,client:t.seqNumClient}:ts},Wie=e=>{var t;return((t=e.select(kt`select head from ${Df}`)[0])==null?void 0:t.head)??ts.global},Kie=(e,t)=>e.execute(kt`UPDATE ${Df} SET head = ${t.global}`),Jie=(e,t,n,r,s)=>z(function*(){Ds&&e.parentSeqNum.global!==ts.global&&t.select(`SELECT COUNT(*) as count FROM ${Ms} WHERE seqNumGlobal = ? AND seqNumClient = ?`,[e.parentSeqNum.global,e.parentSeqNum.client])[0].count===1===!1&&Ce(`Parent mutation ${e.parentSeqNum.global},${e.parentSeqNum.client} does not exist`),yield*Bd(t,...H2({tableName:Ms,columns:Nf.sqliteDef.columns,values:{seqNumGlobal:e.seqNum.global,seqNumClient:e.seqNum.client,parentSeqNumGlobal:e.parentSeqNum.global,parentSeqNumClient:e.parentSeqNum.client,name:e.name,argsJson:e.args??{},clientId:r,sessionId:s,schemaHash:n,syncMetadataJson:e.meta.syncMetadata}}))}),Gie=e=>z(function*(){const{dbEventlog:t}=yield*Ht;for(let n=0;n<e.length;n++){const r=e[n];yield*Bd(t,...Uie({tableName:Ms,columns:Nf.sqliteDef.columns,where:{seqNumGlobal:r.seqNum.global,seqNumClient:r.seqNum.client},updateValues:{syncMetadataJson:r.meta.syncMetadata}}))}}),Qie=e=>z(function*(){const{dbEventlog:t}=yield*Ht;if(e===ts.global)return V();const n=Y({syncMetadataJson:xs(Zi(Ro))}).pipe(cu("syncMetadataJson"),Me,kte),r=yield*Re(()=>t.select(kt`SELECT syncMetadataJson FROM ${Ms} WHERE seqNumGlobal = ${e} ORDER BY seqNumClient ASC LIMIT 1`)).pipe(Qr(Bee(n)),Ee(kL),Or);return W({cursor:{global:e,client:mi},metadata:r})}).pipe(Oe("@livestore/common:eventlog:getSyncBackendCursorInfo",{attributes:{remoteHead:e}})),Yie=({schema:e,dbState:t,dbEventlog:n})=>z(function*(){const r=new Map([...e.eventsDefsMap.entries()].map(([s,o])=>[s,YE(o.schema)]));return(s,o)=>z(function*(){const a=(o==null?void 0:o.skipEventlog)??!1,u=s.name,{eventDef:f,materializer:h}=si(e,u),p=d2({eventDef:f,materializer:h,dbState:t,event:{decoded:void 0,encoded:s}}),g=k_()?W(Joe(p)):V();g._tag==="Some"&&s.meta.materializerHashSession._tag==="Some"&&s.meta.materializerHashSession.value!==g.value&&(yield*De.make({cause:`Materializer hash mismatch detected for event "${s.name}".`,note:"Please make sure your event materializer is a pure function without side effects."}));const k=t.session();for(const{statementSql:O,bindValues:L}of p)yield*Fie(t,O,L);const T=k.changeset();if(k.finish(),yield*Bd(t,...H2({tableName:Ff,columns:cp.sqliteDef.columns,values:{seqNumGlobal:s.seqNum.global,seqNumClient:s.seqNum.client,changeset:T??null,debug:Ds?p:null}})),a===!1){const O=s.name,L=r.get(O)??Ce(`Unknown event definition: ${O}`);yield*Jie(s,n,L,s.clientId,s.sessionId)}return{sessionChangeset:T?{_tag:"sessionChangeset",data:T,debug:Ds?p:null}:{_tag:"no-op"},hash:g}}).pipe(Oe("@livestore/common:leader-thread:materializeEvent",{attributes:{eventName:s.name,eventNum:s.seqNum,"span.label":`${yr(s.seqNum)} ${s.name}`}}))}),Xie=({dbState:e,dbEventlog:t,eventNumsToRollback:n})=>z(function*(){const r=e.select(kt`SELECT * FROM ${Ff} WHERE (seqNumGlobal, seqNumClient) IN (${n.map(o=>`(${o.global}, ${o.client})`).join(", ")})`).map(o=>({seqNum:{global:o.seqNumGlobal,client:o.seqNumClient},changeset:o.changeset,debug:o.debug})).toSorted((o,a)=>_S(o.seqNum,a.seqNum));for(let o=r.length-1;o>=0;o--){const{changeset:a}=r[o];a!==null&&e.makeChangeset(a).invert().apply()}const s=tj(100)(n.map(o=>`(${o.global}, ${o.client})`));for(const o of s)e.execute(kt`DELETE FROM ${Ff} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`);for(const o of s)t.execute(kt`DELETE FROM ${Ms} WHERE (seqNumGlobal, seqNumClient) IN (${o.join(", ")})`)}).pipe(Oe("@livestore/common:LeaderSyncProcessor:rollback",{attributes:{count:n.length}})),Zie=({schema:e,dbEventlogMissing:t,dbEventlog:n,dbState:r,dbStateMissing:s,initialBlockingSyncContext:o,onError:a,params:u,testing:f})=>z(function*(){const h=yield*vC(),p=u.localPushBatchSize??10,g=u.backendPushBatchSize??50,k=yield*$f(void 0),T=G=>{const{eventDef:ke}=si(e,G.name);return ke.options.clientOnly},O=yield*sae,L={current:0},E={current:s?0:yield*oae(r)},S=new Map,_={current:void 0},C=yield*vC(),$=yield*Pb(!0),q=yield*Pb(!0),P={current:ts},N=G=>{P.current=ZN(P.current,G)},M=(G,ke)=>{var qe;return z(function*(){if(G.length===0)return;yield*iae(G,P.current),N(G.at(-1).seqNum);const We=(ke==null?void 0:ke.waitForProcessing)??!1,tt=L.current;if(We){const Ke=yield*$n(G,()=>Ue()),jt=G.map((Nn,Gu)=>[Nn,Ke[Gu],tt]);yield*bl(C,jt),yield*Cd(Ke)}else{const Ke=G.map(jt=>[jt,void 0,tt]);yield*bl(C,Ke)}}).pipe(Oe("@livestore/common:LeaderSyncProcessor:push",{attributes:{batchSize:G.length,batch:no?G:void 0},links:(qe=_.current)!=null&&qe.span?[{_tag:"SpanLink",span:_.current.span,attributes:{}}]:void 0}))},B=({event:{name:G,args:ke},clientId:qe,sessionId:We})=>z(function*(){const tt=yield*k;if(tt===void 0)return Ce("Not initialized");const{eventDef:Ke}=si(e,G),jt=new Fn({name:G,args:ke,clientId:qe,sessionId:We,...ZE(tt.localHead,Ke.options.clientOnly)});yield*M([jt])}).pipe(xv("LeaderAheadError",Or)),F=z(function*(){var as,Lo,N_;const G=yield*Hg.pipe(Or),ke=yield*VE.pipe(Lg(()=>Ve(void 0))),{devtools:qe,shutdownChannel:We}=yield*Ht,tt=yield*No();_.current={otelSpan:ke,span:G,devtoolsLatch:qe.enabled?qe.syncBackendLatch:void 0,runtime:tt};const Ke=t?ts:V2(n),jt=t?ts.global:Wie(n);if(jt>Ke.global)return Ce(`During boot the backend head (${jt}) should never be greater than the local head (${Ke.global})`);const Nn=t?[]:yield*Vie({global:jt,client:mi}),Gu=new ys({pending:Nn,upstreamHead:{global:jt,client:mi},localHead:Ke});if(yield*Ar(k,Gu),Nn.length>0){const zr=Nn.filter(za=>{const{eventDef:cs}=si(e,za.name);return cs.options.clientOnly===!1});zr.length>0&&(yield*bl(h,zr))}const Qu=zr=>z(function*(){a==="shutdown"&&(yield*We.send(De.make({cause:zr})),yield*li(zr))});yield*eae({localPushesLatch:$,localPushesQueue:C,pullLatch:q,syncStateSref:k,syncBackendPushQueue:h,schema:e,isClientEvent:T,otelSpan:ke,currentLocalPushGenerationRef:L,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,localPushBatchSize:p,testing:{delay:(as=f==null?void 0:f.delays)==null?void 0:as.localPushProcessing}}).pipe(vt,$s(Qu),Jt);const Yu=yield*Ix(),Vd=nae({syncBackendPushQueue:h,otelSpan:ke,devtoolsLatch:(Lo=_.current)==null?void 0:Lo.devtoolsLatch,backendPushBatchSize:g}).pipe(vt,$s(Qu));return yield*zm(Yu,Vd),yield*tae({initialBackendHead:jt,isClientEvent:T,restartBackendPushing:zr=>z(function*(){yield*qZ(Yu),yield*Ane(h),yield*bl(h,zr),yield*zm(Yu,Vd)}),syncStateSref:k,localPushesLatch:$,pullLatch:q,dbState:r,otelSpan:ke,initialBlockingSyncContext:o,devtoolsLatch:(N_=_.current)==null?void 0:N_.devtoolsLatch,connectedClientSessionPullQueues:O,mergeCounterRef:E,mergePayloads:S,advancePushHead:N}).pipe(vt,$s(Qu),Jt),{initialLeaderHead:Ke}}).pipe(Rd("@livestore/common:LeaderSyncProcessor:boot")),j=({cursor:G})=>z(function*(){const ke=yield*Z({cursor:G});return Co(ke)}).pipe(wN),Z=({cursor:G})=>{var qe;const ke=((qe=_.current)==null?void 0:qe.runtime)??Ce("Not initialized");return z(function*(){const We=yield*O.makeQueue,tt=Array.from(S.entries()).map(([Ke,jt])=>({payload:jt,mergeCounter:Ke})).filter(({mergeCounter:Ke})=>Ke>G.mergeCounter).toSorted((Ke,jt)=>Ke.mergeCounter-jt.mergeCounter).map(({payload:Ke,mergeCounter:jt})=>Ke._tag==="upstream-advance"?{payload:{_tag:"upstream-advance",newEvents:GL(Ke.newEvents,Nn=>$a(G.eventNum,Nn.seqNum))},mergeCounter:jt}:{payload:Ke,mergeCounter:jt});return yield*We.offerAll(tt),We}).pipe(An(ke))},we=E_({get:z(function*(){const G=yield*k;return G===void 0?Ce("Not initialized"):G}),changes:k.changes.pipe(Ns(PN))});return{pull:j,pullQueue:Z,push:M,pushPartial:B,boot:F,syncState:we,getMergeCounter:()=>E.current}}),eae=({localPushesLatch:e,localPushesQueue:t,pullLatch:n,syncStateSref:r,syncBackendPushQueue:s,schema:o,isClientEvent:a,otelSpan:u,currentLocalPushGenerationRef:f,connectedClientSessionPullQueues:h,mergeCounterRef:p,mergePayloads:g,localPushBatchSize:k,testing:T})=>z(function*(){for(;;){T.delay!==void 0&&(yield*T.delay.pipe(Oe("localPushProcessingDelay")));const O=yield*EN(t,1,k);yield*e.await,yield*n.close;const L=O.filter(([P,N,M])=>M===f.current).map(([P,N])=>[P,N]);if(L.length===0){yield*n.open;continue}const[E,S]=XL(L),_=yield*r;if(_===void 0)return Ce("Not initialized");const C=y2({syncState:_,payload:{_tag:"local-push",newEvents:E},isClientEvent:a,isEqualEvent:m2}),$=yield*K2(p);switch(C._tag){case"unexpected-error":return u==null||u.addEvent(`[${$}]:push:unexpected-error`,{batchSize:E.length,newEvents:no?JSON.stringify(E):void 0}),yield*Hn(C.cause);case"rebase":return Ce("The leader thread should never have to rebase due to a local push");case"reject":{u==null||u.addEvent(`[${$}]:push:reject`,{batchSize:E.length,mergeResult:no?JSON.stringify(C):void 0}),f.current++;const P=f.current,N=E.at(0).seqNum,M=yield*Pne(t,F=>F[2]>=P);if(Ds&&(yield*EC(t))>0){console.log("localPushesQueue is not empty",yield*EC(t));debugger}const B=[...S,...M.map(([F,j])=>j)].filter(PN);yield*$n(B,F=>Uw(F,i0.make({minimumExpectedNum:C.expectedMinimumId,providedNum:N}))),yield*n.open;continue}case"advance":break;default:To(C)}yield*Ar(r,C.newSyncState),yield*h.offer({payload:ta.make({newEvents:C.newEvents}),mergeCounter:$}),g.set($,ta.make({newEvents:C.newEvents})),u==null||u.addEvent(`[${$}]:push:advance`,{batchSize:E.length,mergeResult:no?JSON.stringify(C):void 0});const q=C.newEvents.filter(P=>{const{eventDef:N}=si(o,P.name);return N.options.clientOnly===!1});yield*bl(s,q),yield*W2({batchItems:C.newEvents,deferreds:S}),yield*n.open}}),W2=({batchItems:e,deferreds:t})=>z(function*(){const{dbState:n,dbEventlog:r,materializeEvent:s}=yield*Ht;n.execute("BEGIN TRANSACTION",void 0),r.execute("BEGIN TRANSACTION",void 0),yield*nr(o=>z(function*(){Qc(o)||(n.execute("ROLLBACK",void 0),r.execute("ROLLBACK",void 0))}));for(let o=0;o<e.length;o++){const{sessionChangeset:a,hash:u}=yield*s(e[o]);e[o].meta.sessionChangeset=a,e[o].meta.materializerHashLeader=u,(t==null?void 0:t[o])!==void 0&&(yield*ut(t[o],void 0))}n.execute("COMMIT",void 0),r.execute("COMMIT",void 0)}).pipe(Qo,di,Oe("@livestore/common:LeaderSyncProcessor:materializeEventItems",{attributes:{batchSize:e.length}}),vt,De.mapToUnexpectedError),tae=({initialBackendHead:e,isClientEvent:t,restartBackendPushing:n,otelSpan:r,dbState:s,syncStateSref:o,localPushesLatch:a,pullLatch:u,devtoolsLatch:f,initialBlockingSyncContext:h,connectedClientSessionPullQueues:p,mergeCounterRef:g,mergePayloads:k,advancePushHead:T})=>z(function*(){const{syncBackend:O,dbState:L,dbEventlog:E,schema:S}=yield*Ht;if(O===void 0)return;const _=(q,P)=>z(function*(){if(q.length===0)return;f!==void 0&&(yield*f.await),yield*a.close,yield*u.await;const N=yield*o;if(N===void 0)return Ce("Not initialized");const M=y2({syncState:N,payload:ta.make({newEvents:q}),isClientEvent:t,isEqualEvent:m2,ignoreClientEvents:!0}),B=yield*K2(g);if(M._tag==="reject")return Ce("The leader thread should never reject upstream advances");if(M._tag==="unexpected-error")return r==null||r.addEvent(`[${B}]:pull:unexpected-error`,{newEventsCount:q.length,newEvents:no?JSON.stringify(q):void 0}),yield*Hn(M.cause);const F=q.at(-1).seqNum;if(Kie(E,F),M._tag==="rebase"){r==null||r.addEvent(`[${B}]:pull:rebase`,{newEventsCount:q.length,newEvents:no?JSON.stringify(q):void 0,rollbackCount:M.rollbackEvents.length,mergeResult:no?JSON.stringify(M):void 0});const j=M.newSyncState.pending.filter(Z=>{const{eventDef:we}=si(S,Z.name);return we.options.clientOnly===!1});yield*n(j),M.rollbackEvents.length>0&&(yield*Xie({dbState:L,dbEventlog:E,eventNumsToRollback:M.rollbackEvents.map(Z=>Z.seqNum)})),yield*p.offer({payload:fp.make({newEvents:M.newEvents,rollbackEvents:M.rollbackEvents}),mergeCounter:B}),k.set(B,fp.make({newEvents:M.newEvents,rollbackEvents:M.rollbackEvents}))}else if(r==null||r.addEvent(`[${B}]:pull:advance`,{newEventsCount:q.length,mergeResult:no?JSON.stringify(M):void 0}),yield*p.offer({payload:ta.make({newEvents:M.newEvents}),mergeCounter:B}),k.set(B,ta.make({newEvents:M.newEvents})),M.confirmedEvents.length>0){const j=q.filter(Z=>M.confirmedEvents.some(we=>R_(Z.seqNum,we.seqNum)));yield*Gie(j)}rae(L,F),T(M.newSyncState.localHead),yield*W2({batchItems:M.newEvents,deferreds:void 0}),yield*Ar(o,M.newSyncState),P===0&&(yield*a.open)}),C=yield*Qie(e),$=Koe({schema:S,dbState:s});yield*O.pull(C).pipe(Cn(({batch:q,remaining:P})=>z(function*(){yield*Cf(O.isConnected,N=>N===!0),yield*_(q.map(N=>Fn.fromGlobal(N.eventEncoded,{syncMetadata:N.metadata,materializerHashLeader:$(N.eventEncoded),materializerHashSession:V()})),P),yield*h.update({processed:q.length,remaining:P})})),fn,Pt)}).pipe(Oe("@livestore/common:LeaderSyncProcessor:backend-pulling")),nae=({syncBackendPushQueue:e,otelSpan:t,devtoolsLatch:n,backendPushBatchSize:r})=>z(function*(){const{syncBackend:s}=yield*Ht;if(s!==void 0)for(;;){yield*Cf(s.isConnected,u=>u===!0);const o=yield*EN(e,1,r);yield*Cf(s.isConnected,u=>u===!0),n!==void 0&&(yield*n.await),t==null||t.addEvent("backend-push",{batchSize:o.length,batch:no?JSON.stringify(o):void 0});const a=yield*s.push(o.map(u=>u.toGlobal())).pipe(Oi);if(a._tag==="Left")return Ds&&(yield*ps("handled backend-push-error",{error:a.left.toString()})),t==null||t.addEvent("backend-push-error",{error:a.left.toString()}),yield*Fv}}).pipe(Pt,Oe("@livestore/common:LeaderSyncProcessor:backend-pushing")),rae=(e,t)=>{e.execute(kt`DELETE FROM ${Ff} WHERE seqNumGlobal < ${t.global}`)},sae=z(function*(){const e=new Set;return yield*nr(()=>z(function*(){for(const r of e)yield*Mt(r);e.clear()})),{makeQueue:z(function*(){const r=yield*yn().pipe(at(Mt));return yield*nr(()=>Re(()=>e.delete(r))),e.add(r),r}),offer:r=>z(function*(){if(!(r.payload._tag==="upstream-advance"&&r.payload.newEvents.length===0))for(const s of e)yield*Ze(s,r)})}}),K2=e=>z(function*(){const{dbState:t}=yield*Ht;return e.current++,t.execute(kt`INSERT OR REPLACE INTO ${r0} (id, mergeCounter) VALUES (0, ${e.current})`),e.current}),oae=e=>z(function*(){var n;return((n=e.select(kt`SELECT mergeCounter FROM ${r0} WHERE id = 0`)[0])==null?void 0:n.mergeCounter)??0}),iae=(e,t)=>z(function*(){if(e.length!==0){for(let n=1;n<e.length;n++)$a(e[n-1].seqNum,e[n].seqNum)&&Ce(`Events must be ordered in monotonically ascending order by eventNum. Received: [${e.map(r=>yr(r.seqNum)).join(", ")}]`);if($a(t,e[0].seqNum))return yield*i0.make({minimumExpectedNum:t,providedNum:e[0].seqNum})}}),aae=z(function*(){const{dbState:e,dbEventlog:t,schema:n,bootStatusQueue:r,materializeEvent:s}=yield*Ht,o=n.state.sqlite.migrations;let a;yield*nr(Vg("recreateDb:finalizer")(function*(h){h._tag==="Failure"&&e.destroy()}));const u=e;yield*z2(u,{foreignKeys:!0});const f=h=>z(function*(){yield*dh(()=>{var g;return(g=h==null?void 0:h.init)==null?void 0:g.call(h,u)}).pipe(De.mapToUnexpectedError);const p=yield*xoe({db:u,schema:n,onProgress:({done:g,total:k})=>Ze(r,{stage:"migrating",progress:{done:g,total:k}})});return yield*dh(()=>{var g;return(g=h==null?void 0:h.pre)==null?void 0:g.call(h,u)}).pipe(De.mapToUnexpectedError),{migrationsReport:p,tmpDb:u}});switch(o.strategy){case"auto":{const h=o.hooks,p=yield*f(h);a=p.migrationsReport,yield*Zoe({dbEventlog:t,schema:n,materializeEvent:s,onProgress:({done:g,total:k})=>Ze(r,{stage:"rehydrating",progress:{done:g,total:k}})}),yield*dh(()=>{var g;return(g=h==null?void 0:h.post)==null?void 0:g.call(h,p.tmpDb)}).pipe(De.mapToUnexpectedError);break}case"manual":{const h=e.export();a={migrations:[]};const p=yield*dh(()=>o.migrate(h)).pipe(De.mapToUnexpectedError);u.import(p);break}default:To(o)}return{migrationsReport:a}}).pipe(di,Oe("@livestore/common:leader-thread:recreateDb"),WE("@livestore/common:leader-thread:recreateDb")),cae=({schema:e,storeId:t,clientId:n,syncPayload:r,makeSqliteDb:s,syncOptions:o,dbState:a,dbEventlog:u,devtoolsOptions:f,shutdownChannel:h,params:p,testing:g})=>z(function*(){var N;const k=yield*yn().pipe(at(Mt)),T=u.select(kt`select count(*) as count from sqlite_master`)[0].count===0,O=a.select(kt`select count(*) as count from sqlite_master`)[0].count===0,L=(o==null?void 0:o.backend)===void 0?void 0:yield*o.backend({storeId:t,clientId:n,payload:r});L!==void 0&&(yield*L.connect.pipe(vt,Jt));const E=yield*uae({initialSyncOptions:(o==null?void 0:o.initialSyncOptions)??{_tag:"Skip"},bootStatusQueue:k}),S=yield*Zie({schema:e,dbEventlogMissing:T,dbEventlog:u,dbState:a,dbStateMissing:O,initialBlockingSyncContext:E,onError:(o==null?void 0:o.onSyncError)??"ignore",params:{localPushBatchSize:p==null?void 0:p.localPushBatchSize,backendPushBatchSize:p==null?void 0:p.backendPushBatchSize},testing:{delays:(N=g==null?void 0:g.syncProcessor)==null?void 0:N.delays}}),_=yield*yn().pipe(at(Mt)),C=f.enabled?{enabled:!0,syncBackendLatch:yield*Pb(!0),syncBackendLatchState:yield*$f({latchClosed:!1})}:{enabled:!1},$=yield*Yie({schema:e,dbState:a,dbEventlog:u}),q={schema:e,bootStatusQueue:k,storeId:t,clientId:n,dbState:a,dbEventlog:u,makeSqliteDb:s,eventSchema:Xoe(e),shutdownStateSubRef:yield*$f("running"),shutdownChannel:h,syncBackend:L,syncProcessor:S,materializeEvent:$,extraIncomingMessagesQueue:_,devtools:C,initialState:{}};globalThis.__leaderThreadCtx=q;const P=Bv(Ht,q);return q.initialState=yield*lae({dbStateMissing:O,initialBlockingSyncContext:E,devtoolsOptions:f}).pipe(An(P)),P}).pipe(Oe("@livestore/common:leader-thread:boot"),Rd("@livestore/common:leader-thread"),De.mapToUnexpectedError,vt,Vv),uae=({initialSyncOptions:e,bootStatusQueue:t})=>z(function*(){const n={isDone:!1,processedEvents:0,total:-1},r=e._tag==="Blocking"?yield*Ue():void 0;return r!==void 0&&e._tag==="Blocking"&&(yield*ut(r,void 0).pipe(dQ(e.timeout),Jt)),{blockingDeferred:r,update:({processed:s,remaining:o})=>z(function*(){n.isDone!==!0&&(n.total===-1&&(n.total=o+s),n.processedEvents+=s,yield*Ze(t,{stage:"syncing",progress:{done:n.processedEvents,total:n.total}}),o===0&&r!==void 0&&(yield*ut(r,void 0),n.isDone=!0))})}}),lae=({dbStateMissing:e,initialBlockingSyncContext:t,devtoolsOptions:n})=>z(function*(){const{dbEventlog:r,bootStatusQueue:s,syncProcessor:o}=yield*Ht;yield*Hie(r);const{migrationsReport:a}=e?yield*aae:{migrationsReport:{migrations:[]}},{initialLeaderHead:u}=yield*o.boot;return t.blockingDeferred!==void 0&&(yield*Ze(s,{stage:"syncing",progress:{done:0,total:-1}}),yield*t.blockingDeferred.pipe(Oe("@livestore/common:leader-thread:initial-sync-blocking"))),yield*Ze(s,{stage:"done"}),yield*Mie(n).pipe(vt,Jt),{migrationsReport:a,leaderHead:u}});let f0=class extends Mn()("DevtoolsWebCommon.CreateConnection",{payload:{from:D,port:T_},success:Y({}),failure:g_}){};class Lce extends ie(f0){}const mp=class mp extends rw("@livestore/devtools-web-common:CacheService")(){};d(mp,"layer",({nodeName:t})=>z(function*(){const n=yield*qie(t);return globalThis.__debugWebmeshNode=n,{node:n}}).pipe(LQ(mp)));let Lf=mp;const fae=({from:e,port:t})=>sne(n=>z(function*(){const{node:r}=yield*Lf,s=yield*Gse({port:t,schema:U2});yield*r.addEdge({target:e,edgeChannel:s,replaceIfExists:!0}),Ds&&(yield*ps(`@livestore/devtools-web-common: accepted edge: ${r.nodeName}  ${e}`)),n.single({}),yield*Qn({connectedTo:[...r.edgeKeys]})}).pipe(Or)).pipe(wne(`@livestore/devtools-web-common:worker:create-connection:${e}`)),re=0,dae=1,jf=10,d0=12,Hd=14,Ho=21,qy=25,hae=27,IS=100,mae=101,x_=522,J2=778,YC=2,dp=4,RS=8,G2=64,pae=256,gae=2048,_ae=16384,yae=524288,bae=2048,XC=1,ZC=2,eT=3,tT=4,nT=5,Sae=512;class Q2{constructor(t,n){d(this,"name");d(this,"mxPathname",64);d(this,"_module");this.name=t,this._module=n}close(){}isReady(){return!0}hasAsyncMethod(t){return!1}xOpen(t,n,r,s,o){return Hd}xDelete(t,n,r){return re}xAccess(t,n,r,s){return re}xFullPathname(t,n,r,s){return re}xGetLastError(t,n,r){return re}xClose(t){return re}xRead(t,n,r,s,o){return re}xWrite(t,n,r,s,o){return re}xTruncate(t,n,r){return re}xSync(t,n){return re}xFileSize(t,n){return re}xLock(t,n){return re}xUnlock(t,n){return re}xCheckReservedLock(t,n){return re}xFileControl(t,n,r){return d0}xSectorSize(t){return Sae}xDeviceCharacteristics(t){return 0}}const wae=Object.getPrototypeOf(async function(){}).constructor;var Pr,vl,OS,Y2,s1;let vae=(s1=class extends Q2{constructor(n,r){super(n,r);Vr(this,Pr)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof wae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return Hd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?jf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),x_}jWrite(n,r,s){return J2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return d0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=nt(this,Pr,Y2).call(this,r,o),f=nt(this,Pr,vl).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=nt(this,Pr,vl).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=nt(this,Pr,OS).call(this,r,s),f=Ay(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=nt(this,Pr,OS).call(this,r,s),f=Ay(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=Ay(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=nt(this,Pr,vl).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=nt(this,Pr,vl).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}},Pr=new WeakSet,vl=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&p.match(/^(get)|(set)/))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},OS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},Y2=function(n,r){if(r&G2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:a.push(63),o=2;break;case 2:a.push(61),o=3;break;case 3:a.push(38),o=2;break}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null},s1);function Ay(e,t){return t*4294967296+e+(e<0?2**32:0)}class h0 extends vae{constructor(n,r){super(n,r);d(this,"mapNameToFile",new Map);d(this,"mapIdToFile",new Map)}static async create(n,r){const s=new h0(n,r);return await s.isReady(),s}close(){for(const n of this.mapIdToFile.keys())this.jClose(n)}jOpen(n,r,s,o){const u=new URL(n||Math.random().toString(36).slice(2),"file://").pathname;let f=this.mapNameToFile.get(u);if(!f)if(s&dp)f={pathname:u,flags:s,size:0,data:new ArrayBuffer(0)},this.mapNameToFile.set(u,f);else return Hd;return this.mapIdToFile.set(r,f),o.setInt32(0,s,!0),re}jClose(n){const r=this.mapIdToFile.get(n);return this.mapIdToFile.delete(n),r.flags&RS&&this.mapNameToFile.delete(r.pathname),re}jRead(n,r,s){const o=this.mapIdToFile.get(n),a=Math.min(s,o.size),f=Math.min(s+r.byteLength,o.size)-a;return f&&r.set(new Uint8Array(o.data,a,f)),f<r.byteLength?(r.fill(0,f),x_):re}jWrite(n,r,s){const o=this.mapIdToFile.get(n);if(s+r.byteLength>o.data.byteLength){const a=Math.max(s+r.byteLength,2*o.data.byteLength),u=new ArrayBuffer(a);new Uint8Array(u).set(new Uint8Array(o.data,0,o.size)),o.data=u}return new Uint8Array(o.data,s,r.byteLength).set(r),o.size=Math.max(o.size,s+r.byteLength),re}jTruncate(n,r){const s=this.mapIdToFile.get(n);return s.size=Math.min(s.size,r),re}jFileSize(n,r){const s=this.mapIdToFile.get(n);return r.setBigInt64(0,BigInt(s.size),!0),re}jDelete(n,r){const o=new URL(n,"file://").pathname;return this.mapNameToFile.delete(o),re}jAccess(n,r,s){const a=new URL(n,"file://").pathname,u=this.mapNameToFile.get(a);return s.setInt32(0,u?1:0,!0),re}}let rT;const X2=e=>{if(e.vfs_registered.has("memory-vfs")===!1){const r=new h0("memory-vfs",e.module);e.vfs_register(r,!1),rT=r}return{dbPointer:e.open_v2Sync(":memory:",void 0,"memory-vfs"),vfs:rT}},sT=({sqlite3:e,metadata:t})=>{const n=[],{dbPointer:r}=t;let s=!1;const o={_tag:"SqliteDb",metadata:t,prepare:a=>{try{const u=e.statements(r,a.trim(),{unscoped:!0});let f=!1;const h={execute:(p,g)=>{for(const k of u){p!==void 0&&Object.keys(p).length>0&&e.bind_collection(k,p);try{e.step(k)}finally{g!=null&&g.onRowsChanged&&g.onRowsChanged(e.changes(r)),e.reset(k)}}},select:p=>{if(u.length!==1)throw new gc({query:{bindValues:p,sql:a},code:-1,cause:"Expected only one statement when using `select`"});const g=u[0];p!==void 0&&Object.keys(p).length>0&&e.bind_collection(g,p);const k=[];try{let T;try{T=e.column_names(g)}catch{}for(;e.step(g)===IS;)if(T!==void 0){const O={};for(let L=0;L<T.length;L++)O[T[L]]=e.column(g,L);k.push(O)}}catch(T){throw new gc({query:{bindValues:p,sql:a},code:T.code,cause:T})}finally{e.reset(g)}return k},finalize:()=>{if(!f){f=!0;for(const p of u)e.finalize(p)}},sql:a};return n.push(h),h}catch(u){throw new gc({query:{sql:a,bindValues:{}},code:u.code,cause:u})}},export:()=>e.serialize(r,"main"),execute:Aie((a,u,f)=>{const h=o.prepare(a);h.execute(u,f),h.finalize()}),select:Pie((a,u)=>{const f=o.prepare(a),h=f.select(u);return f.finalize(),h}),destroy:()=>{o.close(),t.deleteDb()},close:()=>{if(!s){for(const a of n)a.finalize();e.close(r),s=!0}},import:a=>{if(a instanceof Uint8Array){const h=X2(e);e.deserialize(h.dbPointer,"main",a,a.length,a.length,3),e.backup(r,"main",h.dbPointer,"main"),e.close(h.dbPointer)}else e.backup(r,"main",a.metadata.dbPointer,"main");t.configureDb(o)},session:()=>{const a=e.session_create(r,"main");return e.session_attach(a,null),{changeset:()=>e.session_changeset(a).changeset??void 0,finish:()=>{e.session_delete(a)}}},makeChangeset:a=>({invert:()=>{const f=e.changeset_invert(a);return o.makeChangeset(f)},apply:()=>{try{e.changeset_apply(r,a),a=void 0}catch(f){throw new gc({code:f.code??-1,cause:f,note:"Failed calling makeChangeset.apply"})}}})};return t.configureDb(o),o},Eae=Object.getPrototypeOf(async()=>{}).constructor;var Fr,El,qS,Z2;class kae extends Q2{constructor(n,r){super(n,r);Vr(this,Fr)}hasAsyncMethod(n){const r=`j${n.slice(1)}`;return this[r]instanceof Eae}getFilename(n){throw new Error("unimplemented")}jOpen(n,r,s,o){return Hd}jDelete(n,r){return re}jAccess(n,r,s){return re}jFullPathname(n,r){const{read:s,written:o}=new TextEncoder().encodeInto(n,r);return s<n.length||o>=r.length?jf:(r[o]=0,re)}jGetLastError(n){return re}jClose(n){return re}jRead(n,r,s){return r.fill(0),x_}jWrite(n,r,s){return J2}jTruncate(n,r){return re}jSync(n,r){return re}jFileSize(n,r){return re}jLock(n,r){return re}jUnlock(n,r){return re}jCheckReservedLock(n,r){return r.setInt32(0,0,!0),re}jFileControl(n,r,s){return d0}jSectorSize(n){return super.xSectorSize(n)}jDeviceCharacteristics(n){return 0}xOpen(n,r,s,o,a){var h;const u=nt(this,Fr,Z2).call(this,r,o),f=nt(this,Fr,El).call(this,"Int32",a);return(h=this.log)==null||h.call(this,"jOpen",u,s,"0x"+o.toString(16)),this.jOpen(u,s,o,f)}xDelete(n,r,s){var a;const o=this._module.UTF8ToString(r);return(a=this.log)==null||a.call(this,"jDelete",o,s),this.jDelete(o,s)}xAccess(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=nt(this,Fr,El).call(this,"Int32",o);return(f=this.log)==null||f.call(this,"jAccess",a,s),this.jAccess(a,s,u)}xFullPathname(n,r,s,o){var f;const a=this._module.UTF8ToString(r),u=this._module.HEAPU8.subarray(o,o+s);return(f=this.log)==null||f.call(this,"jFullPathname",a,s),this.jFullPathname(a,u)}xGetLastError(n,r,s){var a;const o=this._module.HEAPU8.subarray(s,s+r);return(a=this.log)==null||a.call(this,"jGetLastError",r),this.jGetLastError(o)}xClose(n){var r;return(r=this.log)==null||r.call(this,"jClose",n),this.jClose(n)}xRead(n,r,s,o,a){var h;const u=nt(this,Fr,qS).call(this,r,s),f=Py(o,a);return(h=this.log)==null||h.call(this,"jRead",n,s,f),this.jRead(n,u,f)}xWrite(n,r,s,o,a){var h;const u=nt(this,Fr,qS).call(this,r,s),f=Py(o,a);return(h=this.log)==null||h.call(this,"jWrite",n,u,f),this.jWrite(n,u,f)}xTruncate(n,r,s){var a;const o=Py(r,s);return(a=this.log)==null||a.call(this,"jTruncate",n,o),this.jTruncate(n,o)}xSync(n,r){var s;return(s=this.log)==null||s.call(this,"jSync",n,r),this.jSync(n,r)}xFileSize(n,r){var o;const s=nt(this,Fr,El).call(this,"BigInt64",r);return(o=this.log)==null||o.call(this,"jFileSize",n),this.jFileSize(n,s)}xLock(n,r){var s;return(s=this.log)==null||s.call(this,"jLock",n,r),this.jLock(n,r)}xUnlock(n,r){var s;return(s=this.log)==null||s.call(this,"jUnlock",n,r),this.jUnlock(n,r)}xCheckReservedLock(n,r){var o;const s=nt(this,Fr,El).call(this,"Int32",r);return(o=this.log)==null||o.call(this,"jCheckReservedLock",n),this.jCheckReservedLock(n,s)}xFileControl(n,r,s){var a;const o=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(a=this.log)==null||a.call(this,"jFileControl",n,r,o),this.jFileControl(n,r,o)}xSectorSize(n){var r;return(r=this.log)==null||r.call(this,"jSectorSize",n),this.jSectorSize(n)}xDeviceCharacteristics(n){var r;return(r=this.log)==null||r.call(this,"jDeviceCharacteristics",n),this.jDeviceCharacteristics(n)}}Fr=new WeakSet,El=function(n,r){const s=n==="Int32"?4:8,o=`get${n}`,a=`set${n}`,u=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+r,s);let f=u();return new Proxy(f,{get(h,p){if(f.buffer.byteLength===0&&(f=u()),p===o)return function(k,T){if(!T)throw new Error("must be little endian");return f[p](k,T)};if(p===a)return function(k,T,O){if(!O)throw new Error("must be little endian");return f[p](k,T,O)};if(typeof p=="string"&&/^(get)|(set)/.test(p))throw new Error("invalid type");const g=f[p];return typeof g=="function"?g.bind(f):g}})},qS=function(n,r){let s=this._module.HEAPU8.subarray(n,n+r);return new Proxy(s,{get:(o,a,u)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(n,n+r));const f=s[a];return typeof f=="function"?f.bind(s):f}})},Z2=function(n,r){if(r&G2){let s=n,o=1;const a=[];for(;o;){const u=this._module.HEAPU8[s++];if(u)a.push(u);else switch(this._module.HEAPU8[s]||(o=null),o){case 1:{a.push(63),o=2;break}case 2:{a.push(61),o=3;break}case 3:{a.push(38),o=2;break}}}return new TextDecoder().decode(new Uint8Array(a))}return n?this._module.UTF8ToString(n):null};function Py(e,t){return t*4294967296+e+(e<0?2**32:0)}const e3=4096,m0=512,$ae=4,Cae=8,AS=m0+$ae,oT=m0,iT=AS,Ii=e3,Tae=pae|gae|_ae|yae,Iae=6;var zf,Jo,Kr,cr,ds,Jr,wt,t3,n3,r3,cc,FS,uc,xS;const w0=class w0 extends kae{constructor(n,r,s){super(n,s);Vr(this,wt);d(this,"log",null);Vr(this,zf);Vr(this,Jo);Vr(this,Kr,new Map);Vr(this,cr,new Map);Vr(this,ds,new Set);Vr(this,Jr,new Map);Gd(this,zf,r)}static async create(n,r,s){const o=new w0(n,r,s);return await o.isReady(),o}getOpfsFileName(n){const r=nt(this,wt,uc).call(this,n),s=xe(this,cr).get(r);return xe(this,Kr).get(s)}resetAccessHandle(n){const r=nt(this,wt,uc).call(this,n);xe(this,cr).get(r).truncate(Ii)}jOpen(n,r,s,o){try{const a=n?nt(this,wt,uc).call(this,n):Math.random().toString(36);let u=xe(this,cr).get(a);if(!u&&s&dp)if(this.getSize()<this.getCapacity())[u]=xe(this,ds).keys(),nt(this,wt,cc).call(this,u,a,s);else throw new Error("cannot create file");if(!u)throw new Error("file not found");const f={path:a,flags:s,accessHandle:u};return xe(this,Jr).set(r,f),o.setInt32(0,s,!0),re}catch(a){return console.error(a.message),Hd}}jClose(n){const r=xe(this,Jr).get(n);return r&&(r.accessHandle.flush(),xe(this,Jr).delete(n),r.flags&RS&&nt(this,wt,xS).call(this,r.path)),re}jRead(n,r,s){const a=xe(this,Jr).get(n).accessHandle.read(r.subarray(),{at:Ii+s});return a<r.byteLength?(r.fill(0,a,r.byteLength),x_):re}jWrite(n,r,s){return xe(this,Jr).get(n).accessHandle.write(r.subarray(),{at:Ii+s})===r.byteLength?re:jf}jTruncate(n,r){return xe(this,Jr).get(n).accessHandle.truncate(Ii+r),re}jSync(n,r){return xe(this,Jr).get(n).accessHandle.flush(),re}jFileSize(n,r){const o=xe(this,Jr).get(n).accessHandle.getSize()-Ii;return r.setBigInt64(0,BigInt(o),!0),re}jSectorSize(n){return e3}jDeviceCharacteristics(n){return bae}jAccess(n,r,s){const o=nt(this,wt,uc).call(this,n);return s.setInt32(0,xe(this,cr).has(o)?1:0,!0),re}jDelete(n,r){const s=nt(this,wt,uc).call(this,n);return nt(this,wt,xS).call(this,s),re}async close(){nt(this,wt,n3).call(this)}async isReady(){if(!xe(this,Jo)){let n=await navigator.storage.getDirectory();for(const r of xe(this,zf).split("/"))r&&(n=await n.getDirectoryHandle(r,{create:!0}));Gd(this,Jo,n),await nt(this,wt,t3).call(this),this.getCapacity()===0&&await this.addCapacity(Iae)}return!0}getSize(){return xe(this,cr).size}getCapacity(){return xe(this,Kr).size}async addCapacity(n){for(let r=0;r<n;++r){const s=Math.random().toString(36).replace("0.",""),a=await(await xe(this,Jo).getFileHandle(s,{create:!0})).createSyncAccessHandle();xe(this,Kr).set(a,s),nt(this,wt,cc).call(this,a,"",0)}return n}async removeCapacity(n){let r=0;for(const s of Array.from(xe(this,ds))){if(r==n||this.getSize()===this.getCapacity())return r;const o=xe(this,Kr).get(s);s.close(),await xe(this,Jo).removeEntry(o),xe(this,Kr).delete(s),xe(this,ds).delete(s),++r}return r}};zf=new WeakMap,Jo=new WeakMap,Kr=new WeakMap,cr=new WeakMap,ds=new WeakMap,Jr=new WeakMap,wt=new WeakSet,t3=async function(){const n=[];for await(const[r,s]of xe(this,Jo))s.kind==="file"&&n.push([r,s]);await Promise.all(n.map(async([r,s])=>{const o=await s.createSyncAccessHandle();xe(this,Kr).set(o,r);const a=nt(this,wt,r3).call(this,o);a?xe(this,cr).set(a,o):xe(this,ds).add(o)}))},n3=function(){for(const n of xe(this,Kr).keys())n.close();xe(this,Kr).clear(),xe(this,cr).clear(),xe(this,ds).clear()},r3=function(n){const r=new Uint8Array(AS);n.read(r,{at:0});const o=new DataView(r.buffer,r.byteOffset).getUint32(oT);if(r[0]&&(o&RS||(o&Tae)===0))return console.warn(`Remove file with unexpected flags ${o.toString(16)}`),nt(this,wt,cc).call(this,n,"",0),"";const a=new Uint32Array(Cae/4);n.read(a,{at:iT});const u=nt(this,wt,FS).call(this,r);if(a.every((f,h)=>f===u[h])){const f=r.indexOf(0);return f===0&&n.truncate(Ii),new TextDecoder().decode(r.subarray(0,f))}else return console.warn("Disassociating file with bad digest."),nt(this,wt,cc).call(this,n,"",0),""},cc=function(n,r,s){const o=new Uint8Array(AS);if(new TextEncoder().encodeInto(r,o).written>=m0)throw new Error("path too long");new DataView(o.buffer,o.byteOffset).setUint32(oT,s);const f=nt(this,wt,FS).call(this,o);n.write(o,{at:0}),n.write(f,{at:iT}),n.flush(),r?(xe(this,cr).set(r,n),xe(this,ds).delete(n)):(n.truncate(Ii),xe(this,ds).add(n))},FS=function(n){if(!n[0])return new Uint32Array([4274806656,2899230775]);let r=3735928559,s=1103547991;for(const o of n)r=Math.imul(r^o,2654435761),s=Math.imul(s^o,1597334677);return r=Math.imul(r^r>>>16,2246822507)^Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),new Uint32Array([r>>>0,s>>>0])},uc=function(n){return(typeof n=="string"?new URL(n,"file://localhost/"):n).pathname},xS=function(n){const r=xe(this,cr).get(n);r&&(xe(this,cr).delete(n),nt(this,wt,cc).call(this,r,"",0))};let PS=w0;const Rae=Bg(1).pipe(Cs),aT=new Map,Oae=({sqlite3:e,directory:t,fileName:n})=>z(function*(){const r=t.replaceAll(/["*/:<>?\\|]/g,"_"),o=`opfs${r.length===0?"":`-${r}`}`;if(e.vfs_registered.has(o)===!1){const f=yield*Mg(()=>PS.create(o,t,e.module));e.vfs_register(f,!1),aT.set(o,f)}const a=e.open_v2Sync(n,void 0,o),u=aT.get(o);return{dbPointer:a,vfs:u}}).pipe(Rae.withPermits(1));new TextDecoder;const qae=({sqlite3:e})=>t=>z(function*(){if(t._tag==="in-memory"){const{dbPointer:a,vfs:u}=X2(e);return sT({sqlite3:e,metadata:{_tag:"in-memory",vfs:u,dbPointer:a,deleteDb:()=>{},configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:":memory:"}}})}const n=60;let r=t.fileName;t.fileName.length>n&&(yield*to(`dbFilename too long: '${t.fileName}'. Max ${n} chars, got ${t.fileName.length}. Hashing...`),r=`hash-${Tt(t.fileName)}.db`);const{dbPointer:s,vfs:o}=yield*Oae({sqlite3:e,directory:t.opfsDirectory,fileName:r});return sT({sqlite3:e,metadata:{_tag:"opfs",vfs:o,dbPointer:s,deleteDb:()=>o.resetAccessHandle(t.fileName),configureDb:t.configureDb??(()=>{}),persistenceInfo:{fileName:r,opfsDirectory:t.opfsDirectory,opfsFileName:o.getOpfsFileName(r)}}})}),cT=0x7fffffffffffffffn,uT=-0x8000000000000000n;class kr extends Error{constructor(t,n){super(t),this.code=n}}const tc=!1;function Aae(e){const t={};e.retryOps=[];const n=e._getSqliteFree(),r=e._malloc(8),s=[r,r+4];function o(E){if(typeof E!="string")return 0;const S=new TextEncoder().encode(E),_=e._sqlite3_malloc(S.byteLength+1);return e.HEAPU8.set(S,_),e.HEAPU8[_+S.byteLength]=0,_}function a(E,S){return BigInt(S)<<32n|BigInt(E)&0xffffffffn}const u=(function(){const E=BigInt(Number.MAX_SAFE_INTEGER)>>32n,S=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(_,C){return C>E||C<S?a(_,C):C*4294967296+(_&2147483647)-(_&2147483648)}})(),f=new Set;function h(E){if(!f.has(E))throw new kr("not a database",Ho)}const p=new Map;function g(E){if(!p.has(E))throw new kr("not a statement",Ho)}t.bind_collection=function(E,S){g(E);const _=Array.isArray(S),C=t.bind_parameter_count(E);for(let $=1;$<=C;++$){const q=_?$-1:t.bind_parameter_name(E,$),P=S[q];P!==void 0&&t.bind(E,$,P)}return re},t.bind=function(E,S,_){switch(g(E),typeof _){case"number":return _===(_|0)?t.bind_int(E,S,_):t.bind_double(E,S,_);case"string":return t.bind_text(E,S,_);default:return _ instanceof Uint8Array||Array.isArray(_)?t.bind_blob(E,S,_):_===null?t.bind_null(E,S):typeof _=="bigint"?t.bind_int64(E,S,_):_===void 0?hae:(console.warn("unknown binding converted to null",_),t.bind_null(E,S))}},t.bind_blob=(function(){const E="sqlite3_bind_blob",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=$.byteLength??$.length,P=e._sqlite3_malloc(q);e.HEAPU8.subarray(P).set($);const N=S(_,C,P,q,n);return O(E,N,p.get(_))}})(),t.bind_parameter_count=(function(){const S=e.cwrap("sqlite3_bind_parameter_count",...se("n:n"));return function(_){return g(_),S(_)}})(),t.bind_double=(function(){const E="sqlite3_bind_double",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){g(_);const q=S(_,C,$);return O(E,q,p.get(_))}})(),t.bind_int=(function(){const E="sqlite3_bind_int",S=e.cwrap(E,...se("nnn:n"));return function(_,C,$){if(g(_),$>2147483647||$<-2147483648)return qy;const q=S(_,C,$);return O(E,q,p.get(_))}})(),t.bind_int64=(function(){const E="sqlite3_bind_int64",S=e.cwrap(E,...se("nnnn:n"));return function(_,C,$){if(g(_),$>cT||$<uT)return qy;const q=$&0xffffffffn,P=$>>32n,N=S(_,C,Number(q),Number(P));return O(E,N,p.get(_))}})(),t.bind_null=(function(){const E="sqlite3_bind_null",S=e.cwrap(E,...se("nn:n"));return function(_,C){g(_);const $=S(_,C);return O(E,$,p.get(_))}})(),t.bind_parameter_name=(function(){const S=e.cwrap("sqlite3_bind_parameter_name",...se("n:s"));return function(_,C){return g(_),S(_,C)}})(),t.bind_text=(function(){const E="sqlite3_bind_text",S=e.cwrap(E,...se("nnnnn:n"));return function(_,C,$){g(_);const q=o($),P=S(_,C,q,-1,n);return O(E,P,p.get(_))}})(),t.changes=(function(){const S=e.cwrap("sqlite3_changes",...se("n:n"));return function(_){return h(_),S(_)}})(),t.deserialize=(function(){const S=e.cwrap("sqlite3_deserialize",...se("nnnnnn:n"));return function(_,C,$,q,P,N){h(_);const M=e._sqlite3_malloc(q);return e.HEAPU8.subarray(M).set($),S(_,C,M,q,P,N)}})();const k=1;t.serialize=(function(){const S=e.cwrap("sqlite3_serialize",...se("nsnn:n"));return function(_,C){h(_);const $=s[0];let q=S(_,C,$,0);if(q===0){q=S(_,C,$,k);const P=e.getValue($,"*"),N=e.HEAPU8.subarray(q,q+P);return new Uint8Array(N.slice())}else{const P=e.getValue($,"*"),N=e.HEAPU8.subarray(q,q+P);return new Uint8Array(N)}}})(),t.backup=(function(){const E=e.cwrap("sqlite3_backup_init",...se("nsns:n")),S=e.cwrap("sqlite3_backup_step",...se("nn:n")),_=e.cwrap("sqlite3_backup_finish",...se("n:n"));return function(C,$,q,P){h(C),h(q);const N=E(C,$,q,P);if(N===0){const M=e.ccall("sqlite3_errmsg","string",["number"],[C]);throw new kr(`backup failed: ${M}`,dae)}return S(N,-1),_(N)}})(),t.clear_bindings=(function(){const E="sqlite3_clear_bindings",S=e.cwrap(E,...se("n:n"));return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}})(),t.close=(function(){const E="sqlite3_close",S=e.cwrap(E,...se("n:n"),{async:tc});return function(_){h(_);const C=S(_);return f.delete(_),O(E,C,_)}})(),t.column=function(E,S){g(E);const _=t.column_type(E,S);switch(_){case tT:return t.column_blob(E,S);case ZC:return t.column_double(E,S);case XC:const C=t.column_int(E,S),$=e.getTempRet0();return u(C,$);case nT:return null;case eT:return t.column_text(E,S);default:throw new kr("unknown type",_)}},t.column_blob=(function(){const S=e.cwrap("sqlite3_column_blob",...se("nn:n"));return function(_,C){g(_);const $=t.column_bytes(_,C),q=S(_,C);if(q===0)return null;const P=e.HEAPU8.subarray(q,q+$);return new Uint8Array(P)}})(),t.column_bytes=(function(){const S=e.cwrap("sqlite3_column_bytes",...se("nn:n"));return function(_,C){return g(_),S(_,C)}})(),t.column_count=(function(){const S=e.cwrap("sqlite3_column_count",...se("n:n"));return function(_){return g(_),S(_)}})(),t.column_double=(function(){const S=e.cwrap("sqlite3_column_double",...se("nn:n"));return function(_,C){return g(_),S(_,C)}})(),t.column_int=(function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){return g(_),S(_,C)}})(),t.column_int64=(function(){const S=e.cwrap("sqlite3_column_int64",...se("nn:n"));return function(_,C){g(_);const $=S(_,C),q=e.getTempRet0();return a($,q)}})(),t.column_name=(function(){const S=e.cwrap("sqlite3_column_name",...se("nn:s"));return function(_,C){return g(_),S(_,C)}})(),t.column_names=function(E){const S=[],_=t.column_count(E);for(let C=0;C<_;++C)S.push(t.column_name(E,C));return S},t.column_text=(function(){const S=e.cwrap("sqlite3_column_text",...se("nn:s"));return function(_,C){return g(_),S(_,C)}})(),t.column_type=(function(){const S=e.cwrap("sqlite3_column_type",...se("nn:n"));return function(_,C){return g(_),S(_,C)}})(),t.create_function=function(E,S,_,C,$,q,P,N){h(E);function M(F){return((j,Z,we)=>F(j,e.HEAP32.subarray(we/4,we/4+Z)))}const B=e.create_function(E,S,_,C,$,q&&M(q),P&&M(P),N);return O("sqlite3_create_function",B,E)},t.data_count=(function(){const S=e.cwrap("sqlite3_data_count",...se("n:n"));return function(_){return g(_),S(_)}})(),t.exec=function(E,S,_){const C=t.statements(E,S,{unscoped:!0});for(const $ of C){let q;for(;t.step($)===IS;)if(_){q=q??t.column_names($);const P=t.row($);_(P,q),_(P,q)}}for(const $ of C)t.finalize($);return re},t.finalize=(function(){const S=e.cwrap("sqlite3_finalize",...se("n:n"),{async:tc});return function(_){const C=S(_);return p.delete(_),C}})(),t.get_autocommit=(function(){const S=e.cwrap("sqlite3_get_autocommit",...se("n:n"));return function(_){return S(_)}})(),t.libversion=(function(){const S=e.cwrap("sqlite3_libversion",...se(":s"));return function(){return S()}})(),t.libversion_number=(function(){const S=e.cwrap("sqlite3_libversion_number",...se(":n"));return function(){return S()}})(),t.limit=(function(){const S=e.cwrap("sqlite3_limit",...se("nnn:n"));return function(_,C,$){return S(_,C,$)}})(),t.open_v2=(function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:tc});return async function(_,C,$){C=C||dp|YC,$=o($);try{const q=await L(()=>S(_,s[0],C,$)),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}})(),t.open_v2Sync=(function(){const E="sqlite3_open_v2",S=e.cwrap(E,...se("snnn:n"),{async:tc});return function(_,C,$){C=C||dp|YC,$=o($);try{const q=S(_,s[0],C,$),P=e.getValue(s[0],"*");return f.add(P),e.ccall("RegisterExtensionFunctions","void",["number"],[P]),O(E,q,P),P}finally{e._sqlite3_free($)}}})(),t.progress_handler=function(E,S,_,C){h(E),e.progress_handler(E,S,_,C)},t.reset=(function(){const E="sqlite3_reset",S=e.cwrap(E,...se("n:n"),{async:tc});return function(_){g(_);const C=S(_);return O(E,C,p.get(_))}})(),t.result=function(E,S){switch(typeof S){case"number":S===(S|0)?t.result_int(E,S):t.result_double(E,S);break;case"string":t.result_text(E,S);break;default:if(S instanceof Uint8Array||Array.isArray(S))t.result_blob(E,S);else if(S===null)t.result_null(E);else{if(typeof S=="bigint")return t.result_int64(E,S);console.warn("unknown result converted to null",S),t.result_null(E)}break}},t.result_blob=(function(){const S=e.cwrap("sqlite3_result_blob",...se("nnnn:n"));return function(_,C){const $=C.byteLength??C.length,q=e._sqlite3_malloc($);e.HEAPU8.subarray(q).set(C),S(_,q,$,n)}})(),t.result_double=(function(){const S=e.cwrap("sqlite3_result_double",...se("nn:n"));return function(_,C){S(_,C)}})(),t.result_int=(function(){const S=e.cwrap("sqlite3_result_int",...se("nn:n"));return function(_,C){S(_,C)}})(),t.result_int64=(function(){const S=e.cwrap("sqlite3_result_int64",...se("nnn:n"));return function(_,C){if(C>cT||C<uT)return qy;const $=C&0xffffffffn,q=C>>32n;S(_,Number($),Number(q))}})(),t.result_null=(function(){const S=e.cwrap("sqlite3_result_null",...se("n:n"));return function(_){S(_)}})(),t.result_text=(function(){const S=e.cwrap("sqlite3_result_text",...se("nnnn:n"));return function(_,C){const $=o(C);S(_,$,-1,n)}})(),t.row=function(E){const S=[],_=t.data_count(E);for(let C=0;C<_;++C){const $=t.column(E,C);S.push(($==null?void 0:$.buffer)===e.HEAPU8.buffer?$.slice():$)}return S},t.set_authorizer=function(E,S,_){h(E);function C(P,N,M,B,F,j){return[P,N,e.UTF8ToString(M),e.UTF8ToString(B),e.UTF8ToString(F),e.UTF8ToString(j)]}function $(P){return((N,M,B,F,j,Z)=>P(...C(N,M,B,F,j,Z)))}const q=e.set_authorizer(E,$(S),_);return O("sqlite3_set_authorizer",q,E)},t.sql=(function(){const S=e.cwrap("sqlite3_sql",...se("n:s"));return function(_){return g(_),S(_)}})(),t.statements=function(E,S,_={}){const C=e.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!1}),$=[],q=new TextEncoder().encode(S),P=q.byteLength-q.byteLength%4+12,N=e._sqlite3_malloc(P),M=N+q.byteLength+1;e.HEAPU8.set(q,N),e.HEAPU8[M-1]=0;const B=N+P-8,F=N+P-4;let j;function Z(){j&&!_.unscoped&&t.finalize(j),j=0}e.setValue(F,N,"*");do{Z();const we=e.getValue(F,"*"),G=C(E,we,M-F,_.flags||0,B,F);G!==re&&O("sqlite3_prepare_v3",G,E),j=e.getValue(B,"*"),j&&(p.set(j,E),$.push(j))}while(j);return $},t.step=(function(){const E="sqlite3_step",S=e.cwrap(E,...se("n:n"),{async:tc});return function(_){g(_);const C=S(_);return O(E,C,p.get(_),[IS,mae])}})(),t.commit_hook=function(E,S){h(E),e.commit_hook(E,S)},t.update_hook=function(E,S){h(E);function _($,q,P,N,M){return[$,e.UTF8ToString(q),e.UTF8ToString(P),a(N,M)]}function C($){return((q,P,N,M,B)=>$(..._(q,P,N,M,B)))}e.update_hook(E,C(S))},t.session_create=(function(){const E="sqlite3session_create",S=e.cwrap(E,...se("nsn:n"));return function(_,C){h(_);const $=e._malloc(4),q=S(_,C,$);return q!==re&&O(E,q,_),e.getValue($,"i32")}})(),t.session_attach=(function(){const E="sqlite3session_attach",S=e.cwrap(E,...se("ns:n"));return function(_,C){if(typeof _!="number")throw new kr("Invalid session object",Ho);const $=S(_,C);return O(E,$)}})(),t.session_enable=(function(){const S=e.cwrap("sqlite3session_enable",...se("nn:n"));return function(_,C){const $=C?1:0;if(typeof _!="number")throw new kr("Invalid session object",Ho);if(S(_,$)!==$)throw new kr("Failed to enable session",Ho)}})(),t.session_changeset=(function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n"));return function(_){if(typeof _!="number")throw new kr("Invalid session object",Ho);const C=e._malloc(4),$=e._malloc(4);try{const q=S(_,C,$);if(q===re){const P=e.getValue(C,"i32"),N=e.getValue($,"i32");if(N===0)return{result:q,size:0,changeset:null};const M=new Uint8Array(e.HEAPU8.subarray(N,N+P));return e._sqlite3_free(N),{result:q,size:P,changeset:M}}return O(E,q)}finally{e._free(C),e._free($)}}})(),t.session_delete=(function(){const S=e.cwrap("sqlite3session_delete",...se("n:v"));return function(_){if(typeof _!="number")throw new kr("Invalid session object",Ho);return S(_)}})(),t.changeset_start=(function(){const E="sqlite3changeset_start",S=e.cwrap(E,...se("nnn:n"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4);try{const q=S($,_.length,C);return q!==re&&O(E,q),e.getValue($,"i32")}finally{e._sqlite3_free(C),e._free($)}}})(),t.changeset_finalize=(function(){const S=e.cwrap("sqlite3changeset_finalize",...se("n:n"));return function(_){return S(_)}})(),t.changeset_invert=(function(){const E="sqlite3changeset_invert",S=e.cwrap(E,...se("nn:nn"));return function(_){const C=e._sqlite3_malloc(_.length);e.HEAPU8.subarray(C).set(_);const $=e._malloc(4),q=e._malloc(4),P=S(_.length,C,$,q);P!==re&&O(E,P);const N=e.getValue($,"i32"),M=e.getValue(q,"i32"),B=new Uint8Array(e.HEAPU8.buffer,M,N).slice();return e._sqlite3_free(C),e._sqlite3_free(M),B}})(),t.session_changeset_inverted=(function(){const E="sqlite3session_changeset",S=e.cwrap(E,...se("nnn:n")),_="sqlite3changeset_invert",C=e.cwrap(_,...se("nn:nn"));return function($){if(typeof $!="number")throw new kr("Invalid session object",Ho);const q=e._malloc(4),P=e._malloc(4),N=e._malloc(4),M=e._malloc(4);try{const B=S($,q,P);if(B!==re)return O(E,B);const F=e.getValue(q,"i32"),j=e.getValue(P,"i32"),Z=C(F,j,N,M);if(Z!==re)return O(_,Z);const we=e.getValue(N,"i32"),G=e.getValue(M,"i32"),ke=new Uint8Array(e.HEAPU8.buffer,G,we);return e._sqlite3_free(j),e._sqlite3_free(G),{result:B,size:F,changeset:new Uint8Array(ke)}}finally{e._free(q),e._free(P),e._free(N),e._free(M)}}})(),t.changeset_apply=(function(){const E="sqlite3changeset_apply",S=e.cwrap(E,...se("nnnnnn:n"));return function(_,C,$){const q=e._sqlite3_malloc(C.length);e.HEAPU8.subarray(q).set(C);const P=1,N=()=>P,M=S(_,C.length,q,null,N,null);return e._sqlite3_free(q),M!==re&&O(E,M),M}})(),t.value=function(E){const S=t.value_type(E);switch(S){case tT:return t.value_blob(E);case ZC:return t.value_double(E);case XC:const _=t.value_int(E),C=e.getTempRet0();return u(_,C);case nT:return null;case eT:return t.value_text(E);default:throw new kr("unknown type",S)}},t.value_blob=(function(){const S=e.cwrap("sqlite3_value_blob",...se("n:n"));return function(_){const C=t.value_bytes(_),$=S(_);return e.HEAPU8.subarray($,$+C)}})(),t.value_bytes=(function(){const S=e.cwrap("sqlite3_value_bytes",...se("n:n"));return function(_){return S(_)}})(),t.value_double=(function(){const S=e.cwrap("sqlite3_value_double",...se("n:n"));return function(_){return S(_)}})(),t.value_int=(function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){return S(_)}})(),t.value_int64=(function(){const S=e.cwrap("sqlite3_value_int64",...se("n:n"));return function(_){const C=S(_),$=e.getTempRet0();return a(C,$)}})(),t.value_text=(function(){const S=e.cwrap("sqlite3_value_text",...se("n:s"));return function(_){return S(_)}})(),t.value_type=(function(){const S=e.cwrap("sqlite3_value_type",...se("n:n"));return function(_){return S(_)}})();const T=new Set;t.vfs_register=function(E,S){if(T.has(E.name))return;const _=e.vfs_register(E,S),C=O("sqlite3_vfs_register",_);return T.add(E.name),C},t.vfs_registered=T;function O(E,S,_=null,C=[re]){if(C.includes(S))return S;const $=_?e.ccall("sqlite3_errmsg","string",["number"],[_]):E;throw new kr($,S)}async function L(E){let S;do e.retryOps.length&&(await Promise.all(e.retryOps),e.retryOps=[]),S=await E();while(S&&e.retryOps.length);return S}return t}function se(e){const t=[],n=e.match(/([ns@]*):([nsv@])/);switch(n[2]){case"n":t.push("number");break;case"s":t.push("string");break;case"v":t.push(null);break}const r=[];for(let s of n[1])switch(s){case"n":r.push("number");break;case"s":r.push("string");break}return t.push(r),t}var Pae=(()=>{var e=import.meta.url;return(function(t={}){var n,r=t,s,o,a=new Promise((i,c)=>{s=i,o=c}),u=typeof window=="object",f=typeof WorkerGlobalScope<"u";typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var h=Object.assign({},r),p="./this.program",g=(i,c)=>{throw c},k="";function T(i){return r.locateFile?r.locateFile(i,k):k+i}var O,L;(u||f)&&(f?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),e&&(k=e),k.startsWith("blob:")?k="":k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1),f&&(L=i=>{var c=new XMLHttpRequest;return c.open("GET",i,!1),c.responseType="arraybuffer",c.send(null),new Uint8Array(c.response)}),O=i=>fetch(i,{credentials:"same-origin"}).then(c=>c.ok?c.arrayBuffer():Promise.reject(new Error(c.status+" : "+c.url))));var E=r.print||console.log.bind(console),S=r.printErr||console.error.bind(console);Object.assign(r,h),h=null,r.arguments&&r.arguments,r.thisProgram&&(p=r.thisProgram);var _=r.wasmBinary,C,$=!1,q,P,N,M,B,F,j,Z,we;function G(){var i=C.buffer;r.HEAP8=P=new Int8Array(i),r.HEAP16=M=new Int16Array(i),r.HEAPU8=N=new Uint8Array(i),r.HEAPU16=B=new Uint16Array(i),r.HEAP32=F=new Int32Array(i),r.HEAPU32=j=new Uint32Array(i),r.HEAPF32=Z=new Float32Array(i),r.HEAPF64=we=new Float64Array(i)}var ke=[],qe=[],We=[],tt=[];function Ke(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Qu(r.preRun.shift());Wd(ke)}function jt(){!r.noFSInit&&!b.initialized&&b.init(),b.ignorePermissions=!1,Wd(qe)}function Nn(){Wd(We)}function Gu(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Vd(r.postRun.shift());Wd(tt)}function Qu(i){ke.unshift(i)}function Yu(i){qe.unshift(i)}function Vd(i){tt.unshift(i)}var as=0,Lo=null;function N_(i){return i}function zr(i){var c;as++,(c=r.monitorRunDependencies)==null||c.call(r,as)}function za(i){var l;if(as--,(l=r.monitorRunDependencies)==null||l.call(r,as),as==0&&Lo){var c=Lo;Lo=null,c()}}function cs(i){var l;(l=r.onAbort)==null||l.call(r,i),i="Aborted("+i+")",S(i),$=!0,i+=". Build with -sASSERTIONS for more info.";var c=new WebAssembly.RuntimeError(i);throw o(c),c}var p3="data:application/octet-stream;base64,",v0=i=>i.startsWith(p3);function g3(){if(r.locateFile){var i="wa-sqlite.wasm";return v0(i)?i:T(i)}return new URL("/assets/wa-sqlite-CWx0VZcQ.wasm",import.meta.url).href}var D_;function E0(i){if(i==D_&&_)return new Uint8Array(_);if(L)return L(i);throw"both async and sync fetching of the wasm failed"}function _3(i){return _?Promise.resolve().then(()=>E0(i)):O(i).then(c=>new Uint8Array(c),()=>E0(i))}function k0(i,c,l){return _3(i).then(m=>WebAssembly.instantiate(m,c)).then(l,m=>{S(`failed to asynchronously prepare wasm: ${m}`),cs(m)})}function y3(i,c,l,m){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!v0(c)&&typeof fetch=="function"?fetch(c,{credentials:"same-origin"}).then(w=>{var R=WebAssembly.instantiateStreaming(w,l);return R.then(m,function(A){return S(`wasm streaming compile failed: ${A}`),S("falling back to ArrayBuffer instantiation"),k0(c,l,m)})}):k0(c,l,m)}function b3(){return{a:SM}}function S3(){function i(m,w){return I=m.exports,C=I.la,G(),Wa=I.of,Yu(I.ma),za(),I}zr();function c(m){i(m.instance)}var l=b3();if(r.instantiateWasm)try{return r.instantiateWasm(l,i)}catch(m){S(`Module.instantiateWasm callback failed with error: ${m}`),o(m)}return D_??(D_=g3()),y3(_,D_,l,c).catch(o),{}}var ve,At;class $0{constructor(c){d(this,"name","ExitStatus");this.message=`Program terminated with exit(${c})`,this.status=c}}var Wd=i=>{for(;i.length>0;)i.shift()(r)};function C0(i,c="i8"){switch(c.endsWith("*")&&(c="*"),c){case"i1":return P[i];case"i8":return P[i];case"i16":return M[i>>1];case"i32":return F[i>>2];case"i64":cs("to do getValue(i64) use WASM_BIGINT");case"float":return Z[i>>2];case"double":return we[i>>3];case"*":return j[i>>2];default:cs(`invalid type for getValue: ${c}`)}}r.noExitRuntime;function Ba(i,c,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":P[i]=c;break;case"i8":P[i]=c;break;case"i16":M[i>>1]=c;break;case"i32":F[i>>2]=c;break;case"i64":cs("to do setValue(i64) use WASM_BIGINT");case"float":Z[i>>2]=c;break;case"double":we[i>>3]=c;break;case"*":j[i>>2]=c;break;default:cs(`invalid type for setValue: ${l}`)}}var w3=i=>z0(i),v3=()=>H0(),T0=typeof TextDecoder<"u"?new TextDecoder:void 0,Ha=(i,c=0,l=NaN)=>{for(var m=c+l,w=c;i[w]&&!(w>=m);)++w;if(w-c>16&&i.buffer&&T0)return T0.decode(i.subarray(c,w));for(var R="";c<w;){var A=i[c++];if(!(A&128)){R+=String.fromCharCode(A);continue}var x=i[c++]&63;if((A&224)==192){R+=String.fromCharCode((A&31)<<6|x);continue}var H=i[c++]&63;if((A&240)==224?A=(A&15)<<12|x<<6|H:A=(A&7)<<18|x<<12|H<<6|i[c++]&63,A<65536)R+=String.fromCharCode(A);else{var te=A-65536;R+=String.fromCharCode(55296|te>>10,56320|te&1023)}}return R},Ei=(i,c)=>i?Ha(N,i,c):"",E3=(i,c,l,m)=>cs(`Assertion failed: ${Ei(i)}, at: `+[c?Ei(c):"unknown filename",l,m?Ei(m):"unknown function"]),ht={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var c=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return c.exec(i).slice(1)},normalizeArray:(i,c)=>{for(var l=0,m=i.length-1;m>=0;m--){var w=i[m];w==="."?i.splice(m,1):w===".."?(i.splice(m,1),l++):l&&(i.splice(m,1),l--)}if(c)for(;l;l--)i.unshift("..");return i},normalize:i=>{var c=ht.isAbs(i),l=i.substr(-1)==="/";return i=ht.normalizeArray(i.split("/").filter(m=>!!m),!c).join("/"),!i&&!c&&(i="."),i&&l&&(i+="/"),(c?"/":"")+i},dirname:i=>{var c=ht.splitPath(i),l=c[0],m=c[1];return!l&&!m?".":(m&&(m=m.substr(0,m.length-1)),l+m)},basename:i=>{if(i==="/")return"/";i=ht.normalize(i),i=i.replace(/\/$/,"");var c=i.lastIndexOf("/");return c===-1?i:i.substr(c+1)},join:(...i)=>ht.normalize(i.join("/")),join2:(i,c)=>ht.normalize(i+"/"+c)},k3=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return i=>crypto.getRandomValues(i);cs("initRandomDevice")},I0=i=>(I0=k3())(i),jo={resolve:(...i)=>{for(var c="",l=!1,m=i.length-1;m>=-1&&!l;m--){var w=m>=0?i[m]:b.cwd();if(typeof w!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!w)return"";c=w+"/"+c,l=ht.isAbs(w)}return c=ht.normalizeArray(c.split("/").filter(R=>!!R),!l).join("/"),(l?"/":"")+c||"."},relative:(i,c)=>{i=jo.resolve(i).substr(1),c=jo.resolve(c).substr(1);function l(te){for(var Ie=0;Ie<te.length&&te[Ie]==="";Ie++);for(var Pe=te.length-1;Pe>=0&&te[Pe]==="";Pe--);return Ie>Pe?[]:te.slice(Ie,Pe-Ie+1)}for(var m=l(i.split("/")),w=l(c.split("/")),R=Math.min(m.length,w.length),A=R,x=0;x<R;x++)if(m[x]!==w[x]){A=x;break}for(var H=[],x=A;x<m.length;x++)H.push("..");return H=H.concat(w.slice(A)),H.join("/")}},M_=[],Va=i=>{for(var c=0,l=0;l<i.length;++l){var m=i.charCodeAt(l);m<=127?c++:m<=2047?c+=2:m>=55296&&m<=57343?(c+=4,++l):c+=3}return c},L_=(i,c,l,m)=>{if(!(m>0))return 0;for(var w=l,R=l+m-1,A=0;A<i.length;++A){var x=i.charCodeAt(A);if(x>=55296&&x<=57343){var H=i.charCodeAt(++A);x=65536+((x&1023)<<10)|H&1023}if(x<=127){if(l>=R)break;c[l++]=x}else if(x<=2047){if(l+1>=R)break;c[l++]=192|x>>6,c[l++]=128|x&63}else if(x<=65535){if(l+2>=R)break;c[l++]=224|x>>12,c[l++]=128|x>>6&63,c[l++]=128|x&63}else{if(l+3>=R)break;c[l++]=240|x>>18,c[l++]=128|x>>12&63,c[l++]=128|x>>6&63,c[l++]=128|x&63}}return c[l]=0,l-w};function j_(i,c,l){var m=l>0?l:Va(i)+1,w=new Array(m),R=L_(i,w,0,w.length);return c&&(w.length=R),w}var $3=()=>{if(!M_.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(i=window.prompt("Input: "),i!==null&&(i+=`
`)),!i)return null;M_=j_(i,!0)}return M_.shift()},ki={ttys:[],init(){},shutdown(){},register(i,c){ki.ttys[i]={input:[],output:[],ops:c},b.registerDevice(i,ki.stream_ops)},stream_ops:{open(i){var c=ki.ttys[i.node.rdev];if(!c)throw new b.ErrnoError(43);i.tty=c,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,c,l,m,w){if(!i.tty||!i.tty.ops.get_char)throw new b.ErrnoError(60);for(var R=0,A=0;A<m;A++){var x;try{x=i.tty.ops.get_char(i.tty)}catch{throw new b.ErrnoError(29)}if(x===void 0&&R===0)throw new b.ErrnoError(6);if(x==null)break;R++,c[l+A]=x}return R&&(i.node.timestamp=Date.now()),R},write(i,c,l,m,w){if(!i.tty||!i.tty.ops.put_char)throw new b.ErrnoError(60);try{for(var R=0;R<m;R++)i.tty.ops.put_char(i.tty,c[l+R])}catch{throw new b.ErrnoError(29)}return m&&(i.node.timestamp=Date.now()),R}},default_tty_ops:{get_char(i){return $3()},put_char(i,c){c===null||c===10?(E(Ha(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(E(Ha(i.output)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,c,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,c){c===null||c===10?(S(Ha(i.output)),i.output=[]):c!=0&&i.output.push(c)},fsync(i){i.output&&i.output.length>0&&(S(Ha(i.output)),i.output=[])}}},C3=(i,c)=>{N.fill(0,i,i+c)},R0=(i,c)=>Math.ceil(i/c)*c,O0=i=>{i=R0(i,65536);var c=j0(65536,i);return c&&C3(c,i),c},$e={ops_table:null,mount(i){return $e.createNode(null,"/",16895,0)},createNode(i,c,l,m){if(b.isBlkdev(l)||b.isFIFO(l))throw new b.ErrnoError(63);$e.ops_table||($e.ops_table={dir:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr,lookup:$e.node_ops.lookup,mknod:$e.node_ops.mknod,rename:$e.node_ops.rename,unlink:$e.node_ops.unlink,rmdir:$e.node_ops.rmdir,readdir:$e.node_ops.readdir,symlink:$e.node_ops.symlink},stream:{llseek:$e.stream_ops.llseek}},file:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr},stream:{llseek:$e.stream_ops.llseek,read:$e.stream_ops.read,write:$e.stream_ops.write,allocate:$e.stream_ops.allocate,mmap:$e.stream_ops.mmap,msync:$e.stream_ops.msync}},link:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr,readlink:$e.node_ops.readlink},stream:{}},chrdev:{node:{getattr:$e.node_ops.getattr,setattr:$e.node_ops.setattr},stream:b.chrdev_stream_ops}});var w=b.createNode(i,c,l,m);return b.isDir(w.mode)?(w.node_ops=$e.ops_table.dir.node,w.stream_ops=$e.ops_table.dir.stream,w.contents={}):b.isFile(w.mode)?(w.node_ops=$e.ops_table.file.node,w.stream_ops=$e.ops_table.file.stream,w.usedBytes=0,w.contents=null):b.isLink(w.mode)?(w.node_ops=$e.ops_table.link.node,w.stream_ops=$e.ops_table.link.stream):b.isChrdev(w.mode)&&(w.node_ops=$e.ops_table.chrdev.node,w.stream_ops=$e.ops_table.chrdev.stream),w.timestamp=Date.now(),i&&(i.contents[c]=w,i.timestamp=w.timestamp),w},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,c){var l=i.contents?i.contents.length:0;if(!(l>=c)){var m=1024*1024;c=Math.max(c,l*(l<m?2:1.125)>>>0),l!=0&&(c=Math.max(c,256));var w=i.contents;i.contents=new Uint8Array(c),i.usedBytes>0&&i.contents.set(w.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,c){if(i.usedBytes!=c)if(c==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(c),l&&i.contents.set(l.subarray(0,Math.min(c,i.usedBytes))),i.usedBytes=c}},node_ops:{getattr(i){var c={};return c.dev=b.isChrdev(i.mode)?i.id:1,c.ino=i.id,c.mode=i.mode,c.nlink=1,c.uid=0,c.gid=0,c.rdev=i.rdev,b.isDir(i.mode)?c.size=4096:b.isFile(i.mode)?c.size=i.usedBytes:b.isLink(i.mode)?c.size=i.link.length:c.size=0,c.atime=new Date(i.timestamp),c.mtime=new Date(i.timestamp),c.ctime=new Date(i.timestamp),c.blksize=4096,c.blocks=Math.ceil(c.size/c.blksize),c},setattr(i,c){c.mode!==void 0&&(i.mode=c.mode),c.timestamp!==void 0&&(i.timestamp=c.timestamp),c.size!==void 0&&$e.resizeFileStorage(i,c.size)},lookup(i,c){throw $e.doesNotExistError},mknod(i,c,l,m){return $e.createNode(i,c,l,m)},rename(i,c,l){if(b.isDir(i.mode)){var m;try{m=b.lookupNode(c,l)}catch{}if(m)for(var w in m.contents)throw new b.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,c.contents[l]=i,c.timestamp=i.parent.timestamp},unlink(i,c){delete i.contents[c],i.timestamp=Date.now()},rmdir(i,c){var l=b.lookupNode(i,c);for(var m in l.contents)throw new b.ErrnoError(55);delete i.contents[c],i.timestamp=Date.now()},readdir(i){var c=[".",".."];for(var l of Object.keys(i.contents))c.push(l);return c},symlink(i,c,l){var m=$e.createNode(i,c,41471,0);return m.link=l,m},readlink(i){if(!b.isLink(i.mode))throw new b.ErrnoError(28);return i.link}},stream_ops:{read(i,c,l,m,w){var R=i.node.contents;if(w>=i.node.usedBytes)return 0;var A=Math.min(i.node.usedBytes-w,m);if(A>8&&R.subarray)c.set(R.subarray(w,w+A),l);else for(var x=0;x<A;x++)c[l+x]=R[w+x];return A},write(i,c,l,m,w,R){if(c.buffer===P.buffer&&(R=!1),!m)return 0;var A=i.node;if(A.timestamp=Date.now(),c.subarray&&(!A.contents||A.contents.subarray)){if(R)return A.contents=c.subarray(l,l+m),A.usedBytes=m,m;if(A.usedBytes===0&&w===0)return A.contents=c.slice(l,l+m),A.usedBytes=m,m;if(w+m<=A.usedBytes)return A.contents.set(c.subarray(l,l+m),w),m}if($e.expandFileStorage(A,w+m),A.contents.subarray&&c.subarray)A.contents.set(c.subarray(l,l+m),w);else for(var x=0;x<m;x++)A.contents[w+x]=c[l+x];return A.usedBytes=Math.max(A.usedBytes,w+m),m},llseek(i,c,l){var m=c;if(l===1?m+=i.position:l===2&&b.isFile(i.node.mode)&&(m+=i.node.usedBytes),m<0)throw new b.ErrnoError(28);return m},allocate(i,c,l){$e.expandFileStorage(i.node,c+l),i.node.usedBytes=Math.max(i.node.usedBytes,c+l)},mmap(i,c,l,m,w){if(!b.isFile(i.node.mode))throw new b.ErrnoError(43);var R,A,x=i.node.contents;if(!(w&2)&&x&&x.buffer===P.buffer)A=!1,R=x.byteOffset;else{if(A=!0,R=O0(c),!R)throw new b.ErrnoError(48);x&&((l>0||l+c<x.length)&&(x.subarray?x=x.subarray(l,l+c):x=Array.prototype.slice.call(x,l,l+c)),P.set(x,R))}return{ptr:R,allocated:A}},msync(i,c,l,m,w){return $e.stream_ops.write(i,c,0,m,l,!1),0}}},T3=(i,c,l,m)=>{var w=`al ${i}`;O(i).then(R=>{c(new Uint8Array(R)),w&&za()},R=>{if(l)l();else throw`Loading data file "${i}" failed.`}),w&&zr()},I3=(i,c,l,m,w,R)=>{b.createDataFile(i,c,l,m,w,R)},R3=r.preloadPlugins||[],O3=(i,c,l,m)=>{typeof Browser<"u"&&Browser.init();var w=!1;return R3.forEach(R=>{w||R.canHandle(c)&&(R.handle(i,c,l,m),w=!0)}),w},q3=(i,c,l,m,w,R,A,x,H,te)=>{var Ie=c?jo.resolve(ht.join2(i,c)):i;function Pe(Xe){function ue(de){te==null||te(),x||I3(i,c,de,m,w,H),R==null||R(),za()}O3(Xe,Ie,ue,()=>{A==null||A(),za()})||ue(Xe)}zr(),typeof l=="string"?T3(l,Pe,A):Pe(l)},A3=i=>{var c={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=c[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},U_=(i,c)=>{var l=0;return i&&(l|=365),c&&(l|=146),l},b={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class{constructor(i){d(this,"name","ErrnoError");this.errno=i}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{constructor(){d(this,"shared",{})}get object(){return this.node}set object(i){this.node=i}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(i){this.shared.flags=i}get position(){return this.shared.position}set position(i){this.shared.position=i}},FSNode:class{constructor(i,c,l,m){d(this,"node_ops",{});d(this,"stream_ops",{});d(this,"readMode",365);d(this,"writeMode",146);d(this,"mounted",null);i||(i=this),this.parent=i,this.mount=i.mount,this.id=b.nextInode++,this.name=c,this.mode=l,this.rdev=m}get read(){return(this.mode&this.readMode)===this.readMode}set read(i){i?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(i){i?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return b.isDir(this.mode)}get isDevice(){return b.isChrdev(this.mode)}},lookupPath(i,c={}){if(i=jo.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(c=Object.assign(l,c),c.recurse_count>8)throw new b.ErrnoError(32);for(var m=i.split("/").filter(Pe=>!!Pe),w=b.root,R="/",A=0;A<m.length;A++){var x=A===m.length-1;if(x&&c.parent)break;if(w=b.lookupNode(w,m[A]),R=ht.join2(R,m[A]),b.isMountpoint(w)&&(!x||x&&c.follow_mount)&&(w=w.mounted.root),!x||c.follow)for(var H=0;b.isLink(w.mode);){var te=b.readlink(R);R=jo.resolve(ht.dirname(R),te);var Ie=b.lookupPath(R,{recurse_count:c.recurse_count+1});if(w=Ie.node,H++>40)throw new b.ErrnoError(32)}}return{path:R,node:w}},getPath(i){for(var c;;){if(b.isRoot(i)){var l=i.mount.mountpoint;return c?l[l.length-1]!=="/"?`${l}/${c}`:l+c:l}c=c?`${i.name}/${c}`:i.name,i=i.parent}},hashName(i,c){for(var l=0,m=0;m<c.length;m++)l=(l<<5)-l+c.charCodeAt(m)|0;return(i+l>>>0)%b.nameTable.length},hashAddNode(i){var c=b.hashName(i.parent.id,i.name);i.name_next=b.nameTable[c],b.nameTable[c]=i},hashRemoveNode(i){var c=b.hashName(i.parent.id,i.name);if(b.nameTable[c]===i)b.nameTable[c]=i.name_next;else for(var l=b.nameTable[c];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,c){var l=b.mayLookup(i);if(l)throw new b.ErrnoError(l);for(var m=b.hashName(i.id,c),w=b.nameTable[m];w;w=w.name_next){var R=w.name;if(w.parent.id===i.id&&R===c)return w}return b.lookup(i,c)},createNode(i,c,l,m){var w=new b.FSNode(i,c,l,m);return b.hashAddNode(w),w},destroyNode(i){b.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var c=["r","w","rw"][i&3];return i&512&&(c+="w"),c},nodePermissions(i,c){return b.ignorePermissions?0:c.includes("r")&&!(i.mode&292)||c.includes("w")&&!(i.mode&146)||c.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){if(!b.isDir(i.mode))return 54;var c=b.nodePermissions(i,"x");return c||(i.node_ops.lookup?0:2)},mayCreate(i,c){var l;try{return l=b.lookupNode(i,c),20}catch{}return b.nodePermissions(i,"wx")},mayDelete(i,c,l){var m;try{m=b.lookupNode(i,c)}catch(R){return R.errno}var w=b.nodePermissions(i,"wx");if(w)return w;if(l){if(!b.isDir(m.mode))return 54;if(b.isRoot(m)||b.getPath(m)===b.cwd())return 10}else if(b.isDir(m.mode))return 31;return 0},mayOpen(i,c){return i?b.isLink(i.mode)?32:b.isDir(i.mode)&&(b.flagsToPermissionString(c)!=="r"||c&512)?31:b.nodePermissions(i,b.flagsToPermissionString(c)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=b.MAX_OPEN_FDS;i++)if(!b.streams[i])return i;throw new b.ErrnoError(33)},getStreamChecked(i){var c=b.getStream(i);if(!c)throw new b.ErrnoError(8);return c},getStream:i=>b.streams[i],createStream(i,c=-1){return i=Object.assign(new b.FSStream,i),c==-1&&(c=b.nextfd()),i.fd=c,b.streams[c]=i,i},closeStream(i){b.streams[i]=null},dupStream(i,c=-1){var m,w;var l=b.createStream(i,c);return(w=(m=l.stream_ops)==null?void 0:m.dup)==null||w.call(m,l),l},chrdev_stream_ops:{open(i){var l,m;var c=b.getDevice(i.node.rdev);i.stream_ops=c.stream_ops,(m=(l=i.stream_ops).open)==null||m.call(l,i)},llseek(){throw new b.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,c)=>i<<8|c,registerDevice(i,c){b.devices[i]={stream_ops:c}},getDevice:i=>b.devices[i],getMounts(i){for(var c=[],l=[i];l.length;){var m=l.pop();c.push(m),l.push(...m.mounts)}return c},syncfs(i,c){typeof i=="function"&&(c=i,i=!1),b.syncFSRequests++,b.syncFSRequests>1&&S(`warning: ${b.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=b.getMounts(b.root.mount),m=0;function w(A){return b.syncFSRequests--,c(A)}function R(A){if(A)return R.errored?void 0:(R.errored=!0,w(A));++m>=l.length&&w(null)}l.forEach(A=>{if(!A.type.syncfs)return R(null);A.type.syncfs(A,i,R)})},mount(i,c,l){var m=l==="/",w=!l,R;if(m&&b.root)throw new b.ErrnoError(10);if(!m&&!w){var A=b.lookupPath(l,{follow_mount:!1});if(l=A.path,R=A.node,b.isMountpoint(R))throw new b.ErrnoError(10);if(!b.isDir(R.mode))throw new b.ErrnoError(54)}var x={type:i,opts:c,mountpoint:l,mounts:[]},H=i.mount(x);return H.mount=x,x.root=H,m?b.root=H:R&&(R.mounted=x,R.mount&&R.mount.mounts.push(x)),H},unmount(i){var c=b.lookupPath(i,{follow_mount:!1});if(!b.isMountpoint(c.node))throw new b.ErrnoError(28);var l=c.node,m=l.mounted,w=b.getMounts(m);Object.keys(b.nameTable).forEach(A=>{for(var x=b.nameTable[A];x;){var H=x.name_next;w.includes(x.mount)&&b.destroyNode(x),x=H}}),l.mounted=null;var R=l.mount.mounts.indexOf(m);l.mount.mounts.splice(R,1)},lookup(i,c){return i.node_ops.lookup(i,c)},mknod(i,c,l){var m=b.lookupPath(i,{parent:!0}),w=m.node,R=ht.basename(i);if(!R||R==="."||R==="..")throw new b.ErrnoError(28);var A=b.mayCreate(w,R);if(A)throw new b.ErrnoError(A);if(!w.node_ops.mknod)throw new b.ErrnoError(63);return w.node_ops.mknod(w,R,c,l)},statfs(i){var c={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:b.nextInode,ffree:b.nextInode-1,fsid:42,flags:2,namelen:255},l=b.lookupPath(i,{follow:!0}).node;return l!=null&&l.node_ops.statfs&&Object.assign(c,l.node_ops.statfs(l.mount.opts.root)),c},create(i,c=438){return c&=4095,c|=32768,b.mknod(i,c,0)},mkdir(i,c=511){return c&=1023,c|=16384,b.mknod(i,c,0)},mkdirTree(i,c){for(var l=i.split("/"),m="",w=0;w<l.length;++w)if(l[w]){m+="/"+l[w];try{b.mkdir(m,c)}catch(R){if(R.errno!=20)throw R}}},mkdev(i,c,l){return typeof l>"u"&&(l=c,c=438),c|=8192,b.mknod(i,c,l)},symlink(i,c){if(!jo.resolve(i))throw new b.ErrnoError(44);var l=b.lookupPath(c,{parent:!0}),m=l.node;if(!m)throw new b.ErrnoError(44);var w=ht.basename(c),R=b.mayCreate(m,w);if(R)throw new b.ErrnoError(R);if(!m.node_ops.symlink)throw new b.ErrnoError(63);return m.node_ops.symlink(m,w,i)},rename(i,c){var l=ht.dirname(i),m=ht.dirname(c),w=ht.basename(i),R=ht.basename(c),A,x,H;if(A=b.lookupPath(i,{parent:!0}),x=A.node,A=b.lookupPath(c,{parent:!0}),H=A.node,!x||!H)throw new b.ErrnoError(44);if(x.mount!==H.mount)throw new b.ErrnoError(75);var te=b.lookupNode(x,w),Ie=jo.relative(i,m);if(Ie.charAt(0)!==".")throw new b.ErrnoError(28);if(Ie=jo.relative(c,l),Ie.charAt(0)!==".")throw new b.ErrnoError(55);var Pe;try{Pe=b.lookupNode(H,R)}catch{}if(te!==Pe){var Xe=b.isDir(te.mode),ue=b.mayDelete(x,w,Xe);if(ue)throw new b.ErrnoError(ue);if(ue=Pe?b.mayDelete(H,R,Xe):b.mayCreate(H,R),ue)throw new b.ErrnoError(ue);if(!x.node_ops.rename)throw new b.ErrnoError(63);if(b.isMountpoint(te)||Pe&&b.isMountpoint(Pe))throw new b.ErrnoError(10);if(H!==x&&(ue=b.nodePermissions(x,"w"),ue))throw new b.ErrnoError(ue);b.hashRemoveNode(te);try{x.node_ops.rename(te,H,R),te.parent=H}catch(de){throw de}finally{b.hashAddNode(te)}}},rmdir(i){var c=b.lookupPath(i,{parent:!0}),l=c.node,m=ht.basename(i),w=b.lookupNode(l,m),R=b.mayDelete(l,m,!0);if(R)throw new b.ErrnoError(R);if(!l.node_ops.rmdir)throw new b.ErrnoError(63);if(b.isMountpoint(w))throw new b.ErrnoError(10);l.node_ops.rmdir(l,m),b.destroyNode(w)},readdir(i){var c=b.lookupPath(i,{follow:!0}),l=c.node;if(!l.node_ops.readdir)throw new b.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var c=b.lookupPath(i,{parent:!0}),l=c.node;if(!l)throw new b.ErrnoError(44);var m=ht.basename(i),w=b.lookupNode(l,m),R=b.mayDelete(l,m,!1);if(R)throw new b.ErrnoError(R);if(!l.node_ops.unlink)throw new b.ErrnoError(63);if(b.isMountpoint(w))throw new b.ErrnoError(10);l.node_ops.unlink(l,m),b.destroyNode(w)},readlink(i){var c=b.lookupPath(i),l=c.node;if(!l)throw new b.ErrnoError(44);if(!l.node_ops.readlink)throw new b.ErrnoError(28);return l.node_ops.readlink(l)},stat(i,c){var l=b.lookupPath(i,{follow:!c}),m=l.node;if(!m)throw new b.ErrnoError(44);if(!m.node_ops.getattr)throw new b.ErrnoError(63);return m.node_ops.getattr(m)},lstat(i){return b.stat(i,!0)},chmod(i,c,l){var m;if(typeof i=="string"){var w=b.lookupPath(i,{follow:!l});m=w.node}else m=i;if(!m.node_ops.setattr)throw new b.ErrnoError(63);m.node_ops.setattr(m,{mode:c&4095|m.mode&-4096,timestamp:Date.now()})},lchmod(i,c){b.chmod(i,c,!0)},fchmod(i,c){var l=b.getStreamChecked(i);b.chmod(l.node,c)},chown(i,c,l,m){var w;if(typeof i=="string"){var R=b.lookupPath(i,{follow:!m});w=R.node}else w=i;if(!w.node_ops.setattr)throw new b.ErrnoError(63);w.node_ops.setattr(w,{timestamp:Date.now()})},lchown(i,c,l){b.chown(i,c,l,!0)},fchown(i,c,l){var m=b.getStreamChecked(i);b.chown(m.node,c,l)},truncate(i,c){if(c<0)throw new b.ErrnoError(28);var l;if(typeof i=="string"){var m=b.lookupPath(i,{follow:!0});l=m.node}else l=i;if(!l.node_ops.setattr)throw new b.ErrnoError(63);if(b.isDir(l.mode))throw new b.ErrnoError(31);if(!b.isFile(l.mode))throw new b.ErrnoError(28);var w=b.nodePermissions(l,"w");if(w)throw new b.ErrnoError(w);l.node_ops.setattr(l,{size:c,timestamp:Date.now()})},ftruncate(i,c){var l=b.getStreamChecked(i);if((l.flags&2097155)===0)throw new b.ErrnoError(28);b.truncate(l.node,c)},utime(i,c,l){var m=b.lookupPath(i,{follow:!0}),w=m.node;w.node_ops.setattr(w,{timestamp:Math.max(c,l)})},open(i,c,l=438){if(i==="")throw new b.ErrnoError(44);c=typeof c=="string"?A3(c):c,c&64?l=l&4095|32768:l=0;var m;if(typeof i=="object")m=i;else{i=ht.normalize(i);try{var w=b.lookupPath(i,{follow:!(c&131072)});m=w.node}catch{}}var R=!1;if(c&64)if(m){if(c&128)throw new b.ErrnoError(20)}else m=b.mknod(i,l,0),R=!0;if(!m)throw new b.ErrnoError(44);if(b.isChrdev(m.mode)&&(c&=-513),c&65536&&!b.isDir(m.mode))throw new b.ErrnoError(54);if(!R){var A=b.mayOpen(m,c);if(A)throw new b.ErrnoError(A)}c&512&&!R&&b.truncate(m,0),c&=-131713;var x=b.createStream({node:m,path:b.getPath(m),flags:c,seekable:!0,position:0,stream_ops:m.stream_ops,ungotten:[],error:!1});return x.stream_ops.open&&x.stream_ops.open(x),r.logReadFiles&&!(c&1)&&(i in b.readFiles||(b.readFiles[i]=1)),x},close(i){if(b.isClosed(i))throw new b.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(c){throw c}finally{b.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new b.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new b.ErrnoError(28);return i.position=i.stream_ops.llseek(i,c,l),i.ungotten=[],i.position},read(i,c,l,m,w){if(m<0||w<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===1)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.read)throw new b.ErrnoError(28);var R=typeof w<"u";if(!R)w=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var A=i.stream_ops.read(i,c,l,m,w);return R||(i.position+=A),A},write(i,c,l,m,w,R){if(m<0||w<0)throw new b.ErrnoError(28);if(b.isClosed(i))throw new b.ErrnoError(8);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(b.isDir(i.node.mode))throw new b.ErrnoError(31);if(!i.stream_ops.write)throw new b.ErrnoError(28);i.seekable&&i.flags&1024&&b.llseek(i,0,2);var A=typeof w<"u";if(!A)w=i.position;else if(!i.seekable)throw new b.ErrnoError(70);var x=i.stream_ops.write(i,c,l,m,w,R);return A||(i.position+=x),x},allocate(i,c,l){if(b.isClosed(i))throw new b.ErrnoError(8);if(c<0||l<=0)throw new b.ErrnoError(28);if((i.flags&2097155)===0)throw new b.ErrnoError(8);if(!b.isFile(i.node.mode)&&!b.isDir(i.node.mode))throw new b.ErrnoError(43);if(!i.stream_ops.allocate)throw new b.ErrnoError(138);i.stream_ops.allocate(i,c,l)},mmap(i,c,l,m,w){if((m&2)!==0&&(w&2)===0&&(i.flags&2097155)!==2)throw new b.ErrnoError(2);if((i.flags&2097155)===1)throw new b.ErrnoError(2);if(!i.stream_ops.mmap)throw new b.ErrnoError(43);if(!c)throw new b.ErrnoError(28);return i.stream_ops.mmap(i,c,l,m,w)},msync(i,c,l,m,w){return i.stream_ops.msync?i.stream_ops.msync(i,c,l,m,w):0},ioctl(i,c,l){if(!i.stream_ops.ioctl)throw new b.ErrnoError(59);return i.stream_ops.ioctl(i,c,l)},readFile(i,c={}){if(c.flags=c.flags||0,c.encoding=c.encoding||"binary",c.encoding!=="utf8"&&c.encoding!=="binary")throw new Error(`Invalid encoding type "${c.encoding}"`);var l,m=b.open(i,c.flags),w=b.stat(i),R=w.size,A=new Uint8Array(R);return b.read(m,A,0,R,0),c.encoding==="utf8"?l=Ha(A):c.encoding==="binary"&&(l=A),b.close(m),l},writeFile(i,c,l={}){l.flags=l.flags||577;var m=b.open(i,l.flags,l.mode);if(typeof c=="string"){var w=new Uint8Array(Va(c)+1),R=L_(c,w,0,w.length);b.write(m,w,0,R,void 0,l.canOwn)}else if(ArrayBuffer.isView(c))b.write(m,c,0,c.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");b.close(m)},cwd:()=>b.currentPath,chdir(i){var c=b.lookupPath(i,{follow:!0});if(c.node===null)throw new b.ErrnoError(44);if(!b.isDir(c.node.mode))throw new b.ErrnoError(54);var l=b.nodePermissions(c.node,"x");if(l)throw new b.ErrnoError(l);b.currentPath=c.path},createDefaultDirectories(){b.mkdir("/tmp"),b.mkdir("/home"),b.mkdir("/home/web_user")},createDefaultDevices(){b.mkdir("/dev"),b.registerDevice(b.makedev(1,3),{read:()=>0,write:(m,w,R,A,x)=>A,llseek:()=>0}),b.mkdev("/dev/null",b.makedev(1,3)),ki.register(b.makedev(5,0),ki.default_tty_ops),ki.register(b.makedev(6,0),ki.default_tty1_ops),b.mkdev("/dev/tty",b.makedev(5,0)),b.mkdev("/dev/tty1",b.makedev(6,0));var i=new Uint8Array(1024),c=0,l=()=>(c===0&&(c=I0(i).byteLength),i[--c]);b.createDevice("/dev","random",l),b.createDevice("/dev","urandom",l),b.mkdir("/dev/shm"),b.mkdir("/dev/shm/tmp")},createSpecialDirectories(){b.mkdir("/proc");var i=b.mkdir("/proc/self");b.mkdir("/proc/self/fd"),b.mount({mount(){var c=b.createNode(i,"fd",16895,73);return c.node_ops={lookup(l,m){var w=+m,R=b.getStreamChecked(w),A={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>R.path}};return A.parent=A,A}},c}},{},"/proc/self/fd")},createStandardStreams(i,c,l){i?b.createDevice("/dev","stdin",i):b.symlink("/dev/tty","/dev/stdin"),c?b.createDevice("/dev","stdout",null,c):b.symlink("/dev/tty","/dev/stdout"),l?b.createDevice("/dev","stderr",null,l):b.symlink("/dev/tty1","/dev/stderr"),b.open("/dev/stdin",0),b.open("/dev/stdout",1),b.open("/dev/stderr",1)},staticInit(){b.nameTable=new Array(4096),b.mount($e,{},"/"),b.createDefaultDirectories(),b.createDefaultDevices(),b.createSpecialDirectories(),b.filesystems={MEMFS:$e}},init(i,c,l){b.initialized=!0,i??(i=r.stdin),c??(c=r.stdout),l??(l=r.stderr),b.createStandardStreams(i,c,l)},quit(){b.initialized=!1;for(var i=0;i<b.streams.length;i++){var c=b.streams[i];c&&b.close(c)}},findObject(i,c){var l=b.analyzePath(i,c);return l.exists?l.object:null},analyzePath(i,c){try{var l=b.lookupPath(i,{follow:!c});i=l.path}catch{}var m={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=b.lookupPath(i,{parent:!0});m.parentExists=!0,m.parentPath=l.path,m.parentObject=l.node,m.name=ht.basename(i),l=b.lookupPath(i,{follow:!c}),m.exists=!0,m.path=l.path,m.object=l.node,m.name=l.node.name,m.isRoot=l.path==="/"}catch(w){m.error=w.errno}return m},createPath(i,c,l,m){i=typeof i=="string"?i:b.getPath(i);for(var w=c.split("/").reverse();w.length;){var R=w.pop();if(R){var A=ht.join2(i,R);try{b.mkdir(A)}catch{}i=A}}return A},createFile(i,c,l,m,w){var R=ht.join2(typeof i=="string"?i:b.getPath(i),c),A=U_(m,w);return b.create(R,A)},createDataFile(i,c,l,m,w,R){var A=c;i&&(i=typeof i=="string"?i:b.getPath(i),A=c?ht.join2(i,c):i);var x=U_(m,w),H=b.create(A,x);if(l){if(typeof l=="string"){for(var te=new Array(l.length),Ie=0,Pe=l.length;Ie<Pe;++Ie)te[Ie]=l.charCodeAt(Ie);l=te}b.chmod(H,x|146);var Xe=b.open(H,577);b.write(Xe,l,0,l.length,0,R),b.close(Xe),b.chmod(H,x)}},createDevice(i,c,l,m){var x;var w=ht.join2(typeof i=="string"?i:b.getPath(i),c),R=U_(!!l,!!m);(x=b.createDevice).major??(x.major=64);var A=b.makedev(b.createDevice.major++,0);return b.registerDevice(A,{open(H){H.seekable=!1},close(H){var te;(te=m==null?void 0:m.buffer)!=null&&te.length&&m(10)},read(H,te,Ie,Pe,Xe){for(var ue=0,de=0;de<Pe;de++){var mt;try{mt=l()}catch{throw new b.ErrnoError(29)}if(mt===void 0&&ue===0)throw new b.ErrnoError(6);if(mt==null)break;ue++,te[Ie+de]=mt}return ue&&(H.node.timestamp=Date.now()),ue},write(H,te,Ie,Pe,Xe){for(var ue=0;ue<Pe;ue++)try{m(te[Ie+ue])}catch{throw new b.ErrnoError(29)}return Pe&&(H.node.timestamp=Date.now()),ue}}),b.mkdev(w,R,A)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{i.contents=L(i.url),i.usedBytes=i.contents.length}catch{throw new b.ErrnoError(29)}},createLazyFile(i,c,l,m,w){class R{constructor(){d(this,"lengthKnown",!1);d(this,"chunks",[])}get(ue){if(!(ue>this.length-1||ue<0)){var de=ue%this.chunkSize,mt=ue/this.chunkSize|0;return this.getter(mt)[de]}}setDataGetter(ue){this.getter=ue}cacheLength(){var ue=new XMLHttpRequest;if(ue.open("HEAD",l,!1),ue.send(null),!(ue.status>=200&&ue.status<300||ue.status===304))throw new Error("Couldn't load "+l+". Status: "+ue.status);var de=Number(ue.getResponseHeader("Content-length")),mt,Kn=(mt=ue.getResponseHeader("Accept-Ranges"))&&mt==="bytes",ir=(mt=ue.getResponseHeader("Content-Encoding"))&&mt==="gzip",Br=1024*1024;Kn||(Br=de);var Hr=(us,Ja)=>{if(us>Ja)throw new Error("invalid range ("+us+", "+Ja+") or no bytes requested!");if(Ja>de-1)throw new Error("only "+de+" bytes available! programmer error!");var vn=new XMLHttpRequest;if(vn.open("GET",l,!1),de!==Br&&vn.setRequestHeader("Range","bytes="+us+"-"+Ja),vn.responseType="arraybuffer",vn.overrideMimeType&&vn.overrideMimeType("text/plain; charset=x-user-defined"),vn.send(null),!(vn.status>=200&&vn.status<300||vn.status===304))throw new Error("Couldn't load "+l+". Status: "+vn.status);return vn.response!==void 0?new Uint8Array(vn.response||[]):j_(vn.responseText||"",!0)},el=this;el.setDataGetter(us=>{var Ja=us*Br,vn=(us+1)*Br-1;if(vn=Math.min(vn,de-1),typeof el.chunks[us]>"u"&&(el.chunks[us]=Hr(Ja,vn)),typeof el.chunks[us]>"u")throw new Error("doXHR failed!");return el.chunks[us]}),(ir||!de)&&(Br=de=1,de=this.getter(0).length,Br=de,E("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=de,this._chunkSize=Br,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(typeof XMLHttpRequest<"u"){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var A=new R,x={isDevice:!1,contents:A}}else var x={isDevice:!1,url:l};var H=b.createFile(i,c,x,m,w);x.contents?H.contents=x.contents:x.url&&(H.contents=null,H.url=x.url),Object.defineProperties(H,{usedBytes:{get:function(){return this.contents.length}}});var te={},Ie=Object.keys(H.stream_ops);Ie.forEach(Xe=>{var ue=H.stream_ops[Xe];te[Xe]=(...de)=>(b.forceLoadFile(H),ue(...de))});function Pe(Xe,ue,de,mt,Kn){var ir=Xe.node.contents;if(Kn>=ir.length)return 0;var Br=Math.min(ir.length-Kn,mt);if(ir.slice)for(var Hr=0;Hr<Br;Hr++)ue[de+Hr]=ir[Kn+Hr];else for(var Hr=0;Hr<Br;Hr++)ue[de+Hr]=ir.get(Kn+Hr);return Br}return te.read=(Xe,ue,de,mt,Kn)=>(b.forceLoadFile(H),Pe(Xe,ue,de,mt,Kn)),te.mmap=(Xe,ue,de,mt,Kn)=>{b.forceLoadFile(H);var ir=O0(ue);if(!ir)throw new b.ErrnoError(48);return Pe(Xe,P,ir,ue,de),{ptr:ir,allocated:!0}},H.stream_ops=te,H}},Le={DEFAULT_POLLMASK:5,calculateAt(i,c,l){if(ht.isAbs(c))return c;var m;if(i===-100)m=b.cwd();else{var w=Le.getStreamFromFD(i);m=w.path}if(c.length==0){if(!l)throw new b.ErrnoError(44);return m}return ht.join2(m,c)},doStat(i,c,l){var m=i(c);F[l>>2]=m.dev,F[l+4>>2]=m.mode,j[l+8>>2]=m.nlink,F[l+12>>2]=m.uid,F[l+16>>2]=m.gid,F[l+20>>2]=m.rdev,At=[m.size>>>0,(ve=m.size,+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[l+24>>2]=At[0],F[l+28>>2]=At[1],F[l+32>>2]=4096,F[l+36>>2]=m.blocks;var w=m.atime.getTime(),R=m.mtime.getTime(),A=m.ctime.getTime();return At=[Math.floor(w/1e3)>>>0,(ve=Math.floor(w/1e3),+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[l+40>>2]=At[0],F[l+44>>2]=At[1],j[l+48>>2]=w%1e3*1e3*1e3,At=[Math.floor(R/1e3)>>>0,(ve=Math.floor(R/1e3),+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[l+56>>2]=At[0],F[l+60>>2]=At[1],j[l+64>>2]=R%1e3*1e3*1e3,At=[Math.floor(A/1e3)>>>0,(ve=Math.floor(A/1e3),+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[l+72>>2]=At[0],F[l+76>>2]=At[1],j[l+80>>2]=A%1e3*1e3*1e3,At=[m.ino>>>0,(ve=m.ino,+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[l+88>>2]=At[0],F[l+92>>2]=At[1],0},doMsync(i,c,l,m,w){if(!b.isFile(c.node.mode))throw new b.ErrnoError(43);if(m&2)return 0;var R=N.slice(i,i+l);b.msync(c,R,w,l,m)},getStreamFromFD(i){var c=b.getStreamChecked(i);return c},varargs:void 0,getStr(i){var c=Ei(i);return c}};function P3(i,c){try{return i=Le.getStr(i),b.chmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function F3(i,c,l,m){try{if(c=Le.getStr(c),c=Le.calculateAt(i,c),l&-8)return-28;var w=b.lookupPath(c,{follow:!0}),R=w.node;if(!R)return-44;var A="";return l&4&&(A+="r"),l&2&&(A+="w"),l&1&&(A+="x"),A&&b.nodePermissions(R,A)?-2:0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function x3(i,c){try{return b.fchmod(i,c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function N3(i,c,l){try{return b.fchown(i,c,l),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Kd=()=>{var i=F[+Le.varargs>>2];return Le.varargs+=4,i},D3=Kd;function M3(i,c,l){Le.varargs=l;try{var m=Le.getStreamFromFD(i);switch(c){case 0:{var w=Kd();if(w<0)return-28;for(;b.streams[w];)w++;var R;return R=b.dupStream(m,w),R.fd}case 1:case 2:return 0;case 3:return m.flags;case 4:{var w=Kd();return m.flags|=w,0}case 12:{var w=D3(),A=0;return M[w+A>>1]=2,0}case 13:case 14:return 0}return-28}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function L3(i,c){try{var l=Le.getStreamFromFD(i);return Le.doStat(b.stat,l.path,c)}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var Xu=(i,c)=>c+2097152>>>0<4194305-!!i?(i>>>0)+c*4294967296:NaN;function j3(i,c,l){var m=Xu(c,l);try{return isNaN(m)?61:(b.ftruncate(i,m),0)}catch(w){if(typeof b>"u"||w.name!=="ErrnoError")throw w;return-w.errno}}var Uo=(i,c,l)=>L_(i,N,c,l);function U3(i,c){try{if(c===0)return-28;var l=b.cwd(),m=Va(l)+1;return c<m?-68:(Uo(l,i,c),m)}catch(w){if(typeof b>"u"||w.name!=="ErrnoError")throw w;return-w.errno}}function z3(i,c){try{return i=Le.getStr(i),Le.doStat(b.lstat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function B3(i,c,l){try{return c=Le.getStr(c),c=Le.calculateAt(i,c),c=ht.normalize(c),c[c.length-1]==="/"&&(c=c.substr(0,c.length-1)),b.mkdir(c,l,0),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}function H3(i,c,l,m){try{c=Le.getStr(c);var w=m&256,R=m&4096;return m=m&-6401,c=Le.calculateAt(i,c,R),Le.doStat(w?b.lstat:b.stat,c,l)}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return-A.errno}}function V3(i,c,l,m){Le.varargs=m;try{c=Le.getStr(c),c=Le.calculateAt(i,c);var w=m?Kd():0;return b.open(c,l,w).fd}catch(R){if(typeof b>"u"||R.name!=="ErrnoError")throw R;return-R.errno}}function W3(i,c,l,m){try{if(c=Le.getStr(c),c=Le.calculateAt(i,c),m<=0)return-28;var w=b.readlink(c),R=Math.min(m,Va(w)),A=P[l+R];return Uo(w,l,m+1),P[l+R]=A,R}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return-x.errno}}function K3(i){try{return i=Le.getStr(i),b.rmdir(i),0}catch(c){if(typeof b>"u"||c.name!=="ErrnoError")throw c;return-c.errno}}function J3(i,c){try{return i=Le.getStr(i),Le.doStat(b.stat,i,c)}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return-l.errno}}function G3(i,c,l){try{return c=Le.getStr(c),c=Le.calculateAt(i,c),l===0?b.unlink(c):l===512?b.rmdir(c):cs("Invalid flags passed to unlinkat"),0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return-m.errno}}var q0=i=>j[i>>2]+F[i+4>>2]*4294967296;function Q3(i,c,l,m){try{c=Le.getStr(c),c=Le.calculateAt(i,c,!0);var w=Date.now(),R,A;if(!l)R=w,A=w;else{var x=q0(l),H=F[l+8>>2];H==1073741823?R=w:H==1073741822?R=-1:R=x*1e3+H/(1e3*1e3),l+=16,x=q0(l),H=F[l+8>>2],H==1073741823?A=w:H==1073741822?A=-1:A=x*1e3+H/(1e3*1e3)}return(A!=-1||R!=-1)&&b.utime(c,R,A),0}catch(te){if(typeof b>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}var Y3=i=>i%4===0&&(i%100!==0||i%400===0),X3=[0,31,60,91,121,152,182,213,244,274,305,335],Z3=[0,31,59,90,120,151,181,212,243,273,304,334],eD=i=>{var c=Y3(i.getFullYear()),l=c?X3:Z3,m=l[i.getMonth()]+i.getDate()-1;return m};function tD(i,c,l){var m=Xu(i,c),w=new Date(m*1e3);F[l>>2]=w.getSeconds(),F[l+4>>2]=w.getMinutes(),F[l+8>>2]=w.getHours(),F[l+12>>2]=w.getDate(),F[l+16>>2]=w.getMonth(),F[l+20>>2]=w.getFullYear()-1900,F[l+24>>2]=w.getDay();var R=eD(w)|0;F[l+28>>2]=R,F[l+36>>2]=-(w.getTimezoneOffset()*60);var A=new Date(w.getFullYear(),0,1),x=new Date(w.getFullYear(),6,1).getTimezoneOffset(),H=A.getTimezoneOffset(),te=(x!=H&&w.getTimezoneOffset()==Math.min(H,x))|0;F[l+32>>2]=te}function nD(i,c,l,m,w,R,A,x){var H=Xu(w,R);try{if(isNaN(H))return 61;var te=Le.getStreamFromFD(m),Ie=b.mmap(te,i,H,c,l),Pe=Ie.ptr;return F[A>>2]=Ie.allocated,j[x>>2]=Pe,0}catch(Xe){if(typeof b>"u"||Xe.name!=="ErrnoError")throw Xe;return-Xe.errno}}function rD(i,c,l,m,w,R,A){var x=Xu(R,A);try{var H=Le.getStreamFromFD(w);l&2&&Le.doMsync(i,H,c,m,x)}catch(te){if(typeof b>"u"||te.name!=="ErrnoError")throw te;return-te.errno}}var sD=(i,c,l,m)=>{var w=new Date().getFullYear(),R=new Date(w,0,1),A=new Date(w,6,1),x=R.getTimezoneOffset(),H=A.getTimezoneOffset(),te=Math.max(x,H);j[i>>2]=te*60,F[c>>2]=+(x!=H);var Ie=ue=>{var de=ue>=0?"-":"+",mt=Math.abs(ue),Kn=String(Math.floor(mt/60)).padStart(2,"0"),ir=String(mt%60).padStart(2,"0");return`UTC${de}${Kn}${ir}`},Pe=Ie(x),Xe=Ie(H);H<x?(Uo(Pe,l,17),Uo(Xe,m,17)):(Uo(Pe,m,17),Uo(Xe,l,17))},oD=()=>Date.now(),iD=()=>performance.now(),aD=()=>2147483648,cD=i=>{var c=C.buffer,l=(i-c.byteLength+65535)/65536|0;try{return C.grow(l),G(),1}catch{}},uD=i=>{var c=N.length;i>>>=0;var l=aD();if(i>l)return!1;for(var m=1;m<=4;m*=2){var w=c*(1+.2/m);w=Math.min(w,i+100663296);var R=Math.min(l,R0(Math.max(i,w),65536)),A=cD(R);if(A)return!0}return!1},z_={},lD=()=>p||"./this.program",Zu=()=>{if(!Zu.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",c={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:lD()};for(var l in z_)z_[l]===void 0?delete c[l]:c[l]=z_[l];var m=[];for(var l in c)m.push(`${l}=${c[l]}`);Zu.strings=m}return Zu.strings},fD=(i,c)=>{for(var l=0;l<i.length;++l)P[c++]=i.charCodeAt(l);P[c]=0},dD=(i,c)=>{var l=0;return Zu().forEach((m,w)=>{var R=c+l;j[i+w*4>>2]=R,fD(m,R),l+=m.length+1}),0},hD=(i,c)=>{var l=Zu();j[i>>2]=l.length;var m=0;return l.forEach(w=>m+=w.length+1),j[c>>2]=m,0};function mD(i){try{var c=Le.getStreamFromFD(i);return b.close(c),0}catch(l){if(typeof b>"u"||l.name!=="ErrnoError")throw l;return l.errno}}function pD(i,c){try{var l=0,m=0,w=0,R=Le.getStreamFromFD(i),A=R.tty?2:b.isDir(R.mode)?3:b.isLink(R.mode)?7:4;return P[c]=A,M[c+2>>1]=w,At=[l>>>0,(ve=l,+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[c+8>>2]=At[0],F[c+12>>2]=At[1],At=[m>>>0,(ve=m,+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[c+16>>2]=At[0],F[c+20>>2]=At[1],0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return x.errno}}var gD=(i,c,l,m)=>{for(var w=0,R=0;R<l;R++){var A=j[c>>2],x=j[c+4>>2];c+=8;var H=b.read(i,P,A,x,m);if(H<0)return-1;if(w+=H,H<x)break}return w};function _D(i,c,l,m){try{var w=Le.getStreamFromFD(i),R=gD(w,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}function yD(i,c,l,m,w){var R=Xu(c,l);try{if(isNaN(R))return 61;var A=Le.getStreamFromFD(i);return b.llseek(A,R,m),At=[A.position>>>0,(ve=A.position,+Math.abs(ve)>=1?ve>0?+Math.floor(ve/4294967296)>>>0:~~+Math.ceil((ve-+(~~ve>>>0))/4294967296)>>>0:0)],F[w>>2]=At[0],F[w+4>>2]=At[1],A.getdents&&R===0&&m===0&&(A.getdents=null),0}catch(x){if(typeof b>"u"||x.name!=="ErrnoError")throw x;return x.errno}}function bD(i){var l;try{var c=Le.getStreamFromFD(i);return(l=c.stream_ops)!=null&&l.fsync?c.stream_ops.fsync(c):0}catch(m){if(typeof b>"u"||m.name!=="ErrnoError")throw m;return m.errno}}var SD=(i,c,l,m)=>{for(var w=0,R=0;R<l;R++){var A=j[c>>2],x=j[c+4>>2];c+=8;var H=b.write(i,P,A,x,m);if(H<0)return-1;if(w+=H,H<x)break}return w};function wD(i,c,l,m){try{var w=Le.getStreamFromFD(i),R=SD(w,c,l);return j[m>>2]=R,0}catch(A){if(typeof b>"u"||A.name!=="ErrnoError")throw A;return A.errno}}var Je=function(){const i=typeof Asyncify=="object"?Asyncify.handleAsync.bind(Asyncify):null;r.handleAsync=i;const c=new Map;r.setCallback=(l,m)=>c.set(l,m),r.getCallback=l=>c.get(l),r.deleteCallback=l=>c.delete(l),Je=function(l,m,...w){const R=c.get(m);let A=null;const x=typeof R=="function"?R:R[A=Ei(w.shift())];if(l){if(i)return i(()=>x.apply(R,w));throw new Error("Synchronous WebAssembly cannot call async function")}const H=x.apply(R,w);if(typeof(H==null?void 0:H.then)=="function")throw console.error("unexpected Promise",x),new Error(`${A} unexpectedly returned a Promise`);return H}};function vD(...i){return Je(!1,...i)}function ED(...i){return Je(!0,...i)}function kD(...i){return Je(!1,...i)}function $D(...i){return Je(!0,...i)}function CD(...i){return Je(!1,...i)}function TD(...i){return Je(!0,...i)}function ID(...i){return Je(!1,...i)}function RD(...i){return Je(!0,...i)}function OD(...i){return Je(!1,...i)}function qD(...i){return Je(!0,...i)}function AD(...i){return Je(!1,...i)}function PD(...i){return Je(!0,...i)}function FD(...i){return Je(!1,...i)}function xD(...i){return Je(!0,...i)}function ND(...i){return Je(!1,...i)}function DD(...i){return Je(!0,...i)}function MD(...i){return Je(!1,...i)}function LD(...i){return Je(!0,...i)}function jD(...i){return Je(!1,...i)}function UD(...i){return Je(!0,...i)}function zD(...i){return Je(!1,...i)}function BD(...i){return Je(!0,...i)}function HD(...i){return Je(!1,...i)}function VD(...i){return Je(!0,...i)}function WD(...i){return Je(!1,...i)}function KD(...i){return Je(!0,...i)}function JD(...i){return Je(!1,...i)}function GD(...i){return Je(!0,...i)}function QD(...i){return Je(!1,...i)}function YD(...i){return Je(!0,...i)}function XD(...i){return Je(!1,...i)}function ZD(...i){return Je(!0,...i)}var eM=i=>{q=i,g(i,new $0(i))},tM=(i,c)=>{q=i,eM(i)},nM=i=>{if(i instanceof $0||i=="unwind")return q;g(1,i)},A0=(i,c)=>{i<128?c.push(i):c.push(i%128|128,i>>7)},rM=i=>{for(var c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[c[i[0]]]},m=1;m<i.length;++m)l.parameters.push(c[i[m]]);return l},sM=(i,c)=>{var l=i.slice(0,1),m=i.slice(1),w={i:127,p:127,j:126,f:125,d:124,e:111};c.push(96),A0(m.length,c);for(var R=0;R<m.length;++R)c.push(w[m[R]]);l=="v"?c.push(0):c.push(1,w[l])},oM=(i,c)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(rM(c),i);var l=[1];sM(c,l);var m=[0,97,115,109,1,0,0,0,1];A0(l.length,m),m.push(...l),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var w=new WebAssembly.Module(new Uint8Array(m)),R=new WebAssembly.Instance(w,{e:{f:i}}),A=R.exports.f;return A},Wa,iM=i=>Wa.get(i),aM=(i,c)=>{if(Ka)for(var l=i;l<i+c;l++){var m=iM(l);m&&Ka.set(m,l)}},Ka,cM=i=>(Ka||(Ka=new WeakMap,aM(0,Wa.length)),Ka.get(i)||0),P0=[],uM=()=>{if(P0.length)return P0.pop();try{Wa.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return Wa.length-1},F0=(i,c)=>Wa.set(i,c),lM=(i,c)=>{var l=cM(i);if(l)return l;var m=uM();try{F0(m,i)}catch(R){if(!(R instanceof TypeError))throw R;var w=oM(i,c);F0(m,w)}return Ka.set(i,m),m},x0=i=>{var c=r["_"+i];return c},N0=(i,c)=>{P.set(i,c)},D0=i=>B0(i),fM=i=>{var c=Va(i)+1,l=D0(c);return Uo(i,l,c),l},zo=(i,c,l,m,w)=>{var R={string:de=>{var mt=0;return de!=null&&de!==0&&(mt=fM(de)),mt},array:de=>{var mt=D0(de.length);return N0(de,mt),mt}};function A(de){return c==="string"?Ei(de):c==="boolean"?!!de:de}var x=x0(i),H=[],te=0;if(m)for(var Ie=0;Ie<m.length;Ie++){var Pe=R[l[Ie]];Pe?(te===0&&(te=v3()),H[Ie]=Pe(m[Ie])):H[Ie]=m[Ie]}var Xe=x(...H);function ue(de){return te!==0&&w3(te),A(de)}return Xe=ue(Xe),Xe},dM=(i,c,l,m)=>{var w=!l||l.every(A=>A==="number"||A==="boolean"),R=c!=="string";return R&&w&&!m?x0(i):(...A)=>zo(i,c,l,A)},hM=i=>U0(),mM=(i,c,l)=>{if(l??(l=2147483647),l<2)return 0;l-=2;for(var m=c,w=l<i.length*2?l/2:i.length,R=0;R<w;++R){var A=i.charCodeAt(R);M[c>>1]=A,c+=2}return M[c>>1]=0,c-m},pM=(i,c,l)=>{if(l??(l=2147483647),l<4)return 0;for(var m=c,w=m+l-4,R=0;R<i.length;++R){var A=i.charCodeAt(R);if(A>=55296&&A<=57343){var x=i.charCodeAt(++R);A=65536+((A&1023)<<10)|x&1023}if(F[c>>2]=A,c+=4,c+4>w)break}return F[c>>2]=0,c-m},gM=i=>{for(var c="";;){var l=N[i++];if(!l)return c;c+=String.fromCharCode(l)}},M0=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,_M=(i,c)=>{for(var l=i,m=l>>1,w=m+c/2;!(m>=w)&&B[m];)++m;if(l=m<<1,l-i>32&&M0)return M0.decode(N.subarray(i,l));for(var R="",A=0;!(A>=c/2);++A){var x=M[i+A*2>>1];if(x==0)break;R+=String.fromCharCode(x)}return R},yM=(i,c)=>{for(var l=0,m="";!(l>=c/4);){var w=F[i+l*4>>2];if(w==0)break;if(++l,w>=65536){var R=w-65536;m+=String.fromCharCode(55296|R>>10,56320|R&1023)}else m+=String.fromCharCode(w)}return m};function bM(i){for(var c=[],l=0;l<i.length;l++){var m=i[l];m>255&&(m&=255),c.push(String.fromCharCode(m))}return c.join("")}b.createPreloadedFile=q3,b.staticInit(),$e.doesNotExistError=new b.ErrnoError(44),$e.doesNotExistError.stack="<generic error, no stack>",Je();var SM={a:E3,Y:P3,$:F3,Z:x3,X:N3,b:M3,W:L3,y:j3,Q:U3,U:z3,N:B3,S:H3,L:V3,J:W3,I:K3,V:J3,G:G3,F:Q3,w:tD,u:nD,v:rD,M:sD,n:oD,m:iD,D:uD,O:dD,P:hD,o:mD,E:pD,K:_D,x:yD,R:bD,H:wD,s:vD,t:ED,ga:kD,ka:$D,i:CD,j:TD,c:ID,d:RD,ca:OD,da:qD,ea:AD,fa:PD,g:FD,h:xD,z:ND,A:DD,e:MD,f:LD,aa:jD,ba:UD,B:zD,C:BD,p:HD,q:VD,ha:WD,ia:KD,ja:JD,r:GD,k:QD,l:YD,T:XD,_:ZD},I=S3();r._sqlite3_status64=(i,c,l,m)=>(r._sqlite3_status64=I.na)(i,c,l,m),r._sqlite3_status=(i,c,l,m)=>(r._sqlite3_status=I.oa)(i,c,l,m),r._sqlite3_db_status=(i,c,l,m,w)=>(r._sqlite3_db_status=I.pa)(i,c,l,m,w),r._sqlite3_msize=i=>(r._sqlite3_msize=I.qa)(i),r._sqlite3_vfs_find=i=>(r._sqlite3_vfs_find=I.ra)(i),r._sqlite3_vfs_register=(i,c)=>(r._sqlite3_vfs_register=I.sa)(i,c),r._sqlite3_vfs_unregister=i=>(r._sqlite3_vfs_unregister=I.ta)(i),r._sqlite3_release_memory=i=>(r._sqlite3_release_memory=I.ua)(i),r._sqlite3_soft_heap_limit64=(i,c)=>(r._sqlite3_soft_heap_limit64=I.va)(i,c),r._sqlite3_memory_used=()=>(r._sqlite3_memory_used=I.wa)(),r._sqlite3_hard_heap_limit64=(i,c)=>(r._sqlite3_hard_heap_limit64=I.xa)(i,c),r._sqlite3_memory_highwater=i=>(r._sqlite3_memory_highwater=I.ya)(i),r._sqlite3_malloc=i=>(r._sqlite3_malloc=I.za)(i),r._sqlite3_malloc64=(i,c)=>(r._sqlite3_malloc64=I.Aa)(i,c),r._sqlite3_free=i=>(r._sqlite3_free=I.Ba)(i),r._sqlite3_realloc=(i,c)=>(r._sqlite3_realloc=I.Ca)(i,c),r._sqlite3_realloc64=(i,c,l)=>(r._sqlite3_realloc64=I.Da)(i,c,l),r._sqlite3_str_vappendf=(i,c,l)=>(r._sqlite3_str_vappendf=I.Ea)(i,c,l),r._sqlite3_str_append=(i,c,l)=>(r._sqlite3_str_append=I.Fa)(i,c,l),r._sqlite3_str_appendchar=(i,c,l)=>(r._sqlite3_str_appendchar=I.Ga)(i,c,l),r._sqlite3_str_appendall=(i,c)=>(r._sqlite3_str_appendall=I.Ha)(i,c),r._sqlite3_str_appendf=(i,c,l)=>(r._sqlite3_str_appendf=I.Ia)(i,c,l),r._sqlite3_str_finish=i=>(r._sqlite3_str_finish=I.Ja)(i),r._sqlite3_str_errcode=i=>(r._sqlite3_str_errcode=I.Ka)(i),r._sqlite3_str_length=i=>(r._sqlite3_str_length=I.La)(i),r._sqlite3_str_value=i=>(r._sqlite3_str_value=I.Ma)(i),r._sqlite3_str_reset=i=>(r._sqlite3_str_reset=I.Na)(i),r._sqlite3_str_new=i=>(r._sqlite3_str_new=I.Oa)(i),r._sqlite3_vmprintf=(i,c)=>(r._sqlite3_vmprintf=I.Pa)(i,c),r._sqlite3_mprintf=(i,c)=>(r._sqlite3_mprintf=I.Qa)(i,c),r._sqlite3_vsnprintf=(i,c,l,m)=>(r._sqlite3_vsnprintf=I.Ra)(i,c,l,m),r._sqlite3_snprintf=(i,c,l,m)=>(r._sqlite3_snprintf=I.Sa)(i,c,l,m),r._sqlite3_log=(i,c,l)=>(r._sqlite3_log=I.Ta)(i,c,l),r._sqlite3_randomness=(i,c)=>(r._sqlite3_randomness=I.Ua)(i,c),r._sqlite3_stricmp=(i,c)=>(r._sqlite3_stricmp=I.Va)(i,c),r._sqlite3_strnicmp=(i,c,l)=>(r._sqlite3_strnicmp=I.Wa)(i,c,l),r._sqlite3_os_init=()=>(r._sqlite3_os_init=I.Xa)(),r._sqlite3_os_end=()=>(r._sqlite3_os_end=I.Ya)(),r._sqlite3_serialize=(i,c,l,m)=>(r._sqlite3_serialize=I.Za)(i,c,l,m),r._sqlite3_prepare_v2=(i,c,l,m,w)=>(r._sqlite3_prepare_v2=I._a)(i,c,l,m,w),r._sqlite3_step=i=>(r._sqlite3_step=I.$a)(i),r._sqlite3_column_int64=(i,c)=>(r._sqlite3_column_int64=I.ab)(i,c),r._sqlite3_reset=i=>(r._sqlite3_reset=I.bb)(i),r._sqlite3_exec=(i,c,l,m,w)=>(r._sqlite3_exec=I.cb)(i,c,l,m,w),r._sqlite3_column_int=(i,c)=>(r._sqlite3_column_int=I.db)(i,c),r._sqlite3_finalize=i=>(r._sqlite3_finalize=I.eb)(i),r._sqlite3_deserialize=(i,c,l,m,w,R,A,x)=>(r._sqlite3_deserialize=I.fb)(i,c,l,m,w,R,A,x),r._sqlite3_database_file_object=i=>(r._sqlite3_database_file_object=I.gb)(i),r._sqlite3_backup_init=(i,c,l,m)=>(r._sqlite3_backup_init=I.hb)(i,c,l,m),r._sqlite3_backup_step=(i,c)=>(r._sqlite3_backup_step=I.ib)(i,c),r._sqlite3_backup_finish=i=>(r._sqlite3_backup_finish=I.jb)(i),r._sqlite3_backup_remaining=i=>(r._sqlite3_backup_remaining=I.kb)(i),r._sqlite3_backup_pagecount=i=>(r._sqlite3_backup_pagecount=I.lb)(i),r._sqlite3_clear_bindings=i=>(r._sqlite3_clear_bindings=I.mb)(i),r._sqlite3_value_blob=i=>(r._sqlite3_value_blob=I.nb)(i),r._sqlite3_value_text=i=>(r._sqlite3_value_text=I.ob)(i),r._sqlite3_value_bytes=i=>(r._sqlite3_value_bytes=I.pb)(i),r._sqlite3_value_bytes16=i=>(r._sqlite3_value_bytes16=I.qb)(i),r._sqlite3_value_double=i=>(r._sqlite3_value_double=I.rb)(i),r._sqlite3_value_int=i=>(r._sqlite3_value_int=I.sb)(i),r._sqlite3_value_int64=i=>(r._sqlite3_value_int64=I.tb)(i),r._sqlite3_value_subtype=i=>(r._sqlite3_value_subtype=I.ub)(i),r._sqlite3_value_pointer=(i,c)=>(r._sqlite3_value_pointer=I.vb)(i,c),r._sqlite3_value_text16=i=>(r._sqlite3_value_text16=I.wb)(i),r._sqlite3_value_text16be=i=>(r._sqlite3_value_text16be=I.xb)(i),r._sqlite3_value_text16le=i=>(r._sqlite3_value_text16le=I.yb)(i),r._sqlite3_value_type=i=>(r._sqlite3_value_type=I.zb)(i),r._sqlite3_value_encoding=i=>(r._sqlite3_value_encoding=I.Ab)(i),r._sqlite3_value_nochange=i=>(r._sqlite3_value_nochange=I.Bb)(i),r._sqlite3_value_frombind=i=>(r._sqlite3_value_frombind=I.Cb)(i),r._sqlite3_value_dup=i=>(r._sqlite3_value_dup=I.Db)(i),r._sqlite3_value_free=i=>(r._sqlite3_value_free=I.Eb)(i),r._sqlite3_result_blob=(i,c,l,m)=>(r._sqlite3_result_blob=I.Fb)(i,c,l,m),r._sqlite3_result_blob64=(i,c,l,m,w)=>(r._sqlite3_result_blob64=I.Gb)(i,c,l,m,w),r._sqlite3_result_double=(i,c)=>(r._sqlite3_result_double=I.Hb)(i,c),r._sqlite3_result_error=(i,c,l)=>(r._sqlite3_result_error=I.Ib)(i,c,l),r._sqlite3_result_error16=(i,c,l)=>(r._sqlite3_result_error16=I.Jb)(i,c,l),r._sqlite3_result_int=(i,c)=>(r._sqlite3_result_int=I.Kb)(i,c),r._sqlite3_result_int64=(i,c,l)=>(r._sqlite3_result_int64=I.Lb)(i,c,l),r._sqlite3_result_null=i=>(r._sqlite3_result_null=I.Mb)(i),r._sqlite3_result_pointer=(i,c,l,m)=>(r._sqlite3_result_pointer=I.Nb)(i,c,l,m),r._sqlite3_result_subtype=(i,c)=>(r._sqlite3_result_subtype=I.Ob)(i,c),r._sqlite3_result_text=(i,c,l,m)=>(r._sqlite3_result_text=I.Pb)(i,c,l,m),r._sqlite3_result_text64=(i,c,l,m,w,R)=>(r._sqlite3_result_text64=I.Qb)(i,c,l,m,w,R),r._sqlite3_result_text16=(i,c,l,m)=>(r._sqlite3_result_text16=I.Rb)(i,c,l,m),r._sqlite3_result_text16be=(i,c,l,m)=>(r._sqlite3_result_text16be=I.Sb)(i,c,l,m),r._sqlite3_result_text16le=(i,c,l,m)=>(r._sqlite3_result_text16le=I.Tb)(i,c,l,m),r._sqlite3_result_value=(i,c)=>(r._sqlite3_result_value=I.Ub)(i,c),r._sqlite3_result_error_toobig=i=>(r._sqlite3_result_error_toobig=I.Vb)(i),r._sqlite3_result_zeroblob=(i,c)=>(r._sqlite3_result_zeroblob=I.Wb)(i,c),r._sqlite3_result_zeroblob64=(i,c,l)=>(r._sqlite3_result_zeroblob64=I.Xb)(i,c,l),r._sqlite3_result_error_code=(i,c)=>(r._sqlite3_result_error_code=I.Yb)(i,c),r._sqlite3_result_error_nomem=i=>(r._sqlite3_result_error_nomem=I.Zb)(i),r._sqlite3_user_data=i=>(r._sqlite3_user_data=I._b)(i),r._sqlite3_context_db_handle=i=>(r._sqlite3_context_db_handle=I.$b)(i),r._sqlite3_vtab_nochange=i=>(r._sqlite3_vtab_nochange=I.ac)(i),r._sqlite3_vtab_in_first=(i,c)=>(r._sqlite3_vtab_in_first=I.bc)(i,c),r._sqlite3_vtab_in_next=(i,c)=>(r._sqlite3_vtab_in_next=I.cc)(i,c),r._sqlite3_aggregate_context=(i,c)=>(r._sqlite3_aggregate_context=I.dc)(i,c),r._sqlite3_get_auxdata=(i,c)=>(r._sqlite3_get_auxdata=I.ec)(i,c),r._sqlite3_set_auxdata=(i,c,l,m)=>(r._sqlite3_set_auxdata=I.fc)(i,c,l,m),r._sqlite3_column_count=i=>(r._sqlite3_column_count=I.gc)(i),r._sqlite3_data_count=i=>(r._sqlite3_data_count=I.hc)(i),r._sqlite3_column_blob=(i,c)=>(r._sqlite3_column_blob=I.ic)(i,c),r._sqlite3_column_bytes=(i,c)=>(r._sqlite3_column_bytes=I.jc)(i,c),r._sqlite3_column_bytes16=(i,c)=>(r._sqlite3_column_bytes16=I.kc)(i,c),r._sqlite3_column_double=(i,c)=>(r._sqlite3_column_double=I.lc)(i,c),r._sqlite3_column_text=(i,c)=>(r._sqlite3_column_text=I.mc)(i,c),r._sqlite3_column_value=(i,c)=>(r._sqlite3_column_value=I.nc)(i,c),r._sqlite3_column_text16=(i,c)=>(r._sqlite3_column_text16=I.oc)(i,c),r._sqlite3_column_type=(i,c)=>(r._sqlite3_column_type=I.pc)(i,c),r._sqlite3_column_name=(i,c)=>(r._sqlite3_column_name=I.qc)(i,c),r._sqlite3_column_name16=(i,c)=>(r._sqlite3_column_name16=I.rc)(i,c),r._sqlite3_bind_blob=(i,c,l,m,w)=>(r._sqlite3_bind_blob=I.sc)(i,c,l,m,w),r._sqlite3_bind_blob64=(i,c,l,m,w,R)=>(r._sqlite3_bind_blob64=I.tc)(i,c,l,m,w,R),r._sqlite3_bind_double=(i,c,l)=>(r._sqlite3_bind_double=I.uc)(i,c,l),r._sqlite3_bind_int=(i,c,l)=>(r._sqlite3_bind_int=I.vc)(i,c,l),r._sqlite3_bind_int64=(i,c,l,m)=>(r._sqlite3_bind_int64=I.wc)(i,c,l,m),r._sqlite3_bind_null=(i,c)=>(r._sqlite3_bind_null=I.xc)(i,c),r._sqlite3_bind_pointer=(i,c,l,m,w)=>(r._sqlite3_bind_pointer=I.yc)(i,c,l,m,w),r._sqlite3_bind_text=(i,c,l,m,w)=>(r._sqlite3_bind_text=I.zc)(i,c,l,m,w),r._sqlite3_bind_text64=(i,c,l,m,w,R,A)=>(r._sqlite3_bind_text64=I.Ac)(i,c,l,m,w,R,A),r._sqlite3_bind_text16=(i,c,l,m,w)=>(r._sqlite3_bind_text16=I.Bc)(i,c,l,m,w),r._sqlite3_bind_value=(i,c,l)=>(r._sqlite3_bind_value=I.Cc)(i,c,l),r._sqlite3_bind_zeroblob=(i,c,l)=>(r._sqlite3_bind_zeroblob=I.Dc)(i,c,l),r._sqlite3_bind_zeroblob64=(i,c,l,m)=>(r._sqlite3_bind_zeroblob64=I.Ec)(i,c,l,m),r._sqlite3_bind_parameter_count=i=>(r._sqlite3_bind_parameter_count=I.Fc)(i),r._sqlite3_bind_parameter_name=(i,c)=>(r._sqlite3_bind_parameter_name=I.Gc)(i,c),r._sqlite3_bind_parameter_index=(i,c)=>(r._sqlite3_bind_parameter_index=I.Hc)(i,c),r._sqlite3_db_handle=i=>(r._sqlite3_db_handle=I.Ic)(i),r._sqlite3_stmt_readonly=i=>(r._sqlite3_stmt_readonly=I.Jc)(i),r._sqlite3_stmt_isexplain=i=>(r._sqlite3_stmt_isexplain=I.Kc)(i),r._sqlite3_stmt_explain=(i,c)=>(r._sqlite3_stmt_explain=I.Lc)(i,c),r._sqlite3_stmt_busy=i=>(r._sqlite3_stmt_busy=I.Mc)(i),r._sqlite3_next_stmt=(i,c)=>(r._sqlite3_next_stmt=I.Nc)(i,c),r._sqlite3_stmt_status=(i,c,l)=>(r._sqlite3_stmt_status=I.Oc)(i,c,l),r._sqlite3_sql=i=>(r._sqlite3_sql=I.Pc)(i),r._sqlite3_expanded_sql=i=>(r._sqlite3_expanded_sql=I.Qc)(i),r._sqlite3_value_numeric_type=i=>(r._sqlite3_value_numeric_type=I.Rc)(i),r._sqlite3_blob_open=(i,c,l,m,w,R,A,x)=>(r._sqlite3_blob_open=I.Sc)(i,c,l,m,w,R,A,x),r._sqlite3_blob_close=i=>(r._sqlite3_blob_close=I.Tc)(i),r._sqlite3_blob_read=(i,c,l,m)=>(r._sqlite3_blob_read=I.Uc)(i,c,l,m),r._sqlite3_blob_write=(i,c,l,m)=>(r._sqlite3_blob_write=I.Vc)(i,c,l,m),r._sqlite3_blob_bytes=i=>(r._sqlite3_blob_bytes=I.Wc)(i),r._sqlite3_blob_reopen=(i,c,l)=>(r._sqlite3_blob_reopen=I.Xc)(i,c,l),r._sqlite3_set_authorizer=(i,c,l)=>(r._sqlite3_set_authorizer=I.Yc)(i,c,l),r._sqlite3_strglob=(i,c)=>(r._sqlite3_strglob=I.Zc)(i,c),r._sqlite3_strlike=(i,c,l)=>(r._sqlite3_strlike=I._c)(i,c,l),r._sqlite3_errmsg=i=>(r._sqlite3_errmsg=I.$c)(i),r._sqlite3_auto_extension=i=>(r._sqlite3_auto_extension=I.ad)(i),r._sqlite3_cancel_auto_extension=i=>(r._sqlite3_cancel_auto_extension=I.bd)(i),r._sqlite3_reset_auto_extension=()=>(r._sqlite3_reset_auto_extension=I.cd)(),r._sqlite3_prepare=(i,c,l,m,w)=>(r._sqlite3_prepare=I.dd)(i,c,l,m,w),r._sqlite3_prepare_v3=(i,c,l,m,w,R)=>(r._sqlite3_prepare_v3=I.ed)(i,c,l,m,w,R),r._sqlite3_prepare16=(i,c,l,m,w)=>(r._sqlite3_prepare16=I.fd)(i,c,l,m,w),r._sqlite3_prepare16_v2=(i,c,l,m,w)=>(r._sqlite3_prepare16_v2=I.gd)(i,c,l,m,w),r._sqlite3_prepare16_v3=(i,c,l,m,w,R)=>(r._sqlite3_prepare16_v3=I.hd)(i,c,l,m,w,R),r._sqlite3_get_table=(i,c,l,m,w,R)=>(r._sqlite3_get_table=I.id)(i,c,l,m,w,R),r._sqlite3_free_table=i=>(r._sqlite3_free_table=I.jd)(i),r._sqlite3_create_module=(i,c,l,m)=>(r._sqlite3_create_module=I.kd)(i,c,l,m),r._sqlite3_create_module_v2=(i,c,l,m,w)=>(r._sqlite3_create_module_v2=I.ld)(i,c,l,m,w),r._sqlite3_drop_modules=(i,c)=>(r._sqlite3_drop_modules=I.md)(i,c),r._sqlite3_declare_vtab=(i,c)=>(r._sqlite3_declare_vtab=I.nd)(i,c),r._sqlite3_vtab_on_conflict=i=>(r._sqlite3_vtab_on_conflict=I.od)(i),r._sqlite3_vtab_config=(i,c,l)=>(r._sqlite3_vtab_config=I.pd)(i,c,l),r._sqlite3_vtab_collation=(i,c)=>(r._sqlite3_vtab_collation=I.qd)(i,c),r._sqlite3_vtab_in=(i,c,l)=>(r._sqlite3_vtab_in=I.rd)(i,c,l),r._sqlite3_vtab_rhs_value=(i,c,l)=>(r._sqlite3_vtab_rhs_value=I.sd)(i,c,l),r._sqlite3_vtab_distinct=i=>(r._sqlite3_vtab_distinct=I.td)(i),r._sqlite3_keyword_name=(i,c,l)=>(r._sqlite3_keyword_name=I.ud)(i,c,l),r._sqlite3_keyword_count=()=>(r._sqlite3_keyword_count=I.vd)(),r._sqlite3_keyword_check=(i,c)=>(r._sqlite3_keyword_check=I.wd)(i,c),r._sqlite3_complete=i=>(r._sqlite3_complete=I.xd)(i),r._sqlite3_complete16=i=>(r._sqlite3_complete16=I.yd)(i),r._sqlite3_libversion=()=>(r._sqlite3_libversion=I.zd)(),r._sqlite3_libversion_number=()=>(r._sqlite3_libversion_number=I.Ad)(),r._sqlite3_threadsafe=()=>(r._sqlite3_threadsafe=I.Bd)(),r._sqlite3_initialize=()=>(r._sqlite3_initialize=I.Cd)(),r._sqlite3_shutdown=()=>(r._sqlite3_shutdown=I.Dd)(),r._sqlite3_config=(i,c)=>(r._sqlite3_config=I.Ed)(i,c),r._sqlite3_db_mutex=i=>(r._sqlite3_db_mutex=I.Fd)(i),r._sqlite3_db_release_memory=i=>(r._sqlite3_db_release_memory=I.Gd)(i),r._sqlite3_db_cacheflush=i=>(r._sqlite3_db_cacheflush=I.Hd)(i),r._sqlite3_db_config=(i,c,l)=>(r._sqlite3_db_config=I.Id)(i,c,l),r._sqlite3_last_insert_rowid=i=>(r._sqlite3_last_insert_rowid=I.Jd)(i),r._sqlite3_set_last_insert_rowid=(i,c,l)=>(r._sqlite3_set_last_insert_rowid=I.Kd)(i,c,l),r._sqlite3_changes64=i=>(r._sqlite3_changes64=I.Ld)(i),r._sqlite3_changes=i=>(r._sqlite3_changes=I.Md)(i),r._sqlite3_total_changes64=i=>(r._sqlite3_total_changes64=I.Nd)(i),r._sqlite3_total_changes=i=>(r._sqlite3_total_changes=I.Od)(i),r._sqlite3_txn_state=(i,c)=>(r._sqlite3_txn_state=I.Pd)(i,c),r._sqlite3_close=i=>(r._sqlite3_close=I.Qd)(i),r._sqlite3_close_v2=i=>(r._sqlite3_close_v2=I.Rd)(i),r._sqlite3_busy_handler=(i,c,l)=>(r._sqlite3_busy_handler=I.Sd)(i,c,l),r._sqlite3_progress_handler=(i,c,l,m)=>(r._sqlite3_progress_handler=I.Td)(i,c,l,m),r._sqlite3_busy_timeout=(i,c)=>(r._sqlite3_busy_timeout=I.Ud)(i,c),r._sqlite3_interrupt=i=>(r._sqlite3_interrupt=I.Vd)(i),r._sqlite3_is_interrupted=i=>(r._sqlite3_is_interrupted=I.Wd)(i),r._sqlite3_create_function=(i,c,l,m,w,R,A,x)=>(r._sqlite3_create_function=I.Xd)(i,c,l,m,w,R,A,x),r._sqlite3_create_function_v2=(i,c,l,m,w,R,A,x,H)=>(r._sqlite3_create_function_v2=I.Yd)(i,c,l,m,w,R,A,x,H),r._sqlite3_create_window_function=(i,c,l,m,w,R,A,x,H,te)=>(r._sqlite3_create_window_function=I.Zd)(i,c,l,m,w,R,A,x,H,te),r._sqlite3_create_function16=(i,c,l,m,w,R,A,x)=>(r._sqlite3_create_function16=I._d)(i,c,l,m,w,R,A,x),r._sqlite3_overload_function=(i,c,l)=>(r._sqlite3_overload_function=I.$d)(i,c,l),r._sqlite3_trace_v2=(i,c,l,m)=>(r._sqlite3_trace_v2=I.ae)(i,c,l,m),r._sqlite3_commit_hook=(i,c,l)=>(r._sqlite3_commit_hook=I.be)(i,c,l),r._sqlite3_update_hook=(i,c,l)=>(r._sqlite3_update_hook=I.ce)(i,c,l),r._sqlite3_rollback_hook=(i,c,l)=>(r._sqlite3_rollback_hook=I.de)(i,c,l),r._sqlite3_autovacuum_pages=(i,c,l,m)=>(r._sqlite3_autovacuum_pages=I.ee)(i,c,l,m),r._sqlite3_wal_autocheckpoint=(i,c)=>(r._sqlite3_wal_autocheckpoint=I.fe)(i,c),r._sqlite3_wal_hook=(i,c,l)=>(r._sqlite3_wal_hook=I.ge)(i,c,l),r._sqlite3_wal_checkpoint_v2=(i,c,l,m,w)=>(r._sqlite3_wal_checkpoint_v2=I.he)(i,c,l,m,w),r._sqlite3_wal_checkpoint=(i,c)=>(r._sqlite3_wal_checkpoint=I.ie)(i,c),r._sqlite3_error_offset=i=>(r._sqlite3_error_offset=I.je)(i),r._sqlite3_errmsg16=i=>(r._sqlite3_errmsg16=I.ke)(i),r._sqlite3_errcode=i=>(r._sqlite3_errcode=I.le)(i),r._sqlite3_extended_errcode=i=>(r._sqlite3_extended_errcode=I.me)(i),r._sqlite3_system_errno=i=>(r._sqlite3_system_errno=I.ne)(i),r._sqlite3_errstr=i=>(r._sqlite3_errstr=I.oe)(i),r._sqlite3_limit=(i,c,l)=>(r._sqlite3_limit=I.pe)(i,c,l),r._sqlite3_open=(i,c)=>(r._sqlite3_open=I.qe)(i,c),r._sqlite3_open_v2=(i,c,l,m)=>(r._sqlite3_open_v2=I.re)(i,c,l,m),r._sqlite3_open16=(i,c)=>(r._sqlite3_open16=I.se)(i,c),r._sqlite3_create_collation=(i,c,l,m,w)=>(r._sqlite3_create_collation=I.te)(i,c,l,m,w),r._sqlite3_create_collation_v2=(i,c,l,m,w,R)=>(r._sqlite3_create_collation_v2=I.ue)(i,c,l,m,w,R),r._sqlite3_create_collation16=(i,c,l,m,w)=>(r._sqlite3_create_collation16=I.ve)(i,c,l,m,w),r._sqlite3_collation_needed=(i,c,l)=>(r._sqlite3_collation_needed=I.we)(i,c,l),r._sqlite3_collation_needed16=(i,c,l)=>(r._sqlite3_collation_needed16=I.xe)(i,c,l),r._sqlite3_get_clientdata=(i,c)=>(r._sqlite3_get_clientdata=I.ye)(i,c),r._sqlite3_set_clientdata=(i,c,l,m)=>(r._sqlite3_set_clientdata=I.ze)(i,c,l,m),r._sqlite3_get_autocommit=i=>(r._sqlite3_get_autocommit=I.Ae)(i),r._sqlite3_table_column_metadata=(i,c,l,m,w,R,A,x,H)=>(r._sqlite3_table_column_metadata=I.Be)(i,c,l,m,w,R,A,x,H),r._sqlite3_sleep=i=>(r._sqlite3_sleep=I.Ce)(i),r._sqlite3_extended_result_codes=(i,c)=>(r._sqlite3_extended_result_codes=I.De)(i,c),r._sqlite3_file_control=(i,c,l,m)=>(r._sqlite3_file_control=I.Ee)(i,c,l,m),r._sqlite3_test_control=(i,c)=>(r._sqlite3_test_control=I.Fe)(i,c),r._sqlite3_create_filename=(i,c,l,m,w)=>(r._sqlite3_create_filename=I.Ge)(i,c,l,m,w),r._sqlite3_free_filename=i=>(r._sqlite3_free_filename=I.He)(i),r._sqlite3_uri_parameter=(i,c)=>(r._sqlite3_uri_parameter=I.Ie)(i,c),r._sqlite3_uri_key=(i,c)=>(r._sqlite3_uri_key=I.Je)(i,c),r._sqlite3_uri_boolean=(i,c,l)=>(r._sqlite3_uri_boolean=I.Ke)(i,c,l),r._sqlite3_uri_int64=(i,c,l,m)=>(r._sqlite3_uri_int64=I.Le)(i,c,l,m),r._sqlite3_filename_database=i=>(r._sqlite3_filename_database=I.Me)(i),r._sqlite3_filename_journal=i=>(r._sqlite3_filename_journal=I.Ne)(i),r._sqlite3_filename_wal=i=>(r._sqlite3_filename_wal=I.Oe)(i),r._sqlite3_db_name=(i,c)=>(r._sqlite3_db_name=I.Pe)(i,c),r._sqlite3_db_filename=(i,c)=>(r._sqlite3_db_filename=I.Qe)(i,c),r._sqlite3_db_readonly=(i,c)=>(r._sqlite3_db_readonly=I.Re)(i,c),r._sqlite3_compileoption_used=i=>(r._sqlite3_compileoption_used=I.Se)(i),r._sqlite3_compileoption_get=i=>(r._sqlite3_compileoption_get=I.Te)(i),r._sqlite3session_create=(i,c,l)=>(r._sqlite3session_create=I.Ue)(i,c,l),r._sqlite3session_delete=i=>(r._sqlite3session_delete=I.Ve)(i),r._sqlite3session_attach=(i,c)=>(r._sqlite3session_attach=I.We)(i,c),r._sqlite3session_changeset=(i,c,l)=>(r._sqlite3session_changeset=I.Xe)(i,c,l),r._sqlite3session_enable=(i,c)=>(r._sqlite3session_enable=I.Ye)(i,c),r._sqlite3changeset_start=(i,c,l)=>(r._sqlite3changeset_start=I.Ze)(i,c,l),r._sqlite3changeset_finalize=i=>(r._sqlite3changeset_finalize=I._e)(i),r._sqlite3changeset_invert=(i,c,l,m)=>(r._sqlite3changeset_invert=I.$e)(i,c,l,m),r._sqlite3changeset_apply=(i,c,l,m,w,R)=>(r._sqlite3changeset_apply=I.af)(i,c,l,m,w,R),r._sqlite3_sourceid=()=>(r._sqlite3_sourceid=I.bf)(),r._malloc=i=>(r._malloc=I.cf)(i),r._free=i=>(r._free=I.df)(i),r._RegisterExtensionFunctions=i=>(r._RegisterExtensionFunctions=I.ef)(i),r._getSqliteFree=()=>(r._getSqliteFree=I.ff)();var L0=r._main=(i,c)=>(L0=r._main=I.gf)(i,c);r._libauthorizer_set_authorizer=(i,c,l)=>(r._libauthorizer_set_authorizer=I.hf)(i,c,l),r._libfunction_create_function=(i,c,l,m,w,R,A,x)=>(r._libfunction_create_function=I.jf)(i,c,l,m,w,R,A,x),r._libhook_commit_hook=(i,c,l)=>(r._libhook_commit_hook=I.kf)(i,c,l),r._libhook_update_hook=(i,c,l)=>(r._libhook_update_hook=I.lf)(i,c,l),r._libprogress_progress_handler=(i,c,l,m)=>(r._libprogress_progress_handler=I.mf)(i,c,l,m),r._libvfs_vfs_register=(i,c,l,m,w,R)=>(r._libvfs_vfs_register=I.nf)(i,c,l,m,w,R);var j0=(i,c)=>(j0=I.pf)(i,c),U0=()=>(U0=I.qf)(),z0=i=>(z0=I.rf)(i),B0=i=>(B0=I.sf)(i),H0=()=>(H0=I.tf)();r._sqlite3_version=5472,r.getTempRet0=hM,r.ccall=zo,r.cwrap=dM,r.addFunction=lM,r.setValue=Ba,r.getValue=C0,r.UTF8ToString=Ei,r.stringToUTF8=Uo,r.lengthBytesUTF8=Va,r.intArrayFromString=j_,r.intArrayToString=bM,r.AsciiToString=gM,r.UTF16ToString=_M,r.stringToUTF16=mM,r.UTF32ToString=yM,r.stringToUTF32=pM,r.writeArrayToMemory=N0;var Jd;Lo=function i(){Jd||V0(),Jd||(Lo=i)};function wM(){var i=L0,c=0,l=0;try{var m=i(c,l);return tM(m,!0),m}catch(w){return nM(w)}}function V0(){if(as>0||(Ke(),as>0))return;function i(){var c;Jd||(Jd=!0,r.calledRun=!0,!$&&(jt(),Nn(),s(r),(c=r.onRuntimeInitialized)==null||c.call(r),W0&&wM(),Gu()))}r.setStatus?(r.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>r.setStatus(""),1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var W0=!0;return r.noInitialRun&&(W0=!1),V0(),(function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.set_authorizer=function(l,m,w){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Ba(c,m instanceof i?1:0,"i32");const R=zo("libauthorizer_set_authorizer","number",["number","number","number"],[l,m?1:0,c]);return!R&&m&&r.setCallback(c,(A,x,H,te,Ie,Pe)=>m(w,x,H,te,Ie,Pe)),R}})(),(function(){const i=Object.getPrototypeOf(async function(){}).constructor,c=["xFunc","xStep","xFinal"],l=new Map;r.create_function=function(m,w,R,A,x,H,te,Ie){const Pe=r._sqlite3_malloc(4),Xe={xFunc:H,xStep:te,xFinal:Ie};Ba(Pe,c.reduce((de,mt,Kn)=>Xe[mt]instanceof i?de|1<<Kn:de,0),"i32");const ue=zo("libfunction_create_function","number",["number","string","number","number","number","number","number","number"],[m,w,R,A,Pe,H?1:0,te?1:0,Ie?1:0]);if(!ue){if(l.has(w)){const de=l.get(w);r.deleteCallback(de)}l.set(w,Pe),r.setCallback(Pe,{xFunc:H,xStep:te,xFinal:Ie})}return ue}})(),(function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.update_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Ba(c,m instanceof i?1:0,"i32"),zo("libhook_update_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,(w,R,A,x,H,te)=>m(R,A,x,H,te))}})(),(function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.commit_hook=function(l,m){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Ba(c,m instanceof i?1:0,"i32"),zo("libhook_commit_hook","void",["number","number","number"],[l,m?1:0,c]),m&&r.setCallback(c,w=>m())}})(),(function(){const i=Object.getPrototypeOf(async function(){}).constructor;let c=0;r.progress_handler=function(l,m,w,R){c&&(r.deleteCallback(c),r._sqlite3_free(c),c=0),c=r._sqlite3_malloc(4),Ba(c,w instanceof i?1:0,"i32"),zo("libprogress_progress_handler","number",["number","number","number","number"],[l,m,w?1:0,c]),w&&r.setCallback(c,A=>w(R))}})(),(function(){const i=["xOpen","xDelete","xAccess","xFullPathname","xRandomness","xSleep","xCurrentTime","xGetLastError","xCurrentTimeInt64","xClose","xRead","xWrite","xTruncate","xSync","xFileSize","xLock","xUnlock","xCheckReservedLock","xFileControl","xSectorSize","xDeviceCharacteristics","xShmMap","xShmLock","xShmBarrier","xShmUnmap"],c=new Map;r.vfs_register=function(l,m){let w=0,R=0;i.forEach((x,H)=>{l[x]&&(w|=1<<H,l.hasAsyncMethod(x)&&(R|=1<<H))});const A=r._sqlite3_malloc(4);try{const x=zo("libvfs_vfs_register","number",["string","number","number","number","number","number"],[l.name,l.mxPathname,w,R,m?1:0,A]);if(!x){if(c.has(l.name)){const te=c.get(l.name);r.deleteCallback(te)}const H=C0(A,"*");c.set(l.name,H),r.setCallback(H,l)}return x}finally{r._sqlite3_free(A)}}})(),n=a,n})})();const Fae=async()=>{const e=await Pae(),t=Aae(e);return t.module=e,t},p0=typeof navigator>"u"||navigator.storage===void 0?new Proxy({},{get:()=>Promise.reject(new Error("Can't get OPFS root handle in this environment as navigator.storage is undefined"))}):navigator.storage.getDirectory(),xae=async e=>{const t=await p0;if(e===void 0)return t;let n=t;const r=e==null?void 0:e.split("/").filter(Boolean);for(;r.length>0;)n=await n.getDirectoryHandle(r.shift());return n},s3=async(e=p0,t=Number.POSITIVE_INFINITY,n="")=>{if(t<0)return;const r=await e,s=r.values();for await(const o of s){const a=o.kind==="directory",u=o.kind==="file"?await o.getFile().then(f=>qre(f.size)):void 0;if(console.log(`${n}${a?"":""} ${o.name} ${u?`(${u})`:""}`),a){const f=await r.getDirectoryHandle(o.name);await s3(f,t-1,`${n}  `)}}},Nae=async e=>{if(e.kind==="directory")for await(const t of e.keys())await e.removeEntry(t,{recursive:!0})};var Dae=Object.freeze({__proto__:null,deleteAll:Nae,getDirHandle:xae,printTree:s3,rootHandlePromise:p0});class Uce extends Ur()("PersistedSqliteError",{cause:ka}){}const Mae=(e,t)=>{if(e===void 0||e===""||e==="/")return`livestore-${t}@${JC}`;if(e.includes("/"))throw new Error(`@livestore/adapter-web:worker:sanitizeOpfsDir: Nested directories are not yet supported ('${e}')`);return`${e}@${JC}`},Lae=e=>`state${e.state.sqlite.migrations.strategy==="manual"?"fixed":e.state.sqlite.hash.toString()}.db`,jae=e=>Jse({channelName:`livestore.shutdown.${e}`,schema:Die}),Uae=Y({type:oe("opfs"),directory:be(D)}),zae=ie(Uae);Ku({key:D,value:Ro});var NS;(function(e){class t extends Mn()("InitialMessage",{payload:{port:T_,storeId:D,clientId:D},success:vs,failure:De}){}e.InitialMessage=t;class n extends ie(t){}e.Request=n})(NS||(NS={}));var Jn;(function(e){class t extends Mn()("InitialMessage",{payload:{storageOptions:zae,devtoolsEnabled:Ea,storeId:D,clientId:D,debugInstanceId:D,syncPayload:__(Ro)},success:vs,failure:De}){}e.InitialMessage=t;class n extends Mn()("BootStatusStream",{payload:{},success:boe,failure:De}){}e.BootStatusStream=n;class r extends Mn()("PushToLeader",{payload:{batch:Me(Qoe)},success:vs,failure:ie(De,i0)}){}e.PushToLeader=r;class s extends Mn()("PullStream",{payload:{cursor:yoe},success:Y({payload:p2,mergeCounter:je}),failure:De}){}e.PullStream=s;class o extends Mn()("Export",{payload:{},success:Pc,failure:De}){}e.Export=o;class a extends Mn()("ExportEventlog",{payload:{},success:Pc,failure:De}){}e.ExportEventlog=a;class u extends Mn()("GetRecreateSnapshot",{payload:{},success:Y({snapshot:Pc,migrationsReport:woe}),failure:De}){}e.GetRecreateSnapshot=u;class f extends Mn()("GetLeaderHead",{payload:{},success:In,failure:De}){}e.GetLeaderHead=f;class h extends Mn()("GetLeaderSyncState",{payload:{},success:ys,failure:De}){}e.GetLeaderSyncState=h;class p extends Mn()("Shutdown",{payload:{},success:vs,failure:De}){}e.Shutdown=p;class g extends Mn()("ExtraDevtoolsMessage",{payload:{message:P2},success:vs,failure:De}){}e.ExtraDevtoolsMessage=g,e.Request=ie(t,n,r,s,o,a,u,f,h,p,g,f0)})(Jn||(Jn={}));var lT;(function(e){class t extends ge("FromClientSession",{initialMessage:Jn.InitialMessage}){}e.InitialMessagePayloadFromClientSession=t;class n extends Mn()("InitialMessage",{payload:{payload:ie(t,ge("FromWebBridge",{})),liveStoreVersion:oe(F_)},success:vs,failure:De}){}e.InitialMessage=n;class r extends Mn()("UpdateMessagePort",{payload:{port:T_},success:vs,failure:De}){}e.UpdateMessagePort=r;class s extends ie(n,r,Jn.BootStatusStream,Jn.PushToLeader,Jn.PullStream,Jn.Export,Jn.GetRecreateSnapshot,Jn.ExportEventlog,Jn.GetLeaderHead,Jn.GetLeaderSyncState,Jn.Shutdown,Jn.ExtraDevtoolsMessage,f0){}e.Request=s})(lT||(lT={}));k_()&&(globalThis.__debugLiveStoreUtils={opfs:Dae,blobUrl:e=>URL.createObjectURL(new Blob([e],{type:"application/octet-stream"})),runSync:e=>Cs(e),runFork:e=>Do(e)});const Bae=e=>{Hae(e).pipe(Do)},Hae=e=>{var n;const t=(n=e.otelOptions)!=null&&n.tracer?BP(Ee(kre,HP)).pipe(zP(Bv($re,e.otelOptions.tracer))):void 0;return Vae(e).pipe(Hv(roe),QN,di,vt,Cc({thread:self.name}),An(Nne(self.name)),An(xse),Ds?Zse(r=>console.createTask(r)):ce,t?An(t):ce,uQ(ooe()),lQ(4096),kee(Jw))},Vae=e=>GN(NS.InitialMessage,{InitialMessage:({port:t,storeId:n,clientId:r})=>z(function*(){return yield*Wae(e).pipe(Hv(soe(t)),QN,di,Oe("@livestore/adapter-web:worker:wrapper:InitialMessage:innerFiber"),vt,An(Lf.layer({nodeName:Eie.client.leader({storeId:n,clientId:r})})),Jt),MQ}).pipe(Oe("@livestore/adapter-web:worker:wrapper:InitialMessage"),Vv)}),Wae=({schema:e,sync:t})=>GN(Jn.Request,{InitialMessage:({storageOptions:n,storeId:r,clientId:s,devtoolsEnabled:o,debugInstanceId:a,syncPayload:u})=>z(function*(){const f=yield*Mg(()=>Fae()),h=qae({sqlite3:f}),p=yield*No(),g=E=>h({_tag:"opfs",opfsDirectory:Mae(n.directory,r),fileName:E==="state"?Lae(e):"eventlog.db",configureDb:S=>z2(S,{foreignKeys:!0}).pipe(An(p),Cs)}).pipe(at(S=>xo(()=>S.close()).pipe(Td))),[k,T]=yield*Cd([g("state"),g("eventlog")],{concurrency:2}),O=yield*Kae({devtoolsEnabled:o,dbState:k,dbEventlog:T}),L=yield*jae(r);return cae({schema:e,storeId:r,clientId:s,makeSqliteDb:h,syncOptions:t,dbState:k,dbEventlog:T,devtoolsOptions:O,shutdownChannel:L,syncPayload:u})}).pipe(vt,De.mapToUnexpectedError,WE("@livestore/adapter-web:worker:InitialMessage"),Oe("@livestore/adapter-web:worker:InitialMessage"),EQ({debugInstanceId:a}),Vv),GetRecreateSnapshot:()=>z(function*(){const n=yield*Ht;return{snapshot:n.dbState.export(),migrationsReport:n.initialState.migrationsReport}}).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:GetRecreateSnapshot")),PullStream:({cursor:n})=>z(function*(){const{syncProcessor:r}=yield*Ht;return r.pull({cursor:n})}).pipe(wN),PushToLeader:({batch:n})=>Qr(Ht,({syncProcessor:r})=>r.push(n.map(s=>new Fn(s)),{waitForProcessing:!0})).pipe(Qo,Oe("@livestore/adapter-web:worker:PushToLeader")),Export:()=>Qr(Ht,n=>n.dbState.export()).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:Export")),ExportEventlog:()=>Qr(Ht,n=>n.dbEventlog.export()).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:ExportEventlog")),BootStatusStream:()=>Qr(Ht,n=>Co(n.bootStatusQueue)).pipe(SN),GetLeaderHead:()=>z(function*(){const n=yield*Ht;return V2(n.dbEventlog)}).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:GetLeaderHead")),GetLeaderSyncState:()=>z(function*(){return yield*(yield*Ht).syncProcessor.syncState}).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:GetLeaderSyncState")),Shutdown:()=>z(function*(){yield*ps("[@livestore/adapter-web:worker] Shutdown"),yield*nu(300)}).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:Shutdown")),ExtraDevtoolsMessage:({message:n})=>Qr(Ht,r=>r.extraIncomingMessagesQueue.offer(n)).pipe(De.mapToUnexpectedError,Oe("@livestore/adapter-web:worker:ExtraDevtoolsMessage")),"DevtoolsWebCommon.CreateConnection":fae}),Kae=({devtoolsEnabled:e,dbState:t,dbEventlog:n})=>z(function*(){if(e===!1)return{enabled:!1};const{node:r}=yield*Lf;return{enabled:!0,boot:z(function*(){const s={state:t.metadata.persistenceInfo,eventlog:n.metadata.persistenceInfo};return{node:r,persistenceInfo:s,mode:"direct"}})}}),g0=ge("WSMessage.PullReq",{requestId:D,cursor:be(je)}).annotations({title:"@livestore/sync-cf:PullReq"}),Jae=Y({createdAt:D}).annotations({title:"@livestore/sync-cf:SyncMetadata"}),o3=ge("WSMessage.PullRes",{batch:Me(Y({eventEncoded:o0,metadata:Zi(Jae)})),requestId:Y({context:oe("pull","push"),requestId:D}),remaining:je}).annotations({title:"@livestore/sync-cf:PullRes"}),_0=ge("WSMessage.PushReq",{requestId:D,batch:Me(o0)}).annotations({title:"@livestore/sync-cf:PushReq"}),i3=ge("WSMessage.PushAck",{requestId:D}).annotations({title:"@livestore/sync-cf:PushAck"}),a3=ge("WSMessage.Error",{requestId:D,message:D}).annotations({title:"@livestore/sync-cf:Error"}),c3=ge("WSMessage.Ping",{requestId:oe("ping")}).annotations({title:"@livestore/sync-cf:Ping"}),u3=ge("WSMessage.Pong",{requestId:oe("ping")}).annotations({title:"@livestore/sync-cf:Pong"}),l3=ge("WSMessage.AdminResetRoomReq",{requestId:D,adminSecret:D}).annotations({title:"@livestore/sync-cf:AdminResetRoomReq"}),f3=ge("WSMessage.AdminResetRoomRes",{requestId:D}).annotations({title:"@livestore/sync-cf:AdminResetRoomRes"}),d3=ge("WSMessage.AdminInfoReq",{requestId:D,adminSecret:D}).annotations({title:"@livestore/sync-cf:AdminInfoReq"}),h3=ge("WSMessage.AdminInfoRes",{requestId:D,info:Y({durableObjectId:D})}).annotations({title:"@livestore/sync-cf:AdminInfoRes"}),Gae=ie(g0,o3,_0,i3,a3,c3,u3,l3,f3,d3,h3).annotations({title:"@livestore/sync-cf:Message"}),Qae=ie(o3,i3,f3,h3,a3,u3);ie(g0,_0,l3,d3,c3);const Yae=Y({storeId:D,payload:cN(Ete,xs(Ro)).pipe(__)}),Xae=e=>({storeId:t,payload:n})=>z(function*(){const r=yield*Wu(Yae)({storeId:t,payload:n}).pipe(De.mapToUnexpectedError),s=C_(r),o=`${e.url}/websocket?${Xre(s)}`,{isConnected:a,incomingMessages:u,send:f}=yield*Zae(o),h=[];let p=!1;return{isConnected:a,connect:he,pull:k=>z(function*(){var E;if(p)return Ce("Pull already started for this sync backend.");p=!0;let T=!1;const O=ho(),L=(E=hr(k))==null?void 0:E.cursor.global;return yield*f(g0.make({cursor:L,requestId:O})),ep(u).pipe(Cn(S=>S._tag==="WSMessage.Error"&&S.requestId===O?new tie({message:S.message}):he),yN(S=>{var _;if(S._tag==="WSMessage.PullRes")if(S.requestId.context==="pull")if(S.requestId.requestId===O)if(T=!0,h.length>0&&S.remaining===0){const C=((_=S.batch.at(-1))==null?void 0:_.eventEncoded.seqNum)??ts.global,$=h.findIndex(N=>N.eventEncoded.seqNum>C),q=$===-1?[]:h.slice($),P=[...S.batch,...q];return W({...S,batch:P,remaining:0})}else return W(S);else return V();else return T?W(S):(h.push(...S.batch),V());return V()}))}).pipe(SN),push:k=>z(function*(){const T=yield*Ue(),O=ho();yield*ep(u).pipe(Cn(L=>L._tag==="WSMessage.Error"&&L.requestId===O?Uw(T,new eie({reason:{_tag:"Unexpected",message:L.message}})):he),Ns(L=>L._tag==="WSMessage.PushAck"&&L.requestId===O),uu(1),Cn(()=>ut(T,void 0)),fn,vt,Ug),yield*f(_0.make({batch:k,requestId:O})),yield*T}),metadata:{name:"@livestore/cf-sync",description:"LiveStore sync backend implementation using Cloudflare Workers & Durable Objects",protocol:"ws",url:e.url}}}),Zae=e=>z(function*(){const t=yield*$f(!1),n={current:void 0},r=yield*Yv().pipe(at(xm)),s=t.changes.pipe(Ns(Boolean),uu(1),fn),o=u=>z(function*(){yield*s,n.current.send(ws(xs(Gae))(u)),Ds&&(yield*Qn(`Sent message: ${u._tag}`,u._tag==="WSMessage.PushReq"?{seqNum:u.batch[0].seqNum,parentSeqNum:u.batch[0].parentSeqNum,batchLength:u.batch.length}:u._tag==="WSMessage.PullReq"?{cursor:u.cursor??"-"}:{}))});return yield*z(function*(){for(;typeof navigator<"u"&&navigator.onLine===!1;)yield*nu(1e3);const u=yield*Qse({url:e,reconnect:JF(100)});yield*Ar(t,!0),n.current=u;const f=yield*Ue(),h=yield*yn().pipe(at(Mt));yield*hh(u,"message",g=>z(function*(){const k=Jx(xs(Qae))(g.data);if(k._tag==="Left"){console.error("Sync: Invalid message received",k.left);return}else k.right._tag==="WSMessage.Pong"?yield*Ze(h,k.right):yield*Jg(r,k.right)})),yield*hh(u,"close",()=>ut(f,void 0)),yield*hh(u,"error",()=>z(function*(){u.close(3e3,"Sync: WebSocket error"),yield*ut(f,void 0)})),typeof self<"u"&&typeof self.addEventListener=="function"&&(yield*hh(self,"offline",()=>ut(f,void 0))),yield*nr(()=>z(function*(){n.current=void 0,yield*Ar(t,!1)}));const p=z(function*(){yield*o({_tag:"WSMessage.Ping",requestId:"ping"}),yield*ko(h).pipe(zg(5e3)),yield*nu(25e3)}).pipe(Oe("@livestore/sync-cf:connect:checkPingPong"),Nv);yield*s.pipe(Qr(p.pipe(pf)),Nu(()=>ut(f,void 0)),Jt),yield*f}).pipe(di,Oe("@livestore/sync-cf:connect")).pipe(pf,Pt,vt,Jt),{isConnected:t,incomingMessages:r,send:o}}),Xt={members:Gn({name:"members",columns:{id:Ae({primaryKey:!0}),name:Ae({default:""}),bio:Ae({default:""}),role:Ae({default:"member"}),stakeAmount:xt({default:0}),stakeStatus:Ae({default:"none"}),stakedAt:xt({nullable:!0,schema:sn}),permissions:Ae({default:"read"}),createdAt:xt({schema:sn}),updatedAt:xt({nullable:!0,schema:sn})}}),projects:Gn({name:"projects",columns:{id:Ae({primaryKey:!0}),name:Ae({default:""}),status:Ae({default:"active"}),sharingLevel:Ae({default:"private"}),ownerId:Ae({default:""}),origin:Ae({default:""}),description:Ae({default:""}),learned:Ae({default:""}),link:Ae({nullable:!0}),linkText:Ae({nullable:!0}),createdAt:xt({schema:sn}),updatedAt:xt({nullable:!0,schema:sn}),deletedAt:xt({nullable:!0,schema:sn})}}),notebookEntries:Gn({name:"notebookEntries",columns:{id:Ae({primaryKey:!0}),date:Ae({default:""}),title:Ae({default:""}),type:Ae({default:"note"}),sharingLevel:Ae({default:"private"}),ownerId:Ae({default:""}),content:Ae({default:""}),createdAt:xt({schema:sn}),updatedAt:xt({nullable:!0,schema:sn}),deletedAt:xt({nullable:!0,schema:sn})}}),proposals:Gn({name:"proposals",columns:{id:Ae({primaryKey:!0}),title:Ae({default:""}),description:Ae({default:""}),type:Ae({default:"general"}),targetId:Ae({nullable:!0}),proposerId:Ae({default:""}),status:Ae({default:"open"}),votesFor:xt({default:0}),votesAgainst:xt({default:0}),createdAt:xt({schema:sn}),closedAt:xt({nullable:!0,schema:sn}),deletedAt:xt({nullable:!0,schema:sn})}}),votes:Gn({name:"votes",columns:{id:Ae({primaryKey:!0}),proposalId:Ae({default:""}),memberId:Ae({default:""}),vote:Ae({default:"abstain"}),createdAt:xt({schema:sn})}}),comments:Gn({name:"comments",columns:{id:Ae({primaryKey:!0}),targetType:Ae({default:"project"}),targetId:Ae({default:""}),authorId:Ae({default:""}),content:Ae({default:""}),createdAt:xt({schema:sn}),updatedAt:xt({nullable:!0,schema:sn}),deletedAt:xt({nullable:!0,schema:sn})}}),collaborators:Gn({name:"collaborators",columns:{id:Ae({primaryKey:!0}),icon:Ae({default:""}),title:Ae({default:""}),description:Ae({default:""}),order:xt({default:0}),createdAt:xt({schema:sn}),updatedAt:xt({nullable:!0,schema:sn}),deletedAt:xt({nullable:!0,schema:sn})}}),uiState:Uoe({name:"uiState",schema:Y({activeSection:oe("projects","notebook","chama","proposals","collaborators","export"),selectedItemId:ie(D,lr),currentMemberId:ie(D,lr)}),default:{id:ip,value:{activeSection:"projects",selectedItemId:null,currentMemberId:null}}})},m3={memberCreated:pn({name:"v1.MemberCreated",schema:Y({id:D,name:D,bio:D,role:oe("founder","member","contributor"),stakeAmount:je,stakeStatus:oe("none","pending","active","withdrawn"),stakedAt:ie(Gt,lr),permissions:oe("read","comment","propose","vote","admin"),createdAt:Gt})}),memberUpdated:pn({name:"v1.MemberUpdated",schema:Y({id:D,name:be(D),bio:be(D),role:be(oe("founder","member","contributor")),stakeAmount:be(je),stakeStatus:be(oe("none","pending","active","withdrawn")),stakedAt:be(ie(Gt,lr)),permissions:be(oe("read","comment","propose","vote","admin")),updatedAt:Gt})}),projectCreated:pn({name:"v1.ProjectCreated",schema:Y({id:D,name:D,status:oe("active","archived"),sharingLevel:oe("private","chama","public"),ownerId:D,origin:D,description:D,learned:D,link:ie(D,lr),linkText:ie(D,lr),createdAt:Gt})}),projectUpdated:pn({name:"v1.ProjectUpdated",schema:Y({id:D,name:be(D),status:be(oe("active","archived")),sharingLevel:be(oe("private","chama","public")),ownerId:be(D),origin:be(D),description:be(D),learned:be(D),link:be(ie(D,lr)),linkText:be(ie(D,lr)),updatedAt:Gt})}),projectDeleted:pn({name:"v1.ProjectDeleted",schema:Y({id:D,deletedAt:Gt})}),notebookEntryCreated:pn({name:"v1.NotebookEntryCreated",schema:Y({id:D,date:D,title:D,type:oe("prototype","sketch","failed","concept","note","thought","reflection"),sharingLevel:oe("private","chama","public"),ownerId:D,content:D,createdAt:Gt})}),notebookEntryUpdated:pn({name:"v1.NotebookEntryUpdated",schema:Y({id:D,date:be(D),title:be(D),type:be(oe("prototype","sketch","failed","concept","note","thought","reflection")),sharingLevel:be(oe("private","chama","public")),ownerId:be(D),content:be(D),updatedAt:Gt})}),notebookEntryDeleted:pn({name:"v1.NotebookEntryDeleted",schema:Y({id:D,deletedAt:Gt})}),proposalCreated:pn({name:"v1.ProposalCreated",schema:Y({id:D,title:D,description:D,type:oe("general","elevate-project","budget","membership"),targetId:ie(D,lr),proposerId:D,status:oe("open","approved","rejected","withdrawn"),createdAt:Gt})}),proposalUpdated:pn({name:"v1.ProposalUpdated",schema:Y({id:D,title:be(D),description:be(D),status:be(oe("open","approved","rejected","withdrawn")),votesFor:be(je),votesAgainst:be(je),closedAt:be(ie(Gt,lr))})}),proposalDeleted:pn({name:"v1.ProposalDeleted",schema:Y({id:D,deletedAt:Gt})}),voteCreated:pn({name:"v1.VoteCreated",schema:Y({id:D,proposalId:D,memberId:D,vote:oe("for","against","abstain"),createdAt:Gt})}),commentCreated:pn({name:"v1.CommentCreated",schema:Y({id:D,targetType:oe("project","notebook","proposal"),targetId:D,authorId:D,content:D,createdAt:Gt})}),commentUpdated:pn({name:"v1.CommentUpdated",schema:Y({id:D,content:be(D),updatedAt:Gt})}),commentDeleted:pn({name:"v1.CommentDeleted",schema:Y({id:D,deletedAt:Gt})}),collaboratorCreated:pn({name:"v1.CollaboratorCreated",schema:Y({id:D,icon:D,title:D,description:D,order:je,createdAt:Gt})}),collaboratorUpdated:pn({name:"v1.CollaboratorUpdated",schema:Y({id:D,icon:be(D),title:be(D),description:be(D),order:be(je),updatedAt:Gt})}),collaboratorDeleted:pn({name:"v1.CollaboratorDeleted",schema:Y({id:D,deletedAt:Gt})}),uiStateSet:Xt.uiState.set},ece=Loe(m3,{"v1.MemberCreated":e=>Xt.members.insert({id:e.id,name:e.name,bio:e.bio,role:e.role,stakeAmount:e.stakeAmount,stakeStatus:e.stakeStatus,stakedAt:e.stakedAt,permissions:e.permissions,createdAt:e.createdAt}),"v1.MemberUpdated":e=>{const t={updatedAt:e.updatedAt};return e.name!==void 0&&(t.name=e.name),e.bio!==void 0&&(t.bio=e.bio),e.role!==void 0&&(t.role=e.role),e.stakeAmount!==void 0&&(t.stakeAmount=e.stakeAmount),e.stakeStatus!==void 0&&(t.stakeStatus=e.stakeStatus),e.stakedAt!==void 0&&(t.stakedAt=e.stakedAt),e.permissions!==void 0&&(t.permissions=e.permissions),Xt.members.update(t).where({id:e.id})},"v1.ProjectCreated":e=>Xt.projects.insert({id:e.id,name:e.name,status:e.status,sharingLevel:e.sharingLevel,ownerId:e.ownerId,origin:e.origin,description:e.description,learned:e.learned,link:e.link,linkText:e.linkText,createdAt:e.createdAt}),"v1.ProjectUpdated":e=>{const t={updatedAt:e.updatedAt};return e.name!==void 0&&(t.name=e.name),e.status!==void 0&&(t.status=e.status),e.sharingLevel!==void 0&&(t.sharingLevel=e.sharingLevel),e.ownerId!==void 0&&(t.ownerId=e.ownerId),e.origin!==void 0&&(t.origin=e.origin),e.description!==void 0&&(t.description=e.description),e.learned!==void 0&&(t.learned=e.learned),e.link!==void 0&&(t.link=e.link),e.linkText!==void 0&&(t.linkText=e.linkText),Xt.projects.update(t).where({id:e.id})},"v1.ProjectDeleted":({id:e,deletedAt:t})=>Xt.projects.update({deletedAt:t}).where({id:e}),"v1.NotebookEntryCreated":e=>Xt.notebookEntries.insert({id:e.id,date:e.date,title:e.title,type:e.type,sharingLevel:e.sharingLevel,ownerId:e.ownerId,content:e.content,createdAt:e.createdAt}),"v1.NotebookEntryUpdated":e=>{const t={updatedAt:e.updatedAt};return e.date!==void 0&&(t.date=e.date),e.title!==void 0&&(t.title=e.title),e.type!==void 0&&(t.type=e.type),e.sharingLevel!==void 0&&(t.sharingLevel=e.sharingLevel),e.ownerId!==void 0&&(t.ownerId=e.ownerId),e.content!==void 0&&(t.content=e.content),Xt.notebookEntries.update(t).where({id:e.id})},"v1.NotebookEntryDeleted":({id:e,deletedAt:t})=>Xt.notebookEntries.update({deletedAt:t}).where({id:e}),"v1.ProposalCreated":e=>Xt.proposals.insert({id:e.id,title:e.title,description:e.description,type:e.type,targetId:e.targetId,proposerId:e.proposerId,status:e.status,votesFor:0,votesAgainst:0,createdAt:e.createdAt}),"v1.ProposalUpdated":e=>{const t={};return e.title!==void 0&&(t.title=e.title),e.description!==void 0&&(t.description=e.description),e.status!==void 0&&(t.status=e.status),e.votesFor!==void 0&&(t.votesFor=e.votesFor),e.votesAgainst!==void 0&&(t.votesAgainst=e.votesAgainst),e.closedAt!==void 0&&(t.closedAt=e.closedAt),Xt.proposals.update(t).where({id:e.id})},"v1.ProposalDeleted":({id:e,deletedAt:t})=>Xt.proposals.update({deletedAt:t}).where({id:e}),"v1.VoteCreated":e=>Xt.votes.insert({id:e.id,proposalId:e.proposalId,memberId:e.memberId,vote:e.vote,createdAt:e.createdAt}),"v1.CommentCreated":e=>Xt.comments.insert({id:e.id,targetType:e.targetType,targetId:e.targetId,authorId:e.authorId,content:e.content,createdAt:e.createdAt}),"v1.CommentUpdated":e=>{const t={updatedAt:e.updatedAt};return e.content!==void 0&&(t.content=e.content),Xt.comments.update(t).where({id:e.id})},"v1.CommentDeleted":({id:e,deletedAt:t})=>Xt.comments.update({deletedAt:t}).where({id:e}),"v1.CollaboratorCreated":e=>Xt.collaborators.insert({id:e.id,icon:e.icon,title:e.title,description:e.description,order:e.order,createdAt:e.createdAt}),"v1.CollaboratorUpdated":e=>{const t={updatedAt:e.updatedAt};return e.icon!==void 0&&(t.icon=e.icon),e.title!==void 0&&(t.title=e.title),e.description!==void 0&&(t.description=e.description),e.order!==void 0&&(t.order=e.order),Xt.collaborators.update(t).where({id:e.id})},"v1.CollaboratorDeleted":({id:e,deletedAt:t})=>Xt.collaborators.update({deletedAt:t}).where({id:e})}),tce=Goe({tables:Xt,materializers:ece}),nce=Woe({events:m3,state:tce});Bae({schema:nce,sync:{backend:Xae({url:void 0}),initialSyncOptions:{_tag:"Blocking",timeout:5e3}}});
